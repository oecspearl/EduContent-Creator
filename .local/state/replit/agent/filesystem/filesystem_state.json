{"file_contents":{"client/src/components/ui/label.tsx":{"content":"import * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst labelVariants = cva(\n  \"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n)\n\nconst Label = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &\n    VariantProps<typeof labelVariants>\n>(({ className, ...props }, ref) => (\n  <LabelPrimitive.Root\n    ref={ref}\n    className={cn(labelVariants(), className)}\n    {...props}\n  />\n))\nLabel.displayName = LabelPrimitive.Root.displayName\n\nexport { Label }\n","size_bytes":710},"client/src/components/players/ImageHotspotPlayer.tsx":{"content":"import { useState, useEffect, useRef } from \"react\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { X } from \"lucide-react\";\nimport type { ImageHotspotData } from \"@shared/schema\";\nimport { useProgressTracker } from \"@/hooks/use-progress-tracker\";\n\ntype ImageHotspotPlayerProps = {\n  data: ImageHotspotData;\n  contentId: string;\n};\n\nexport function ImageHotspotPlayer({ data, contentId }: ImageHotspotPlayerProps) {\n  const [selectedHotspot, setSelectedHotspot] = useState<number | null>(null);\n  const [viewedHotspots, setViewedHotspots] = useState<Set<string>>(new Set());\n\n  const { progress: savedProgress, isProgressFetched, updateProgress, logInteraction, isAuthenticated } = useProgressTracker(contentId);\n  const [lastSentProgress, setLastSentProgress] = useState<number>(-1);\n  const [isProgressInitialized, setIsProgressInitialized] = useState(false);\n  const pendingMilestoneRef = useRef<number | null>(null);\n  const pendingTimeoutRef = useRef<NodeJS.Timeout | null>(null);\n  const previousAuthRef = useRef<boolean>(isAuthenticated);\n\n  // Reset initialization when auth changes from false → true\n  useEffect(() => {\n    if (!previousAuthRef.current && isAuthenticated) {\n      // User just logged in - reset to wait for progress fetch\n      setIsProgressInitialized(false);\n      setLastSentProgress(-1);\n      pendingMilestoneRef.current = null;\n      if (pendingTimeoutRef.current) {\n        clearTimeout(pendingTimeoutRef.current);\n        pendingTimeoutRef.current = null;\n      }\n    }\n    previousAuthRef.current = isAuthenticated;\n  }, [isAuthenticated]);\n\n  // Initialize from persisted progress and reconcile when savedProgress updates\n  useEffect(() => {\n    if (!isProgressInitialized) {\n      if (!isAuthenticated) {\n        setIsProgressInitialized(true);\n      } else if (isProgressFetched) {\n        if (savedProgress) {\n          setLastSentProgress(savedProgress.completionPercentage);\n        }\n        setIsProgressInitialized(true);\n      }\n    } else if (savedProgress) {\n      // After initialization, reconcile: server can only raise, never lower\n      // Only update if savedProgress is truthy (skip null refetches)\n      setLastSentProgress(prev => Math.max(prev, savedProgress.completionPercentage));\n      // Clear pending milestone if it's been saved\n      if (pendingMilestoneRef.current !== null && savedProgress.completionPercentage >= pendingMilestoneRef.current) {\n        pendingMilestoneRef.current = null;\n        if (pendingTimeoutRef.current) {\n          clearTimeout(pendingTimeoutRef.current);\n          pendingTimeoutRef.current = null;\n        }\n      }\n    }\n  }, [savedProgress, isProgressFetched, isAuthenticated, isProgressInitialized]);\n\n  // Track hotspot views and update progress (monotonic, only after initialization)\n  useEffect(() => {\n    if (!isProgressInitialized || !isAuthenticated) return;\n    \n    if (selectedHotspot !== null) {\n      const hotspot = data.hotspots[selectedHotspot];\n      if (!viewedHotspots.has(hotspot.id)) {\n        const newViewedHotspots = new Set(viewedHotspots).add(hotspot.id);\n        setViewedHotspots(newViewedHotspots);\n\n        // Update progress based on hotspots viewed (only if higher and not pending)\n        const completionPercentage = Math.round((newViewedHotspots.size / data.hotspots.length) * 100);\n        if (completionPercentage > lastSentProgress && completionPercentage !== pendingMilestoneRef.current) {\n          pendingMilestoneRef.current = completionPercentage;\n          updateProgress(completionPercentage);\n          // Clear pending after 5 seconds to allow retry on failure\n          if (pendingTimeoutRef.current) {\n            clearTimeout(pendingTimeoutRef.current);\n          }\n          pendingTimeoutRef.current = setTimeout(() => {\n            pendingMilestoneRef.current = null;\n            pendingTimeoutRef.current = null;\n          }, 5000);\n        }\n\n        // Log interaction\n        logInteraction(\"hotspot_viewed\", {\n          hotspotId: hotspot.id,\n          hotspotTitle: hotspot.id,\n        });\n      }\n    }\n  }, [selectedHotspot, lastSentProgress, isProgressInitialized, isAuthenticated]);\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Image with Hotspots */}\n      <Card>\n        <CardContent className=\"p-0\">\n          <div className=\"relative bg-muted\" style={{ aspectRatio: \"16/9\" }}>\n            <img\n              src={data.imageUrl}\n              alt=\"Interactive image\"\n              className=\"w-full h-full object-contain\"\n              data-testid=\"hotspot-image\"\n            />\n\n            {/* Hotspot Points */}\n            {data.hotspots.map((hotspot, index) => (\n              <div\n                key={hotspot.id}\n                className=\"absolute w-8 h-8 bg-primary rounded-full border-4 border-primary-foreground cursor-pointer transform -translate-x-1/2 -translate-y-1/2 hover-elevate transition-all z-10\"\n                style={{\n                  left: `${hotspot.x}%`,\n                  top: `${hotspot.y}%`,\n                }}\n                onClick={() => setSelectedHotspot(selectedHotspot === index ? null : index)}\n                data-testid={`hotspot-point-${index}`}\n              >\n                <div className=\"absolute inset-0 flex items-center justify-center text-primary-foreground font-bold text-sm\">\n                  {index + 1}\n                </div>\n              </div>\n            ))}\n\n            {/* Hotspot Popup */}\n            {selectedHotspot !== null && (\n              <div\n                className=\"absolute bg-card border rounded-lg shadow-lg p-4 max-w-xs z-20\"\n                style={{\n                  left: `${data.hotspots[selectedHotspot].x}%`,\n                  top: `${data.hotspots[selectedHotspot].y}%`,\n                  transform: \"translate(20px, -50%)\",\n                }}\n                data-testid={`hotspot-popup-${selectedHotspot}`}\n              >\n                <button\n                  className=\"absolute top-2 right-2 p-1 rounded hover-elevate\"\n                  onClick={(e) => {\n                    e.stopPropagation();\n                    setSelectedHotspot(null);\n                  }}\n                  data-testid=\"button-close-popup\"\n                >\n                  <X className=\"h-4 w-4\" />\n                </button>\n                <h4 className=\"font-semibold mb-2\">{data.hotspots[selectedHotspot].title}</h4>\n                <p className=\"text-sm text-muted-foreground\">{data.hotspots[selectedHotspot].description}</p>\n              </div>\n            )}\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Hotspot List */}\n      <Card>\n        <CardContent className=\"pt-6\">\n          <h3 className=\"font-semibold mb-4\">Hotspots ({data.hotspots.length})</h3>\n          <div className=\"space-y-3\">\n            {data.hotspots.map((hotspot, index) => (\n              <div\n                key={hotspot.id}\n                className={`p-4 rounded-lg border cursor-pointer transition-all hover-elevate ${\n                  selectedHotspot === index ? \"border-primary bg-primary/5\" : \"\"\n                }`}\n                onClick={() => setSelectedHotspot(selectedHotspot === index ? null : index)}\n                data-testid={`hotspot-list-${index}`}\n              >\n                <div className=\"flex items-start gap-3\">\n                  <div className=\"flex-shrink-0 w-6 h-6 bg-primary rounded-full flex items-center justify-center text-primary-foreground text-xs font-bold\">\n                    {index + 1}\n                  </div>\n                  <div className=\"flex-1\">\n                    <h4 className=\"font-medium mb-1\">{hotspot.title}</h4>\n                    <p className=\"text-sm text-muted-foreground\">{hotspot.description}</p>\n                  </div>\n                </div>\n              </div>\n            ))}\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":7893},"client/src/pages/QuizCreator.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useParams, useLocation } from \"wouter\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { AIGenerationModal } from \"@/components/AIGenerationModal\";\nimport { Breadcrumbs } from \"@/components/Breadcrumbs\";\nimport { useBreadcrumbs } from \"@/hooks/useBreadcrumbs\";\nimport { \n  ArrowLeft, \n  Save, \n  Sparkles, \n  Plus, \n  Trash2, \n  GripVertical, \n  Settings,\n  Eye,\n  Globe\n} from \"lucide-react\";\nimport type { H5pContent, QuizData, QuizQuestion } from \"@shared/schema\";\nimport ShareToClassroomDialog from \"@/components/ShareToClassroomDialog\";\n\nexport default function QuizCreator() {\n  const params = useParams();\n  const [_, navigate] = useLocation();\n  const { toast } = useToast();\n  const contentId = params.id;\n  const isEditing = !!contentId;\n\n  const [title, setTitle] = useState(\"\");\n  const [description, setDescription] = useState(\"\");\n  const [questions, setQuestions] = useState<QuizQuestion[]>([]);\n  const [settings, setSettings] = useState({\n    shuffleQuestions: false,\n    showCorrectAnswers: true,\n    allowRetry: true,\n    timeLimit: undefined as number | undefined,\n  });\n  const [isPublished, setIsPublished] = useState(false);\n  const [isPublic, setIsPublic] = useState(false);\n  const [showAIModal, setShowAIModal] = useState(false);\n  const [showSettings, setShowSettings] = useState(false);\n  const [isSaving, setIsSaving] = useState(false);\n\n  const { data: content } = useQuery<H5pContent>({\n    queryKey: [\"/api/content\", contentId],\n    enabled: isEditing,\n  });\n\n  useEffect(() => {\n    if (content && content.type === \"quiz\") {\n      setTitle(content.title);\n      setDescription(content.description || \"\");\n      const quizData = content.data as QuizData;\n      setQuestions(quizData.questions || []);\n      setSettings({\n        shuffleQuestions: quizData.settings?.shuffleQuestions ?? false,\n        showCorrectAnswers: quizData.settings?.showCorrectAnswers ?? true,\n        allowRetry: quizData.settings?.allowRetry ?? true,\n        timeLimit: quizData.settings?.timeLimit,\n      });\n      setIsPublished(content.isPublished);\n      setIsPublic(content.isPublic || false);\n    }\n  }, [content]);\n\n  const saveMutation = useMutation({\n    mutationFn: async (publish: boolean = false) => {\n      const data: QuizData = { questions, settings };\n      \n      if (isEditing) {\n        const response = await apiRequest(\"PUT\", `/api/content/${contentId}`, {\n          title,\n          description,\n          data,\n          isPublished: publish,\n          isPublic,\n        });\n        return await response.json();\n      } else {\n        const response = await apiRequest(\"POST\", \"/api/content\", {\n          title,\n          description,\n          type: \"quiz\",\n          data,\n          isPublished: publish,\n          isPublic,\n        });\n        return await response.json();\n      }\n    },\n    onSuccess: (data) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/content\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/content/public\"] });\n      if (!isEditing) {\n        navigate(`/create/quiz/${data.id}`);\n      }\n      toast({ title: \"Saved!\", description: \"Quiz saved successfully.\" });\n      setIsSaving(false);\n    },\n  });\n\n  useEffect(() => {\n    if (!title || questions.length === 0) return;\n    \n    const timer = setTimeout(() => {\n      setIsSaving(true);\n      saveMutation.mutate(isPublished);\n    }, 2000);\n\n    return () => clearTimeout(timer);\n  }, [title, description, questions, settings, isPublic]);\n\n  const addQuestion = () => {\n    const newQuestion: QuizQuestion = {\n      id: Date.now().toString(),\n      type: \"multiple-choice\",\n      question: \"\",\n      options: [\"\", \"\", \"\", \"\"],\n      correctAnswer: 0,\n      explanation: \"\",\n    };\n    setQuestions([...questions, newQuestion]);\n  };\n\n  const updateQuestion = (index: number, updates: Partial<QuizQuestion>) => {\n    const updated = [...questions];\n    updated[index] = { ...updated[index], ...updates };\n    setQuestions(updated);\n  };\n\n  const removeQuestion = (index: number) => {\n    setQuestions(questions.filter((_, i) => i !== index));\n  };\n\n  const handleAIGenerated = (data: any) => {\n    if (data.questions) {\n      setQuestions(prev => [...prev, ...data.questions]);\n    }\n  };\n\n  const handlePublish = async () => {\n    setIsPublished(!isPublished);\n    await saveMutation.mutateAsync(!isPublished);\n    toast({\n      title: isPublished ? \"Unpublished\" : \"Published!\",\n      description: isPublished\n        ? \"Quiz is now private.\"\n        : \"Quiz is now publicly accessible via share link.\",\n    });\n  };\n\n  const breadcrumbs = useBreadcrumbs(contentId);\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      {/* Toolbar */}\n      <div className=\"sticky top-0 z-10 bg-card/95 backdrop-blur border-b\">\n        <div className=\"max-w-7xl mx-auto px-6 h-14 flex items-center justify-between\">\n          <div className=\"flex items-center gap-4\">\n            <Button variant=\"ghost\" size=\"icon\" onClick={() => navigate(\"/\")} data-testid=\"button-back\">\n              <ArrowLeft className=\"h-5 w-5\" />\n            </Button>\n            <div className=\"flex items-center gap-2\">\n              <h1 className=\"text-lg font-semibold\">Quiz Creator</h1>\n              {isSaving && <Badge variant=\"outline\">Saving...</Badge>}\n            </div>\n          </div>\n          <div className=\"flex items-center gap-2\">\n            <Button variant=\"outline\" size=\"sm\" onClick={() => setShowSettings(!showSettings)} data-testid=\"button-settings\">\n              <Settings className=\"h-4 w-4 mr-1\" />\n              Settings\n            </Button>\n            <Button variant=\"outline\" size=\"sm\" onClick={() => setShowAIModal(true)} data-testid=\"button-ai-generate\">\n              <Sparkles className=\"h-4 w-4 mr-1\" />\n              AI Generate\n            </Button>\n            {contentId && isPublished && (\n              <ShareToClassroomDialog\n                contentTitle={title}\n                contentDescription={description}\n                materialLink={`${window.location.origin}/public/${contentId}`}\n              />\n            )}\n            <Button\n              variant={isPublished ? \"outline\" : \"default\"}\n              size=\"sm\"\n              onClick={handlePublish}\n              disabled={!title || questions.length === 0}\n              data-testid=\"button-publish\"\n            >\n              <Globe className=\"h-4 w-4 mr-1\" />\n              {isPublished ? \"Unpublish\" : \"Publish\"}\n            </Button>\n          </div>\n        </div>\n      </div>\n\n      {/* Breadcrumbs */}\n      <div className=\"bg-background border-b\">\n        <div className=\"max-w-7xl mx-auto px-6 py-3\">\n          <Breadcrumbs items={breadcrumbs} />\n        </div>\n      </div>\n\n      <div className=\"max-w-7xl mx-auto px-6 py-8\">\n        <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-8\">\n          {/* Main Editor */}\n          <div className=\"lg:col-span-2 space-y-6\">\n            {/* Title & Description */}\n            <Card>\n              <CardHeader>\n                <CardTitle>Quiz Details</CardTitle>\n              </CardHeader>\n              <CardContent className=\"space-y-4\">\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"title\">Title *</Label>\n                  <Input\n                    id=\"title\"\n                    placeholder=\"e.g., World War II Quiz\"\n                    value={title}\n                    onChange={(e) => setTitle(e.target.value)}\n                    data-testid=\"input-title\"\n                  />\n                </div>\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"description\">Description (Optional)</Label>\n                  <Textarea\n                    id=\"description\"\n                    placeholder=\"Brief description of this quiz...\"\n                    value={description}\n                    onChange={(e) => setDescription(e.target.value)}\n                    className=\"h-20 resize-none\"\n                    data-testid=\"textarea-description\"\n                  />\n                </div>\n                <div className=\"flex items-center justify-between p-4 bg-muted/50 rounded-lg\">\n                  <div className=\"space-y-0.5\">\n                    <Label htmlFor=\"isPublic\" className=\"text-base\">Share as Public Resource</Label>\n                    <p className=\"text-sm text-muted-foreground\">\n                      Allow other teachers to discover and use this quiz on the Shared Resources page. Content will be automatically published when shared.\n                    </p>\n                  </div>\n                  <Switch\n                    id=\"isPublic\"\n                    checked={isPublic}\n                    onCheckedChange={(checked) => {\n                      setIsPublic(checked);\n                      if (checked) {\n                        setIsPublished(true);\n                      }\n                    }}\n                    data-testid=\"switch-public\"\n                  />\n                </div>\n              </CardContent>\n            </Card>\n\n            {/* Questions */}\n            <div className=\"space-y-4\">\n              <div className=\"flex items-center justify-between\">\n                <h3 className=\"text-lg font-semibold\">Questions ({questions.length})</h3>\n                <Button onClick={addQuestion} size=\"sm\" data-testid=\"button-add-question\">\n                  <Plus className=\"h-4 w-4 mr-1\" />\n                  Add Question\n                </Button>\n              </div>\n\n              {questions.length === 0 ? (\n                <Card className=\"text-center py-12\">\n                  <CardContent>\n                    <p className=\"text-muted-foreground mb-4\">No questions yet. Add your first question to get started.</p>\n                    <Button onClick={addQuestion} data-testid=\"button-add-first-question\">\n                      <Plus className=\"h-4 w-4 mr-2\" />\n                      Add Question\n                    </Button>\n                  </CardContent>\n                </Card>\n              ) : (\n                questions.map((question, index) => (\n                  <Card key={question.id} data-testid={`question-${index}`}>\n                    <CardHeader>\n                      <div className=\"flex items-start gap-3\">\n                        <GripVertical className=\"h-5 w-5 text-muted-foreground mt-1 cursor-move\" />\n                        <div className=\"flex-1 space-y-4\">\n                          <div className=\"flex items-start justify-between gap-4\">\n                            <div className=\"flex-1\">\n                              <Label>Question {index + 1}</Label>\n                              <Textarea\n                                placeholder=\"Enter your question...\"\n                                value={question.question}\n                                onChange={(e) => updateQuestion(index, { question: e.target.value })}\n                                className=\"mt-2 resize-none\"\n                                data-testid={`input-question-${index}`}\n                              />\n                            </div>\n                            <div className=\"flex flex-col gap-2\">\n                              <Select\n                                value={question.type}\n                                onValueChange={(value: any) => {\n                                  const updates: Partial<QuizQuestion> = { type: value };\n                                  if (value === \"true-false\") {\n                                    updates.options = undefined;\n                                    updates.correctAnswer = \"true\";\n                                  } else if (value === \"multiple-choice\" && !question.options) {\n                                    updates.options = [\"\", \"\", \"\", \"\"];\n                                    updates.correctAnswer = 0;\n                                  }\n                                  updateQuestion(index, updates);\n                                }}\n                              >\n                                <SelectTrigger className=\"w-40\" data-testid={`select-type-${index}`}>\n                                  <SelectValue />\n                                </SelectTrigger>\n                                <SelectContent>\n                                  <SelectItem value=\"multiple-choice\">Multiple Choice</SelectItem>\n                                  <SelectItem value=\"true-false\">True/False</SelectItem>\n                                  <SelectItem value=\"fill-blank\">Fill in Blank</SelectItem>\n                                </SelectContent>\n                              </Select>\n                              <Button\n                                variant=\"destructive\"\n                                size=\"icon\"\n                                onClick={() => removeQuestion(index)}\n                                data-testid={`button-delete-${index}`}\n                              >\n                                <Trash2 className=\"h-4 w-4\" />\n                              </Button>\n                            </div>\n                          </div>\n\n                          {/* Answer Options */}\n                          {question.type === \"multiple-choice\" && question.options && (\n                            <div className=\"space-y-2\">\n                              <Label>Answer Options</Label>\n                              {question.options.map((option, optIndex) => (\n                                <div key={optIndex} className=\"flex items-center gap-2\">\n                                  <Input\n                                    placeholder={`Option ${optIndex + 1}`}\n                                    value={option}\n                                    onChange={(e) => {\n                                      const newOptions = [...question.options!];\n                                      newOptions[optIndex] = e.target.value;\n                                      updateQuestion(index, { options: newOptions });\n                                    }}\n                                    data-testid={`input-option-${index}-${optIndex}`}\n                                  />\n                                  <Button\n                                    variant={question.correctAnswer === optIndex ? \"default\" : \"outline\"}\n                                    size=\"sm\"\n                                    onClick={() => updateQuestion(index, { correctAnswer: optIndex })}\n                                    data-testid={`button-correct-${index}-${optIndex}`}\n                                  >\n                                    {question.correctAnswer === optIndex ? \"Correct\" : \"Mark Correct\"}\n                                  </Button>\n                                </div>\n                              ))}\n                            </div>\n                          )}\n\n                          {question.type === \"true-false\" && (\n                            <div className=\"flex gap-2\">\n                              <Button\n                                variant={question.correctAnswer === \"true\" ? \"default\" : \"outline\"}\n                                onClick={() => updateQuestion(index, { correctAnswer: \"true\" })}\n                                data-testid={`button-true-${index}`}\n                              >\n                                True\n                              </Button>\n                              <Button\n                                variant={question.correctAnswer === \"false\" ? \"default\" : \"outline\"}\n                                onClick={() => updateQuestion(index, { correctAnswer: \"false\" })}\n                                data-testid={`button-false-${index}`}\n                              >\n                                False\n                              </Button>\n                            </div>\n                          )}\n\n                          {question.type === \"fill-blank\" && (\n                            <div>\n                              <Label>Correct Answer</Label>\n                              <Input\n                                placeholder=\"Enter the correct answer...\"\n                                value={question.correctAnswer as string}\n                                onChange={(e) => updateQuestion(index, { correctAnswer: e.target.value })}\n                                data-testid={`input-answer-${index}`}\n                              />\n                            </div>\n                          )}\n\n                          {/* Explanation */}\n                          <div>\n                            <Label>Explanation (Optional)</Label>\n                            <Textarea\n                              placeholder=\"Explain the answer...\"\n                              value={question.explanation || \"\"}\n                              onChange={(e) => updateQuestion(index, { explanation: e.target.value })}\n                              className=\"mt-2 h-16 resize-none\"\n                              data-testid={`textarea-explanation-${index}`}\n                            />\n                          </div>\n                        </div>\n                      </div>\n                    </CardHeader>\n                  </Card>\n                ))\n              )}\n            </div>\n          </div>\n\n          {/* Settings Panel */}\n          {showSettings && (\n            <div className=\"lg:col-span-1\">\n              <Card className=\"sticky top-20\">\n                <CardHeader>\n                  <CardTitle>Quiz Settings</CardTitle>\n                </CardHeader>\n                <CardContent className=\"space-y-6\">\n                  <div className=\"flex items-center justify-between\">\n                    <Label htmlFor=\"shuffle\">Shuffle Questions</Label>\n                    <Switch\n                      id=\"shuffle\"\n                      checked={settings.shuffleQuestions}\n                      onCheckedChange={(checked) => setSettings({ ...settings, shuffleQuestions: checked })}\n                      data-testid=\"switch-shuffle\"\n                    />\n                  </div>\n                  <div className=\"flex items-center justify-between\">\n                    <Label htmlFor=\"showAnswers\">Show Correct Answers</Label>\n                    <Switch\n                      id=\"showAnswers\"\n                      checked={settings.showCorrectAnswers}\n                      onCheckedChange={(checked) => setSettings({ ...settings, showCorrectAnswers: checked })}\n                      data-testid=\"switch-show-answers\"\n                    />\n                  </div>\n                  <div className=\"flex items-center justify-between\">\n                    <Label htmlFor=\"retry\">Allow Retry</Label>\n                    <Switch\n                      id=\"retry\"\n                      checked={settings.allowRetry}\n                      onCheckedChange={(checked) => setSettings({ ...settings, allowRetry: checked })}\n                      data-testid=\"switch-retry\"\n                    />\n                  </div>\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"timeLimit\">Time Limit (minutes)</Label>\n                    <Input\n                      id=\"timeLimit\"\n                      type=\"number\"\n                      min=\"0\"\n                      placeholder=\"No limit\"\n                      value={settings.timeLimit || \"\"}\n                      onChange={(e) =>\n                        setSettings({ ...settings, timeLimit: e.target.value ? parseInt(e.target.value) : undefined })\n                      }\n                      data-testid=\"input-time-limit\"\n                    />\n                  </div>\n                </CardContent>\n              </Card>\n            </div>\n          )}\n        </div>\n      </div>\n\n      <AIGenerationModal\n        open={showAIModal}\n        onOpenChange={setShowAIModal}\n        contentType=\"quiz\"\n        onGenerated={handleAIGenerated}\n      />\n    </div>\n  );\n}\n","size_bytes":20594},"client/src/components/ui/separator.tsx":{"content":"import * as React from \"react\"\nimport * as SeparatorPrimitive from \"@radix-ui/react-separator\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Separator = React.forwardRef<\n  React.ElementRef<typeof SeparatorPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>\n>(\n  (\n    { className, orientation = \"horizontal\", decorative = true, ...props },\n    ref\n  ) => (\n    <SeparatorPrimitive.Root\n      ref={ref}\n      decorative={decorative}\n      orientation={orientation}\n      className={cn(\n        \"shrink-0 bg-border\",\n        orientation === \"horizontal\" ? \"h-[1px] w-full\" : \"h-full w-[1px]\",\n        className\n      )}\n      {...props}\n    />\n  )\n)\nSeparator.displayName = SeparatorPrimitive.Root.displayName\n\nexport { Separator }\n","size_bytes":756},"client/src/lib/queryClient.ts":{"content":"import { QueryClient, QueryFunction } from \"@tanstack/react-query\";\n\nasync function throwIfResNotOk(res: Response) {\n  if (!res.ok) {\n    const text = (await res.text()) || res.statusText;\n    throw new Error(`${res.status}: ${text}`);\n  }\n}\n\nexport async function apiRequest(\n  method: string,\n  url: string,\n  data?: unknown | undefined,\n): Promise<Response> {\n  const res = await fetch(url, {\n    method,\n    headers: data ? { \"Content-Type\": \"application/json\" } : {},\n    body: data ? JSON.stringify(data) : undefined,\n    credentials: \"include\",\n  });\n\n  await throwIfResNotOk(res);\n  return res;\n}\n\ntype UnauthorizedBehavior = \"returnNull\" | \"throw\";\nexport const getQueryFn: <T>(options: {\n  on401: UnauthorizedBehavior;\n}) => QueryFunction<T> =\n  ({ on401: unauthorizedBehavior }) =>\n  async ({ queryKey }) => {\n    // Handle query params: queryKey can be [url] or [url, {params}]\n    let url: string;\n    if (queryKey.length === 1) {\n      url = queryKey[0] as string;\n    } else if (queryKey.length === 2 && typeof queryKey[1] === 'object' && queryKey[1] !== null) {\n      const baseUrl = queryKey[0] as string;\n      const params = queryKey[1] as Record<string, string>;\n      const queryParams = new URLSearchParams(params);\n      const queryString = queryParams.toString();\n      url = queryString ? `${baseUrl}?${queryString}` : baseUrl;\n    } else {\n      url = queryKey.join(\"/\") as string;\n    }\n\n    const res = await fetch(url, {\n      credentials: \"include\",\n    });\n\n    if (unauthorizedBehavior === \"returnNull\" && res.status === 401) {\n      return null;\n    }\n\n    await throwIfResNotOk(res);\n    return await res.json();\n  };\n\nexport const queryClient = new QueryClient({\n  defaultOptions: {\n    queries: {\n      queryFn: getQueryFn({ on401: \"throw\" }),\n      refetchInterval: false,\n      refetchOnWindowFocus: false,\n      staleTime: Infinity,\n      retry: false,\n    },\n    mutations: {\n      retry: false,\n    },\n  },\n});\n","size_bytes":1952},"shared/schema.ts":{"content":"import { sql } from \"drizzle-orm\";\nimport { pgTable, text, varchar, boolean, jsonb, timestamp, integer, real, unique } from \"drizzle-orm/pg-core\";\nimport { createInsertSchema } from \"drizzle-zod\";\nimport { z } from \"zod\";\n\n// Profiles table\nexport const profiles = pgTable(\"profiles\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  email: text(\"email\").notNull().unique(),\n  password: text(\"password\"), // Nullable for OAuth users\n  fullName: text(\"full_name\").notNull(),\n  role: text(\"role\").notNull().default(\"teacher\"),\n  institution: text(\"institution\"),\n  authProvider: text(\"auth_provider\").default(\"email\"), // 'email' | 'google' | 'microsoft'\n  googleId: text(\"google_id\"),\n  microsoftId: text(\"microsoft_id\"),\n  googleAccessToken: text(\"google_access_token\"), // For Google Slides API access\n  googleRefreshToken: text(\"google_refresh_token\"), // For refreshing access tokens\n  googleTokenExpiry: timestamp(\"google_token_expiry\"), // When the access token expires\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n  updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n});\n\n// H5P Content table\nexport const h5pContent = pgTable(\"h5p_content\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  title: text(\"title\").notNull(),\n  description: text(\"description\"),\n  type: text(\"type\").notNull(), // 'quiz' | 'flashcard' | 'interactive-video' | 'image-hotspot'\n  data: jsonb(\"data\").notNull(), // stores full content structure\n  userId: varchar(\"user_id\").notNull().references(() => profiles.id, { onDelete: \"cascade\" }),\n  isPublished: boolean(\"is_published\").default(false).notNull(),\n  isPublic: boolean(\"is_public\").default(false).notNull(), // Share with other teachers\n  tags: text(\"tags\").array(),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n  updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n});\n\n// Content shares table\nexport const contentShares = pgTable(\"content_shares\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  contentId: varchar(\"content_id\").notNull().references(() => h5pContent.id, { onDelete: \"cascade\" }),\n  sharedBy: varchar(\"shared_by\").notNull().references(() => profiles.id, { onDelete: \"cascade\" }),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\n// Learner progress table - tracks overall completion for each content item\nexport const learnerProgress = pgTable(\"learner_progress\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").notNull().references(() => profiles.id, { onDelete: \"cascade\" }),\n  contentId: varchar(\"content_id\").notNull().references(() => h5pContent.id, { onDelete: \"cascade\" }),\n  completionPercentage: real(\"completion_percentage\").notNull().default(0), // 0-100\n  completedAt: timestamp(\"completed_at\"),\n  lastAccessedAt: timestamp(\"last_accessed_at\").defaultNow().notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n  updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n}, (table) => ({\n  uniqueUserContent: unique().on(table.userId, table.contentId),\n}));\n\n// Quiz attempts table - stores individual quiz attempt details\nexport const quizAttempts = pgTable(\"quiz_attempts\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").notNull().references(() => profiles.id, { onDelete: \"cascade\" }),\n  contentId: varchar(\"content_id\").notNull().references(() => h5pContent.id, { onDelete: \"cascade\" }),\n  score: integer(\"score\").notNull(), // Number of correct answers\n  totalQuestions: integer(\"total_questions\").notNull(),\n  answers: jsonb(\"answers\").notNull(), // Array of {questionId, answer, isCorrect}\n  completedAt: timestamp(\"completed_at\").defaultNow().notNull(),\n});\n\n// Interaction events table - stores granular interaction data\nexport const interactionEvents = pgTable(\"interaction_events\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").notNull().references(() => profiles.id, { onDelete: \"cascade\" }),\n  contentId: varchar(\"content_id\").notNull().references(() => h5pContent.id, { onDelete: \"cascade\" }),\n  eventType: text(\"event_type\").notNull(), // 'card_flipped', 'hotspot_completed', 'video_paused', etc.\n  eventData: jsonb(\"event_data\"), // Additional contextual data\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\n// Chat messages table - stores AI assistant conversation history\nexport const chatMessages = pgTable(\"chat_messages\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").notNull().references(() => profiles.id, { onDelete: \"cascade\" }),\n  role: text(\"role\").notNull(), // 'user' | 'assistant' | 'system'\n  content: text(\"content\").notNull(),\n  context: jsonb(\"context\"), // User's current context (page, content being viewed, etc.)\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\n// Zod schemas\nexport const insertProfileSchema = createInsertSchema(profiles).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertH5pContentSchema = createInsertSchema(h5pContent).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertContentShareSchema = createInsertSchema(contentShares).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertLearnerProgressSchema = createInsertSchema(learnerProgress).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n}).extend({\n  completionPercentage: z.number().min(0).max(100),\n  completedAt: z.date().optional().nullable(),\n  lastAccessedAt: z.date(),\n});\n\nexport const insertQuizAttemptSchema = createInsertSchema(quizAttempts).omit({\n  id: true,\n  completedAt: true,\n}).extend({\n  score: z.number().int().min(0),\n  totalQuestions: z.number().int().min(1),\n  answers: z.array(z.object({\n    questionId: z.string(),\n    answer: z.union([z.string(), z.number(), z.boolean()]),\n    isCorrect: z.boolean(),\n  })),\n});\n\nexport const insertInteractionEventSchema = createInsertSchema(interactionEvents).omit({\n  id: true,\n  createdAt: true,\n}).extend({\n  eventType: z.string().min(1),\n  eventData: z.record(z.any()).optional().nullable(),\n});\n\nexport const insertChatMessageSchema = createInsertSchema(chatMessages).omit({\n  id: true,\n  createdAt: true,\n}).extend({\n  role: z.enum([\"user\", \"assistant\", \"system\"]),\n  content: z.string().min(1),\n  context: z.record(z.any()).optional().nullable(),\n});\n\n// Types\nexport type Profile = typeof profiles.$inferSelect;\nexport type InsertProfile = z.infer<typeof insertProfileSchema>;\nexport type H5pContent = typeof h5pContent.$inferSelect;\nexport type InsertH5pContent = z.infer<typeof insertH5pContentSchema>;\nexport type ContentShare = typeof contentShares.$inferSelect;\nexport type InsertContentShare = z.infer<typeof insertContentShareSchema>;\nexport type LearnerProgress = typeof learnerProgress.$inferSelect;\nexport type InsertLearnerProgress = z.infer<typeof insertLearnerProgressSchema>;\nexport type QuizAttempt = typeof quizAttempts.$inferSelect;\nexport type InsertQuizAttempt = z.infer<typeof insertQuizAttemptSchema>;\nexport type InteractionEvent = typeof interactionEvents.$inferSelect;\nexport type InsertInteractionEvent = z.infer<typeof insertInteractionEventSchema>;\nexport type ChatMessage = typeof chatMessages.$inferSelect;\nexport type InsertChatMessage = z.infer<typeof insertChatMessageSchema>;\n\n// Content type definitions\nexport type ContentType = \"quiz\" | \"flashcard\" | \"interactive-video\" | \"image-hotspot\" | \"drag-drop\" | \"fill-blanks\" | \"memory-game\" | \"interactive-book\" | \"video-finder\" | \"google-slides\";\n\nexport type QuizQuestion = {\n  id: string;\n  type: \"multiple-choice\" | \"true-false\" | \"fill-blank\";\n  question: string;\n  options?: string[]; // for multiple-choice\n  correctAnswer: string | number; // index for multiple-choice, \"true\"/\"false\" for true-false, string for fill-blank\n  explanation?: string;\n};\n\nexport type QuizData = {\n  questions: QuizQuestion[];\n  settings: {\n    shuffleQuestions: boolean;\n    showCorrectAnswers: boolean;\n    allowRetry: boolean;\n    timeLimit?: number; // in minutes\n  };\n};\n\nexport type FlashcardData = {\n  cards: Array<{\n    id: string;\n    front: string;\n    back: string;\n    category?: string;\n    frontImageUrl?: string;\n    backImageUrl?: string;\n    frontImageAlt?: string;\n    backImageAlt?: string;\n  }>;\n  settings: {\n    shuffleCards: boolean;\n    showProgress: boolean;\n    autoFlipDelay?: number; // in seconds\n  };\n};\n\nexport type VideoHotspot = {\n  id: string;\n  timestamp: number; // in seconds\n  type: \"question\" | \"info\" | \"navigation\";\n  title: string;\n  content: string;\n  options?: string[]; // for question hotspots\n  correctAnswer?: number; // for question hotspots\n};\n\nexport type InteractiveVideoData = {\n  videoUrl: string; // YouTube URL\n  hotspots: VideoHotspot[];\n};\n\nexport type ImageHotspot = {\n  id: string;\n  x: number; // percentage 0-100\n  y: number; // percentage 0-100\n  title: string;\n  description: string;\n};\n\nexport type ImageHotspotData = {\n  imageUrl: string;\n  hotspots: ImageHotspot[];\n};\n\n// Drag and Drop types\nexport type DragItem = {\n  id: string;\n  content: string;\n  correctZone: string; // ID of the correct drop zone\n};\n\nexport type DropZone = {\n  id: string;\n  label: string;\n  allowMultiple: boolean;\n};\n\nexport type DragAndDropData = {\n  items: DragItem[];\n  zones: DropZone[];\n  settings: {\n    showZoneLabels: boolean;\n    instantFeedback: boolean;\n    allowRetry: boolean;\n  };\n};\n\n// Fill in the Blanks types\nexport type BlankItem = {\n  id: string;\n  correctAnswers: string[]; // Multiple acceptable answers\n  caseSensitive: boolean;\n  showHint?: string;\n};\n\nexport type FillInBlanksData = {\n  text: string; // Text with __blank__ or *blank* markers\n  blanks: BlankItem[]; // Array indexed to match blank positions\n  settings: {\n    caseSensitive: boolean;\n    showHints: boolean;\n    allowRetry: boolean;\n  };\n};\n\n// Memory Game types\nexport type MemoryCard = {\n  id: string;\n  content: string;\n  matchId: string; // Cards with same matchId are pairs\n  type: \"text\" | \"image\";\n  imageUrl?: string;\n};\n\nexport type MemoryGameData = {\n  cards: MemoryCard[];\n  settings: {\n    rows: number;\n    columns: number;\n    showTimer: boolean;\n    showMoves: boolean;\n  };\n};\n\n// Interactive Book types\nexport type BookPage = {\n  id: string;\n  title: string;\n  content: string; // Rich text/HTML content\n  embeddedContentId?: string; // Reference to h5pContent.id (new format)\n  // Legacy format (backward compatibility)\n  embeddedContent?: {\n    type: ContentType;\n    data: QuizData | FlashcardData | InteractiveVideoData | ImageHotspotData | DragAndDropData | FillInBlanksData | MemoryGameData;\n  };\n};\n\nexport type InteractiveBookData = {\n  pages: BookPage[];\n  settings: {\n    showNavigation: boolean;\n    showProgress: boolean;\n    requireCompletion: boolean; // Must complete embedded activities to proceed\n  };\n};\n\n// Video Finder types\nexport type VideoResult = {\n  id: string;\n  videoId: string;\n  title: string;\n  description: string;\n  thumbnailUrl: string;\n  channelTitle: string;\n  publishedAt: string;\n  duration?: string;\n};\n\nexport type VideoFinderData = {\n  searchCriteria: {\n    subject: string;\n    topic: string;\n    learningOutcome: string;\n    gradeLevel: string;\n    ageRange: string;\n    videoCount: number;\n  };\n  searchResults: VideoResult[];\n  searchDate: string;\n  viewingInstructions?: string; // Pedagogical guidance for learners\n  guidingQuestions?: string[]; // Questions to focus learning\n};\n\n// Google Slides types\nexport type SlideContent = {\n  id: string;\n  type: \"title\" | \"content\" | \"guiding-questions\" | \"reflection\" | \"image\";\n  title?: string;\n  content?: string;\n  bulletPoints?: string[];\n  imageUrl?: string;\n  imageAlt?: string;\n  questions?: string[];\n  notes?: string; // Speaker notes with pedagogical guidance\n};\n\nexport type GoogleSlidesData = {\n  topic: string;\n  gradeLevel: string;\n  ageRange: string;\n  learningOutcomes: string[];\n  customInstructions?: string; // Optional custom instructions from teacher\n  slides: SlideContent[];\n  presentationId?: string; // Google Slides presentation ID if created\n  presentationUrl?: string; // Public URL to the presentation\n  generatedDate: string;\n  colorScheme?: string; // Color theme for presentation (e.g., \"blue\", \"green\", \"purple\", \"orange\")\n  imageProvider?: \"puterjs\" | \"unsplash\"; // Image source for slides (defaults to puterjs)\n};\n\n// Google Slides Generation request\nexport const googleSlidesGenerationSchema = z.object({\n  topic: z.string().min(1),\n  gradeLevel: z.string().min(1),\n  ageRange: z.string().min(1),\n  learningOutcomes: z.array(z.string()).min(1).max(10),\n  numberOfSlides: z.number().min(5).max(30).default(10),\n  customInstructions: z.string().optional(), // Optional custom instructions from teacher\n});\n\nexport type GoogleSlidesGenerationRequest = z.infer<typeof googleSlidesGenerationSchema>;\n\n// AI Generation request\nexport const aiGenerationSchema = z.object({\n  contentType: z.enum([\"quiz\", \"flashcard\", \"interactive-video\", \"image-hotspot\", \"drag-drop\", \"fill-blanks\", \"memory-game\", \"interactive-book\"]),\n  topic: z.string().min(1),\n  difficulty: z.enum([\"beginner\", \"intermediate\", \"advanced\"]),\n  gradeLevel: z.string().optional(),\n  numberOfItems: z.number().min(1).max(20),\n  language: z.string().default(\"English\"),\n  additionalContext: z.string().optional(),\n});\n\nexport type AIGenerationRequest = z.infer<typeof aiGenerationSchema>;\n\n// Video Finder Pedagogy Generation request\nexport const videoFinderPedagogySchema = z.object({\n  subject: z.string().min(1),\n  topic: z.string().min(1),\n  learningOutcome: z.string().min(1),\n  gradeLevel: z.string().min(1),\n  ageRange: z.string().optional(),\n  videoCount: z.number().min(1).max(50),\n});\n\nexport type VideoFinderPedagogyRequest = z.infer<typeof videoFinderPedagogySchema>;\n","size_bytes":13893},"server/index.ts":{"content":"import express, { type Request, Response, NextFunction } from \"express\";\nimport { registerRoutes } from \"./routes\";\nimport { setupVite, serveStatic, log } from \"./vite\";\n\nconst app = express();\n\ndeclare module 'http' {\n  interface IncomingMessage {\n    rawBody: unknown\n  }\n}\napp.use(express.json({\n  limit: '50mb',\n  verify: (req, _res, buf) => {\n    req.rawBody = buf;\n  }\n}));\napp.use(express.urlencoded({ extended: false, limit: '50mb' }));\n\napp.use((req, res, next) => {\n  const start = Date.now();\n  const path = req.path;\n  let capturedJsonResponse: Record<string, any> | undefined = undefined;\n\n  const originalResJson = res.json;\n  res.json = function (bodyJson, ...args) {\n    capturedJsonResponse = bodyJson;\n    return originalResJson.apply(res, [bodyJson, ...args]);\n  };\n\n  res.on(\"finish\", () => {\n    const duration = Date.now() - start;\n    if (path.startsWith(\"/api\")) {\n      let logLine = `${req.method} ${path} ${res.statusCode} in ${duration}ms`;\n      if (capturedJsonResponse) {\n        logLine += ` :: ${JSON.stringify(capturedJsonResponse)}`;\n      }\n\n      if (logLine.length > 80) {\n        logLine = logLine.slice(0, 79) + \"…\";\n      }\n\n      log(logLine);\n    }\n  });\n\n  next();\n});\n\n(async () => {\n  const server = await registerRoutes(app);\n\n  app.use((err: any, _req: Request, res: Response, _next: NextFunction) => {\n    const status = err.status || err.statusCode || 500;\n    const message = err.message || \"Internal Server Error\";\n\n    res.status(status).json({ message });\n    throw err;\n  });\n\n  // importantly only setup vite in development and after\n  // setting up all the other routes so the catch-all route\n  // doesn't interfere with the other routes\n  if (app.get(\"env\") === \"development\") {\n    await setupVite(app, server);\n  } else {\n    serveStatic(app);\n  }\n\n  // ALWAYS serve the app on the port specified in the environment variable PORT\n  // Other ports are firewalled. Default to 5000 if not specified.\n  // this serves both the API and the client.\n  // It is the only port that is not firewalled.\n  const port = parseInt(process.env.PORT || '5000', 10);\n  server.listen({\n    port,\n    host: \"0.0.0.0\",\n    reusePort: true,\n  }, () => {\n    log(`serving on port ${port}`);\n  });\n})();\n","size_bytes":2242},"client/src/App.tsx":{"content":"import { Switch, Route, Redirect } from \"wouter\";\nimport { queryClient } from \"./lib/queryClient\";\nimport { QueryClientProvider } from \"@tanstack/react-query\";\nimport { Toaster } from \"@/components/ui/toaster\";\nimport { TooltipProvider } from \"@/components/ui/tooltip\";\nimport { AuthProvider, useAuth } from \"@/hooks/useAuth\";\nimport { ThemeProvider } from \"@/components/ThemeProvider\";\nimport { ChatContextProvider } from \"@/hooks/useChatContext\";\nimport ChatAssistant from \"@/components/ChatAssistant\";\nimport LandingPage from \"@/pages/LandingPage\";\nimport LoginPage from \"@/pages/LoginPage\";\nimport Dashboard from \"@/pages/Dashboard\";\nimport SharedResourcesPage from \"@/pages/SharedResourcesPage\";\nimport QuizCreator from \"@/pages/QuizCreator\";\nimport FlashcardCreator from \"@/pages/FlashcardCreator\";\nimport InteractiveVideoCreator from \"@/pages/InteractiveVideoCreator\";\nimport ImageHotspotCreator from \"@/pages/ImageHotspotCreator\";\nimport DragDropCreator from \"@/pages/DragDropCreator\";\nimport FillBlanksCreator from \"@/pages/FillBlanksCreator\";\nimport MemoryGameCreator from \"@/pages/MemoryGameCreator\";\nimport InteractiveBookCreator from \"@/pages/InteractiveBookCreator\";\nimport VideoFinderCreator from \"@/pages/VideoFinderCreator\";\nimport GoogleSlidesCreator from \"@/pages/GoogleSlidesCreator\";\nimport PreviewPage from \"@/pages/PreviewPage\";\nimport SharePage from \"@/pages/SharePage\";\nimport PublicPreviewPage from \"@/pages/PublicPreviewPage\";\nimport HelpPage from \"@/pages/HelpPage\";\nimport AnalyticsPage from \"@/pages/AnalyticsPage\";\nimport NotFound from \"@/pages/not-found\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\n\nfunction ProtectedRoute({ component: Component }: { component: React.ComponentType }) {\n  const { user, isLoading } = useAuth();\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen bg-background p-8\">\n        <div className=\"max-w-7xl mx-auto space-y-6\">\n          <Skeleton className=\"h-16 w-full\" />\n          <Skeleton className=\"h-96 w-full\" />\n        </div>\n      </div>\n    );\n  }\n\n  if (!user) {\n    return <Redirect to=\"/login\" />;\n  }\n\n  return <Component />;\n}\n\nfunction Router() {\n  return (\n    <Switch>\n      <Route path=\"/\" component={LandingPage} />\n      <Route path=\"/login\" component={LoginPage} />\n      <Route path=\"/public/:id\" component={PublicPreviewPage} />\n      <Route path=\"/dashboard\">\n        <ProtectedRoute component={Dashboard} />\n      </Route>\n      <Route path=\"/shared-resources\">\n        <ProtectedRoute component={SharedResourcesPage} />\n      </Route>\n      <Route path=\"/create/quiz\">\n        <ProtectedRoute component={QuizCreator} />\n      </Route>\n      <Route path=\"/create/quiz/:id\">\n        <ProtectedRoute component={QuizCreator} />\n      </Route>\n      <Route path=\"/create/flashcard\">\n        <ProtectedRoute component={FlashcardCreator} />\n      </Route>\n      <Route path=\"/create/flashcard/:id\">\n        <ProtectedRoute component={FlashcardCreator} />\n      </Route>\n      <Route path=\"/create/interactive-video\">\n        <ProtectedRoute component={InteractiveVideoCreator} />\n      </Route>\n      <Route path=\"/create/interactive-video/:id\">\n        <ProtectedRoute component={InteractiveVideoCreator} />\n      </Route>\n      <Route path=\"/create/image-hotspot\">\n        <ProtectedRoute component={ImageHotspotCreator} />\n      </Route>\n      <Route path=\"/create/image-hotspot/:id\">\n        <ProtectedRoute component={ImageHotspotCreator} />\n      </Route>\n      <Route path=\"/create/drag-drop\">\n        <ProtectedRoute component={DragDropCreator} />\n      </Route>\n      <Route path=\"/create/drag-drop/:id\">\n        <ProtectedRoute component={DragDropCreator} />\n      </Route>\n      <Route path=\"/create/fill-blanks\">\n        <ProtectedRoute component={FillBlanksCreator} />\n      </Route>\n      <Route path=\"/create/fill-blanks/:id\">\n        <ProtectedRoute component={FillBlanksCreator} />\n      </Route>\n      <Route path=\"/create/memory-game\">\n        <ProtectedRoute component={MemoryGameCreator} />\n      </Route>\n      <Route path=\"/create/memory-game/:id\">\n        <ProtectedRoute component={MemoryGameCreator} />\n      </Route>\n      <Route path=\"/create/interactive-book\">\n        <ProtectedRoute component={InteractiveBookCreator} />\n      </Route>\n      <Route path=\"/create/interactive-book/:id\">\n        <ProtectedRoute component={InteractiveBookCreator} />\n      </Route>\n      <Route path=\"/create/video-finder\">\n        <ProtectedRoute component={VideoFinderCreator} />\n      </Route>\n      <Route path=\"/create/video-finder/:id\">\n        <ProtectedRoute component={VideoFinderCreator} />\n      </Route>\n      <Route path=\"/create/google-slides\">\n        <ProtectedRoute component={GoogleSlidesCreator} />\n      </Route>\n      <Route path=\"/create/google-slides/:id\">\n        <ProtectedRoute component={GoogleSlidesCreator} />\n      </Route>\n      <Route path=\"/preview/:id\">\n        <ProtectedRoute component={PreviewPage} />\n      </Route>\n      <Route path=\"/share/:id\">\n        <ProtectedRoute component={SharePage} />\n      </Route>\n      <Route path=\"/help\">\n        <ProtectedRoute component={HelpPage} />\n      </Route>\n      <Route path=\"/analytics\">\n        <ProtectedRoute component={AnalyticsPage} />\n      </Route>\n      <Route component={NotFound} />\n    </Switch>\n  );\n}\n\nfunction AppContent() {\n  const { user } = useAuth();\n  \n  return (\n    <ChatContextProvider>\n      <Router />\n      {user && <ChatAssistant />}\n    </ChatContextProvider>\n  );\n}\n\nfunction App() {\n  return (\n    <QueryClientProvider client={queryClient}>\n      <ThemeProvider>\n        <AuthProvider>\n          <TooltipProvider>\n            <Toaster />\n            <AppContent />\n          </TooltipProvider>\n        </AuthProvider>\n      </ThemeProvider>\n    </QueryClientProvider>\n  );\n}\n\nexport default App;\n","size_bytes":5829},"client/src/main.tsx":{"content":"import { createRoot } from \"react-dom/client\";\nimport App from \"./App\";\nimport \"./index.css\";\n\ncreateRoot(document.getElementById(\"root\")!).render(<App />);\n","size_bytes":157},"client/src/components/ui/switch.tsx":{"content":"import * as React from \"react\"\nimport * as SwitchPrimitives from \"@radix-ui/react-switch\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Switch = React.forwardRef<\n  React.ElementRef<typeof SwitchPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>\n>(({ className, ...props }, ref) => (\n  <SwitchPrimitives.Root\n    className={cn(\n      \"peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  >\n    <SwitchPrimitives.Thumb\n      className={cn(\n        \"pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0\"\n      )}\n    />\n  </SwitchPrimitives.Root>\n))\nSwitch.displayName = SwitchPrimitives.Root.displayName\n\nexport { Switch }\n","size_bytes":1139},"client/src/components/ThemeToggle.tsx":{"content":"import { Moon, Sun } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { useTheme } from \"./ThemeProvider\";\n\nexport function ThemeToggle() {\n  const { theme, toggleTheme } = useTheme();\n\n  return (\n    <Button\n      variant=\"ghost\"\n      size=\"icon\"\n      onClick={toggleTheme}\n      data-testid=\"button-theme-toggle\"\n      aria-label=\"Toggle theme\"\n    >\n      {theme === \"light\" ? (\n        <Moon className=\"h-5 w-5\" />\n      ) : (\n        <Sun className=\"h-5 w-5\" />\n      )}\n    </Button>\n  );\n}\n","size_bytes":527},"client/src/pages/PreviewPage.tsx":{"content":"import { useParams, useLocation } from \"wouter\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { Breadcrumbs } from \"@/components/Breadcrumbs\";\nimport { useBreadcrumbs } from \"@/hooks/useBreadcrumbs\";\nimport { ArrowLeft, Share2 } from \"lucide-react\";\nimport type { H5pContent, QuizData, FlashcardData, InteractiveVideoData, ImageHotspotData, DragAndDropData, FillInBlanksData, MemoryGameData, InteractiveBookData, VideoFinderData, GoogleSlidesData } from \"@shared/schema\";\nimport ShareToClassroomDialog from \"@/components/ShareToClassroomDialog\";\nimport { QuizPlayer } from \"@/components/players/QuizPlayer\";\nimport { FlashcardPlayer } from \"@/components/players/FlashcardPlayer\";\nimport { VideoPlayer } from \"@/components/players/VideoPlayer\";\nimport { ImageHotspotPlayer } from \"@/components/players/ImageHotspotPlayer\";\nimport { DragDropPlayer } from \"@/components/players/DragDropPlayer\";\nimport { FillBlanksPlayer } from \"@/components/players/FillBlanksPlayer\";\nimport { MemoryGamePlayer } from \"@/components/players/MemoryGamePlayer\";\nimport { InteractiveBookPlayer } from \"@/components/players/InteractiveBookPlayer\";\nimport { VideoFinderPlayer } from \"@/components/players/VideoFinderPlayer\";\nimport GoogleSlidesPlayer from \"@/components/players/GoogleSlidesPlayer\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\n\nexport default function PreviewPage() {\n  const params = useParams();\n  const [_, navigate] = useLocation();\n  const contentId = params.id;\n\n  const { data: content, isLoading } = useQuery<H5pContent>({\n    queryKey: [\"/api/content\", contentId],\n  });\n\n  const breadcrumbs = useBreadcrumbs(contentId);\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen bg-background p-8\">\n        <div className=\"max-w-4xl mx-auto space-y-6\">\n          <Skeleton className=\"h-10 w-full\" />\n          <Skeleton className=\"h-96 w-full\" />\n        </div>\n      </div>\n    );\n  }\n\n  if (!content) {\n    return (\n      <div className=\"min-h-screen bg-background flex items-center justify-center\">\n        <div className=\"text-center\">\n          <h1 className=\"text-2xl font-bold text-foreground mb-2\">Content not found</h1>\n          <p className=\"text-muted-foreground mb-6\">The content you're looking for doesn't exist.</p>\n          <Button onClick={() => navigate(\"/\")} data-testid=\"button-home\">\n            Go to Dashboard\n          </Button>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      {/* Skip to main content */}\n      <a href=\"#main-content\" className=\"skip-to-content\">\n        Skip to main content\n      </a>\n      \n      {/* Header */}\n      <div className=\"border-b bg-card\" role=\"banner\">\n        <div className=\"max-w-7xl mx-auto px-6 h-16 flex items-center justify-between\">\n          <div className=\"flex items-center gap-4\">\n            <Button variant=\"ghost\" size=\"icon\" onClick={() => navigate(\"/\")} data-testid=\"button-back\" aria-label=\"Back to dashboard\">\n              <ArrowLeft className=\"h-5 w-5\" />\n            </Button>\n            <div>\n              <h1 className=\"text-xl font-bold text-foreground\">{content.title}</h1>\n              {content.description && <p className=\"text-sm text-muted-foreground\">{content.description}</p>}\n            </div>\n          </div>\n          <div className=\"flex gap-2\">\n            {content.isPublished && (\n              <ShareToClassroomDialog\n                contentTitle={content.title}\n                contentDescription={content.description || \"\"}\n                materialLink={`${window.location.origin}/public/${content.id}`}\n              />\n            )}\n            <Button variant=\"outline\" size=\"sm\" onClick={() => navigate(`/share/${content.id}`)} data-testid=\"button-share\">\n              <Share2 className=\"h-4 w-4 mr-2\" />\n              Share\n            </Button>\n          </div>\n        </div>\n      </div>\n\n      {/* Breadcrumbs */}\n      <div className=\"bg-background border-b\">\n        <div className=\"max-w-7xl mx-auto px-6 py-3\">\n          <Breadcrumbs items={breadcrumbs} />\n        </div>\n      </div>\n\n      {/* Content Player */}\n      <main id=\"main-content\" className=\"max-w-7xl mx-auto px-6 py-8\" role=\"main\">\n        {content.type === \"quiz\" && <QuizPlayer data={content.data as QuizData} contentId={content.id} />}\n        {content.type === \"flashcard\" && <FlashcardPlayer data={content.data as FlashcardData} contentId={content.id} />}\n        {content.type === \"interactive-video\" && <VideoPlayer data={content.data as InteractiveVideoData} contentId={content.id} />}\n        {content.type === \"image-hotspot\" && <ImageHotspotPlayer data={content.data as ImageHotspotData} contentId={content.id} />}\n        {content.type === \"drag-drop\" && <DragDropPlayer data={content.data as DragAndDropData} contentId={content.id} />}\n        {content.type === \"fill-blanks\" && <FillBlanksPlayer data={content.data as FillInBlanksData} contentId={content.id} />}\n        {content.type === \"memory-game\" && <MemoryGamePlayer data={content.data as MemoryGameData} contentId={content.id} />}\n        {content.type === \"interactive-book\" && <InteractiveBookPlayer data={content.data as InteractiveBookData} contentId={content.id} />}\n        {content.type === \"video-finder\" && <VideoFinderPlayer data={content.data as VideoFinderData} />}\n        {content.type === \"google-slides\" && <GoogleSlidesPlayer data={content.data as GoogleSlidesData} />}\n      </main>\n    </div>\n  );\n}\n","size_bytes":5517},"client/src/components/ui/resizable.tsx":{"content":"\"use client\"\n\nimport { GripVertical } from \"lucide-react\"\nimport * as ResizablePrimitive from \"react-resizable-panels\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ResizablePanelGroup = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelGroup>) => (\n  <ResizablePrimitive.PanelGroup\n    className={cn(\n      \"flex h-full w-full data-[panel-group-direction=vertical]:flex-col\",\n      className\n    )}\n    {...props}\n  />\n)\n\nconst ResizablePanel = ResizablePrimitive.Panel\n\nconst ResizableHandle = ({\n  withHandle,\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelResizeHandle> & {\n  withHandle?: boolean\n}) => (\n  <ResizablePrimitive.PanelResizeHandle\n    className={cn(\n      \"relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90\",\n      className\n    )}\n    {...props}\n  >\n    {withHandle && (\n      <div className=\"z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border\">\n        <GripVertical className=\"h-2.5 w-2.5\" />\n      </div>\n    )}\n  </ResizablePrimitive.PanelResizeHandle>\n)\n\nexport { ResizablePanelGroup, ResizablePanel, ResizableHandle }\n","size_bytes":1723},"client/src/components/ui/aspect-ratio.tsx":{"content":"import * as AspectRatioPrimitive from \"@radix-ui/react-aspect-ratio\"\n\nconst AspectRatio = AspectRatioPrimitive.Root\n\nexport { AspectRatio }\n","size_bytes":140},"vite.config.ts":{"content":"import { defineConfig } from \"vite\";\nimport react from \"@vitejs/plugin-react\";\nimport path from \"path\";\nimport runtimeErrorOverlay from \"@replit/vite-plugin-runtime-error-modal\";\n\nexport default defineConfig({\n  plugins: [\n    react(),\n    runtimeErrorOverlay(),\n    ...(process.env.NODE_ENV !== \"production\" &&\n    process.env.REPL_ID !== undefined\n      ? [\n          await import(\"@replit/vite-plugin-cartographer\").then((m) =>\n            m.cartographer(),\n          ),\n          await import(\"@replit/vite-plugin-dev-banner\").then((m) =>\n            m.devBanner(),\n          ),\n        ]\n      : []),\n  ],\n  resolve: {\n    alias: {\n      \"@\": path.resolve(import.meta.dirname, \"client\", \"src\"),\n      \"@shared\": path.resolve(import.meta.dirname, \"shared\"),\n      \"@assets\": path.resolve(import.meta.dirname, \"attached_assets\"),\n    },\n  },\n  root: path.resolve(import.meta.dirname, \"client\"),\n  build: {\n    outDir: path.resolve(import.meta.dirname, \"dist/public\"),\n    emptyOutDir: true,\n  },\n  server: {\n    fs: {\n      strict: true,\n      deny: [\"**/.*\"],\n    },\n  },\n});\n","size_bytes":1080},"client/src/pages/PublicPreviewPage.tsx":{"content":"import { useParams, useLocation } from \"wouter\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Card } from \"@/components/ui/card\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Button } from \"@/components/ui/button\";\nimport { BookOpen, Copy } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport type { H5pContent, QuizData, FlashcardData, InteractiveVideoData, ImageHotspotData, DragAndDropData, FillInBlanksData, MemoryGameData, InteractiveBookData, VideoFinderData, GoogleSlidesData } from \"@shared/schema\";\nimport { QuizPlayer } from \"@/components/players/QuizPlayer\";\nimport { FlashcardPlayer } from \"@/components/players/FlashcardPlayer\";\nimport { VideoPlayer } from \"@/components/players/VideoPlayer\";\nimport { ImageHotspotPlayer } from \"@/components/players/ImageHotspotPlayer\";\nimport { DragDropPlayer } from \"@/components/players/DragDropPlayer\";\nimport { FillBlanksPlayer } from \"@/components/players/FillBlanksPlayer\";\nimport { MemoryGamePlayer } from \"@/components/players/MemoryGamePlayer\";\nimport { InteractiveBookPlayer } from \"@/components/players/InteractiveBookPlayer\";\nimport { VideoFinderPlayer } from \"@/components/players/VideoFinderPlayer\";\nimport GoogleSlidesPlayer from \"@/components/players/GoogleSlidesPlayer\";\n\nexport default function PublicPreviewPage() {\n  const params = useParams();\n  const contentId = params.id;\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n\n  const { data: content, isLoading, error } = useQuery<H5pContent>({\n    queryKey: [\"/api/preview\", contentId],\n    retry: false,\n  });\n\n  const copyMutation = useMutation({\n    mutationFn: async () => {\n      const res = await apiRequest(\"POST\", `/api/content/${contentId}/copy`);\n      return (await res.json()) as H5pContent;\n    },\n    onSuccess: (copiedContent) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/content\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/content/public\"] });\n      toast({\n        title: \"Content Copied!\",\n        description: `\"${copiedContent.title}\" has been added to your content library.`,\n      });\n      setLocation(\"/dashboard\");\n    },\n    onError: (error: any) => {\n      const errorMessage = error?.message || \"Failed to copy content. Please try again.\";\n      toast({\n        title: \"Copy Failed\",\n        description: errorMessage,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen bg-background p-8\">\n        <div className=\"max-w-4xl mx-auto space-y-6\">\n          <Skeleton className=\"h-20 w-full\" />\n          <Skeleton className=\"h-96 w-full\" />\n        </div>\n      </div>\n    );\n  }\n\n  if (error || !content) {\n    return (\n      <div className=\"min-h-screen bg-background flex items-center justify-center p-6\">\n        <Card className=\"max-w-md w-full p-8 text-center\">\n          <div className=\"mb-6\">\n            <div className=\"h-16 w-16 bg-muted rounded-full flex items-center justify-center mx-auto mb-4\">\n              <BookOpen className=\"h-8 w-8 text-muted-foreground\" />\n            </div>\n            <h1 className=\"text-2xl font-bold text-foreground mb-2\">Content Not Available</h1>\n            <p className=\"text-muted-foreground\">\n              This content doesn't exist or hasn't been published yet.\n            </p>\n          </div>\n        </Card>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      {/* Skip to main content */}\n      <a href=\"#main-content\" className=\"skip-to-content\" data-testid=\"link-skip-to-content\">\n        Skip to main content\n      </a>\n      \n      {/* Header */}\n      <div className=\"border-b bg-card\" role=\"banner\">\n        <div className=\"max-w-7xl mx-auto px-6 py-6\">\n          <div className=\"flex items-start justify-between gap-4\">\n            <div className=\"flex items-start gap-4 flex-1\">\n              <img \n                src=\"/favicon.png\" \n                alt=\"OECS Content Creator Logo\" \n                className=\"h-12 w-12 rounded-lg flex-shrink-0\"\n                data-testid=\"img-logo\"\n              />\n              <div>\n                <h1 className=\"text-2xl font-bold text-foreground mb-1\" data-testid=\"text-content-title\">{content.title}</h1>\n                {content.description && (\n                  <p className=\"text-muted-foreground\" data-testid=\"text-content-description\">{content.description}</p>\n                )}\n              </div>\n            </div>\n            <Button \n              onClick={() => copyMutation.mutate()}\n              disabled={copyMutation.isPending}\n              data-testid=\"button-copy-content\"\n              className=\"flex-shrink-0\"\n            >\n              <Copy className=\"h-4 w-4 mr-2\" />\n              {copyMutation.isPending ? \"Copying...\" : \"Copy to My Content\"}\n            </Button>\n          </div>\n        </div>\n      </div>\n\n      {/* Content Player - Public preview doesn't track progress */}\n      <main id=\"main-content\" className=\"max-w-7xl mx-auto px-6 py-8\" role=\"main\">\n        {content.type === \"quiz\" && <QuizPlayer data={content.data as QuizData} contentId={content.id} />}\n        {content.type === \"flashcard\" && <FlashcardPlayer data={content.data as FlashcardData} contentId={content.id} />}\n        {content.type === \"interactive-video\" && <VideoPlayer data={content.data as InteractiveVideoData} contentId={content.id} />}\n        {content.type === \"image-hotspot\" && <ImageHotspotPlayer data={content.data as ImageHotspotData} contentId={content.id} />}\n        {content.type === \"drag-drop\" && <DragDropPlayer data={content.data as DragAndDropData} contentId={content.id} />}\n        {content.type === \"fill-blanks\" && <FillBlanksPlayer data={content.data as FillInBlanksData} contentId={content.id} />}\n        {content.type === \"memory-game\" && <MemoryGamePlayer data={content.data as MemoryGameData} contentId={content.id} />}\n        {content.type === \"interactive-book\" && <InteractiveBookPlayer data={content.data as InteractiveBookData} contentId={content.id} />}\n        {content.type === \"video-finder\" && <VideoFinderPlayer data={content.data as VideoFinderData} />}\n        {content.type === \"google-slides\" && <GoogleSlidesPlayer data={content.data as GoogleSlidesData} />}\n      </main>\n\n      {/* Footer */}\n      <div className=\"border-t bg-card mt-12\">\n        <div className=\"max-w-7xl mx-auto px-6 py-4 text-center text-sm text-muted-foreground\">\n          Created with <span className=\"text-primary font-semibold\">OECS Content Creator</span>\n        </div>\n      </div>\n    </div>\n  );\n}\n","size_bytes":6687},"client/src/components/ui/navigation-menu.tsx":{"content":"import * as React from \"react\"\nimport * as NavigationMenuPrimitive from \"@radix-ui/react-navigation-menu\"\nimport { cva } from \"class-variance-authority\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst NavigationMenu = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative z-10 flex max-w-max flex-1 items-center justify-center\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <NavigationMenuViewport />\n  </NavigationMenuPrimitive.Root>\n))\nNavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName\n\nconst NavigationMenuList = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.List\n    ref={ref}\n    className={cn(\n      \"group flex flex-1 list-none items-center justify-center space-x-1\",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName\n\nconst NavigationMenuItem = NavigationMenuPrimitive.Item\n\nconst navigationMenuTriggerStyle = cva(\n  \"group inline-flex h-10 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[state=open]:text-accent-foreground data-[state=open]:bg-accent/50 data-[state=open]:hover:bg-accent data-[state=open]:focus:bg-accent\"\n)\n\nconst NavigationMenuTrigger = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Trigger\n    ref={ref}\n    className={cn(navigationMenuTriggerStyle(), \"group\", className)}\n    {...props}\n  >\n    {children}{\" \"}\n    <ChevronDown\n      className=\"relative top-[1px] ml-1 h-3 w-3 transition duration-200 group-data-[state=open]:rotate-180\"\n      aria-hidden=\"true\"\n    />\n  </NavigationMenuPrimitive.Trigger>\n))\nNavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName\n\nconst NavigationMenuContent = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto \",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName\n\nconst NavigationMenuLink = NavigationMenuPrimitive.Link\n\nconst NavigationMenuViewport = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>\n>(({ className, ...props }, ref) => (\n  <div className={cn(\"absolute left-0 top-full flex justify-center\")}>\n    <NavigationMenuPrimitive.Viewport\n      className={cn(\n        \"origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  </div>\n))\nNavigationMenuViewport.displayName =\n  NavigationMenuPrimitive.Viewport.displayName\n\nconst NavigationMenuIndicator = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Indicator\n    ref={ref}\n    className={cn(\n      \"top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in\",\n      className\n    )}\n    {...props}\n  >\n    <div className=\"relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md\" />\n  </NavigationMenuPrimitive.Indicator>\n))\nNavigationMenuIndicator.displayName =\n  NavigationMenuPrimitive.Indicator.displayName\n\nexport {\n  navigationMenuTriggerStyle,\n  NavigationMenu,\n  NavigationMenuList,\n  NavigationMenuItem,\n  NavigationMenuContent,\n  NavigationMenuTrigger,\n  NavigationMenuLink,\n  NavigationMenuIndicator,\n  NavigationMenuViewport,\n}\n","size_bytes":5128},"client/src/components/ui/carousel.tsx":{"content":"import * as React from \"react\"\nimport useEmblaCarousel, {\n  type UseEmblaCarouselType,\n} from \"embla-carousel-react\"\nimport { ArrowLeft, ArrowRight } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\n\ntype CarouselApi = UseEmblaCarouselType[1]\ntype UseCarouselParameters = Parameters<typeof useEmblaCarousel>\ntype CarouselOptions = UseCarouselParameters[0]\ntype CarouselPlugin = UseCarouselParameters[1]\n\ntype CarouselProps = {\n  opts?: CarouselOptions\n  plugins?: CarouselPlugin\n  orientation?: \"horizontal\" | \"vertical\"\n  setApi?: (api: CarouselApi) => void\n}\n\ntype CarouselContextProps = {\n  carouselRef: ReturnType<typeof useEmblaCarousel>[0]\n  api: ReturnType<typeof useEmblaCarousel>[1]\n  scrollPrev: () => void\n  scrollNext: () => void\n  canScrollPrev: boolean\n  canScrollNext: boolean\n} & CarouselProps\n\nconst CarouselContext = React.createContext<CarouselContextProps | null>(null)\n\nfunction useCarousel() {\n  const context = React.useContext(CarouselContext)\n\n  if (!context) {\n    throw new Error(\"useCarousel must be used within a <Carousel />\")\n  }\n\n  return context\n}\n\nconst Carousel = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & CarouselProps\n>(\n  (\n    {\n      orientation = \"horizontal\",\n      opts,\n      setApi,\n      plugins,\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const [carouselRef, api] = useEmblaCarousel(\n      {\n        ...opts,\n        axis: orientation === \"horizontal\" ? \"x\" : \"y\",\n      },\n      plugins\n    )\n    const [canScrollPrev, setCanScrollPrev] = React.useState(false)\n    const [canScrollNext, setCanScrollNext] = React.useState(false)\n\n    const onSelect = React.useCallback((api: CarouselApi) => {\n      if (!api) {\n        return\n      }\n\n      setCanScrollPrev(api.canScrollPrev())\n      setCanScrollNext(api.canScrollNext())\n    }, [])\n\n    const scrollPrev = React.useCallback(() => {\n      api?.scrollPrev()\n    }, [api])\n\n    const scrollNext = React.useCallback(() => {\n      api?.scrollNext()\n    }, [api])\n\n    const handleKeyDown = React.useCallback(\n      (event: React.KeyboardEvent<HTMLDivElement>) => {\n        if (event.key === \"ArrowLeft\") {\n          event.preventDefault()\n          scrollPrev()\n        } else if (event.key === \"ArrowRight\") {\n          event.preventDefault()\n          scrollNext()\n        }\n      },\n      [scrollPrev, scrollNext]\n    )\n\n    React.useEffect(() => {\n      if (!api || !setApi) {\n        return\n      }\n\n      setApi(api)\n    }, [api, setApi])\n\n    React.useEffect(() => {\n      if (!api) {\n        return\n      }\n\n      onSelect(api)\n      api.on(\"reInit\", onSelect)\n      api.on(\"select\", onSelect)\n\n      return () => {\n        api?.off(\"select\", onSelect)\n      }\n    }, [api, onSelect])\n\n    return (\n      <CarouselContext.Provider\n        value={{\n          carouselRef,\n          api: api,\n          opts,\n          orientation:\n            orientation || (opts?.axis === \"y\" ? \"vertical\" : \"horizontal\"),\n          scrollPrev,\n          scrollNext,\n          canScrollPrev,\n          canScrollNext,\n        }}\n      >\n        <div\n          ref={ref}\n          onKeyDownCapture={handleKeyDown}\n          className={cn(\"relative\", className)}\n          role=\"region\"\n          aria-roledescription=\"carousel\"\n          {...props}\n        >\n          {children}\n        </div>\n      </CarouselContext.Provider>\n    )\n  }\n)\nCarousel.displayName = \"Carousel\"\n\nconst CarouselContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { carouselRef, orientation } = useCarousel()\n\n  return (\n    <div ref={carouselRef} className=\"overflow-hidden\">\n      <div\n        ref={ref}\n        className={cn(\n          \"flex\",\n          orientation === \"horizontal\" ? \"-ml-4\" : \"-mt-4 flex-col\",\n          className\n        )}\n        {...props}\n      />\n    </div>\n  )\n})\nCarouselContent.displayName = \"CarouselContent\"\n\nconst CarouselItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { orientation } = useCarousel()\n\n  return (\n    <div\n      ref={ref}\n      role=\"group\"\n      aria-roledescription=\"slide\"\n      className={cn(\n        \"min-w-0 shrink-0 grow-0 basis-full\",\n        orientation === \"horizontal\" ? \"pl-4\" : \"pt-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nCarouselItem.displayName = \"CarouselItem\"\n\nconst CarouselPrevious = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollPrev, canScrollPrev } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute  h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-left-12 top-1/2 -translate-y-1/2\"\n          : \"-top-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollPrev}\n      onClick={scrollPrev}\n      {...props}\n    >\n      <ArrowLeft className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Previous slide</span>\n    </Button>\n  )\n})\nCarouselPrevious.displayName = \"CarouselPrevious\"\n\nconst CarouselNext = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollNext, canScrollNext } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-right-12 top-1/2 -translate-y-1/2\"\n          : \"-bottom-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollNext}\n      onClick={scrollNext}\n      {...props}\n    >\n      <ArrowRight className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Next slide</span>\n    </Button>\n  )\n})\nCarouselNext.displayName = \"CarouselNext\"\n\nexport {\n  type CarouselApi,\n  Carousel,\n  CarouselContent,\n  CarouselItem,\n  CarouselPrevious,\n  CarouselNext,\n}\n","size_bytes":6210},"client/src/types/youtube.d.ts":{"content":"declare global {\n  interface Window {\n    YT: typeof YT;\n    onYouTubeIframeAPIReady: () => void;\n  }\n}\n\nexport namespace YT {\n  export interface Player {\n    playVideo(): void;\n    pauseVideo(): void;\n    stopVideo(): void;\n    seekTo(seconds: number, allowSeekAhead: boolean): void;\n    mute(): void;\n    unMute(): void;\n    isMuted(): boolean;\n    setVolume(volume: number): void;\n    getVolume(): number;\n    getDuration(): number;\n    getCurrentTime(): number;\n    getPlayerState(): PlayerState;\n    destroy(): void;\n  }\n\n  export enum PlayerState {\n    UNSTARTED = -1,\n    ENDED = 0,\n    PLAYING = 1,\n    PAUSED = 2,\n    BUFFERING = 3,\n    CUED = 5,\n  }\n\n  export interface PlayerOptions {\n    videoId?: string;\n    width?: number | string;\n    height?: number | string;\n    playerVars?: PlayerVars;\n    events?: PlayerEvents;\n  }\n\n  export interface PlayerVars {\n    autoplay?: 0 | 1;\n    cc_load_policy?: 0 | 1;\n    color?: 'red' | 'white';\n    controls?: 0 | 1;\n    disablekb?: 0 | 1;\n    enablejsapi?: 0 | 1;\n    end?: number;\n    fs?: 0 | 1;\n    hl?: string;\n    iv_load_policy?: 1 | 3;\n    list?: string;\n    listType?: 'playlist' | 'search' | 'user_uploads';\n    loop?: 0 | 1;\n    modestbranding?: 0 | 1;\n    origin?: string;\n    playlist?: string;\n    playsinline?: 0 | 1;\n    rel?: 0 | 1;\n    showinfo?: 0 | 1;\n    start?: number;\n    widget_referrer?: string;\n  }\n\n  export interface PlayerEvents {\n    onReady?: (event: PlayerEvent) => void;\n    onStateChange?: (event: OnStateChangeEvent) => void;\n    onPlaybackQualityChange?: (event: PlayerEvent) => void;\n    onPlaybackRateChange?: (event: PlayerEvent) => void;\n    onError?: (event: OnErrorEvent) => void;\n    onApiChange?: (event: PlayerEvent) => void;\n  }\n\n  export interface PlayerEvent {\n    target: Player;\n    data: any;\n  }\n\n  export interface OnStateChangeEvent extends PlayerEvent {\n    data: PlayerState;\n  }\n\n  export interface OnErrorEvent extends PlayerEvent {\n    data: PlayerError;\n  }\n\n  export enum PlayerError {\n    INVALID_PARAM = 2,\n    HTML5_ERROR = 5,\n    NOT_FOUND = 100,\n    NOT_EMBEDDABLE = 101,\n    CANT_PLAY = 150,\n  }\n\n  export class Player {\n    constructor(elementId: string | HTMLElement, options: PlayerOptions);\n  }\n}\n\nexport {};\n","size_bytes":2235},"client/src/components/ui/dropdown-menu.tsx":{"content":"import * as React from \"react\"\nimport * as DropdownMenuPrimitive from \"@radix-ui/react-dropdown-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst DropdownMenu = DropdownMenuPrimitive.Root\n\nconst DropdownMenuTrigger = DropdownMenuPrimitive.Trigger\n\nconst DropdownMenuGroup = DropdownMenuPrimitive.Group\n\nconst DropdownMenuPortal = DropdownMenuPrimitive.Portal\n\nconst DropdownMenuSub = DropdownMenuPrimitive.Sub\n\nconst DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup\n\nconst DropdownMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto\" />\n  </DropdownMenuPrimitive.SubTrigger>\n))\nDropdownMenuSubTrigger.displayName =\n  DropdownMenuPrimitive.SubTrigger.displayName\n\nconst DropdownMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuSubContent.displayName =\n  DropdownMenuPrimitive.SubContent.displayName\n\nconst DropdownMenuContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <DropdownMenuPrimitive.Portal>\n    <DropdownMenuPrimitive.Content\n      ref={ref}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </DropdownMenuPrimitive.Portal>\n))\nDropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName\n\nconst DropdownMenuItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName\n\nconst DropdownMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <DropdownMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.CheckboxItem>\n))\nDropdownMenuCheckboxItem.displayName =\n  DropdownMenuPrimitive.CheckboxItem.displayName\n\nconst DropdownMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.RadioItem>\n))\nDropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName\n\nconst DropdownMenuLabel = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName\n\nconst DropdownMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nDropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName\n\nconst DropdownMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\"ml-auto text-xs tracking-widest opacity-60\", className)}\n      {...props}\n    />\n  )\n}\nDropdownMenuShortcut.displayName = \"DropdownMenuShortcut\"\n\nexport {\n  DropdownMenu,\n  DropdownMenuTrigger,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuCheckboxItem,\n  DropdownMenuRadioItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuShortcut,\n  DropdownMenuGroup,\n  DropdownMenuPortal,\n  DropdownMenuSub,\n  DropdownMenuSubContent,\n  DropdownMenuSubTrigger,\n  DropdownMenuRadioGroup,\n}\n","size_bytes":7609},"server/vite.ts":{"content":"import express, { type Express } from \"express\";\nimport fs from \"fs\";\nimport path from \"path\";\nimport { createServer as createViteServer, createLogger } from \"vite\";\nimport { type Server } from \"http\";\nimport viteConfig from \"../vite.config\";\nimport { nanoid } from \"nanoid\";\n\nconst viteLogger = createLogger();\n\nexport function log(message: string, source = \"express\") {\n  const formattedTime = new Date().toLocaleTimeString(\"en-US\", {\n    hour: \"numeric\",\n    minute: \"2-digit\",\n    second: \"2-digit\",\n    hour12: true,\n  });\n\n  console.log(`${formattedTime} [${source}] ${message}`);\n}\n\nexport async function setupVite(app: Express, server: Server) {\n  const serverOptions = {\n    middlewareMode: true,\n    hmr: { server },\n    allowedHosts: true as const,\n  };\n\n  const vite = await createViteServer({\n    ...viteConfig,\n    configFile: false,\n    customLogger: {\n      ...viteLogger,\n      error: (msg, options) => {\n        viteLogger.error(msg, options);\n        process.exit(1);\n      },\n    },\n    server: serverOptions,\n    appType: \"custom\",\n  });\n\n  app.use(vite.middlewares);\n  app.use(\"*\", async (req, res, next) => {\n    const url = req.originalUrl;\n\n    try {\n      const clientTemplate = path.resolve(\n        import.meta.dirname,\n        \"..\",\n        \"client\",\n        \"index.html\",\n      );\n\n      // always reload the index.html file from disk incase it changes\n      let template = await fs.promises.readFile(clientTemplate, \"utf-8\");\n      template = template.replace(\n        `src=\"/src/main.tsx\"`,\n        `src=\"/src/main.tsx?v=${nanoid()}\"`,\n      );\n      const page = await vite.transformIndexHtml(url, template);\n      res.status(200).set({ \"Content-Type\": \"text/html\" }).end(page);\n    } catch (e) {\n      vite.ssrFixStacktrace(e as Error);\n      next(e);\n    }\n  });\n}\n\nexport function serveStatic(app: Express) {\n  const distPath = path.resolve(import.meta.dirname, \"public\");\n\n  if (!fs.existsSync(distPath)) {\n    throw new Error(\n      `Could not find the build directory: ${distPath}, make sure to build the client first`,\n    );\n  }\n\n  app.use(express.static(distPath));\n\n  // fall through to index.html if the file doesn't exist\n  app.use(\"*\", (_req, res) => {\n    res.sendFile(path.resolve(distPath, \"index.html\"));\n  });\n}\n","size_bytes":2263},"client/src/components/ui/card.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"shadcn-card rounded-xl border bg-card border-card-border text-card-foreground shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n));\nCard.displayName = \"Card\"\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex flex-col space-y-1.5 p-6\", className)}\n    {...props}\n  />\n));\nCardHeader.displayName = \"CardHeader\"\n\nconst CardTitle = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"text-2xl font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nCardTitle.displayName = \"CardTitle\"\n\nconst CardDescription = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n));\nCardDescription.displayName = \"CardDescription\"\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />\n))\nCardContent.displayName = \"CardContent\"\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex items-center p-6 pt-0\", className)}\n    {...props}\n  />\n))\nCardFooter.displayName = \"CardFooter\"\nexport {\n  Card,\n  CardHeader,\n  CardFooter,\n  CardTitle,\n  CardDescription,\n  CardContent,\n}\n","size_bytes":1904},"client/src/pages/LoginPage.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { useLocation } from \"wouter\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Card, CardContent, CardDescription, CardFooter, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { GraduationCap, Building2 } from \"lucide-react\";\nimport { SiGoogle } from \"react-icons/si\";\n\nexport default function LoginPage() {\n  const { user, login, register } = useAuth();\n  const [_, navigate] = useLocation();\n  const { toast } = useToast();\n  const [isLoading, setIsLoading] = useState(false);\n\n  useEffect(() => {\n    if (user) {\n      navigate(\"/dashboard\");\n    }\n  }, [user, navigate]);\n\n  const [loginData, setLoginData] = useState({ email: \"\", password: \"\" });\n  const [registerData, setRegisterData] = useState({\n    email: \"\",\n    password: \"\",\n    fullName: \"\",\n    role: \"teacher\",\n    institution: \"\",\n  });\n\n  const handleLogin = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setIsLoading(true);\n    try {\n      await login(loginData.email, loginData.password);\n      toast({ title: \"Welcome back!\", description: \"You've successfully logged in.\" });\n    } catch (error: any) {\n      toast({\n        title: \"Login failed\",\n        description: error.message || \"Invalid credentials. Please try again.\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const handleRegister = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setIsLoading(true);\n    try {\n      await register(\n        registerData.email,\n        registerData.password,\n        registerData.fullName,\n        registerData.role,\n        registerData.institution || undefined\n      );\n      toast({ title: \"Account created!\", description: \"Welcome to OECS Content Creator.\" });\n    } catch (error: any) {\n      toast({\n        title: \"Registration failed\",\n        description: error.message || \"Could not create account. Please try again.\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const handleGoogleSignIn = () => {\n    window.location.href = \"/api/auth/google\";\n  };\n\n  const handleMicrosoftSignIn = () => {\n    window.location.href = \"/api/auth/microsoft\";\n  };\n\n  return (\n    <div className=\"min-h-screen flex items-center justify-center bg-background p-6\">\n      <div className=\"w-full max-w-md\">\n        <div className=\"text-center mb-8\">\n          <div className=\"flex items-center justify-center mb-4\">\n            <img \n              src=\"/favicon.png\" \n              alt=\"OECS Content Creator Logo\" \n              className=\"h-16 w-16 rounded-xl\"\n            />\n          </div>\n          <h1 className=\"text-3xl font-bold text-foreground\">OECS Content Creator</h1>\n          <p className=\"text-muted-foreground mt-2\">Create. Engage. Educate.</p>\n        </div>\n\n        <Tabs defaultValue=\"login\" className=\"w-full\">\n          <TabsList className=\"grid w-full grid-cols-2\">\n            <TabsTrigger value=\"login\" data-testid=\"tab-login\">Login</TabsTrigger>\n            <TabsTrigger value=\"register\" data-testid=\"tab-register\">Register</TabsTrigger>\n          </TabsList>\n\n          <TabsContent value=\"login\">\n            <Card>\n              <CardHeader>\n                <CardTitle>Login</CardTitle>\n                <CardDescription>Enter your credentials to access your account</CardDescription>\n              </CardHeader>\n              <form onSubmit={handleLogin}>\n                <CardContent className=\"space-y-4\">\n                  {/* OAuth Sign-in Buttons */}\n                  <div className=\"space-y-3\">\n                    <Button\n                      type=\"button\"\n                      variant=\"outline\"\n                      className=\"w-full\"\n                      onClick={handleGoogleSignIn}\n                      data-testid=\"button-google-signin\"\n                    >\n                      <SiGoogle className=\"mr-2 h-4 w-4\" />\n                      Continue with Google\n                    </Button>\n                    <Button\n                      type=\"button\"\n                      variant=\"outline\"\n                      className=\"w-full\"\n                      onClick={handleMicrosoftSignIn}\n                      data-testid=\"button-microsoft-signin\"\n                    >\n                      <Building2 className=\"mr-2 h-4 w-4\" />\n                      Continue with Microsoft\n                    </Button>\n                  </div>\n\n                  {/* Divider */}\n                  <div className=\"relative\">\n                    <div className=\"absolute inset-0 flex items-center\">\n                      <span className=\"w-full border-t\" />\n                    </div>\n                    <div className=\"relative flex justify-center text-xs uppercase\">\n                      <span className=\"bg-background px-2 text-muted-foreground\">\n                        Or continue with email\n                      </span>\n                    </div>\n                  </div>\n\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"login-email\">Email</Label>\n                    <Input\n                      id=\"login-email\"\n                      type=\"email\"\n                      placeholder=\"educator@example.com\"\n                      value={loginData.email}\n                      onChange={(e) => setLoginData({ ...loginData, email: e.target.value })}\n                      required\n                      data-testid=\"input-login-email\"\n                    />\n                  </div>\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"login-password\">Password</Label>\n                    <Input\n                      id=\"login-password\"\n                      type=\"password\"\n                      value={loginData.password}\n                      onChange={(e) => setLoginData({ ...loginData, password: e.target.value })}\n                      required\n                      data-testid=\"input-login-password\"\n                    />\n                  </div>\n                </CardContent>\n                <CardFooter>\n                  <Button type=\"submit\" className=\"w-full\" disabled={isLoading} data-testid=\"button-login-submit\">\n                    {isLoading ? \"Logging in...\" : \"Login\"}\n                  </Button>\n                </CardFooter>\n              </form>\n            </Card>\n          </TabsContent>\n\n          <TabsContent value=\"register\">\n            <Card>\n              <CardHeader>\n                <CardTitle>Create Account</CardTitle>\n                <CardDescription>Fill in your details to get started</CardDescription>\n              </CardHeader>\n              <form onSubmit={handleRegister}>\n                <CardContent className=\"space-y-4\">\n                  {/* OAuth Sign-in Buttons */}\n                  <div className=\"space-y-3\">\n                    <Button\n                      type=\"button\"\n                      variant=\"outline\"\n                      className=\"w-full\"\n                      onClick={handleGoogleSignIn}\n                      data-testid=\"button-google-register\"\n                    >\n                      <SiGoogle className=\"mr-2 h-4 w-4\" />\n                      Sign up with Google\n                    </Button>\n                    <Button\n                      type=\"button\"\n                      variant=\"outline\"\n                      className=\"w-full\"\n                      onClick={handleMicrosoftSignIn}\n                      data-testid=\"button-microsoft-register\"\n                    >\n                      <Building2 className=\"mr-2 h-4 w-4\" />\n                      Sign up with Microsoft\n                    </Button>\n                  </div>\n\n                  {/* Divider */}\n                  <div className=\"relative\">\n                    <div className=\"absolute inset-0 flex items-center\">\n                      <span className=\"w-full border-t\" />\n                    </div>\n                    <div className=\"relative flex justify-center text-xs uppercase\">\n                      <span className=\"bg-background px-2 text-muted-foreground\">\n                        Or continue with email\n                      </span>\n                    </div>\n                  </div>\n\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"register-name\">Full Name</Label>\n                    <Input\n                      id=\"register-name\"\n                      type=\"text\"\n                      placeholder=\"John Doe\"\n                      value={registerData.fullName}\n                      onChange={(e) => setRegisterData({ ...registerData, fullName: e.target.value })}\n                      required\n                      data-testid=\"input-register-name\"\n                    />\n                  </div>\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"register-email\">Email</Label>\n                    <Input\n                      id=\"register-email\"\n                      type=\"email\"\n                      placeholder=\"educator@example.com\"\n                      value={registerData.email}\n                      onChange={(e) => setRegisterData({ ...registerData, email: e.target.value })}\n                      required\n                      data-testid=\"input-register-email\"\n                    />\n                  </div>\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"register-password\">Password</Label>\n                    <Input\n                      id=\"register-password\"\n                      type=\"password\"\n                      value={registerData.password}\n                      onChange={(e) => setRegisterData({ ...registerData, password: e.target.value })}\n                      required\n                      minLength={6}\n                      data-testid=\"input-register-password\"\n                    />\n                    <p className=\"text-xs text-muted-foreground\">At least 6 characters</p>\n                  </div>\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"register-role\">Role</Label>\n                    <Select\n                      value={registerData.role}\n                      onValueChange={(value) => setRegisterData({ ...registerData, role: value })}\n                    >\n                      <SelectTrigger id=\"register-role\" data-testid=\"select-register-role\">\n                        <SelectValue />\n                      </SelectTrigger>\n                      <SelectContent>\n                        <SelectItem value=\"teacher\">Teacher</SelectItem>\n                        <SelectItem value=\"student\">Student</SelectItem>\n                        <SelectItem value=\"admin\">Admin</SelectItem>\n                      </SelectContent>\n                    </Select>\n                  </div>\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"register-institution\">Institution (Optional)</Label>\n                    <Input\n                      id=\"register-institution\"\n                      type=\"text\"\n                      placeholder=\"University or School Name\"\n                      value={registerData.institution}\n                      onChange={(e) => setRegisterData({ ...registerData, institution: e.target.value })}\n                      data-testid=\"input-register-institution\"\n                    />\n                  </div>\n                </CardContent>\n                <CardFooter>\n                  <Button type=\"submit\" className=\"w-full\" disabled={isLoading} data-testid=\"button-register-submit\">\n                    {isLoading ? \"Creating Account...\" : \"Create Account\"}\n                  </Button>\n                </CardFooter>\n              </form>\n            </Card>\n          </TabsContent>\n        </Tabs>\n      </div>\n    </div>\n  );\n}\n","size_bytes":12179},"client/src/components/ui/sidebar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, VariantProps } from \"class-variance-authority\"\nimport { PanelLeftIcon } from \"lucide-react\"\n\nimport { useIsMobile } from \"@/hooks/use-mobile\"\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Separator } from \"@/components/ui/separator\"\nimport {\n  Sheet,\n  SheetContent,\n  SheetDescription,\n  SheetHeader,\n  SheetTitle,\n} from \"@/components/ui/sheet\"\nimport { Skeleton } from \"@/components/ui/skeleton\"\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\"\n\nconst SIDEBAR_COOKIE_NAME = \"sidebar_state\"\nconst SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7\nconst SIDEBAR_WIDTH = \"16rem\"\nconst SIDEBAR_WIDTH_MOBILE = \"18rem\"\nconst SIDEBAR_WIDTH_ICON = \"3rem\"\nconst SIDEBAR_KEYBOARD_SHORTCUT = \"b\"\n\ntype SidebarContextProps = {\n  state: \"expanded\" | \"collapsed\"\n  open: boolean\n  setOpen: (open: boolean) => void\n  openMobile: boolean\n  setOpenMobile: (open: boolean) => void\n  isMobile: boolean\n  toggleSidebar: () => void\n}\n\nconst SidebarContext = React.createContext<SidebarContextProps | null>(null)\n\nfunction useSidebar() {\n  const context = React.useContext(SidebarContext)\n  if (!context) {\n    throw new Error(\"useSidebar must be used within a SidebarProvider.\")\n  }\n\n  return context\n}\n\nfunction SidebarProvider({\n  defaultOpen = true,\n  open: openProp,\n  onOpenChange: setOpenProp,\n  className,\n  style,\n  children,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  defaultOpen?: boolean\n  open?: boolean\n  onOpenChange?: (open: boolean) => void\n}) {\n  const isMobile = useIsMobile()\n  const [openMobile, setOpenMobile] = React.useState(false)\n\n  // This is the internal state of the sidebar.\n  // We use openProp and setOpenProp for control from outside the component.\n  const [_open, _setOpen] = React.useState(defaultOpen)\n  const open = openProp ?? _open\n  const setOpen = React.useCallback(\n    (value: boolean | ((value: boolean) => boolean)) => {\n      const openState = typeof value === \"function\" ? value(open) : value\n      if (setOpenProp) {\n        setOpenProp(openState)\n      } else {\n        _setOpen(openState)\n      }\n\n      // This sets the cookie to keep the sidebar state.\n      document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`\n    },\n    [setOpenProp, open]\n  )\n\n  // Helper to toggle the sidebar.\n  const toggleSidebar = React.useCallback(() => {\n    return isMobile ? setOpenMobile((open) => !open) : setOpen((open) => !open)\n  }, [isMobile, setOpen, setOpenMobile])\n\n  // Adds a keyboard shortcut to toggle the sidebar.\n  React.useEffect(() => {\n    const handleKeyDown = (event: KeyboardEvent) => {\n      if (\n        event.key === SIDEBAR_KEYBOARD_SHORTCUT &&\n        (event.metaKey || event.ctrlKey)\n      ) {\n        event.preventDefault()\n        toggleSidebar()\n      }\n    }\n\n    window.addEventListener(\"keydown\", handleKeyDown)\n    return () => window.removeEventListener(\"keydown\", handleKeyDown)\n  }, [toggleSidebar])\n\n  // We add a state so that we can do data-state=\"expanded\" or \"collapsed\".\n  // This makes it easier to style the sidebar with Tailwind classes.\n  const state = open ? \"expanded\" : \"collapsed\"\n\n  const contextValue = React.useMemo<SidebarContextProps>(\n    () => ({\n      state,\n      open,\n      setOpen,\n      isMobile,\n      openMobile,\n      setOpenMobile,\n      toggleSidebar,\n    }),\n    [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar]\n  )\n\n  return (\n    <SidebarContext.Provider value={contextValue}>\n      <TooltipProvider delayDuration={0}>\n        <div\n          data-slot=\"sidebar-wrapper\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH,\n              \"--sidebar-width-icon\": SIDEBAR_WIDTH_ICON,\n              ...style,\n            } as React.CSSProperties\n          }\n          className={cn(\n            \"group/sidebar-wrapper has-data-[variant=inset]:bg-sidebar flex min-h-svh w-full\",\n            className\n          )}\n          {...props}\n        >\n          {children}\n        </div>\n      </TooltipProvider>\n    </SidebarContext.Provider>\n  )\n}\n\nfunction Sidebar({\n  side = \"left\",\n  variant = \"sidebar\",\n  collapsible = \"offcanvas\",\n  className,\n  children,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  side?: \"left\" | \"right\"\n  variant?: \"sidebar\" | \"floating\" | \"inset\"\n  collapsible?: \"offcanvas\" | \"icon\" | \"none\"\n}) {\n  const { isMobile, state, openMobile, setOpenMobile } = useSidebar()\n\n  if (collapsible === \"none\") {\n    return (\n      <div\n        data-slot=\"sidebar\"\n        className={cn(\n          \"bg-sidebar text-sidebar-foreground flex h-full w-[var(--sidebar-width)] flex-col\",\n          className\n        )}\n        {...props}\n      >\n        {children}\n      </div>\n    )\n  }\n\n  if (isMobile) {\n    return (\n      <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>\n        <SheetContent\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar\"\n          data-mobile=\"true\"\n          className=\"bg-sidebar text-sidebar-foreground w-[var(--sidebar-width)] p-0 [&>button]:hidden\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH_MOBILE,\n            } as React.CSSProperties\n          }\n          side={side}\n        >\n          <SheetHeader className=\"sr-only\">\n            <SheetTitle>Sidebar</SheetTitle>\n            <SheetDescription>Displays the mobile sidebar.</SheetDescription>\n          </SheetHeader>\n          <div className=\"flex h-full w-full flex-col\">{children}</div>\n        </SheetContent>\n      </Sheet>\n    )\n  }\n\n  return (\n    <div\n      className=\"group peer text-sidebar-foreground hidden md:block\"\n      data-state={state}\n      data-collapsible={state === \"collapsed\" ? collapsible : \"\"}\n      data-variant={variant}\n      data-side={side}\n      data-slot=\"sidebar\"\n    >\n      {/* This is what handles the sidebar gap on desktop */}\n      <div\n        data-slot=\"sidebar-gap\"\n        className={cn(\n          \"relative w-[var(--sidebar-width)] bg-transparent transition-[width] duration-200 ease-linear\",\n          \"group-data-[collapsible=offcanvas]:w-0\",\n          \"group-data-[side=right]:rotate-180\",\n          variant === \"floating\" || variant === \"inset\"\n            ? \"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4))]\"\n            : \"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)]\"\n        )}\n      />\n      <div\n        data-slot=\"sidebar-container\"\n        className={cn(\n          \"fixed inset-y-0 z-10 hidden h-svh w-[var(--sidebar-width)] transition-[left,right,width] duration-200 ease-linear md:flex\",\n          side === \"left\"\n            ? \"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]\"\n            : \"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]\",\n          // Adjust the padding for floating and inset variants.\n          variant === \"floating\" || variant === \"inset\"\n            ? \"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4)+2px)]\"\n            : \"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)] group-data-[side=left]:border-r group-data-[side=right]:border-l\",\n          className\n        )}\n        {...props}\n      >\n        <div\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar-inner\"\n          className=\"bg-sidebar group-data-[variant=floating]:border-sidebar-border flex h-full w-full flex-col group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:shadow-sm\"\n        >\n          {children}\n        </div>\n      </div>\n    </div>\n  )\n}\n\nfunction SidebarTrigger({\n  className,\n  onClick,\n  ...props\n}: React.ComponentProps<typeof Button>) {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <Button\n      data-sidebar=\"trigger\"\n      data-slot=\"sidebar-trigger\"\n      variant=\"ghost\"\n      size=\"icon\"\n      className={cn(\"h-7 w-7\", className)}\n      onClick={(event) => {\n        onClick?.(event)\n        toggleSidebar()\n      }}\n      {...props}\n    >\n      <PanelLeftIcon />\n      <span className=\"sr-only\">Toggle Sidebar</span>\n    </Button>\n  )\n}\n\nfunction SidebarRail({ className, ...props }: React.ComponentProps<\"button\">) {\n  const { toggleSidebar } = useSidebar()\n\n  // Note: Tailwind v3.4 doesn't support \"in-\" selectors. So the rail won't work perfectly.\n  return (\n    <button\n      data-sidebar=\"rail\"\n      data-slot=\"sidebar-rail\"\n      aria-label=\"Toggle Sidebar\"\n      tabIndex={-1}\n      onClick={toggleSidebar}\n      title=\"Toggle Sidebar\"\n      className={cn(\n        \"hover:after:bg-sidebar-border absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear group-data-[side=left]:-right-4 group-data-[side=right]:left-0 after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] sm:flex\",\n        \"in-data-[side=left]:cursor-w-resize in-data-[side=right]:cursor-e-resize\",\n        \"[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize\",\n        \"hover:group-data-[collapsible=offcanvas]:bg-sidebar group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full\",\n        \"[[data-side=left][data-collapsible=offcanvas]_&]:-right-2\",\n        \"[[data-side=right][data-collapsible=offcanvas]_&]:-left-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarInset({ className, ...props }: React.ComponentProps<\"main\">) {\n  return (\n    <main\n      data-slot=\"sidebar-inset\"\n      className={cn(\n        \"bg-background relative flex w-full flex-1 flex-col\",\n        \"md:peer-data-[variant=inset]:m-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow-sm md:peer-data-[variant=inset]:peer-data-[state=collapsed]:ml-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarInput({\n  className,\n  ...props\n}: React.ComponentProps<typeof Input>) {\n  return (\n    <Input\n      data-slot=\"sidebar-input\"\n      data-sidebar=\"input\"\n      className={cn(\"bg-background h-8 w-full shadow-none\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarHeader({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-header\"\n      data-sidebar=\"header\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarFooter({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-footer\"\n      data-sidebar=\"footer\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarSeparator({\n  className,\n  ...props\n}: React.ComponentProps<typeof Separator>) {\n  return (\n    <Separator\n      data-slot=\"sidebar-separator\"\n      data-sidebar=\"separator\"\n      className={cn(\"bg-sidebar-border mx-2 w-auto\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarContent({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-content\"\n      data-sidebar=\"content\"\n      className={cn(\n        \"flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroup({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-group\"\n      data-sidebar=\"group\"\n      className={cn(\"relative flex w-full min-w-0 flex-col p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupLabel({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"div\"> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"div\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-label\"\n      data-sidebar=\"group-label\"\n      className={cn(\n        \"text-sidebar-foreground/70 ring-sidebar-ring flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium outline-hidden transition-[margin,opacity] duration-200 ease-linear focus-visible:ring-2 [&>svg]:h-4 [&>svg]:w-4 [&>svg]:shrink-0\",\n        \"group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupAction({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"button\"> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-action\"\n      data-sidebar=\"group-action\"\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground absolute top-3.5 right-3 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 md:after:hidden\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupContent({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-group-content\"\n      data-sidebar=\"group-content\"\n      className={cn(\"w-full text-sm\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenu({ className, ...props }: React.ComponentProps<\"ul\">) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu\"\n      data-sidebar=\"menu\"\n      className={cn(\"flex w-full min-w-0 flex-col gap-1\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuItem({ className, ...props }: React.ComponentProps<\"li\">) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-item\"\n      data-sidebar=\"menu-item\"\n      className={cn(\"group/menu-item relative\", className)}\n      {...props}\n    />\n  )\n}\n\nconst sidebarMenuButtonVariants = cva(\n  \"peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-hidden ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-data-[sidebar=menu-action]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:w-8! group-data-[collapsible=icon]:h-8! group-data-[collapsible=icon]:p-2! [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground\",\n        outline:\n          \"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]\",\n      },\n      size: {\n        default: \"h-8 text-sm\",\n        sm: \"h-7 text-xs\",\n        lg: \"h-12 text-sm group-data-[collapsible=icon]:p-0!\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nfunction SidebarMenuButton({\n  asChild = false,\n  isActive = false,\n  variant = \"default\",\n  size = \"default\",\n  tooltip,\n  className,\n  ...props\n}: React.ComponentProps<\"button\"> & {\n  asChild?: boolean\n  isActive?: boolean\n  tooltip?: string | React.ComponentProps<typeof TooltipContent>\n} & VariantProps<typeof sidebarMenuButtonVariants>) {\n  const Comp = asChild ? Slot : \"button\"\n  const { isMobile, state } = useSidebar()\n\n  const button = (\n    <Comp\n      data-slot=\"sidebar-menu-button\"\n      data-sidebar=\"menu-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(sidebarMenuButtonVariants({ variant, size }), className)}\n      {...props}\n    />\n  )\n\n  if (!tooltip) {\n    return button\n  }\n\n  if (typeof tooltip === \"string\") {\n    tooltip = {\n      children: tooltip,\n    }\n  }\n\n  return (\n    <Tooltip>\n      <TooltipTrigger asChild>{button}</TooltipTrigger>\n      <TooltipContent\n        side=\"right\"\n        align=\"center\"\n        hidden={state !== \"collapsed\" || isMobile}\n        {...tooltip}\n      />\n    </Tooltip>\n  )\n}\n\nfunction SidebarMenuAction({\n  className,\n  asChild = false,\n  showOnHover = false,\n  ...props\n}: React.ComponentProps<\"button\"> & {\n  asChild?: boolean\n  showOnHover?: boolean\n}) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-action\"\n      data-sidebar=\"menu-action\"\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground peer-hover/menu-button:text-sidebar-accent-foreground absolute top-1.5 right-1 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 md:after:hidden\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        showOnHover &&\n          \"peer-data-[active=true]/menu-button:text-sidebar-accent-foreground group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 md:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuBadge({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-menu-badge\"\n      data-sidebar=\"menu-badge\"\n      className={cn(\n        \"text-sidebar-foreground pointer-events-none absolute right-1 flex h-5 min-w-5 items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums select-none\",\n        \"peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSkeleton({\n  className,\n  showIcon = false,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  showIcon?: boolean\n}) {\n  // Random width between 50 to 90%.\n  const width = React.useMemo(() => {\n    return `${Math.floor(Math.random() * 40) + 50}%`\n  }, [])\n\n  return (\n    <div\n      data-slot=\"sidebar-menu-skeleton\"\n      data-sidebar=\"menu-skeleton\"\n      className={cn(\"flex h-8 items-center gap-2 rounded-md px-2\", className)}\n      {...props}\n    >\n      {showIcon && (\n        <Skeleton\n          className=\"size-4 rounded-md\"\n          data-sidebar=\"menu-skeleton-icon\"\n        />\n      )}\n      <Skeleton\n        className=\"h-4 max-w-[var(--skeleton-width)] flex-1\"\n        data-sidebar=\"menu-skeleton-text\"\n        style={\n          {\n            \"--skeleton-width\": width,\n          } as React.CSSProperties\n        }\n      />\n    </div>\n  )\n}\n\nfunction SidebarMenuSub({ className, ...props }: React.ComponentProps<\"ul\">) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu-sub\"\n      data-sidebar=\"menu-sub\"\n      className={cn(\n        \"border-sidebar-border mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l px-2.5 py-0.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSubItem({\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-sub-item\"\n      data-sidebar=\"menu-sub-item\"\n      className={cn(\"group/menu-sub-item relative\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSubButton({\n  asChild = false,\n  size = \"md\",\n  isActive = false,\n  className,\n  ...props\n}: React.ComponentProps<\"a\"> & {\n  asChild?: boolean\n  size?: \"sm\" | \"md\"\n  isActive?: boolean\n}) {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-sub-button\"\n      data-sidebar=\"menu-sub-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground active:bg-sidebar-accent active:text-sidebar-accent-foreground [&>svg]:text-sidebar-accent-foreground flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 outline outline-2 outline-transparent outline-offset-2 focus-visible:ring-2 disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n        \"data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground\",\n        size === \"sm\" && \"text-xs\",\n        size === \"md\" && \"text-sm\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport {\n  Sidebar,\n  SidebarContent,\n  SidebarFooter,\n  SidebarGroup,\n  SidebarGroupAction,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarHeader,\n  SidebarInput,\n  SidebarInset,\n  SidebarMenu,\n  SidebarMenuAction,\n  SidebarMenuBadge,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarMenuSkeleton,\n  SidebarMenuSub,\n  SidebarMenuSubButton,\n  SidebarMenuSubItem,\n  SidebarProvider,\n  SidebarRail,\n  SidebarSeparator,\n  SidebarTrigger,\n  useSidebar,\n}\n","size_bytes":21846},"client/src/components/ui/calendar.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight } from \"lucide-react\"\nimport { DayPicker } from \"react-day-picker\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nexport type CalendarProps = React.ComponentProps<typeof DayPicker>\n\nfunction Calendar({\n  className,\n  classNames,\n  showOutsideDays = true,\n  ...props\n}: CalendarProps) {\n  return (\n    <DayPicker\n      showOutsideDays={showOutsideDays}\n      className={cn(\"p-3\", className)}\n      classNames={{\n        months: \"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0\",\n        month: \"space-y-4\",\n        caption: \"flex justify-center pt-1 relative items-center\",\n        caption_label: \"text-sm font-medium\",\n        nav: \"space-x-1 flex items-center\",\n        nav_button: cn(\n          buttonVariants({ variant: \"outline\" }),\n          \"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100\"\n        ),\n        nav_button_previous: \"absolute left-1\",\n        nav_button_next: \"absolute right-1\",\n        table: \"w-full border-collapse space-y-1\",\n        head_row: \"flex\",\n        head_cell:\n          \"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]\",\n        row: \"flex w-full mt-2\",\n        cell: \"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20\",\n        day: cn(\n          buttonVariants({ variant: \"ghost\" }),\n          \"h-9 w-9 p-0 font-normal aria-selected:opacity-100\"\n        ),\n        day_range_end: \"day-range-end\",\n        day_selected:\n          \"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground\",\n        day_today: \"bg-accent text-accent-foreground\",\n        day_outside:\n          \"day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground\",\n        day_disabled: \"text-muted-foreground opacity-50\",\n        day_range_middle:\n          \"aria-selected:bg-accent aria-selected:text-accent-foreground\",\n        day_hidden: \"invisible\",\n        ...classNames,\n      }}\n      components={{\n        IconLeft: ({ className, ...props }) => (\n          <ChevronLeft className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n        IconRight: ({ className, ...props }) => (\n          <ChevronRight className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n      }}\n      {...props}\n    />\n  )\n}\nCalendar.displayName = \"Calendar\"\n\nexport { Calendar }\n","size_bytes":2695},"tailwind.config.ts":{"content":"import type { Config } from \"tailwindcss\";\n\nexport default {\n  darkMode: [\"class\"],\n  content: [\"./client/index.html\", \"./client/src/**/*.{js,jsx,ts,tsx}\"],\n  theme: {\n    extend: {\n      borderRadius: {\n        lg: \".5625rem\", /* 9px */\n        md: \".375rem\", /* 6px */\n        sm: \".1875rem\", /* 3px */\n      },\n      colors: {\n        // Flat / base colors (regular buttons)\n        background: \"hsl(var(--background) / <alpha-value>)\",\n        foreground: \"hsl(var(--foreground) / <alpha-value>)\",\n        border: \"hsl(var(--border) / <alpha-value>)\",\n        input: \"hsl(var(--input) / <alpha-value>)\",\n        card: {\n          DEFAULT: \"hsl(var(--card) / <alpha-value>)\",\n          foreground: \"hsl(var(--card-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--card-border) / <alpha-value>)\",\n        },\n        popover: {\n          DEFAULT: \"hsl(var(--popover) / <alpha-value>)\",\n          foreground: \"hsl(var(--popover-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--popover-border) / <alpha-value>)\",\n        },\n        primary: {\n          DEFAULT: \"hsl(var(--primary) / <alpha-value>)\",\n          foreground: \"hsl(var(--primary-foreground) / <alpha-value>)\",\n          border: \"var(--primary-border)\",\n        },\n        secondary: {\n          DEFAULT: \"hsl(var(--secondary) / <alpha-value>)\",\n          foreground: \"hsl(var(--secondary-foreground) / <alpha-value>)\",\n          border: \"var(--secondary-border)\",\n        },\n        muted: {\n          DEFAULT: \"hsl(var(--muted) / <alpha-value>)\",\n          foreground: \"hsl(var(--muted-foreground) / <alpha-value>)\",\n          border: \"var(--muted-border)\",\n        },\n        accent: {\n          DEFAULT: \"hsl(var(--accent) / <alpha-value>)\",\n          foreground: \"hsl(var(--accent-foreground) / <alpha-value>)\",\n          border: \"var(--accent-border)\",\n        },\n        destructive: {\n          DEFAULT: \"hsl(var(--destructive) / <alpha-value>)\",\n          foreground: \"hsl(var(--destructive-foreground) / <alpha-value>)\",\n          border: \"var(--destructive-border)\",\n        },\n        ring: \"hsl(var(--ring) / <alpha-value>)\",\n        chart: {\n          \"1\": \"hsl(var(--chart-1) / <alpha-value>)\",\n          \"2\": \"hsl(var(--chart-2) / <alpha-value>)\",\n          \"3\": \"hsl(var(--chart-3) / <alpha-value>)\",\n          \"4\": \"hsl(var(--chart-4) / <alpha-value>)\",\n          \"5\": \"hsl(var(--chart-5) / <alpha-value>)\",\n        },\n        sidebar: {\n          ring: \"hsl(var(--sidebar-ring) / <alpha-value>)\",\n          DEFAULT: \"hsl(var(--sidebar) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--sidebar-border) / <alpha-value>)\",\n        },\n        \"sidebar-primary\": {\n          DEFAULT: \"hsl(var(--sidebar-primary) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-primary-foreground) / <alpha-value>)\",\n          border: \"var(--sidebar-primary-border)\",\n        },\n        \"sidebar-accent\": {\n          DEFAULT: \"hsl(var(--sidebar-accent) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-accent-foreground) / <alpha-value>)\",\n          border: \"var(--sidebar-accent-border)\"\n        },\n        status: {\n          online: \"rgb(34 197 94)\",\n          away: \"rgb(245 158 11)\",\n          busy: \"rgb(239 68 68)\",\n          offline: \"rgb(156 163 175)\",\n        },\n      },\n      fontFamily: {\n        sans: [\"var(--font-sans)\"],\n        serif: [\"var(--font-serif)\"],\n        mono: [\"var(--font-mono)\"],\n      },\n      keyframes: {\n        \"accordion-down\": {\n          from: { height: \"0\" },\n          to: { height: \"var(--radix-accordion-content-height)\" },\n        },\n        \"accordion-up\": {\n          from: { height: \"var(--radix-accordion-content-height)\" },\n          to: { height: \"0\" },\n        },\n      },\n      animation: {\n        \"accordion-down\": \"accordion-down 0.2s ease-out\",\n        \"accordion-up\": \"accordion-up 0.2s ease-out\",\n      },\n    },\n  },\n  plugins: [require(\"tailwindcss-animate\"), require(\"@tailwindcss/typography\")],\n} satisfies Config;\n","size_bytes":4050},"client/src/components/ui/tabs.tsx":{"content":"import * as React from \"react\"\nimport * as TabsPrimitive from \"@radix-ui/react-tabs\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Tabs = TabsPrimitive.Root\n\nconst TabsList = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.List\n    ref={ref}\n    className={cn(\n      \"inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsList.displayName = TabsPrimitive.List.displayName\n\nconst TabsTrigger = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsTrigger.displayName = TabsPrimitive.Trigger.displayName\n\nconst TabsContent = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsContent.displayName = TabsPrimitive.Content.displayName\n\nexport { Tabs, TabsList, TabsTrigger, TabsContent }\n","size_bytes":1883},"client/src/components/ui/radio-group.tsx":{"content":"import * as React from \"react\"\nimport * as RadioGroupPrimitive from \"@radix-ui/react-radio-group\"\nimport { Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst RadioGroup = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Root\n      className={cn(\"grid gap-2\", className)}\n      {...props}\n      ref={ref}\n    />\n  )\n})\nRadioGroup.displayName = RadioGroupPrimitive.Root.displayName\n\nconst RadioGroupItem = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Item>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        \"aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    >\n      <RadioGroupPrimitive.Indicator className=\"flex items-center justify-center\">\n        <Circle className=\"h-2.5 w-2.5 fill-current text-current\" />\n      </RadioGroupPrimitive.Indicator>\n    </RadioGroupPrimitive.Item>\n  )\n})\nRadioGroupItem.displayName = RadioGroupPrimitive.Item.displayName\n\nexport { RadioGroup, RadioGroupItem }\n","size_bytes":1467},"client/src/lib/youtube-loader.ts":{"content":"type YouTubeCallback = () => void;\n\nclass YouTubeAPILoader {\n  private callbacks: YouTubeCallback[] = [];\n  private isLoading = false;\n  private isLoaded = false;\n  private originalHandler: (() => void) | null = null;\n\n  load(callback: YouTubeCallback) {\n    // If API is fully loaded and ready, call callback immediately\n    if (window.YT && window.YT.Player) {\n      if (!this.isLoaded) {\n        // Mark as loaded and drain any pending callbacks\n        this.isLoaded = true;\n        this.isLoading = false;\n        const pending = [...this.callbacks];\n        this.callbacks = [];\n        pending.forEach(cb => cb());\n      }\n      callback();\n      return;\n    }\n\n    // Add callback to queue\n    this.callbacks.push(callback);\n\n    // If already loading, just wait\n    if (this.isLoading) {\n      return;\n    }\n\n    // Set up the ready handler only once\n    this.isLoading = true;\n    \n    // Preserve any existing handler\n    if (window.onYouTubeIframeAPIReady && !this.originalHandler) {\n      this.originalHandler = window.onYouTubeIframeAPIReady;\n    }\n\n    window.onYouTubeIframeAPIReady = () => {\n      this.onReady();\n      // Call original handler if it existed with proper context\n      if (this.originalHandler) {\n        this.originalHandler.call(window);\n      }\n    };\n\n    // Load the API script if not already loading\n    if (!window.YT && !document.querySelector('script[src*=\"youtube.com/iframe_api\"]')) {\n      const tag = document.createElement('script');\n      tag.src = \"https://www.youtube.com/iframe_api\";\n      const firstScriptTag = document.getElementsByTagName('script')[0];\n      firstScriptTag.parentNode?.insertBefore(tag, firstScriptTag);\n    }\n  }\n\n  private onReady() {\n    this.isLoaded = true;\n    this.isLoading = false;\n\n    // Execute all queued callbacks\n    const callbacks = [...this.callbacks];\n    this.callbacks = [];\n    callbacks.forEach(cb => cb());\n  }\n}\n\nexport const youtubeLoader = new YouTubeAPILoader();\n","size_bytes":1963},"server/openai.ts":{"content":"import OpenAI from \"openai\";\nimport type { AIGenerationRequest, QuizQuestion, FlashcardData, VideoHotspot, ImageHotspot, DragAndDropData, FillInBlanksData, MemoryGameData, InteractiveBookData, H5pContent, GoogleSlidesGenerationRequest, SlideContent } from \"@shared/schema\";\n\n// This is using OpenAI's API, which points to OpenAI's API servers and requires your own API key.\n// the newest OpenAI model is \"gpt-5\" which was released August 7, 2025. do not change this unless explicitly requested by the user\nconst openai = new OpenAI({ apiKey: process.env.OPENAI_API_KEY });\n\nexport function getOpenAIClient() {\n  return openai;\n}\n\nexport async function generateQuizQuestions(request: AIGenerationRequest): Promise<QuizQuestion[]> {\n  const prompt = `Generate ${request.numberOfItems} quiz questions about \"${request.topic}\" at ${request.difficulty} difficulty level${request.gradeLevel ? ` for ${request.gradeLevel}` : \"\"}.\n\nRequirements:\n- Mix of multiple-choice (with 4 options), true/false, and fill-in-the-blank questions\n- Each question should have a correct answer and an explanation\n- Make questions educational and engaging\n${request.additionalContext ? `\\nAdditional context: ${request.additionalContext}` : \"\"}\n\nRespond in JSON format with an array of questions following this structure:\n{\n  \"questions\": [\n    {\n      \"id\": \"unique-id\",\n      \"type\": \"multiple-choice\" | \"true-false\" | \"fill-blank\",\n      \"question\": \"question text\",\n      \"options\": [\"option1\", \"option2\", \"option3\", \"option4\"], // only for multiple-choice\n      \"correctAnswer\": 0 | \"true\" | \"false\" | \"answer text\",\n      \"explanation\": \"why this is the correct answer\"\n    }\n  ]\n}`;\n\n  const response = await openai.chat.completions.create({\n    model: \"gpt-5\",\n    messages: [\n      { role: \"system\", content: \"You are an expert educator creating quiz questions. Always respond with valid JSON.\" },\n      { role: \"user\", content: prompt },\n    ],\n    response_format: { type: \"json_object\" },\n    max_completion_tokens: 4096,\n  });\n\n  const result = JSON.parse(response.choices[0].message.content || \"{}\");\n  return result.questions || [];\n}\n\nexport async function generateFlashcards(request: AIGenerationRequest): Promise<FlashcardData[\"cards\"]> {\n  const prompt = `Generate ${request.numberOfItems} flashcard pairs about \"${request.topic}\" at ${request.difficulty} difficulty level${request.gradeLevel ? ` for ${request.gradeLevel}` : \"\"}.\n\nRequirements:\n- Front: term, concept, or question\n- Back: definition, explanation, or answer\n- Include a category for each card\n- Make them educational and memorable\n${request.additionalContext ? `\\nAdditional context: ${request.additionalContext}` : \"\"}\n\nRespond in JSON format:\n{\n  \"cards\": [\n    {\n      \"id\": \"unique-id\",\n      \"front\": \"term or question\",\n      \"back\": \"definition or answer\",\n      \"category\": \"category name\"\n    }\n  ]\n}`;\n\n  const response = await openai.chat.completions.create({\n    model: \"gpt-5\",\n    messages: [\n      { role: \"system\", content: \"You are an expert educator creating flashcards. Always respond with valid JSON.\" },\n      { role: \"user\", content: prompt },\n    ],\n    response_format: { type: \"json_object\" },\n    max_completion_tokens: 4096,\n  });\n\n  const result = JSON.parse(response.choices[0].message.content || \"{}\");\n  return result.cards || [];\n}\n\nexport async function generateVideoHotspots(request: AIGenerationRequest): Promise<VideoHotspot[]> {\n  const prompt = `Generate ${request.numberOfItems} interactive hotspots for a video about \"${request.topic}\" at ${request.difficulty} difficulty level${request.gradeLevel ? ` for ${request.gradeLevel}` : \"\"}.\n\nRequirements:\n- Mix of question, information, and navigation hotspots\n- Each hotspot should have a timestamp (in seconds), title, and content\n- Question hotspots should include options and correct answer\n- Distribute timestamps evenly throughout a typical educational video (assume 10-15 minutes)\n${request.additionalContext ? `\\nAdditional context: ${request.additionalContext}` : \"\"}\n\nRespond in JSON format:\n{\n  \"hotspots\": [\n    {\n      \"id\": \"unique-id\",\n      \"timestamp\": 60,\n      \"type\": \"question\" | \"info\" | \"navigation\",\n      \"title\": \"hotspot title\",\n      \"content\": \"description or question\",\n      \"options\": [\"option1\", \"option2\", \"option3\"], // only for questions\n      \"correctAnswer\": 0 // only for questions\n    }\n  ]\n}`;\n\n  const response = await openai.chat.completions.create({\n    model: \"gpt-5\",\n    messages: [\n      { role: \"system\", content: \"You are an expert educator creating interactive video content. Always respond with valid JSON.\" },\n      { role: \"user\", content: prompt },\n    ],\n    response_format: { type: \"json_object\" },\n    max_completion_tokens: 4096,\n  });\n\n  const result = JSON.parse(response.choices[0].message.content || \"{}\");\n  return result.hotspots || [];\n}\n\nexport async function generateImageHotspots(request: AIGenerationRequest): Promise<ImageHotspot[]> {\n  const prompt = `Generate ${request.numberOfItems} image hotspot descriptions for \"${request.topic}\" at ${request.difficulty} difficulty level${request.gradeLevel ? ` for ${request.gradeLevel}` : \"\"}.\n\nRequirements:\n- Each hotspot represents a point of interest on an image\n- Include x,y coordinates (as percentages 0-100) that would make sense for a typical educational diagram\n- Provide title and detailed description\n- Make them educational and informative\n${request.additionalContext ? `\\nAdditional context: ${request.additionalContext}` : \"\"}\n\nRespond in JSON format:\n{\n  \"hotspots\": [\n    {\n      \"id\": \"unique-id\",\n      \"x\": 25,\n      \"y\": 30,\n      \"title\": \"hotspot title\",\n      \"description\": \"detailed description\"\n    }\n  ]\n}`;\n\n  const response = await openai.chat.completions.create({\n    model: \"gpt-5\",\n    messages: [\n      { role: \"system\", content: \"You are an expert educator creating interactive image content. Always respond with valid JSON.\" },\n      { role: \"user\", content: prompt },\n    ],\n    response_format: { type: \"json_object\" },\n    max_completion_tokens: 4096,\n  });\n\n  const result = JSON.parse(response.choices[0].message.content || \"{}\");\n  return result.hotspots || [];\n}\n\nexport async function generateDragDropItems(request: AIGenerationRequest): Promise<{ zones: DragAndDropData[\"zones\"], items: DragAndDropData[\"items\"] }> {\n  const prompt = `Generate a drag-and-drop activity about \"${request.topic}\" at ${request.difficulty} difficulty level${request.gradeLevel ? ` for ${request.gradeLevel}` : \"\"}.\n\nRequirements:\n- Create 3-5 drop zones (categories)\n- Create ${request.numberOfItems} draggable items that belong to these zones\n- Each item should have a clear association with one zone\n- Make it educational and intuitive\n${request.additionalContext ? `\\nAdditional context: ${request.additionalContext}` : \"\"}\n\nRespond in JSON format:\n{\n  \"zones\": [\n    {\n      \"id\": \"unique-id\",\n      \"label\": \"zone label\"\n    }\n  ],\n  \"items\": [\n    {\n      \"id\": \"unique-id\",\n      \"content\": \"item text\",\n      \"correctZone\": \"zone-id\"\n    }\n  ]\n}`;\n\n  const response = await openai.chat.completions.create({\n    model: \"gpt-5\",\n    messages: [\n      { role: \"system\", content: \"You are an expert educator creating interactive drag-and-drop activities. Always respond with valid JSON.\" },\n      { role: \"user\", content: prompt },\n    ],\n    response_format: { type: \"json_object\" },\n    max_completion_tokens: 4096,\n  });\n\n  const result = JSON.parse(response.choices[0].message.content || \"{}\");\n  return { zones: result.zones || [], items: result.items || [] };\n}\n\nexport async function generateFillBlanksBlanks(request: AIGenerationRequest): Promise<{ text: string, blanks: FillInBlanksData[\"blanks\"] }> {\n  const prompt = `Generate a fill-in-the-blanks exercise about \"${request.topic}\" at ${request.difficulty} difficulty level${request.gradeLevel ? ` for ${request.gradeLevel}` : \"\"}.\n\nRequirements:\n- Create a passage with ${request.numberOfItems} blanks marked as *blank*\n- For each blank, provide correct answers (including acceptable variations)\n- Optionally include hints\n- Make it educational and clear\n${request.additionalContext ? `\\nAdditional context: ${request.additionalContext}` : \"\"}\n\nRespond in JSON format:\n{\n  \"text\": \"The capital of France is *blank*. It is known for the *blank* Tower.\",\n  \"blanks\": [\n    {\n      \"id\": \"1\",\n      \"correctAnswers\": [\"Paris\", \"paris\"],\n      \"caseSensitive\": false,\n      \"showHint\": \"Starts with P\"\n    }\n  ]\n}`;\n\n  const response = await openai.chat.completions.create({\n    model: \"gpt-5\",\n    messages: [\n      { role: \"system\", content: \"You are an expert educator creating fill-in-the-blanks exercises. Always respond with valid JSON.\" },\n      { role: \"user\", content: prompt },\n    ],\n    response_format: { type: \"json_object\" },\n    max_completion_tokens: 4096,\n  });\n\n  const result = JSON.parse(response.choices[0].message.content || \"{}\");\n  return { text: result.text || \"\", blanks: result.blanks || [] };\n}\n\nexport async function generateMemoryGameCards(request: AIGenerationRequest): Promise<MemoryGameData[\"cards\"]> {\n  const prompt = `Generate ${request.numberOfItems} matching card pairs for a memory game about \"${request.topic}\" at ${request.difficulty} difficulty level${request.gradeLevel ? ` for ${request.gradeLevel}` : \"\"}.\n\nRequirements:\n- Each pair should have two matching items (term-definition, question-answer, etc.)\n- Make the matches clear and educational\n- Content should be concise to fit on cards\n${request.additionalContext ? `\\nAdditional context: ${request.additionalContext}` : \"\"}\n\nRespond in JSON format:\n{\n  \"cards\": [\n    {\n      \"id\": \"1-a\",\n      \"content\": \"H2O\",\n      \"matchId\": \"pair-1\",\n      \"type\": \"text\"\n    },\n    {\n      \"id\": \"1-b\",\n      \"content\": \"Water\",\n      \"matchId\": \"pair-1\",\n      \"type\": \"text\"\n    }\n  ]\n}`;\n\n  const response = await openai.chat.completions.create({\n    model: \"gpt-5\",\n    messages: [\n      { role: \"system\", content: \"You are an expert educator creating memory game cards. Always respond with valid JSON.\" },\n      { role: \"user\", content: prompt },\n    ],\n    response_format: { type: \"json_object\" },\n    max_completion_tokens: 4096,\n  });\n\n  const result = JSON.parse(response.choices[0].message.content || \"{}\");\n  return result.cards || [];\n}\n\nexport async function generateInteractiveBookPages(request: AIGenerationRequest): Promise<InteractiveBookData[\"pages\"]> {\n  const prompt = `Generate ${request.numberOfItems} pages for an interactive educational book about \"${request.topic}\" at ${request.difficulty} difficulty level${request.gradeLevel ? ` for ${request.gradeLevel}` : \"\"}.\n\nRequirements:\n- Each page should have a title and informative content\n- Progress logically from page to page\n- Make content engaging and educational\n- Keep each page focused on one concept\n${request.additionalContext ? `\\nAdditional context: ${request.additionalContext}` : \"\"}\n\nRespond in JSON format:\n{\n  \"pages\": [\n    {\n      \"id\": \"unique-id\",\n      \"title\": \"page title\",\n      \"content\": \"page content - can be multiple paragraphs\"\n    }\n  ]\n}`;\n\n  const response = await openai.chat.completions.create({\n    model: \"gpt-5\",\n    messages: [\n      { role: \"system\", content: \"You are an expert educator creating interactive educational books. Always respond with valid JSON.\" },\n      { role: \"user\", content: prompt },\n    ],\n    response_format: { type: \"json_object\" },\n    max_completion_tokens: 4096,\n  });\n\n  const result = JSON.parse(response.choices[0].message.content || \"{}\");\n  return result.pages || [];\n}\n\nexport async function generateVideoFinderPedagogy(params: {\n  subject: string;\n  topic: string;\n  learningOutcome: string;\n  gradeLevel: string;\n  ageRange?: string;\n  videoCount: number;\n}): Promise<{ viewingInstructions: string; guidingQuestions: string[] }> {\n  const prompt = `Generate pedagogical guidance for a video viewing activity about \"${params.topic}\" in ${params.subject}.\n\nActivity Details:\n- Subject: ${params.subject}\n- Topic: ${params.topic}\n- Learning Outcome: ${params.learningOutcome}\n- Grade Level: ${params.gradeLevel}\n${params.ageRange ? `- Age Range: ${params.ageRange}` : \"\"}\n- Number of Videos: ${params.videoCount}\n\nGenerate:\n1. Viewing Instructions: A paragraph (3-5 sentences) explaining:\n   - The purpose of watching these videos\n   - What learners should focus on while watching\n   - How to actively engage with the content\n   - Any preparation or follow-up activities\n\n2. Guiding Questions: 4-6 thought-provoking questions that:\n   - Help learners focus on key concepts\n   - Encourage critical thinking\n   - Connect to the learning outcome\n   - Range from literal comprehension to deeper analysis\n\nMake the guidance age-appropriate, clear, and actionable.\n\nRespond in JSON format:\n{\n  \"viewingInstructions\": \"clear, concise paragraph of guidance\",\n  \"guidingQuestions\": [\"question 1\", \"question 2\", \"question 3\", \"question 4\"]\n}`;\n\n  const response = await openai.chat.completions.create({\n    model: \"gpt-5\",\n    messages: [\n      { role: \"system\", content: \"You are an expert educator creating video viewing guides. Always respond with valid JSON.\" },\n      { role: \"user\", content: prompt },\n    ],\n    response_format: { type: \"json_object\" },\n    max_completion_tokens: 2048,\n  });\n\n  try {\n    const result = JSON.parse(response.choices[0].message.content || \"{}\");\n    return {\n      viewingInstructions: result.viewingInstructions || \"\",\n      guidingQuestions: result.guidingQuestions || [],\n    };\n  } catch (parseError) {\n    console.error(\"Failed to parse OpenAI response:\", parseError);\n    throw new Error(\"Received invalid response from AI. Please try again.\");\n  }\n}\n\nexport async function generateGoogleSlides(request: GoogleSlidesGenerationRequest): Promise<SlideContent[]> {\n  const learningOutcomesText = request.learningOutcomes.map((o, i) => `${i + 1}. ${o}`).join('\\n');\n  \n  const customInstructionsSection = request.customInstructions \n    ? `\\n\\nAdditional Teacher Instructions:\\n${request.customInstructions}\\n\\nPlease carefully follow these custom instructions from the teacher when creating the presentation.`\n    : '';\n  \n  const prompt = `Create a pedagogically sound Google Slides presentation about \"${request.topic}\" for grade ${request.gradeLevel} students (age ${request.ageRange}).\n\nLearning Outcomes:\n${learningOutcomesText}${customInstructionsSection}\n\nCreate ${request.numberOfSlides} slides that follow best practices for educational presentations:\n\nSlide Structure Requirements:\n1. Title Slide: Engaging title and brief subtitle\n2. Learning Outcomes Slide: List the learning outcomes clearly\n3. Content Slides (${request.numberOfSlides - 5}): Mix of:\n   - Text-heavy slides with clear headings and 3-5 bullet points\n   - Image-focused slides with descriptive alt text and brief captions\n   - Real-world examples and applications\n4. Guiding Questions Slide: 4-6 thought-provoking questions that check understanding\n5. Reflection Slide: 2-3 reflection questions for deeper thinking\n\nPedagogical Guidelines:\n- Use age-appropriate language and examples\n- Break complex concepts into digestible chunks\n- Include visual variety (suggest images with descriptive alt text)\n- Add speaker notes with teaching tips and explanation guidance\n- Questions should range from recall to analysis to application\n- Content should be culturally relevant and inclusive\n\nIMPORTANT - Image Requirements:\n- AT LEAST 30-40% of slides should include relevant educational images\n- For ANY slide that would benefit from a visual (title, content, or image type), include an imageUrl\n- The imageUrl should be a short, specific search query (2-4 words) to find a relevant stock photo\n- Examples of good image queries: \"students learning science\", \"mathematics geometric shapes\", \"rainforest ecosystem\"\n- Always include detailed imageAlt text for accessibility\n- Images should enhance understanding and engagement\n\nRespond in JSON format:\n{\n  \"slides\": [\n    {\n      \"id\": \"unique-id\",\n      \"type\": \"title\" | \"content\" | \"guiding-questions\" | \"reflection\" | \"image\",\n      \"title\": \"slide title\",\n      \"content\": \"main text content (optional)\",\n      \"bulletPoints\": [\"point 1\", \"point 2\"], // for content slides\n      \"imageUrl\": \"concise search query for stock photo\", // INCLUDE FOR MOST SLIDES - short query like \"happy students learning\"\n      \"imageAlt\": \"detailed accessibility description\",\n      \"questions\": [\"question 1\", \"question 2\"], // for question slides\n      \"notes\": \"speaker notes with pedagogical guidance\"\n    }\n  ]\n}`;\n\n  const response = await openai.chat.completions.create({\n    model: \"gpt-5\",\n    messages: [\n      { role: \"system\", content: \"You are an expert instructional designer creating educational presentations. Always respond with valid JSON and follow Universal Design for Learning (UDL) principles.\" },\n      { role: \"user\", content: prompt },\n    ],\n    response_format: { type: \"json_object\" },\n    max_completion_tokens: 8000,\n  });\n\n  try {\n    const result = JSON.parse(response.choices[0].message.content || \"{}\");\n    return result.slides || [];\n  } catch (parseError) {\n    console.error(\"Failed to parse OpenAI response:\", parseError);\n    throw new Error(\"Received invalid response from AI. Please try again.\");\n  }\n}\n","size_bytes":17267},"client/src/components/players/QuizPlayer.tsx":{"content":"import { useState, useEffect, useRef } from \"react\";\nimport { Card, CardContent, CardFooter, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { RadioGroup, RadioGroupItem } from \"@/components/ui/radio-group\";\nimport { Label } from \"@/components/ui/label\";\nimport { CheckCircle2, XCircle, RotateCcw } from \"lucide-react\";\nimport type { QuizData } from \"@shared/schema\";\nimport { useProgressTracker } from \"@/hooks/use-progress-tracker\";\nimport { ScreenReaderAnnouncer, useScreenReaderAnnounce } from \"@/components/ScreenReaderAnnouncer\";\n\ntype QuizPlayerProps = {\n  data: QuizData;\n  contentId: string;\n};\n\nexport function QuizPlayer({ data, contentId }: QuizPlayerProps) {\n  const [currentIndex, setCurrentIndex] = useState(0);\n  const [answers, setAnswers] = useState<(string | number | null)[]>(new Array(data.questions.length).fill(null));\n  const [showResults, setShowResults] = useState(false);\n  const [showExplanation, setShowExplanation] = useState(false);\n  const { announcement, announce } = useScreenReaderAnnounce();\n  const restartButtonRef = useRef<HTMLButtonElement>(null);\n\n  const { progress: savedProgress, isProgressFetched, updateProgress, saveQuizAttempt, logInteraction, isAuthenticated } = useProgressTracker(contentId);\n  const [lastSentProgress, setLastSentProgress] = useState<number>(-1);\n  const [isProgressInitialized, setIsProgressInitialized] = useState(false);\n  const pendingMilestoneRef = useRef<number | null>(null);\n  const pendingTimeoutRef = useRef<NodeJS.Timeout | null>(null);\n  const previousAuthRef = useRef<boolean>(isAuthenticated);\n\n  const currentQuestion = data.questions[currentIndex];\n  const progressPercentage = ((currentIndex + 1) / data.questions.length) * 100;\n\n  // Reset initialization when auth changes from false → true\n  useEffect(() => {\n    if (!previousAuthRef.current && isAuthenticated) {\n      // User just logged in - reset to wait for progress fetch\n      setIsProgressInitialized(false);\n      setLastSentProgress(-1);\n      pendingMilestoneRef.current = null;\n      if (pendingTimeoutRef.current) {\n        clearTimeout(pendingTimeoutRef.current);\n        pendingTimeoutRef.current = null;\n      }\n    }\n    previousAuthRef.current = isAuthenticated;\n  }, [isAuthenticated]);\n\n  // Initialize from persisted progress and reconcile when savedProgress updates\n  useEffect(() => {\n    if (!isProgressInitialized) {\n      if (!isAuthenticated) {\n        setIsProgressInitialized(true);\n      } else if (isProgressFetched) {\n        if (savedProgress) {\n          setLastSentProgress(savedProgress.completionPercentage);\n        }\n        setIsProgressInitialized(true);\n      }\n    } else if (savedProgress) {\n      // After initialization, reconcile: server can only raise, never lower\n      // Only update if savedProgress is truthy (skip null refetches)\n      setLastSentProgress(prev => Math.max(prev, savedProgress.completionPercentage));\n      // Clear pending milestone if it's been saved\n      if (pendingMilestoneRef.current !== null && savedProgress.completionPercentage >= pendingMilestoneRef.current) {\n        pendingMilestoneRef.current = null;\n        if (pendingTimeoutRef.current) {\n          clearTimeout(pendingTimeoutRef.current);\n          pendingTimeoutRef.current = null;\n        }\n      }\n    }\n  }, [savedProgress, isProgressFetched, isAuthenticated, isProgressInitialized]);\n\n  // Update progress as user advances through questions (monotonic, only after initialization)\n  useEffect(() => {\n    if (!isProgressInitialized || !isAuthenticated) return;\n    \n    if (answers[currentIndex] !== null) {\n      const completionPercentage = Math.round(\n        (answers.filter((a) => a !== null).length / data.questions.length) * 100\n      );\n      // Only send if higher than local high water mark, not yet complete, and not already pending\n      if (completionPercentage > lastSentProgress && completionPercentage < 100 && completionPercentage !== pendingMilestoneRef.current) {\n        pendingMilestoneRef.current = completionPercentage;\n        updateProgress(completionPercentage);\n        // Clear pending after 5 seconds to allow retry on failure\n        if (pendingTimeoutRef.current) {\n          clearTimeout(pendingTimeoutRef.current);\n        }\n        pendingTimeoutRef.current = setTimeout(() => {\n          pendingMilestoneRef.current = null;\n          pendingTimeoutRef.current = null;\n        }, 5000);\n      }\n    }\n  }, [currentIndex, answers, lastSentProgress, isProgressInitialized, isAuthenticated]);\n\n  const handleAnswer = (answer: string | number) => {\n    // Don't allow changing answers after explanation is shown\n    if (showExplanation) return;\n    \n    const newAnswers = [...answers];\n    newAnswers[currentIndex] = answer;\n    setAnswers(newAnswers);\n    \n    // Log interaction\n    logInteraction(\"answered\");\n    \n    // If immediate feedback is enabled, show explanation\n    if (data.settings.provideFeedback && currentQuestion.explanation) {\n      setShowExplanation(true);\n    }\n    \n    // Screen reader announcement\n    const isCorrect = currentQuestion.correctAnswer === answer;\n    announce(\n      isCorrect \n        ? \"Correct! \" + (currentQuestion.explanation || \"\")\n        : \"Incorrect. \" + (currentQuestion.explanation || \"\"),\n      \"assertive\"\n    );\n  };\n\n  const handleNext = () => {\n    // Don't allow advancing without an answer\n    if (answers[currentIndex] === null) {\n      announce(\"Please select an answer before continuing\", \"assertive\");\n      return;\n    }\n    \n    setShowExplanation(false);\n    if (currentIndex < data.questions.length - 1) {\n      setCurrentIndex(currentIndex + 1);\n      // Announce question change for screen readers\n      announce(`Question ${currentIndex + 2} of ${data.questions.length}`, \"polite\");\n    } else {\n      // Quiz completed - save attempt and show results\n      const score = calculateScore();\n      const answersData = data.questions.map((q, i) => ({\n        questionId: q.id,\n        answer: answers[i] || \"\",\n        isCorrect: q.correctAnswer === answers[i],\n      }));\n      \n      // Save quiz attempt (which also updates progress to 100%)\n      // Don't update local state here - let reconciliation handle it on success\n      saveQuizAttempt(score, data.questions.length, answersData);\n      setShowResults(true);\n      announce(`Quiz complete! You scored ${Math.round((score / data.questions.length) * 100)}%`, \"assertive\");\n      // Focus the restart button when results are shown\n      setTimeout(() => {\n        restartButtonRef.current?.focus();\n      }, 100);\n    }\n  };\n\n  const handlePrevious = () => {\n    setShowExplanation(false);\n    setCurrentIndex(currentIndex - 1);\n  };\n\n  const handleRestart = () => {\n    setCurrentIndex(0);\n    setAnswers(new Array(data.questions.length).fill(null));\n    setShowResults(false);\n    setShowExplanation(false);\n    logInteraction(\"quiz_restarted\");\n  };\n\n  const calculateScore = () => {\n    return data.questions.reduce((score, question, index) => {\n      const answer = answers[index];\n      if (question.correctAnswer === answer) {\n        return score + 1;\n      }\n      return score;\n    }, 0);\n  };\n\n  const isCorrect = (questionIndex: number) => {\n    return data.questions[questionIndex].correctAnswer === answers[questionIndex];\n  };\n\n  if (showResults) {\n    const score = calculateScore();\n    const percentage = Math.round((score / data.questions.length) * 100);\n\n    return (\n      <Card className=\"max-w-2xl mx-auto\" role=\"region\" aria-label=\"Quiz results\">\n        <CardHeader className=\"text-center\">\n          <CardTitle className=\"text-3xl\">Quiz Complete!</CardTitle>\n        </CardHeader>\n        <CardContent className=\"space-y-6\">\n          <div className=\"text-center\">\n            <div className=\"text-6xl font-bold text-primary mb-2\" aria-label={`Your score is ${percentage} percent`}>{percentage}%</div>\n            <p className=\"text-lg text-muted-foreground\">\n              You got {score} out of {data.questions.length} questions correct\n            </p>\n          </div>\n\n          {data.settings.showCorrectAnswers && (\n            <div className=\"space-y-3\">\n              <h3 className=\"font-semibold\">Results:</h3>\n              {data.questions.map((question, index) => (\n                <div key={index} className=\"flex items-start gap-3 p-3 rounded-lg bg-muted/50\">\n                  {isCorrect(index) ? (\n                    <CheckCircle2 className=\"h-5 w-5 text-green-600 mt-0.5\" />\n                  ) : (\n                    <XCircle className=\"h-5 w-5 text-destructive mt-0.5\" />\n                  )}\n                  <div className=\"flex-1\">\n                    <p className=\"font-medium text-sm\">{question.question}</p>\n                    {!isCorrect(index) && (\n                      <p className=\"text-xs text-muted-foreground mt-1\">\n                        Correct answer: {typeof question.correctAnswer === \"number\" && question.options\n                          ? question.options[question.correctAnswer]\n                          : String(question.correctAnswer)}\n                      </p>\n                    )}\n                  </div>\n                </div>\n              ))}\n            </div>\n          )}\n        </CardContent>\n        <CardFooter className=\"justify-center\">\n          {data.settings.allowRetry && (\n            <Button \n              ref={restartButtonRef}\n              onClick={handleRestart} \n              data-testid=\"button-restart\" \n              aria-label=\"Restart the quiz\"\n            >\n              <RotateCcw className=\"h-4 w-4 mr-2\" />\n              Retry Quiz\n            </Button>\n          )}\n        </CardFooter>\n      </Card>\n    );\n  }\n\n  return (\n    <div className=\"max-w-2xl mx-auto space-y-6\">\n      {/* Screen Reader Announcer */}\n      <ScreenReaderAnnouncer announcement={announcement} />\n      \n      {/* Progress */}\n      <div className=\"space-y-2\" role=\"region\" aria-label=\"Quiz progress\">\n        <div className=\"flex items-center justify-between text-sm\">\n          <span className=\"text-muted-foreground\">Question {currentIndex + 1} of {data.questions.length}</span>\n          <span className=\"font-medium\">{Math.round(progressPercentage)}%</span>\n        </div>\n        <Progress value={progressPercentage} className=\"h-2\" aria-label={`Quiz progress: ${Math.round(progressPercentage)}%`} />\n      </div>\n\n      {/* Question Card */}\n      <Card role=\"region\" aria-label={`Question ${currentIndex + 1} of ${data.questions.length}`}>\n        <CardHeader>\n          <div className=\"flex items-start justify-between gap-4\">\n            <CardTitle id={`question-${currentIndex}`} className=\"text-xl\">{currentQuestion.question}</CardTitle>\n            <Badge variant=\"outline\">{currentQuestion.type.replace(\"-\", \" \")}</Badge>\n          </div>\n        </CardHeader>\n        <CardContent className=\"space-y-3\">\n          {currentQuestion.type === \"multiple-choice\" && currentQuestion.options && (\n            <RadioGroup \n              value={answers[currentIndex]?.toString() || \"\"}\n              onValueChange={(value) => handleAnswer(parseInt(value))}\n              disabled={showExplanation}\n              aria-labelledby={`question-${currentIndex}`}\n              aria-required=\"true\"\n              className=\"space-y-2\"\n            >\n              {currentQuestion.options.map((option, index) => {\n                const isSelected = answers[currentIndex] === index;\n                const isCorrectOption = currentQuestion.correctAnswer === index;\n                const showCorrect = showExplanation && data.settings.showCorrectAnswers;\n\n                return (\n                  <div \n                    key={index} \n                    className={`flex items-center space-x-3 border rounded-lg p-4 ${\n                      isSelected ? \"border-primary bg-primary/5\" : \"border-border\"\n                    } ${\n                      showCorrect && isCorrectOption ? \"border-green-600 bg-green-50 dark:bg-green-950\" : \"\"\n                    } ${\n                      showCorrect && isSelected && !isCorrectOption ? \"border-destructive bg-destructive/10\" : \"\"\n                    }`}\n                  >\n                    <RadioGroupItem \n                      value={index.toString()} \n                      id={`option-${currentIndex}-${index}`}\n                      disabled={showExplanation}\n                      data-testid={`option-${index}`}\n                    />\n                    <Label \n                      htmlFor={`option-${currentIndex}-${index}`}\n                      className=\"flex-1 cursor-pointer text-base\"\n                    >\n                      {option}\n                    </Label>\n                    {showCorrect && isCorrectOption && <CheckCircle2 className=\"h-5 w-5 text-green-600\" />}\n                    {showCorrect && isSelected && !isCorrectOption && <XCircle className=\"h-5 w-5 text-destructive\" />}\n                  </div>\n                );\n              })}\n            </RadioGroup>\n          )}\n\n          {currentQuestion.type === \"true-false\" && (\n            <div className=\"flex gap-3\">\n              <Button\n                variant={answers[currentIndex] === \"true\" ? \"default\" : \"outline\"}\n                className=\"flex-1 h-16\"\n                onClick={() => !showExplanation && handleAnswer(\"true\")}\n                disabled={showExplanation}\n                data-testid=\"button-true\"\n              >\n                True\n              </Button>\n              <Button\n                variant={answers[currentIndex] === \"false\" ? \"default\" : \"outline\"}\n                className=\"flex-1 h-16\"\n                onClick={() => !showExplanation && handleAnswer(\"false\")}\n                disabled={showExplanation}\n                data-testid=\"button-false\"\n              >\n                False\n              </Button>\n            </div>\n          )}\n\n          {currentQuestion.type === \"fill-blank\" && (\n            <input\n              type=\"text\"\n              className=\"w-full px-4 py-3 rounded-lg border bg-background\"\n              placeholder=\"Type your answer...\"\n              value={answers[currentIndex] as string || \"\"}\n              onChange={(e) => !showExplanation && handleAnswer(e.target.value)}\n              disabled={showExplanation}\n              data-testid=\"input-fill-blank\"\n              aria-label=\"Answer input\"\n            />\n          )}\n\n          {showExplanation && currentQuestion.explanation && (\n            <div className=\"mt-4 p-4 rounded-lg bg-muted\">\n              <p className=\"text-sm font-medium mb-1\">Explanation:</p>\n              <p className=\"text-sm text-muted-foreground\">{currentQuestion.explanation}</p>\n            </div>\n          )}\n        </CardContent>\n        <CardFooter className=\"flex justify-between\">\n          <Button\n            variant=\"outline\"\n            onClick={handlePrevious}\n            disabled={currentIndex === 0}\n            data-testid=\"button-previous\"\n            aria-label=\"Go to previous question\"\n          >\n            Previous\n          </Button>\n          <Button\n            onClick={handleNext}\n            disabled={answers[currentIndex] === null}\n            data-testid=\"button-next\"\n            aria-label={currentIndex === data.questions.length - 1 ? \"Finish quiz\" : \"Go to next question\"}\n          >\n            {currentIndex === data.questions.length - 1 ? \"Finish\" : \"Next\"}\n          </Button>\n        </CardFooter>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":15614},"client/src/pages/FlashcardCreator.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useParams, useLocation } from \"wouter\";\nimport { Breadcrumbs } from \"@/components/Breadcrumbs\";\nimport { useBreadcrumbs } from \"@/hooks/useBreadcrumbs\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { AIGenerationModal } from \"@/components/AIGenerationModal\";\nimport { \n  ArrowLeft, \n  Sparkles, \n  Plus, \n  Trash2, \n  GripVertical, \n  Settings,\n  Globe,\n  Image as ImageIcon\n} from \"lucide-react\";\nimport type { H5pContent, FlashcardData } from \"@shared/schema\";\nimport ShareToClassroomDialog from \"@/components/ShareToClassroomDialog\";\n\nexport default function FlashcardCreator() {\n  const params = useParams();\n  const [_, navigate] = useLocation();\n  const { toast } = useToast();\n  const contentId = params.id;\n  const breadcrumbs = useBreadcrumbs(contentId);\n  const isEditing = !!contentId;\n\n  const [title, setTitle] = useState(\"\");\n  const [description, setDescription] = useState(\"\");\n  const [cards, setCards] = useState<FlashcardData[\"cards\"]>([]);\n  const [settings, setSettings] = useState({\n    shuffleCards: false,\n    showProgress: true,\n    autoFlipDelay: undefined as number | undefined,\n  });\n  const [isPublished, setIsPublished] = useState(false);\n  const [isPublic, setIsPublic] = useState(false);\n  const [showAIModal, setShowAIModal] = useState(false);\n  const [showSettings, setShowSettings] = useState(false);\n  const [isSaving, setIsSaving] = useState(false);\n\n  const { data: content } = useQuery<H5pContent>({\n    queryKey: [\"/api/content\", contentId],\n    enabled: isEditing,\n  });\n\n  useEffect(() => {\n    if (content && content.type === \"flashcard\") {\n      setTitle(content.title);\n      setDescription(content.description || \"\");\n      const flashcardData = content.data as FlashcardData;\n      setCards(flashcardData.cards || []);\n      setSettings({\n        shuffleCards: flashcardData.settings?.shuffleCards ?? settings.shuffleCards,\n        showProgress: flashcardData.settings?.showProgress ?? settings.showProgress,\n        autoFlipDelay: flashcardData.settings?.autoFlipDelay ?? settings.autoFlipDelay,\n      });\n      setIsPublished(content.isPublished);\n      setIsPublic(content.isPublic || false);\n    }\n  }, [content]);\n\n  const saveMutation = useMutation({\n    mutationFn: async (publish: boolean = false) => {\n      const data: FlashcardData = { cards, settings };\n      \n      if (isEditing) {\n        const response = await apiRequest(\"PUT\", `/api/content/${contentId}`, {\n          title,\n          description,\n          data,\n          isPublished: publish,\n          isPublic,\n        });\n        return await response.json();\n      } else {\n        const response = await apiRequest(\"POST\", \"/api/content\", {\n          title,\n          description,\n          type: \"flashcard\",\n          data,\n          isPublished: publish,\n          isPublic,\n        });\n        return await response.json();\n      }\n    },\n    onSuccess: (data) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/content\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/content/public\"] });\n      if (!isEditing) {\n        navigate(`/create/flashcard/${data.id}`);\n      }\n      toast({ title: \"Saved!\", description: \"Flashcard set saved successfully.\" });\n      setIsSaving(false);\n    },\n  });\n\n  useEffect(() => {\n    if (!title || cards.length === 0) return;\n    \n    const timer = setTimeout(() => {\n      setIsSaving(true);\n      saveMutation.mutate(isPublished);\n    }, 2000);\n\n    return () => clearTimeout(timer);\n  }, [title, description, cards, settings, isPublic]);\n\n  const addCard = () => {\n    const newCard = {\n      id: Date.now().toString(),\n      front: \"\",\n      back: \"\",\n      category: \"\",\n      frontImageUrl: undefined,\n      backImageUrl: undefined,\n      frontImageAlt: undefined,\n      backImageAlt: undefined,\n    };\n    setCards([...cards, newCard]);\n  };\n\n  const updateCard = (index: number, updates: Partial<typeof cards[0]>) => {\n    const updated = [...cards];\n    updated[index] = { ...updated[index], ...updates };\n    setCards(updated);\n  };\n\n  const removeCard = (index: number) => {\n    setCards(cards.filter((_, i) => i !== index));\n  };\n\n  const handleAIGenerated = (data: any) => {\n    if (data.cards) {\n      setCards(prev => [...prev, ...data.cards]);\n    }\n  };\n\n  const handlePublish = async () => {\n    setIsPublished(!isPublished);\n    await saveMutation.mutateAsync(!isPublished);\n    toast({\n      title: isPublished ? \"Unpublished\" : \"Published!\",\n      description: isPublished\n        ? \"Flashcard set is now private.\"\n        : \"Flashcard set is now publicly accessible via share link.\",\n    });\n  };\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      {/* Toolbar */}\n      <div className=\"sticky top-0 z-10 bg-card/95 backdrop-blur border-b\">\n        <div className=\"max-w-7xl mx-auto px-6 h-14 flex items-center justify-between\">\n          <div className=\"flex items-center gap-4\">\n            <Button variant=\"ghost\" size=\"icon\" onClick={() => navigate(\"/\")} data-testid=\"button-back\">\n              <ArrowLeft className=\"h-5 w-5\" />\n            </Button>\n            <div className=\"flex items-center gap-2\">\n              <h1 className=\"text-lg font-semibold\">Flashcard Creator</h1>\n              {isSaving && <Badge variant=\"outline\">Saving...</Badge>}\n            </div>\n          </div>\n\n      {/* Breadcrumbs */}\n      <div className=\"bg-background border-b\">\n        <div className=\"max-w-7xl mx-auto px-6 py-3\">\n          <Breadcrumbs items={breadcrumbs} />\n        </div>\n      </div>\n          <div className=\"flex items-center gap-2\">\n            <Button variant=\"outline\" size=\"sm\" onClick={() => setShowSettings(!showSettings)} data-testid=\"button-settings\">\n              <Settings className=\"h-4 w-4 mr-1\" />\n              Settings\n            </Button>\n            <Button variant=\"outline\" size=\"sm\" onClick={() => setShowAIModal(true)} data-testid=\"button-ai-generate\">\n              <Sparkles className=\"h-4 w-4 mr-1\" />\n              AI Generate\n            </Button>\n            {contentId && isPublished && (\n              <ShareToClassroomDialog\n                contentTitle={title}\n                contentDescription={description}\n                materialLink={`${window.location.origin}/public/${contentId}`}\n              />\n            )}\n            <Button\n              variant={isPublished ? \"outline\" : \"default\"}\n              size=\"sm\"\n              onClick={handlePublish}\n              disabled={!title || cards.length === 0}\n              data-testid=\"button-publish\"\n            >\n              <Globe className=\"h-4 w-4 mr-1\" />\n              {isPublished ? \"Unpublish\" : \"Publish\"}\n            </Button>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"max-w-7xl mx-auto px-6 py-8\">\n        <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-8\">\n          {/* Main Editor */}\n          <div className=\"lg:col-span-2 space-y-6\">\n            {/* Title & Description */}\n            <Card>\n              <CardHeader>\n                <CardTitle>Flashcard Set Details</CardTitle>\n              </CardHeader>\n              <CardContent className=\"space-y-4\">\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"title\">Title *</Label>\n                  <Input\n                    id=\"title\"\n                    placeholder=\"e.g., Spanish Vocabulary - Food\"\n                    value={title}\n                    onChange={(e) => setTitle(e.target.value)}\n                    data-testid=\"input-title\"\n                  />\n                </div>\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"description\">Description (Optional)</Label>\n                  <Textarea\n                    id=\"description\"\n                    placeholder=\"Brief description of this flashcard set...\"\n                    value={description}\n                    onChange={(e) => setDescription(e.target.value)}\n                    className=\"h-20 resize-none\"\n                    data-testid=\"textarea-description\"\n                  />\n                </div>\n                <div className=\"flex items-center justify-between p-4 bg-muted/50 rounded-lg\">\n                  <div className=\"space-y-0.5\">\n                    <Label htmlFor=\"isPublic\" className=\"text-base\">Share as Public Resource</Label>\n                    <p className=\"text-sm text-muted-foreground\">\n                      Allow other teachers to discover and use this flashcard deck on the Shared Resources page. Content will be automatically published when shared.\n                    </p>\n                  </div>\n                  <Switch\n                    id=\"isPublic\"\n                    checked={isPublic}\n                    onCheckedChange={(checked) => {\n                      setIsPublic(checked);\n                      if (checked) {\n                        setIsPublished(true);\n                      }\n                    }}\n                    data-testid=\"switch-public\"\n                  />\n                </div>\n              </CardContent>\n            </Card>\n\n            {/* Cards */}\n            <div className=\"space-y-4\">\n              <div className=\"flex items-center justify-between\">\n                <h3 className=\"text-lg font-semibold\">Cards ({cards.length})</h3>\n                <Button onClick={addCard} size=\"sm\" data-testid=\"button-add-card\">\n                  <Plus className=\"h-4 w-4 mr-1\" />\n                  Add Card\n                </Button>\n              </div>\n\n              {cards.length === 0 ? (\n                <Card className=\"text-center py-12\">\n                  <CardContent>\n                    <p className=\"text-muted-foreground mb-4\">No cards yet. Add your first flashcard to get started.</p>\n                    <Button onClick={addCard} data-testid=\"button-add-first-card\">\n                      <Plus className=\"h-4 w-4 mr-2\" />\n                      Add Card\n                    </Button>\n                  </CardContent>\n                </Card>\n              ) : (\n                cards.map((card, index) => (\n                  <Card key={card.id} data-testid={`card-${index}`}>\n                    <CardHeader>\n                      <div className=\"flex items-start gap-3\">\n                        <GripVertical className=\"h-5 w-5 text-muted-foreground mt-1 cursor-move\" />\n                        <div className=\"flex-1 space-y-4\">\n                          <div className=\"flex items-start justify-between\">\n                            <h4 className=\"font-medium\">Card {index + 1}</h4>\n                            <Button\n                              variant=\"destructive\"\n                              size=\"icon\"\n                              onClick={() => removeCard(index)}\n                              data-testid={`button-delete-${index}`}\n                            >\n                              <Trash2 className=\"h-4 w-4\" />\n                            </Button>\n                          </div>\n\n                          <div className=\"grid grid-cols-2 gap-4\">\n                            <div className=\"space-y-2\">\n                              <Label>Front</Label>\n                              <Textarea\n                                placeholder=\"Question or term...\"\n                                value={card.front}\n                                onChange={(e) => updateCard(index, { front: e.target.value })}\n                                className=\"h-24 resize-none\"\n                                data-testid={`textarea-front-${index}`}\n                              />\n                              <div className=\"space-y-1.5\">\n                                <Label className=\"text-xs flex items-center gap-1\">\n                                  <ImageIcon className=\"h-3 w-3\" />\n                                  Front Image URL (Optional)\n                                </Label>\n                                <Input\n                                  placeholder=\"https://example.com/image.jpg\"\n                                  value={card.frontImageUrl || \"\"}\n                                  onChange={(e) => {\n                                    const value = e.target.value.trim();\n                                    updateCard(index, { frontImageUrl: value || undefined });\n                                  }}\n                                  className=\"text-sm\"\n                                  data-testid={`input-front-image-${index}`}\n                                />\n                                {card.frontImageUrl && (\n                                  <>\n                                    <Input\n                                      placeholder=\"Image description (for accessibility)\"\n                                      value={card.frontImageAlt || \"\"}\n                                      onChange={(e) => {\n                                        const value = e.target.value.trim();\n                                        updateCard(index, { frontImageAlt: value || undefined });\n                                      }}\n                                      className=\"text-sm\"\n                                      data-testid={`input-front-image-alt-${index}`}\n                                    />\n                                    <div className=\"mt-2 rounded-md overflow-hidden border\">\n                                      <img \n                                        src={card.frontImageUrl} \n                                        alt={card.frontImageAlt || \"Front preview\"} \n                                        className=\"w-full h-32 object-cover\"\n                                        loading=\"lazy\"\n                                        onError={(e) => {\n                                          (e.target as HTMLImageElement).style.display = 'none';\n                                        }}\n                                      />\n                                    </div>\n                                  </>\n                                )}\n                              </div>\n                            </div>\n                            <div className=\"space-y-2\">\n                              <Label>Back</Label>\n                              <Textarea\n                                placeholder=\"Answer or definition...\"\n                                value={card.back}\n                                onChange={(e) => updateCard(index, { back: e.target.value })}\n                                className=\"h-24 resize-none\"\n                                data-testid={`textarea-back-${index}`}\n                              />\n                              <div className=\"space-y-1.5\">\n                                <Label className=\"text-xs flex items-center gap-1\">\n                                  <ImageIcon className=\"h-3 w-3\" />\n                                  Back Image URL (Optional)\n                                </Label>\n                                <Input\n                                  placeholder=\"https://example.com/image.jpg\"\n                                  value={card.backImageUrl || \"\"}\n                                  onChange={(e) => {\n                                    const value = e.target.value.trim();\n                                    updateCard(index, { backImageUrl: value || undefined });\n                                  }}\n                                  className=\"text-sm\"\n                                  data-testid={`input-back-image-${index}`}\n                                />\n                                {card.backImageUrl && (\n                                  <>\n                                    <Input\n                                      placeholder=\"Image description (for accessibility)\"\n                                      value={card.backImageAlt || \"\"}\n                                      onChange={(e) => {\n                                        const value = e.target.value.trim();\n                                        updateCard(index, { backImageAlt: value || undefined });\n                                      }}\n                                      className=\"text-sm\"\n                                      data-testid={`input-back-image-alt-${index}`}\n                                    />\n                                    <div className=\"mt-2 rounded-md overflow-hidden border\">\n                                      <img \n                                        src={card.backImageUrl} \n                                        alt={card.backImageAlt || \"Back preview\"} \n                                        className=\"w-full h-32 object-cover\"\n                                        loading=\"lazy\"\n                                        onError={(e) => {\n                                          (e.target as HTMLImageElement).style.display = 'none';\n                                        }}\n                                      />\n                                    </div>\n                                  </>\n                                )}\n                              </div>\n                            </div>\n                          </div>\n\n                          <div className=\"space-y-2\">\n                            <Label>Category (Optional)</Label>\n                            <Input\n                              placeholder=\"e.g., Verbs, Numbers, Colors\"\n                              value={card.category || \"\"}\n                              onChange={(e) => updateCard(index, { category: e.target.value })}\n                              data-testid={`input-category-${index}`}\n                            />\n                          </div>\n                        </div>\n                      </div>\n                    </CardHeader>\n                  </Card>\n                ))\n              )}\n            </div>\n          </div>\n\n          {/* Settings Panel */}\n          {showSettings && (\n            <div className=\"lg:col-span-1\">\n              <Card className=\"sticky top-20\">\n                <CardHeader>\n                  <CardTitle>Flashcard Settings</CardTitle>\n                </CardHeader>\n                <CardContent className=\"space-y-6\">\n                  <div className=\"flex items-center justify-between\">\n                    <Label htmlFor=\"shuffle\">Shuffle Cards</Label>\n                    <Switch\n                      id=\"shuffle\"\n                      checked={settings.shuffleCards}\n                      onCheckedChange={(checked) => setSettings({ ...settings, shuffleCards: checked })}\n                      data-testid=\"switch-shuffle\"\n                    />\n                  </div>\n                  <div className=\"flex items-center justify-between\">\n                    <Label htmlFor=\"progress\">Show Progress Bar</Label>\n                    <Switch\n                      id=\"progress\"\n                      checked={settings.showProgress}\n                      onCheckedChange={(checked) => setSettings({ ...settings, showProgress: checked })}\n                      data-testid=\"switch-progress\"\n                    />\n                  </div>\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"autoFlip\">Auto-flip Delay (seconds)</Label>\n                    <Input\n                      id=\"autoFlip\"\n                      type=\"number\"\n                      min=\"0\"\n                      placeholder=\"No auto-flip\"\n                      value={settings.autoFlipDelay || \"\"}\n                      onChange={(e) =>\n                        setSettings({ ...settings, autoFlipDelay: e.target.value ? parseInt(e.target.value) : undefined })\n                      }\n                      data-testid=\"input-auto-flip\"\n                    />\n                  </div>\n                </CardContent>\n              </Card>\n            </div>\n          )}\n        </div>\n      </div>\n\n      <AIGenerationModal\n        open={showAIModal}\n        onOpenChange={setShowAIModal}\n        contentType=\"flashcard\"\n        onGenerated={handleAIGenerated}\n      />\n    </div>\n  );\n}\n","size_bytes":20599},"client/src/components/ui/toggle.tsx":{"content":"import * as React from \"react\"\nimport * as TogglePrimitive from \"@radix-ui/react-toggle\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst toggleVariants = cva(\n  \"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 gap-2\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        outline:\n          \"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground\",\n      },\n      size: {\n        default: \"h-10 px-3 min-w-10\",\n        sm: \"h-9 px-2.5 min-w-9\",\n        lg: \"h-11 px-5 min-w-11\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst Toggle = React.forwardRef<\n  React.ElementRef<typeof TogglePrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, ...props }, ref) => (\n  <TogglePrimitive.Root\n    ref={ref}\n    className={cn(toggleVariants({ variant, size, className }))}\n    {...props}\n  />\n))\n\nToggle.displayName = TogglePrimitive.Root.displayName\n\nexport { Toggle, toggleVariants }\n","size_bytes":1527},"client/src/components/ui/badge.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst badgeVariants = cva(\n  // Whitespace-nowrap: Badges should never wrap.\n  \"whitespace-nowrap inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\" +\n  \" hover-elevate \" ,\n  {\n    variants: {\n      variant: {\n        default:\n          \"border-transparent bg-primary text-primary-foreground shadow-xs\",\n        secondary: \"border-transparent bg-secondary text-secondary-foreground\",\n        destructive:\n          \"border-transparent bg-destructive text-destructive-foreground shadow-xs\",\n\n        outline: \" border [border-color:var(--badge-outline)] shadow-xs\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  },\n)\n\nexport interface BadgeProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof badgeVariants> {}\n\nfunction Badge({ className, variant, ...props }: BadgeProps) {\n  return (\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\n  );\n}\n\nexport { Badge, badgeVariants }\n","size_bytes":1202},"db/index.ts":{"content":"import { drizzle } from \"drizzle-orm/neon-http\";\nimport { neon } from \"@neondatabase/serverless\";\nimport * as schema from \"@shared/schema\";\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\"DATABASE_URL is not set\");\n}\n\nconst sql = neon(process.env.DATABASE_URL);\nexport const db = drizzle(sql, { schema });\n","size_bytes":311},"client/src/components/ui/dialog.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as DialogPrimitive from \"@radix-ui/react-dialog\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Dialog = DialogPrimitive.Root\n\nconst DialogTrigger = DialogPrimitive.Trigger\n\nconst DialogPortal = DialogPrimitive.Portal\n\nconst DialogClose = DialogPrimitive.Close\n\nconst DialogOverlay = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Overlay\n    ref={ref}\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogOverlay.displayName = DialogPrimitive.Overlay.displayName\n\nconst DialogContent = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DialogPortal>\n    <DialogOverlay />\n    <DialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <DialogPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </DialogPrimitive.Close>\n    </DialogPrimitive.Content>\n  </DialogPortal>\n))\nDialogContent.displayName = DialogPrimitive.Content.displayName\n\nconst DialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-1.5 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogHeader.displayName = \"DialogHeader\"\n\nconst DialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogFooter.displayName = \"DialogFooter\"\n\nconst DialogTitle = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogTitle.displayName = DialogPrimitive.Title.displayName\n\nconst DialogDescription = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDialogDescription.displayName = DialogPrimitive.Description.displayName\n\nexport {\n  Dialog,\n  DialogPortal,\n  DialogOverlay,\n  DialogClose,\n  DialogTrigger,\n  DialogContent,\n  DialogHeader,\n  DialogFooter,\n  DialogTitle,\n  DialogDescription,\n}\n","size_bytes":3848},"replit.md":{"content":"# OECS Content Creator\n\n## Overview\nOECS Content Creator is a full-stack web application for educators in the Organization of Eastern Caribbean States. It enables the creation, management, and sharing of interactive educational content, including quizzes, flashcards, interactive videos, image hotspots, drag and drop exercises, fill in the blanks, memory games, interactive books, video finders with pedagogical guidance, and AI-generated Google Slides presentations. The platform features AI-powered content generation using OpenAI's GPT models, real-time content preview, public sharing capabilities, and Google Classroom integration for sharing all content types to enhance learning and collaboration among educators and students.\n\n## User Preferences\nPreferred communication style: Simple, everyday language.\n\n## System Architecture\n\n### Frontend Architecture\nThe frontend is built with React 18+ and TypeScript, utilizing Vite for fast development. Client-side routing is handled by React Router (Wouter). UI development adheres to Material Design 3 principles, implemented with Tailwind CSS and shadcn/ui components, based on Radix UI primitives for accessibility. State management and data fetching are managed by TanStack Query, complemented by a custom authentication context. The design system employs Inter and JetBrains Mono fonts, consistent spacing, and supports light/dark themes. Content players are custom-built for each interactive content type, and the platform includes a TipTap rich text editor with DOMPurify for sanitization. Navigation is enhanced with breadcrumb trails on all major pages, showing the current location hierarchy and enabling quick navigation back to the dashboard.\n\n### Backend Architecture\nThe backend uses Express.js for RESTful APIs, with session-based authentication via `express-session` (PostgreSQL-backed for production, with memory fallback for development) and custom middleware for logging and authentication guards. API endpoints are structured for authentication (local and OAuth), content CRUD operations, content sharing, public previews, and AI-powered generation. Authentication supports multiple providers: local email/password (bcrypt hashing), Google OAuth 2.0 (via Passport.js), and Microsoft OAuth 2.0 (via @azure/msal-node). Sessions use httpOnly cookies and support role-based access (teacher, student, admin). OAuth users are created with sentinel password hashes for security. Content is managed across ten types using JSON-based data storage and includes a publication workflow from draft to published, with share link generation.\n\n### Data Storage\nPostgreSQL, accessed via Neon serverless driver and Drizzle ORM, serves as the database. The schema includes tables for `profiles` (user accounts with OAuth provider fields), `h5p_content` (educational content with JSONB for flexible structures), `content_shares`, `learner_progress` (completion tracking), `quiz_attempts`, `interaction_events`, and `session` (PostgreSQL-backed session storage). User profiles support multiple authentication providers via `authProvider`, `googleId`, and `microsoftId` fields. Data modeling emphasizes JSONB columns for schema flexibility, foreign key relationships, UUID primary keys, and timestamp tracking.\n\n### AI Chat Assistant\nA context-aware AI assistant, powered by OpenAI's GPT-5, is available to authenticated users. It offers streaming responses, markdown rendering, and chat history persistence. The assistant's prompts are context-aware, incorporating the current page, content type, and user role.\n\n### Analytics Dashboard\nThe platform provides an analytics dashboard displaying overview metrics (total content, viewers, completion rates, interaction events) and a sortable content performance table. Individual learner performance views offer detailed insights into student engagement, completion, and quiz attempt history.\n\n### Accessibility Features\nThe application is designed to comply with WCAG 2.1 AA standards, featuring full keyboard navigation, skip-to-content links, visible focus indicators, and logical tab order. Screen reader support includes ARIA labels, live regions for dynamic announcements, semantic HTML, and proper heading hierarchies. WAI-ARIA compliance is maintained for interactive components. Visual accessibility is ensured through high contrast focus indicators, WCAG-compliant color contrast ratios, light/dark mode support, and clear visual feedback. The system also respects the `prefers-reduced-motion` setting. Breadcrumb navigation provides clear location context with proper ARIA landmarks and keyboard accessibility.\n\n## Content Types\n\n### Google Slides Presentations\nThe Google Slides content type enables teachers to create AI-generated educational presentations and export them to actual Google Slides presentations:\n\n**Creation Process**:\n- Teachers specify topic, grade level, age range, and learning outcomes\n- Configure number of slides (5-30)\n- AI generates pedagogically sound slide content following Universal Design for Learning (UDL) principles\n- **Create in Google Slides**: One-click button to create an actual Google Slides presentation with real images\n\n**AI-Generated Content**:\n- **Title slides**: Engaging titles and subtitles\n- **Learning outcomes slides**: Clear presentation of objectives\n- **Content slides**: Structured information with 3-5 bullet points\n- **Image slides**: Educational images via two providers:\n  - **Puter.js AI (Default)**: Free browser-based AI image generation, no API key required\n  - **Unsplash API**: Stock photos as fallback or alternative option\n- **Guiding questions**: 4-6 thought-provoking questions to check understanding (recall to analysis to application)\n- **Reflection questions**: 2-3 deeper thinking prompts for learner engagement\n- **Speaker notes**: Pedagogical guidance and teaching tips for educators\n\n**Google Slides Integration**:\n- **Flexible image sourcing**: \n  - **Puter.js AI (Free, Default)**: Browser-based AI image generation with no API key required\n  - **Unsplash Stock Photos**: Alternative option for stock photography\n  - **Automatic fallback**: Falls back to Unsplash if Puter.js unavailable\n- **Real presentation creation**: Uses Google Slides API to create actual presentations in teacher's Google Drive\n- **Persistent links**: Stores presentation ID and URL for future access\n- **One-click access**: \"Open in Google Slides\" button in both creator and player views\n- **Full editing capability**: Teachers can edit, share, and present using Google Slides' native features\n\n**Player Features**:\n- **Presentation mode**: Full-screen slide navigation with Previous/Next controls and slide indicators\n- **Grid view**: Overview of all slides as clickable thumbnails\n- **Keyboard navigation**: Support for arrow key navigation\n- **Accessible design**: Speaker notes visible to teachers, proper ARIA labels\n- **Google Slides link**: Opens the actual presentation in a new tab (when created)\n- **Google Classroom sharing**: One-click sharing to Google Classroom as assignment or announcement\n\n**Google Classroom Integration** (Universal for All Content Types):\n- **Share as Assignment**: Create coursework assignments with due dates and instructions for any published content\n- **Share as Announcement**: Post announcements with content links for any published content\n- **Course Selection**: Automatic listing of teacher's active Google Classroom courses\n- **Direct Integration**: All published content can be shared from creator pages and preview pages\n- **OAuth Scopes**: Requires Google Classroom API permissions (courses.readonly, coursework.students, announcements)\n- **Availability**: Share to Classroom button appears in:\n  - Creator toolbars (for all 10 content types when content is published)\n  - Preview page header (for all published content)\n\n**Pedagogical Approach**:\n- Age-appropriate language and examples\n- Concepts broken into digestible chunks\n- Visual variety with real, relevant images\n- Questions range from literal comprehension to deeper analysis\n- Culturally relevant and inclusive content\n- Follows instructional design best practices\n\n### Interactive Books\nThe Interactive Books content type enables teachers to create multi-page educational books with rich text content and embedded interactive elements:\n\n**Creation Process**:\n- Manual creation: Add pages one at a time with custom titles and content\n- **AI Generation**: One-click AI-powered book creation from natural language prompts\n- Rich text editor with formatting, images, and media support\n- **Image Options**: Three ways to add images to book pages:\n  - **Upload**: Local image files up to 2MB (JPG, PNG, GIF, WebP, SVG, BMP)\n  - **URL**: Embed images from external URLs\n  - **AI Generate**: Create custom images from text prompts with two provider options:\n    - **Puter.js** (Free, Recommended): Unlimited free image generation via browser-based AI, no API key required\n    - **OpenAI DALL-E 3** (Premium): High-quality images requiring OPENAI_API_KEY\n- Embed other content types (quizzes, flashcards, videos, etc.) within pages\n- Manual save button (removed auto-save per user preference)\n\n**AI-Generated Books**:\nTeachers can prompt the AI to generate complete books on any topic:\n- **Story prompts**: \"Create a Caribbean adventure story for Grade 3 students\"\n- **Guided lessons**: \"Explain photosynthesis step-by-step for middle school\"\n- **Historical narratives**: \"Tell the story of Caribbean independence movements\"\n- **Concept explorations**: \"Teach fractions through real-world examples\"\n- AI generates multiple pages with titles and educational content\n- Content follows pedagogical best practices\n- Age-appropriate language based on grade level\n- Logical progression from page to page\n\n**Interactive Features**:\n- Page-by-page navigation with progress tracking\n- Embed quizzes, flashcards, or other activities within specific pages\n- Rich text formatting with images and media\n- Configurable settings (show navigation, show progress, require completion)\n- Manual save with visual feedback\n\n**AI Generation Safety**:\n- Robust validation of AI responses\n- Automatic fallbacks for missing or malformed data\n- Error handling with user-friendly feedback\n- Unique ID generation for all pages\n- Content sanitization and normalization\n\n**Player Features**:\n- Sequential page navigation\n- Progress indicators\n- Embedded content plays inline\n- Responsive design for all devices\n- Google Classroom sharing for published books\n\n## External Dependencies\n\n*   **AI Integration**: \n    - OpenAI GPT-5 model for text content generation\n    - OpenAI DALL-E 3 for premium AI image generation in Interactive Books\n    - Puter.js for free, browser-based AI image generation in Interactive Books and Google Slides (no API key required)\n*   **OAuth Providers**: Google OAuth 2.0 (via Passport.js) and Microsoft OAuth 2.0 (via @azure/msal-node) for user authentication.\n*   **Google Slides API**: Google Slides API (via googleapis npm package) for creating actual presentations.\n*   **Google Classroom API**: Google Classroom API (via googleapis npm package) for sharing presentations to courses.\n*   **Unsplash API**: Unsplash API for fetching educational stock photos for presentations.\n*   **Database Service**: Neon PostgreSQL serverless database.\n*   **Font Delivery**: Google Fonts CDN for Inter and JetBrains Mono.\n*   **Development Tools**: Replit-specific plugins, TypeScript compiler.\n*   **Session Storage**: PostgreSQL-backed session storage (via connect-pg-simple) with memory fallback for development.\n*   **Build & Deployment**: esbuild for server-side, Vite for client-side bundling, support for static hosting platforms.\n\n## OAuth Authentication Setup\n\nThe application supports Google and Microsoft OAuth authentication. See `OAUTH_SETUP_GUIDE.md` for detailed setup instructions.\n\n### Required Secrets for Production\n- `SESSION_SECRET`: Required for secure session management\n- `OPENAI_API_KEY`: Required for AI text content generation. Optional for image generation (Puter.js provides free alternative)\n- `GOOGLE_CLIENT_ID` and `GOOGLE_CLIENT_SECRET`: Optional, for Google OAuth (required for Google Slides API access)\n- `MICROSOFT_CLIENT_ID`, `MICROSOFT_CLIENT_SECRET`, and `MICROSOFT_TENANT_ID`: Optional, for Microsoft OAuth\n- `UNSPLASH_ACCESS_KEY`: Optional for Google Slides presentations (Puter.js AI provides free alternative)\n- `DATABASE_URL`: Recommended for production (enables persistent session storage)\n\n### OAuth Features\n- Seamless account creation on first OAuth sign-in\n- Account linking for existing users who sign in with OAuth\n- Secure sentinel passwords for OAuth-only accounts\n- Production-ready session persistence with PostgreSQL\n- Graceful fallback to memory sessions in development\n- **Google OAuth token storage**: Access tokens and refresh tokens stored for Google Slides API and Classroom API access\n- **OAuth scope management**: Requests multiple Google API scopes:\n  - `https://www.googleapis.com/auth/presentations` - Google Slides API for presentation creation\n  - `https://www.googleapis.com/auth/classroom.courses.readonly` - List teacher's Classroom courses\n  - `https://www.googleapis.com/auth/classroom.coursework.students` - Create assignments\n  - `https://www.googleapis.com/auth/classroom.announcements` - Create announcements","size_bytes":13342},"client/src/pages/not-found.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { AlertCircle } from \"lucide-react\";\n\nexport default function NotFound() {\n  return (\n    <div className=\"min-h-screen w-full flex items-center justify-center bg-gray-50\">\n      <Card className=\"w-full max-w-md mx-4\">\n        <CardContent className=\"pt-6\">\n          <div className=\"flex mb-4 gap-2\">\n            <AlertCircle className=\"h-8 w-8 text-red-500\" />\n            <h1 className=\"text-2xl font-bold text-gray-900\">404 Page Not Found</h1>\n          </div>\n\n          <p className=\"mt-4 text-sm text-gray-600\">\n            Did you forget to add the page to the router?\n          </p>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":711},"client/src/components/ui/avatar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as AvatarPrimitive from \"@radix-ui/react-avatar\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Avatar = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Root\n    ref={ref}\n    className={cn(`\n      after:content-[''] after:block after:absolute after:inset-0 after:rounded-full after:pointer-events-none after:border after:border-black/10 dark:after:border-white/10\n      relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full`,\n      className\n    )}\n    {...props}\n  />\n))\nAvatar.displayName = AvatarPrimitive.Root.displayName\n\nconst AvatarImage = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Image>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Image\n    ref={ref}\n    className={cn(\"aspect-square h-full w-full\", className)}\n    {...props}\n  />\n))\nAvatarImage.displayName = AvatarPrimitive.Image.displayName\n\nconst AvatarFallback = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Fallback>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Fallback\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full items-center justify-center rounded-full bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatarFallback.displayName = AvatarPrimitive.Fallback.displayName\n\nexport { Avatar, AvatarImage, AvatarFallback }\n","size_bytes":1592},"client/src/components/ui/command.tsx":{"content":"import * as React from \"react\"\nimport { type DialogProps } from \"@radix-ui/react-dialog\"\nimport { Command as CommandPrimitive } from \"cmdk\"\nimport { Search } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Dialog, DialogContent } from \"@/components/ui/dialog\"\n\nconst Command = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nCommand.displayName = CommandPrimitive.displayName\n\nconst CommandDialog = ({ children, ...props }: DialogProps) => {\n  return (\n    <Dialog {...props}>\n      <DialogContent className=\"overflow-hidden p-0 shadow-lg\">\n        <Command className=\"[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5\">\n          {children}\n        </Command>\n      </DialogContent>\n    </Dialog>\n  )\n}\n\nconst CommandInput = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Input>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>\n>(({ className, ...props }, ref) => (\n  <div className=\"flex items-center border-b px-3\" cmdk-input-wrapper=\"\">\n    <Search className=\"mr-2 h-4 w-4 shrink-0 opacity-50\" />\n    <CommandPrimitive.Input\n      ref={ref}\n      className={cn(\n        \"flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    />\n  </div>\n))\n\nCommandInput.displayName = CommandPrimitive.Input.displayName\n\nconst CommandList = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.List\n    ref={ref}\n    className={cn(\"max-h-[300px] overflow-y-auto overflow-x-hidden\", className)}\n    {...props}\n  />\n))\n\nCommandList.displayName = CommandPrimitive.List.displayName\n\nconst CommandEmpty = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Empty>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>\n>((props, ref) => (\n  <CommandPrimitive.Empty\n    ref={ref}\n    className=\"py-6 text-center text-sm\"\n    {...props}\n  />\n))\n\nCommandEmpty.displayName = CommandPrimitive.Empty.displayName\n\nconst CommandGroup = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Group>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Group\n    ref={ref}\n    className={cn(\n      \"overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandGroup.displayName = CommandPrimitive.Group.displayName\n\nconst CommandSeparator = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nCommandSeparator.displayName = CommandPrimitive.Separator.displayName\n\nconst CommandItem = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandItem.displayName = CommandPrimitive.Item.displayName\n\nconst CommandShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nCommandShortcut.displayName = \"CommandShortcut\"\n\nexport {\n  Command,\n  CommandDialog,\n  CommandInput,\n  CommandList,\n  CommandEmpty,\n  CommandGroup,\n  CommandItem,\n  CommandShortcut,\n  CommandSeparator,\n}\n","size_bytes":4885},"client/src/components/ui/toaster.tsx":{"content":"import { useToast } from \"@/hooks/use-toast\"\nimport {\n  Toast,\n  ToastClose,\n  ToastDescription,\n  ToastProvider,\n  ToastTitle,\n  ToastViewport,\n} from \"@/components/ui/toast\"\n\nexport function Toaster() {\n  const { toasts } = useToast()\n\n  return (\n    <ToastProvider>\n      {toasts.map(function ({ id, title, description, action, ...props }) {\n        return (\n          <Toast key={id} {...props}>\n            <div className=\"grid gap-1\">\n              {title && <ToastTitle>{title}</ToastTitle>}\n              {description && (\n                <ToastDescription>{description}</ToastDescription>\n              )}\n            </div>\n            {action}\n            <ToastClose />\n          </Toast>\n        )\n      })}\n      <ToastViewport />\n    </ToastProvider>\n  )\n}\n","size_bytes":772},"client/src/components/ui/button.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\" +\n  \" hover-elevate active-elevate-2\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"bg-primary text-primary-foreground border border-primary-border\",\n        destructive:\n          \"bg-destructive text-destructive-foreground border border-destructive-border\",\n        outline:\n          // Shows the background color of whatever card / sidebar / accent background it is inside of.\n          // Inherits the current text color.\n          \" border [border-color:var(--button-outline)]  shadow-xs active:shadow-none \",\n        secondary: \"border bg-secondary text-secondary-foreground border border-secondary-border \",\n        // Add a transparent border so that when someone toggles a border on later, it doesn't shift layout/size.\n        ghost: \"border border-transparent\",\n      },\n      // Heights are set as \"min\" heights, because sometimes Ai will place large amount of content\n      // inside buttons. With a min-height they will look appropriate with small amounts of content,\n      // but will expand to fit large amounts of content.\n      size: {\n        default: \"min-h-9 px-4 py-2\",\n        sm: \"min-h-8 rounded-md px-3 text-xs\",\n        lg: \"min-h-10 rounded-md px-8\",\n        icon: \"h-9 w-9\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  },\n)\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"button\"\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      />\n    )\n  },\n)\nButton.displayName = \"Button\"\n\nexport { Button, buttonVariants }\n","size_bytes":2359},"client/src/components/ui/pagination.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { ButtonProps, buttonVariants } from \"@/components/ui/button\"\n\nconst Pagination = ({ className, ...props }: React.ComponentProps<\"nav\">) => (\n  <nav\n    role=\"navigation\"\n    aria-label=\"pagination\"\n    className={cn(\"mx-auto flex w-full justify-center\", className)}\n    {...props}\n  />\n)\nPagination.displayName = \"Pagination\"\n\nconst PaginationContent = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    className={cn(\"flex flex-row items-center gap-1\", className)}\n    {...props}\n  />\n))\nPaginationContent.displayName = \"PaginationContent\"\n\nconst PaginationItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li ref={ref} className={cn(\"\", className)} {...props} />\n))\nPaginationItem.displayName = \"PaginationItem\"\n\ntype PaginationLinkProps = {\n  isActive?: boolean\n} & Pick<ButtonProps, \"size\"> &\n  React.ComponentProps<\"a\">\n\nconst PaginationLink = ({\n  className,\n  isActive,\n  size = \"icon\",\n  ...props\n}: PaginationLinkProps) => (\n  <a\n    aria-current={isActive ? \"page\" : undefined}\n    className={cn(\n      buttonVariants({\n        variant: isActive ? \"outline\" : \"ghost\",\n        size,\n      }),\n      className\n    )}\n    {...props}\n  />\n)\nPaginationLink.displayName = \"PaginationLink\"\n\nconst PaginationPrevious = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to previous page\"\n    size=\"default\"\n    className={cn(\"gap-1 pl-2.5\", className)}\n    {...props}\n  >\n    <ChevronLeft className=\"h-4 w-4\" />\n    <span>Previous</span>\n  </PaginationLink>\n)\nPaginationPrevious.displayName = \"PaginationPrevious\"\n\nconst PaginationNext = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to next page\"\n    size=\"default\"\n    className={cn(\"gap-1 pr-2.5\", className)}\n    {...props}\n  >\n    <span>Next</span>\n    <ChevronRight className=\"h-4 w-4\" />\n  </PaginationLink>\n)\nPaginationNext.displayName = \"PaginationNext\"\n\nconst PaginationEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    aria-hidden\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More pages</span>\n  </span>\n)\nPaginationEllipsis.displayName = \"PaginationEllipsis\"\n\nexport {\n  Pagination,\n  PaginationContent,\n  PaginationEllipsis,\n  PaginationItem,\n  PaginationLink,\n  PaginationNext,\n  PaginationPrevious,\n}\n","size_bytes":2751},"server/routes.ts":{"content":"import type { Express } from \"express\";\nimport { createServer, type Server } from \"http\";\nimport session from \"express-session\";\nimport connectPgSimple from \"connect-pg-simple\";\nimport { Pool } from \"pg\";\nimport crypto from \"crypto\";\nimport { storage } from \"./storage\";\nimport { \n  aiGenerationSchema, \n  videoFinderPedagogySchema,\n  googleSlidesGenerationSchema,\n  insertLearnerProgressSchema, \n  insertQuizAttemptSchema, \n  insertInteractionEventSchema \n} from \"@shared/schema\";\nimport bcrypt from \"bcryptjs\";\nimport { \n  generateQuizQuestions, \n  generateFlashcards, \n  generateVideoHotspots, \n  generateImageHotspots,\n  generateDragDropItems,\n  generateFillBlanksBlanks,\n  generateMemoryGameCards,\n  generateInteractiveBookPages,\n  generateVideoFinderPedagogy,\n  generateGoogleSlides,\n  getOpenAIClient\n} from \"./openai\";\nimport { searchEducationalVideos } from \"./youtube\";\nimport passportConfig from \"./passport-config\";\nimport { getMsalClient, getRedirectUri } from \"./msal-config\";\n\n// Type augmentation for session\ndeclare module \"express-session\" {\n  interface SessionData {\n    userId: string;\n    oauthReturnTo?: string;\n  }\n}\n\nexport async function registerRoutes(app: Express): Promise<Server> {\n  // Validate required environment variables\n  if (!process.env.SESSION_SECRET) {\n    throw new Error(\"SESSION_SECRET environment variable is required\");\n  }\n\n  // Trust proxy for deployed apps (Replit uses reverse proxy)\n  // This is critical for secure cookies to work properly\n  if (process.env.NODE_ENV === \"production\") {\n    app.set(\"trust proxy\", 1);\n  }\n\n  // Configure session store (PostgreSQL or memory fallback)\n  let sessionStore: session.Store | undefined;\n  \n  if (process.env.DATABASE_URL) {\n    // Use PostgreSQL session store (recommended for production)\n    const PgSession = connectPgSimple(session);\n    const pgPool = new Pool({\n      connectionString: process.env.DATABASE_URL,\n      ssl: {\n        rejectUnauthorized: false,\n      },\n      max: 20,\n      idleTimeoutMillis: 30000,\n      connectionTimeoutMillis: 10000, // Increased timeout for Neon cold starts\n    });\n    \n    // Handle pool errors\n    pgPool.on('error', (err) => {\n      console.error('Unexpected error on idle PostgreSQL client', err);\n    });\n    \n    // Test database connection at startup\n    try {\n      await pgPool.query('SELECT NOW()');\n      console.log('✓ PostgreSQL connection verified');\n      \n      sessionStore = new PgSession({\n        pool: pgPool,\n        createTableIfMissing: true,\n        tableName: \"session\",\n        pruneSessionInterval: 900, // Clean up old sessions every 15 minutes\n        errorLog: (error) => {\n          console.error('Session store error:', error);\n        },\n      });\n      console.log('✓ Using PostgreSQL session store');\n    } catch (error) {\n      console.error('⚠ Failed to connect to PostgreSQL:', error);\n      console.warn('⚠ Falling back to memory session store (not recommended for production)');\n      sessionStore = undefined; // Will use default memory store\n    }\n  } else {\n    console.warn('⚠ DATABASE_URL not set. Using memory session store.');\n    console.warn('⚠ For production, set DATABASE_URL to use persistent session storage.');\n    sessionStore = undefined; // Will use default memory store\n  }\n  \n  // Check OAuth provider availability\n  const isGoogleOAuthAvailable = !!(\n    process.env.GOOGLE_CLIENT_ID && process.env.GOOGLE_CLIENT_SECRET\n  );\n  const isMicrosoftOAuthAvailable = !!(\n    process.env.MICROSOFT_CLIENT_ID && \n    process.env.MICROSOFT_CLIENT_SECRET && \n    process.env.MICROSOFT_TENANT_ID\n  );\n  \n  console.log('OAuth providers:', {\n    google: isGoogleOAuthAvailable,\n    microsoft: isMicrosoftOAuthAvailable,\n  });\n\n  // Session middleware\n  const sessionConfig: session.SessionOptions = {\n    secret: process.env.SESSION_SECRET!,\n    resave: false,\n    saveUninitialized: false,\n    cookie: {\n      secure: process.env.NODE_ENV === \"production\",\n      httpOnly: true,\n      sameSite: \"lax\", // Use 'lax' since frontend and backend are same-origin\n      maxAge: 1000 * 60 * 60 * 24 * 7, // 7 days\n    },\n  };\n  \n  // Add PostgreSQL store if available\n  if (sessionStore) {\n    sessionConfig.store = sessionStore;\n  }\n  \n  app.use(session(sessionConfig));\n\n  // Initialize Passport\n  app.use(passportConfig.initialize());\n  app.use(passportConfig.session());\n\n  // Auth middleware\n  const requireAuth = (req: any, res: any, next: any) => {\n    if (!req.session.userId) {\n      return res.status(401).json({ message: \"Unauthorized\" });\n    }\n    next();\n  };\n\n  // Auth routes\n  app.post(\"/api/auth/register\", async (req, res) => {\n    try {\n      const { email, password, fullName, role, institution } = req.body;\n\n      if (!email || !password || !fullName) {\n        return res.status(400).json({ message: \"Missing required fields\" });\n      }\n\n      const existing = await storage.getProfileByEmail(email);\n      if (existing) {\n        return res.status(400).json({ message: \"Email already registered\" });\n      }\n\n      const profile = await storage.createProfile({\n        email,\n        password,\n        fullName,\n        role: role || \"teacher\",\n        institution: institution || null,\n      });\n\n      req.session.userId = profile.id;\n\n      // Don't send password back\n      const { password: _, ...profileWithoutPassword } = profile;\n      res.json(profileWithoutPassword);\n    } catch (error: any) {\n      console.error(\"Registration error:\", error);\n      res.status(500).json({ message: \"Registration failed\" });\n    }\n  });\n\n  app.post(\"/api/auth/login\", async (req, res) => {\n    try {\n      const { email, password } = req.body;\n\n      if (!email || !password) {\n        return res.status(400).json({ message: \"Missing email or password\" });\n      }\n\n      const profile = await storage.getProfileByEmail(email);\n      if (!profile) {\n        return res.status(401).json({ message: \"Invalid credentials\" });\n      }\n\n      // OAuth users have sentinel passwords and should not use password login\n      if (!profile.password) {\n        return res.status(401).json({ message: \"Invalid credentials\" });\n      }\n\n      const isValid = await bcrypt.compare(password, profile.password);\n      if (!isValid) {\n        return res.status(401).json({ message: \"Invalid credentials\" });\n      }\n\n      req.session.userId = profile.id;\n\n      const { password: _, ...profileWithoutPassword } = profile;\n      res.json(profileWithoutPassword);\n    } catch (error: any) {\n      console.error(\"Login error:\", error);\n      res.status(500).json({ message: \"Login failed\" });\n    }\n  });\n\n  app.get(\"/api/auth/me\", requireAuth, async (req, res) => {\n    try {\n      const profile = await storage.getProfileById(req.session.userId!);\n      if (!profile) {\n        return res.status(404).json({ message: \"Profile not found\" });\n      }\n\n      const { password: _, ...profileWithoutPassword } = profile;\n      res.json(profileWithoutPassword);\n    } catch (error: any) {\n      console.error(\"Get profile error:\", error);\n      res.status(500).json({ message: \"Failed to get profile\" });\n    }\n  });\n\n  app.get(\"/api/auth/providers\", (req, res) => {\n    res.json({\n      google: isGoogleOAuthAvailable,\n      microsoft: isMicrosoftOAuthAvailable,\n    });\n  });\n\n  app.post(\"/api/auth/logout\", (req, res) => {\n    req.session.destroy((err) => {\n      if (err) {\n        return res.status(500).json({ message: \"Logout failed\" });\n      }\n      res.json({ message: \"Logged out successfully\" });\n    });\n  });\n\n  // Google OAuth routes\n  app.get(\"/api/auth/google\", (req, res, next) => {\n    if (!isGoogleOAuthAvailable) {\n      return res.status(503).json({ \n        message: \"Google authentication is not configured. Please set GOOGLE_CLIENT_ID and GOOGLE_CLIENT_SECRET.\" \n      });\n    }\n    \n    // Store return URL in session if provided\n    const returnTo = req.query.returnTo as string;\n    if (returnTo && returnTo.startsWith('/')) {\n      req.session.oauthReturnTo = returnTo;\n    }\n    \n    // Request all required Google API scopes for Slides and Classroom integration\n    passportConfig.authenticate(\"google\", {\n      scope: [\n        'profile',\n        'email',\n        'https://www.googleapis.com/auth/presentations', // Google Slides API\n        'https://www.googleapis.com/auth/classroom.courses.readonly', // List Classroom courses\n        'https://www.googleapis.com/auth/classroom.coursework.students', // Create assignments\n        'https://www.googleapis.com/auth/classroom.announcements', // Create announcements\n      ]\n    })(req, res, next);\n  });\n\n  app.get(\"/api/auth/google/callback\", (req, res, next) => {\n    if (!isGoogleOAuthAvailable) {\n      return res.redirect(\"/login?error=google_not_configured\");\n    }\n    passportConfig.authenticate(\"google\", { failureRedirect: \"/login\" })(req, res, next);\n  }, (req: any, res) => {\n    // Set session userId\n    req.session.userId = req.user.id;\n    \n    // Get return URL from session (validate it's a safe relative path)\n    const returnTo = req.session.oauthReturnTo;\n    delete req.session.oauthReturnTo;\n    \n    req.session.save(() => {\n      // Redirect to stored return URL or dashboard\n      if (returnTo && returnTo.startsWith('/') && !returnTo.includes('//')) {\n        res.redirect(returnTo + '?googleAuthSuccess=true');\n      } else {\n        res.redirect(\"/dashboard?googleAuthSuccess=true\");\n      }\n    });\n  });\n\n  // Microsoft OAuth routes (using MSAL)\n  app.get(\"/api/auth/microsoft\", async (req, res) => {\n    if (!isMicrosoftOAuthAvailable) {\n      return res.status(503).json({ \n        message: \"Microsoft authentication is not configured. Please set MICROSOFT_CLIENT_ID, MICROSOFT_CLIENT_SECRET, and MICROSOFT_TENANT_ID.\" \n      });\n    }\n\n    try {\n      const msalClient = getMsalClient();\n      if (!msalClient) {\n        return res.status(503).json({ message: \"Microsoft OAuth client not configured\" });\n      }\n\n      const redirectUri = getRedirectUri(req);\n      const authCodeUrlParameters = {\n        scopes: [\"user.read\"],\n        redirectUri,\n      };\n\n      const authUrl = await msalClient.getAuthCodeUrl(authCodeUrlParameters);\n      res.redirect(authUrl);\n    } catch (error) {\n      console.error(\"Microsoft OAuth initiation error:\", error);\n      res.status(500).json({ message: \"Failed to initiate Microsoft authentication\" });\n    }\n  });\n\n  app.get(\"/api/auth/microsoft/callback\", async (req, res) => {\n    if (!isMicrosoftOAuthAvailable) {\n      return res.redirect(\"/login?error=microsoft_not_configured\");\n    }\n\n    try {\n      const msalClient = getMsalClient();\n      if (!msalClient) {\n        return res.redirect(\"/login?error=microsoft_not_configured\");\n      }\n\n      const redirectUri = getRedirectUri(req);\n      const tokenRequest = {\n        code: req.query.code as string,\n        scopes: [\"user.read\"],\n        redirectUri,\n      };\n\n      const response = await msalClient.acquireTokenByCode(tokenRequest);\n      \n      if (!response || !response.account) {\n        return res.redirect(\"/login?error=microsoft_no_account\");\n      }\n\n      const { username: email, name } = response.account;\n      const microsoftId = response.account.homeAccountId;\n\n      if (!email) {\n        return res.redirect(\"/login?error=microsoft_no_email\");\n      }\n\n      let user = await storage.getProfileByEmail(email);\n\n      if (!user) {\n        const sentinelPassword = await bcrypt.hash(crypto.randomBytes(32).toString('hex'), 10);\n        \n        user = await storage.createProfile({\n          email,\n          password: sentinelPassword,\n          fullName: name || email,\n          role: 'teacher',\n          institution: null,\n          authProvider: 'microsoft',\n          googleId: null,\n          microsoftId,\n        });\n      } else if (!user.microsoftId) {\n        await storage.updateProfile(user.id, {\n          microsoftId,\n        });\n      }\n\n      req.session.userId = user.id;\n      req.session.save(() => {\n        res.redirect(\"/dashboard\");\n      });\n    } catch (error) {\n      console.error(\"Microsoft OAuth callback error:\", error);\n      res.redirect(\"/login?error=microsoft_auth_failed\");\n    }\n  });\n\n  // Content routes\n  app.get(\"/api/content\", requireAuth, async (req, res) => {\n    try {\n      const { search, type, tags, startDate, endDate } = req.query;\n      let contents = await storage.getContentByUserId(req.session.userId!);\n      \n      // Apply search filter (title or description)\n      if (search && typeof search === 'string') {\n        const searchLower = search.toLowerCase();\n        contents = contents.filter(c => \n          c.title.toLowerCase().includes(searchLower) || \n          (c.description && c.description.toLowerCase().includes(searchLower))\n        );\n      }\n      \n      // Apply content type filter\n      if (type && typeof type === 'string') {\n        contents = contents.filter(c => c.type === type);\n      }\n      \n      // Apply tags filter (comma-separated)\n      if (tags && typeof tags === 'string') {\n        const tagList = tags.split(',').map(t => t.trim().toLowerCase());\n        contents = contents.filter(c => \n          c.tags && c.tags.some(tag => tagList.includes(tag.toLowerCase()))\n        );\n      }\n      \n      // Apply date range filter\n      if (startDate && typeof startDate === 'string') {\n        const start = new Date(startDate);\n        if (!isNaN(start.getTime())) {\n          contents = contents.filter(c => {\n            if (!c.updatedAt) return false;\n            const updated = new Date(c.updatedAt);\n            return !isNaN(updated.getTime()) && updated >= start;\n          });\n        }\n      }\n      if (endDate && typeof endDate === 'string') {\n        const end = new Date(endDate);\n        if (!isNaN(end.getTime())) {\n          end.setHours(23, 59, 59, 999); // Include the entire end date\n          contents = contents.filter(c => {\n            if (!c.updatedAt) return false;\n            const updated = new Date(c.updatedAt);\n            return !isNaN(updated.getTime()) && updated <= end;\n          });\n        }\n      }\n      \n      res.json(contents);\n    } catch (error: any) {\n      console.error(\"Get content error:\", error);\n      res.status(500).json({ message: \"Failed to fetch content\" });\n    }\n  });\n\n  // Public content route\n  app.get(\"/api/content/public\", requireAuth, async (req, res) => {\n    try {\n      const { search, type, tags } = req.query;\n      console.log(`[DEBUG] Query params:`, { search, type, tags });\n      \n      let contents = await storage.getPublicContent();\n      console.log(`[DEBUG] Public content query returned ${contents.length} items`);\n      console.log(`[DEBUG] First item:`, contents[0] ? JSON.stringify(contents[0]) : 'none');\n      \n      // Apply search filter (title or description)\n      if (search && typeof search === 'string') {\n        const searchLower = search.toLowerCase();\n        contents = contents.filter(c => \n          c.title.toLowerCase().includes(searchLower) || \n          (c.description && c.description.toLowerCase().includes(searchLower))\n        );\n        console.log(`[DEBUG] After search filter: ${contents.length} items`);\n      }\n      \n      // Apply content type filter\n      if (type && typeof type === 'string') {\n        contents = contents.filter(c => c.type === type);\n        console.log(`[DEBUG] After type filter: ${contents.length} items`);\n      }\n      \n      // Apply tags filter (comma-separated)\n      if (tags && typeof tags === 'string') {\n        const tagList = tags.split(',').map(t => t.trim().toLowerCase());\n        contents = contents.filter(c => \n          c.tags && c.tags.some(tag => tagList.includes(tag.toLowerCase()))\n        );\n        console.log(`[DEBUG] After tags filter: ${contents.length} items`);\n      }\n      \n      console.log(`[DEBUG] Final response: ${contents.length} items`);\n      console.log(`[DEBUG] Response data:`, JSON.stringify(contents));\n      \n      // Prevent caching so updates are immediately visible\n      res.set('Cache-Control', 'no-cache, no-store, must-revalidate');\n      res.set('Pragma', 'no-cache');\n      res.set('Expires', '0');\n      res.json(contents);\n    } catch (error: any) {\n      console.error(\"Get public content error:\", error);\n      res.status(500).json({ message: \"Failed to fetch public content\" });\n    }\n  });\n\n  app.get(\"/api/content/:id\", requireAuth, async (req, res) => {\n    try {\n      const content = await storage.getContentById(req.params.id);\n      if (!content) {\n        return res.status(404).json({ message: \"Content not found\" });\n      }\n\n      if (content.userId !== req.session.userId) {\n        return res.status(403).json({ message: \"Forbidden\" });\n      }\n\n      res.json(content);\n    } catch (error: any) {\n      console.error(\"Get content error:\", error);\n      res.status(500).json({ message: \"Failed to fetch content\" });\n    }\n  });\n\n  app.post(\"/api/content\", requireAuth, async (req, res) => {\n    try {\n      const { title, description, type, data, isPublished, isPublic, tags } = req.body;\n\n      if (!title || !type || !data) {\n        return res.status(400).json({ message: \"Missing required fields\" });\n      }\n\n      const content = await storage.createContent({\n        title,\n        description: description || null,\n        type,\n        data,\n        userId: req.session.userId!,\n        isPublished: isPublished || false,\n        isPublic: isPublic || false,\n        tags: tags || null,\n      });\n\n      res.json(content);\n    } catch (error: any) {\n      console.error(\"Create content error:\", error);\n      res.status(500).json({ message: \"Failed to create content\" });\n    }\n  });\n\n  app.put(\"/api/content/:id\", requireAuth, async (req, res) => {\n    try {\n      const existing = await storage.getContentById(req.params.id);\n      if (!existing) {\n        return res.status(404).json({ message: \"Content not found\" });\n      }\n\n      if (existing.userId !== req.session.userId) {\n        return res.status(403).json({ message: \"Forbidden\" });\n      }\n\n      const { title, description, data, isPublished, isPublic, tags } = req.body;\n      const updates: any = {};\n\n      if (title !== undefined) updates.title = title;\n      if (description !== undefined) updates.description = description;\n      if (data !== undefined) updates.data = data;\n      if (isPublished !== undefined) updates.isPublished = isPublished;\n      if (isPublic !== undefined) updates.isPublic = isPublic;\n      if (tags !== undefined) updates.tags = tags;\n\n      const updated = await storage.updateContent(req.params.id, updates);\n      res.json(updated);\n    } catch (error: any) {\n      console.error(\"Update content error:\", error);\n      res.status(500).json({ message: \"Failed to update content\" });\n    }\n  });\n\n  app.delete(\"/api/content/:id\", requireAuth, async (req, res) => {\n    try {\n      const existing = await storage.getContentById(req.params.id);\n      if (!existing) {\n        return res.status(404).json({ message: \"Content not found\" });\n      }\n\n      if (existing.userId !== req.session.userId) {\n        return res.status(403).json({ message: \"Forbidden\" });\n      }\n\n      await storage.deleteContent(req.params.id);\n      res.json({ message: \"Content deleted successfully\" });\n    } catch (error: any) {\n      console.error(\"Delete content error:\", error);\n      res.status(500).json({ message: \"Failed to delete content\" });\n    }\n  });\n\n  app.post(\"/api/content/:id/share\", requireAuth, async (req, res) => {\n    try {\n      const content = await storage.getContentById(req.params.id);\n      if (!content) {\n        return res.status(404).json({ message: \"Content not found\" });\n      }\n\n      if (content.userId !== req.session.userId) {\n        return res.status(403).json({ message: \"Forbidden\" });\n      }\n\n      // Ensure content is published\n      if (!content.isPublished) {\n        await storage.updateContent(req.params.id, { isPublished: true });\n      }\n\n      const share = await storage.createShare({\n        contentId: req.params.id,\n        sharedBy: req.session.userId!,\n      });\n\n      res.json(share);\n    } catch (error: any) {\n      console.error(\"Share content error:\", error);\n      res.status(500).json({ message: \"Failed to share content\" });\n    }\n  });\n\n  // Copy public content to user's library\n  app.post(\"/api/content/:id/copy\", requireAuth, async (req, res) => {\n    try {\n      const copiedContent = await storage.copyContent(req.params.id, req.session.userId!);\n      res.json(copiedContent);\n    } catch (error: any) {\n      console.error(\"Copy content error:\", error);\n      if (error.message === \"Content not found\") {\n        return res.status(404).json({ message: error.message });\n      }\n      if (error.message === \"Content must be published and public to be copied\") {\n        return res.status(403).json({ message: error.message });\n      }\n      res.status(500).json({ message: \"Failed to copy content\" });\n    }\n  });\n\n  // Public preview route\n  app.get(\"/api/preview/:id\", async (req, res) => {\n    try {\n      const content = await storage.getPublishedContent(req.params.id);\n      if (!content) {\n        return res.status(404).json({ message: \"Content not found or not published\" });\n      }\n\n      res.json(content);\n    } catch (error: any) {\n      console.error(\"Preview content error:\", error);\n      res.status(500).json({ message: \"Failed to fetch content\" });\n    }\n  });\n\n  // AI generation route\n  app.post(\"/api/ai/generate\", requireAuth, async (req, res) => {\n    try {\n      const parsed = aiGenerationSchema.parse(req.body);\n\n      let result: any;\n\n      switch (parsed.contentType) {\n        case \"quiz\":\n          result = { questions: await generateQuizQuestions(parsed) };\n          break;\n        case \"flashcard\":\n          result = { cards: await generateFlashcards(parsed) };\n          break;\n        case \"interactive-video\":\n          result = { hotspots: await generateVideoHotspots(parsed) };\n          break;\n        case \"image-hotspot\":\n          result = { hotspots: await generateImageHotspots(parsed) };\n          break;\n        case \"drag-drop\":\n          result = await generateDragDropItems(parsed);\n          break;\n        case \"fill-blanks\":\n          result = await generateFillBlanksBlanks(parsed);\n          break;\n        case \"memory-game\":\n          result = { cards: await generateMemoryGameCards(parsed) };\n          break;\n        case \"interactive-book\":\n          result = { pages: await generateInteractiveBookPages(parsed) };\n          break;\n        default:\n          return res.status(400).json({ message: \"Invalid content type\" });\n      }\n\n      res.json(result);\n    } catch (error: any) {\n      console.error(\"AI generation error:\", error);\n      res.status(500).json({ message: error.message || \"Failed to generate content\" });\n    }\n  });\n\n  // Chat assistant endpoint with streaming\n  app.post(\"/api/chat\", requireAuth, async (req, res) => {\n    try {\n      const { message, context } = req.body;\n      const userId = req.session.userId!;\n\n      if (!message || typeof message !== \"string\") {\n        return res.status(400).json({ message: \"Message is required\" });\n      }\n\n      // Get user info\n      const user = await storage.getProfileById(userId);\n      if (!user) {\n        return res.status(404).json({ message: \"User not found\" });\n      }\n\n      // Get recent chat history for context (last 10 messages)\n      const history = await storage.getChatHistory(userId, 10);\n      const recentMessages = history.reverse().slice(-10);\n\n      // Build context-aware system message\n      let systemMessage = `You are a helpful AI assistant for the OECS Content Creator platform, an educational content creation tool for teachers in the Organization of Eastern Caribbean States.\n\nYour role is to help educators:\n- Create engaging educational content (quizzes, flashcards, interactive videos, etc.)\n- Get guidance on using the platform features\n- Answer questions about educational best practices\n- Provide support with content creation\n\nUser Information:\n- Name: ${user.fullName}\n- Role: ${user.role}\n- Institution: ${user.institution || \"Not specified\"}\n\nPlatform Features:\n- 8 content types: Quiz, Flashcard, Interactive Video, Image Hotspot, Drag & Drop, Fill in the Blanks, Memory Game, Interactive Book\n- AI-powered content generation\n- Progress tracking and analytics\n- Public sharing and preview links\n- Full accessibility support (WCAG 2.1 AA compliant)\n\nBe conversational, friendly, and educational. Provide specific, actionable advice.`;\n\n      // Add additional context if provided\n      if (context) {\n        systemMessage += `\\n\\nCurrent Context:\\n${JSON.stringify(context, null, 2)}`;\n      }\n\n      // Build messages array for OpenAI\n      const messages: any[] = [\n        { role: \"system\", content: systemMessage },\n        ...recentMessages.map((msg) => ({\n          role: msg.role,\n          content: msg.content,\n        })),\n        { role: \"user\", content: message },\n      ];\n\n      // Save user message\n      await storage.createChatMessage({\n        userId,\n        role: \"user\",\n        content: message,\n        context: context || null,\n      });\n\n      // CRITICAL: Save session before starting SSE stream\n      // This ensures auth cookies remain valid during streaming in production\n      await new Promise<void>((resolve, reject) => {\n        req.session.save((err) => {\n          if (err) reject(err);\n          else resolve();\n        });\n      });\n\n      // Set headers for streaming\n      res.setHeader(\"Content-Type\", \"text/event-stream\");\n      res.setHeader(\"Cache-Control\", \"no-cache\");\n      res.setHeader(\"Connection\", \"keep-alive\");\n\n      const openai = getOpenAIClient();\n      const stream = await openai.chat.completions.create({\n        model: \"gpt-5\",\n        messages,\n        stream: true,\n        max_completion_tokens: 2048,\n      });\n\n      let fullResponse = \"\";\n\n      // Stream the response\n      for await (const chunk of stream) {\n        const content = chunk.choices[0]?.delta?.content || \"\";\n        if (content) {\n          fullResponse += content;\n          res.write(`data: ${JSON.stringify({ content })}\\n\\n`);\n        }\n      }\n\n      // Save assistant response\n      await storage.createChatMessage({\n        userId,\n        role: \"assistant\",\n        content: fullResponse,\n        context: null,\n      });\n\n      res.write(`data: [DONE]\\n\\n`);\n      res.end();\n    } catch (error: any) {\n      console.error(\"Chat error:\", error);\n      if (!res.headersSent) {\n        res.status(500).json({ message: error.message || \"Failed to process chat\" });\n      } else {\n        res.write(`data: ${JSON.stringify({ error: error.message })}\\n\\n`);\n        res.end();\n      }\n    }\n  });\n\n  // Get chat history\n  app.get(\"/api/chat/history\", requireAuth, async (req, res) => {\n    try {\n      const userId = req.session.userId!;\n      const limit = parseInt(req.query.limit as string) || 50;\n      const history = await storage.getChatHistory(userId, limit);\n      res.json(history.reverse());\n    } catch (error: any) {\n      console.error(\"Get chat history error:\", error);\n      res.status(500).json({ message: \"Failed to get chat history\" });\n    }\n  });\n\n  // Clear chat history\n  app.delete(\"/api/chat/history\", requireAuth, async (req, res) => {\n    try {\n      const userId = req.session.userId!;\n      await storage.deleteChatHistory(userId);\n      res.json({ message: \"Chat history cleared\" });\n    } catch (error: any) {\n      console.error(\"Delete chat history error:\", error);\n      res.status(500).json({ message: \"Failed to clear chat history\" });\n    }\n  });\n\n  // Progress tracking routes\n  app.post(\"/api/progress\", requireAuth, async (req, res) => {\n    try {\n      const parsed = insertLearnerProgressSchema.parse({\n        ...req.body,\n        userId: req.session.userId!,\n        completedAt: req.body.completedAt \n          ? new Date(req.body.completedAt) \n          : (req.body.completionPercentage >= 100 ? new Date() : null),\n        lastAccessedAt: new Date(),\n      });\n\n      const progress = await storage.upsertLearnerProgress(parsed);\n      res.json(progress);\n    } catch (error: any) {\n      console.error(\"Save progress error:\", error);\n      if (error.name === 'ZodError') {\n        return res.status(400).json({ message: \"Invalid request data\", errors: error.errors });\n      }\n      res.status(500).json({ message: \"Failed to save progress\" });\n    }\n  });\n\n  app.get(\"/api/progress/:contentId\", requireAuth, async (req, res) => {\n    try {\n      const progress = await storage.getLearnerProgress(req.session.userId!, req.params.contentId);\n      res.json(progress || null);\n    } catch (error: any) {\n      console.error(\"Get progress error:\", error);\n      res.status(500).json({ message: \"Failed to fetch progress\" });\n    }\n  });\n\n  app.get(\"/api/progress\", requireAuth, async (req, res) => {\n    try {\n      const progress = await storage.getAllUserProgress(req.session.userId!);\n      res.json(progress);\n    } catch (error: any) {\n      console.error(\"Get all progress error:\", error);\n      res.status(500).json({ message: \"Failed to fetch progress\" });\n    }\n  });\n\n  // Quiz attempt routes\n  app.post(\"/api/quiz-attempts\", requireAuth, async (req, res) => {\n    try {\n      const parsed = insertQuizAttemptSchema.parse({\n        ...req.body,\n        userId: req.session.userId!,\n      });\n\n      const attempt = await storage.createQuizAttempt(parsed);\n      res.json(attempt);\n    } catch (error: any) {\n      console.error(\"Save quiz attempt error:\", error);\n      if (error.name === 'ZodError') {\n        return res.status(400).json({ message: \"Invalid request data\", errors: error.errors });\n      }\n      res.status(500).json({ message: \"Failed to save quiz attempt\" });\n    }\n  });\n\n  app.get(\"/api/quiz-attempts/:contentId\", requireAuth, async (req, res) => {\n    try {\n      const attempts = await storage.getQuizAttempts(req.session.userId!, req.params.contentId);\n      res.json(attempts);\n    } catch (error: any) {\n      console.error(\"Get quiz attempts error:\", error);\n      res.status(500).json({ message: \"Failed to fetch quiz attempts\" });\n    }\n  });\n\n  // Interaction event routes\n  app.post(\"/api/interaction-events\", requireAuth, async (req, res) => {\n    try {\n      const parsed = insertInteractionEventSchema.parse({\n        ...req.body,\n        userId: req.session.userId!,\n      });\n\n      const event = await storage.createInteractionEvent(parsed);\n      res.json(event);\n    } catch (error: any) {\n      console.error(\"Save interaction event error:\", error);\n      if (error.name === 'ZodError') {\n        return res.status(400).json({ message: \"Invalid request data\", errors: error.errors });\n      }\n      res.status(500).json({ message: \"Failed to save interaction event\" });\n    }\n  });\n\n  app.get(\"/api/interaction-events/:contentId\", requireAuth, async (req, res) => {\n    try {\n      const events = await storage.getInteractionEvents(req.session.userId!, req.params.contentId);\n      res.json(events);\n    } catch (error: any) {\n      console.error(\"Get interaction events error:\", error);\n      res.status(500).json({ message: \"Failed to fetch interaction events\" });\n    }\n  });\n\n  // Analytics routes\n  app.get(\"/api/analytics/overview\", requireAuth, async (req, res) => {\n    try {\n      const analytics = await storage.getUserContentAnalytics(req.session.userId!);\n      res.json(analytics);\n    } catch (error: any) {\n      console.error(\"Get analytics overview error:\", error);\n      res.status(500).json({ message: \"Failed to fetch analytics\" });\n    }\n  });\n\n  app.get(\"/api/analytics/content/:contentId\", requireAuth, async (req, res) => {\n    try {\n      // First verify user owns this content\n      const content = await storage.getContentById(req.params.contentId);\n      if (!content || content.userId !== req.session.userId!) {\n        return res.status(403).json({ message: \"Not authorized to view analytics for this content\" });\n      }\n\n      const analytics = await storage.getContentAnalytics(req.params.contentId);\n      res.json(analytics);\n    } catch (error: any) {\n      console.error(\"Get content analytics error:\", error);\n      res.status(500).json({ message: \"Failed to fetch content analytics\" });\n    }\n  });\n\n  app.get(\"/api/analytics/content/:contentId/learners\", requireAuth, async (req, res) => {\n    try {\n      // First verify user owns this content\n      const content = await storage.getContentById(req.params.contentId);\n      if (!content || content.userId !== req.session.userId!) {\n        return res.status(403).json({ message: \"Not authorized to view learner data for this content\" });\n      }\n\n      const learners = await storage.getContentLearners(req.params.contentId);\n      res.json(learners);\n    } catch (error: any) {\n      console.error(\"Get content learners error:\", error);\n      res.status(500).json({ message: \"Failed to fetch learner data\" });\n    }\n  });\n\n  // YouTube video search route\n  app.post(\"/api/youtube/search\", requireAuth, async (req, res) => {\n    try {\n      const { subject, topic, learningOutcome, gradeLevel, ageRange, videoCount } = req.body;\n\n      if (!subject || !topic || !learningOutcome || !gradeLevel || !videoCount) {\n        return res.status(400).json({ message: \"Missing required search criteria\" });\n      }\n\n      if (videoCount < 1 || videoCount > 50) {\n        return res.status(400).json({ message: \"Video count must be between 1 and 50\" });\n      }\n\n      const results = await searchEducationalVideos({\n        subject,\n        topic,\n        learningOutcome,\n        gradeLevel,\n        ageRange: ageRange || '',\n        maxResults: videoCount,\n      });\n\n      res.json({ results, searchDate: new Date().toISOString() });\n    } catch (error: any) {\n      console.error(\"YouTube search error:\", error);\n      res.status(500).json({ \n        message: error.message || \"Failed to search YouTube videos. Please try again.\" \n      });\n    }\n  });\n\n  // Video Finder AI pedagogy generation route\n  app.post(\"/api/video-finder/generate-pedagogy\", requireAuth, async (req, res) => {\n    try {\n      const parsed = videoFinderPedagogySchema.parse(req.body);\n\n      const result = await generateVideoFinderPedagogy(parsed);\n\n      res.json(result);\n    } catch (error: any) {\n      console.error(\"Video Finder pedagogy generation error:\", error);\n      if (error.name === 'ZodError') {\n        return res.status(400).json({ message: \"Invalid request data\", errors: error.errors });\n      }\n      res.status(500).json({ \n        message: error.message || \"Failed to generate pedagogical content. Please try again.\" \n      });\n    }\n  });\n\n  // Google Slides AI generation route\n  app.post(\"/api/google-slides/generate\", requireAuth, async (req, res) => {\n    try {\n      const parsed = googleSlidesGenerationSchema.parse(req.body);\n\n      const slides = await generateGoogleSlides(parsed);\n\n      res.json({ slides, generatedDate: new Date().toISOString() });\n    } catch (error: any) {\n      console.error(\"Google Slides generation error:\", error);\n      if (error.name === 'ZodError') {\n        return res.status(400).json({ message: \"Invalid request data\", errors: error.errors });\n      }\n      res.status(500).json({ \n        message: error.message || \"Failed to generate slides content. Please try again.\" \n      });\n    }\n  });\n\n  // Fetch image from Unsplash for a given query\n  app.post(\"/api/unsplash/search\", requireAuth, async (req, res) => {\n    try {\n      const { query, count = 1 } = req.body;\n      \n      if (!query) {\n        return res.status(400).json({ message: \"Query is required\" });\n      }\n\n      const { searchPhotos } = await import('./unsplash');\n      const photos = await searchPhotos(query, count);\n      \n      res.json({ photos });\n    } catch (error: any) {\n      console.error(\"Unsplash search error:\", error);\n      res.status(500).json({ \n        message: error.message || \"Failed to search for images\" \n      });\n    }\n  });\n\n  // AI image generation endpoint using OpenAI DALL-E\n  app.post(\"/api/ai/generate-image\", requireAuth, async (req, res) => {\n    try {\n      const { prompt } = req.body;\n      \n      if (!prompt || typeof prompt !== 'string') {\n        return res.status(400).json({ message: \"Prompt is required\" });\n      }\n\n      // Check if OpenAI API key is configured before calling getOpenAIClient\n      if (!process.env.OPENAI_API_KEY) {\n        return res.status(400).json({ \n          message: \"OpenAI API key is not configured. Please add OPENAI_API_KEY to your environment variables to use AI image generation.\" \n        });\n      }\n\n      // Use OpenAI DALL-E for image generation (safe to call now that key is verified)\n      let openai;\n      try {\n        openai = getOpenAIClient();\n      } catch (configError: any) {\n        return res.status(400).json({ \n          message: configError.message || \"OpenAI configuration error. Please check your API key.\" \n        });\n      }\n      \n      const response = await openai.images.generate({\n        model: \"dall-e-3\",\n        prompt: prompt,\n        n: 1,\n        size: \"1024x1024\",\n        quality: \"standard\",\n      });\n\n      const imageUrl = response.data[0]?.url;\n      \n      if (!imageUrl) {\n        throw new Error('No image URL returned from OpenAI');\n      }\n\n      res.json({ \n        imageUrl,\n        prompt,\n        revisedPrompt: response.data[0]?.revised_prompt,\n      });\n    } catch (error: any) {\n      console.error(\"OpenAI image generation error:\", error);\n      res.status(500).json({ \n        message: error.message || \"Failed to generate image with AI. Please try again.\" \n      });\n    }\n  });\n\n  // Create actual Google Slides presentation from generated content\n  app.post(\"/api/google-slides/create-presentation\", requireAuth, async (req, res) => {\n    try {\n      const { title, slides } = req.body;\n\n      if (!title || !slides || !Array.isArray(slides)) {\n        return res.status(400).json({ message: \"Missing required fields: title and slides\" });\n      }\n\n      // Get user profile to access Google OAuth tokens\n      const user = await storage.getProfileById(req.session.userId!);\n      if (!user) {\n        return res.status(404).json({ message: \"User not found\" });\n      }\n\n      if (!user.googleAccessToken || !user.googleRefreshToken) {\n        return res.status(403).json({ \n          message: \"Please sign in with Google to create presentations in Google Slides. Your current account doesn't have Google Slides access.\" \n        });\n      }\n\n      // Import services (dynamic to avoid loading if not needed)\n      const { createPresentation, addSlidesToPresentation } = await import('./google-slides');\n      const { searchPhotos, getAltText, generateAttribution } = await import('./unsplash');\n\n      // Fetch real images for slides that need them\n      const slidesWithImages = await Promise.all(slides.map(async (slide: any) => {\n        if (slide.imageUrl && typeof slide.imageUrl === 'string' && !slide.imageUrl.startsWith('http')) {\n          // imageUrl contains a search query, not an actual URL\n          const photos = await searchPhotos(slide.imageUrl, 1);\n          if (photos.length > 0) {\n            const photo = photos[0];\n            return {\n              ...slide,\n              imageUrl: photo.urls.regular,\n              imageAlt: slide.imageAlt || getAltText(photo),\n              imageAttribution: generateAttribution(photo),\n            };\n          }\n        }\n        return slide;\n      }));\n\n      // Create presentation\n      const { presentationId, url } = await createPresentation(user, title);\n\n      // Add slides to presentation\n      await addSlidesToPresentation(user, presentationId, slidesWithImages);\n\n      res.json({ \n        presentationId, \n        url,\n        message: \"Google Slides presentation created successfully!\" \n      });\n    } catch (error: any) {\n      console.error(\"Create Google Slides presentation error:\", error);\n      \n      if (error.message?.includes('not connected their Google account')) {\n        return res.status(403).json({ \n          message: \"Please sign in with Google to create presentations. Go to Settings and connect your Google account.\" \n        });\n      }\n      \n      res.status(500).json({ \n        message: error.message || \"Failed to create Google Slides presentation. Please try again.\" \n      });\n    }\n  });\n\n  // Google Classroom: List teacher's courses\n  app.get(\"/api/google-classroom/courses\", requireAuth, async (req, res) => {\n    try {\n      const user = await storage.getProfileById(req.session.userId!);\n      if (!user) {\n        return res.status(404).json({ message: \"User not found\" });\n      }\n\n      if (!user.googleAccessToken) {\n        return res.status(403).json({ \n          message: \"Please sign in with Google to access Google Classroom. Your current account doesn't have Google access.\" \n        });\n      }\n\n      const { listTeacherCourses } = await import('./google-classroom');\n      const courses = await listTeacherCourses(user);\n\n      res.json({ courses });\n    } catch (error: any) {\n      console.error(\"List Google Classroom courses error:\", error);\n      res.status(500).json({ \n        message: error.message || \"Failed to list Google Classroom courses\" \n      });\n    }\n  });\n\n  // Google Classroom: Share content as assignment\n  app.post(\"/api/google-classroom/share\", requireAuth, async (req, res) => {\n    try {\n      const { courseId, title, description, materialLink, dueDate, dueTime } = req.body;\n\n      if (!courseId || !title || !materialLink) {\n        return res.status(400).json({ \n          message: \"Missing required fields: courseId, title, materialLink\" \n        });\n      }\n\n      const user = await storage.getProfileById(req.session.userId!);\n      if (!user) {\n        return res.status(404).json({ message: \"User not found\" });\n      }\n\n      if (!user.googleAccessToken) {\n        return res.status(403).json({ \n          message: \"Please sign in with Google to share to Google Classroom\" \n        });\n      }\n\n      const { shareToClassroom } = await import('./google-classroom');\n      const coursework = await shareToClassroom(\n        user,\n        courseId,\n        title,\n        description || '',\n        materialLink,\n        dueDate,\n        dueTime\n      );\n\n      res.json({ \n        coursework,\n        message: \"Successfully shared to Google Classroom!\" \n      });\n    } catch (error: any) {\n      console.error(\"Share to Google Classroom error:\", error);\n      res.status(500).json({ \n        message: error.message || \"Failed to share to Google Classroom\" \n      });\n    }\n  });\n\n  // Google Classroom: Post announcement\n  app.post(\"/api/google-classroom/announce\", requireAuth, async (req, res) => {\n    try {\n      const { courseId, text, materialLink, materialTitle } = req.body;\n\n      if (!courseId || !text) {\n        return res.status(400).json({ \n          message: \"Missing required fields: courseId, text\" \n        });\n      }\n\n      const user = await storage.getProfileById(req.session.userId!);\n      if (!user) {\n        return res.status(404).json({ message: \"User not found\" });\n      }\n\n      if (!user.googleAccessToken) {\n        return res.status(403).json({ \n          message: \"Please sign in with Google to post to Google Classroom\" \n        });\n      }\n\n      const { postAnnouncement } = await import('./google-classroom');\n      const announcement = await postAnnouncement(\n        user,\n        courseId,\n        text,\n        materialLink,\n        materialTitle\n      );\n\n      res.json({ \n        announcement,\n        message: \"Successfully posted announcement to Google Classroom!\" \n      });\n    } catch (error: any) {\n      console.error(\"Post announcement to Google Classroom error:\", error);\n      res.status(500).json({ \n        message: error.message || \"Failed to post announcement to Google Classroom\" \n      });\n    }\n  });\n\n  const httpServer = createServer(app);\n  return httpServer;\n}\n","size_bytes":43934},"client/src/components/ui/skeleton.tsx":{"content":"import { cn } from \"@/lib/utils\"\n\nfunction Skeleton({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) {\n  return (\n    <div\n      className={cn(\"animate-pulse rounded-md bg-muted\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Skeleton }\n","size_bytes":261},"client/src/hooks/useAuth.tsx":{"content":"import { createContext, useContext, useState, useEffect, ReactNode } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport type { Profile } from \"@shared/schema\";\n\ntype AuthContextType = {\n  user: Profile | null;\n  isLoading: boolean;\n  login: (email: string, password: string) => Promise<void>;\n  register: (email: string, password: string, fullName: string, role: string, institution?: string) => Promise<void>;\n  logout: () => Promise<void>;\n};\n\nconst AuthContext = createContext<AuthContextType | undefined>(undefined);\n\nexport function AuthProvider({ children }: { children: ReactNode }) {\n  const [user, setUser] = useState<Profile | null>(null);\n\n  const { data, isLoading } = useQuery<Profile>({\n    queryKey: [\"/api/auth/me\"],\n    retry: false,\n    refetchOnWindowFocus: false,\n  });\n\n  useEffect(() => {\n    if (data) {\n      setUser(data);\n    }\n  }, [data]);\n\n  const loginMutation = useMutation({\n    mutationFn: async ({ email, password }: { email: string; password: string }) => {\n      const res = await apiRequest(\"POST\", \"/api/auth/login\", { email, password });\n      return await res.json() as Profile;\n    },\n    onSuccess: (data) => {\n      setUser(data);\n      queryClient.invalidateQueries({ queryKey: [\"/api/auth/me\"] });\n    },\n  });\n\n  const registerMutation = useMutation({\n    mutationFn: async (data: { email: string; password: string; fullName: string; role: string; institution?: string }) => {\n      const res = await apiRequest(\"POST\", \"/api/auth/register\", data);\n      return await res.json() as Profile;\n    },\n    onSuccess: (data) => {\n      setUser(data);\n      queryClient.invalidateQueries({ queryKey: [\"/api/auth/me\"] });\n    },\n  });\n\n  const logoutMutation = useMutation({\n    mutationFn: async () => {\n      await apiRequest(\"POST\", \"/api/auth/logout\", {});\n    },\n    onSuccess: () => {\n      setUser(null);\n      queryClient.clear();\n    },\n  });\n\n  const login = async (email: string, password: string) => {\n    await loginMutation.mutateAsync({ email, password });\n  };\n\n  const register = async (email: string, password: string, fullName: string, role: string, institution?: string) => {\n    await registerMutation.mutateAsync({ email, password, fullName, role, institution });\n  };\n\n  const logout = async () => {\n    await logoutMutation.mutateAsync();\n  };\n\n  return (\n    <AuthContext.Provider value={{ user, isLoading, login, register, logout }}>\n      {children}\n    </AuthContext.Provider>\n  );\n}\n\nexport function useAuth() {\n  const context = useContext(AuthContext);\n  if (context === undefined) {\n    throw new Error(\"useAuth must be used within an AuthProvider\");\n  }\n  return context;\n}\n","size_bytes":2740},"client/src/components/ui/menubar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as MenubarPrimitive from \"@radix-ui/react-menubar\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction MenubarMenu({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Menu>) {\n  return <MenubarPrimitive.Menu {...props} />\n}\n\nfunction MenubarGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Group>) {\n  return <MenubarPrimitive.Group {...props} />\n}\n\nfunction MenubarPortal({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Portal>) {\n  return <MenubarPrimitive.Portal {...props} />\n}\n\nfunction MenubarRadioGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.RadioGroup>) {\n  return <MenubarPrimitive.RadioGroup {...props} />\n}\n\nfunction MenubarSub({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Sub>) {\n  return <MenubarPrimitive.Sub data-slot=\"menubar-sub\" {...props} />\n}\n\nconst Menubar = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"flex h-10 items-center space-x-1 rounded-md border bg-background p-1\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubar.displayName = MenubarPrimitive.Root.displayName\n\nconst MenubarTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-3 py-1.5 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarTrigger.displayName = MenubarPrimitive.Trigger.displayName\n\nconst MenubarSubTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <MenubarPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </MenubarPrimitive.SubTrigger>\n))\nMenubarSubTrigger.displayName = MenubarPrimitive.SubTrigger.displayName\n\nconst MenubarSubContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarSubContent.displayName = MenubarPrimitive.SubContent.displayName\n\nconst MenubarContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Content>\n>(\n  (\n    { className, align = \"start\", alignOffset = -4, sideOffset = 8, ...props },\n    ref\n  ) => (\n    <MenubarPrimitive.Portal>\n      <MenubarPrimitive.Content\n        ref={ref}\n        align={align}\n        alignOffset={alignOffset}\n        sideOffset={sideOffset}\n        className={cn(\n          \"z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n          className\n        )}\n        {...props}\n      />\n    </MenubarPrimitive.Portal>\n  )\n)\nMenubarContent.displayName = MenubarPrimitive.Content.displayName\n\nconst MenubarItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarItem.displayName = MenubarPrimitive.Item.displayName\n\nconst MenubarCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <MenubarPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.CheckboxItem>\n))\nMenubarCheckboxItem.displayName = MenubarPrimitive.CheckboxItem.displayName\n\nconst MenubarRadioItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <MenubarPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.RadioItem>\n))\nMenubarRadioItem.displayName = MenubarPrimitive.RadioItem.displayName\n\nconst MenubarLabel = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarLabel.displayName = MenubarPrimitive.Label.displayName\n\nconst MenubarSeparator = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nMenubarSeparator.displayName = MenubarPrimitive.Separator.displayName\n\nconst MenubarShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nMenubarShortcut.displayname = \"MenubarShortcut\"\n\nexport {\n  Menubar,\n  MenubarMenu,\n  MenubarTrigger,\n  MenubarContent,\n  MenubarItem,\n  MenubarSeparator,\n  MenubarLabel,\n  MenubarCheckboxItem,\n  MenubarRadioGroup,\n  MenubarRadioItem,\n  MenubarPortal,\n  MenubarSubContent,\n  MenubarSubTrigger,\n  MenubarGroup,\n  MenubarSub,\n  MenubarShortcut,\n}\n","size_bytes":8605},"client/src/components/ui/drawer.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Drawer as DrawerPrimitive } from \"vaul\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Drawer = ({\n  shouldScaleBackground = true,\n  ...props\n}: React.ComponentProps<typeof DrawerPrimitive.Root>) => (\n  <DrawerPrimitive.Root\n    shouldScaleBackground={shouldScaleBackground}\n    {...props}\n  />\n)\nDrawer.displayName = \"Drawer\"\n\nconst DrawerTrigger = DrawerPrimitive.Trigger\n\nconst DrawerPortal = DrawerPrimitive.Portal\n\nconst DrawerClose = DrawerPrimitive.Close\n\nconst DrawerOverlay = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Overlay\n    ref={ref}\n    className={cn(\"fixed inset-0 z-50 bg-black/80\", className)}\n    {...props}\n  />\n))\nDrawerOverlay.displayName = DrawerPrimitive.Overlay.displayName\n\nconst DrawerContent = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DrawerPortal>\n    <DrawerOverlay />\n    <DrawerPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background\",\n        className\n      )}\n      {...props}\n    >\n      <div className=\"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted\" />\n      {children}\n    </DrawerPrimitive.Content>\n  </DrawerPortal>\n))\nDrawerContent.displayName = \"DrawerContent\"\n\nconst DrawerHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"grid gap-1.5 p-4 text-center sm:text-left\", className)}\n    {...props}\n  />\n)\nDrawerHeader.displayName = \"DrawerHeader\"\n\nconst DrawerFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"mt-auto flex flex-col gap-2 p-4\", className)}\n    {...props}\n  />\n)\nDrawerFooter.displayName = \"DrawerFooter\"\n\nconst DrawerTitle = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDrawerTitle.displayName = DrawerPrimitive.Title.displayName\n\nconst DrawerDescription = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDrawerDescription.displayName = DrawerPrimitive.Description.displayName\n\nexport {\n  Drawer,\n  DrawerPortal,\n  DrawerOverlay,\n  DrawerTrigger,\n  DrawerClose,\n  DrawerContent,\n  DrawerHeader,\n  DrawerFooter,\n  DrawerTitle,\n  DrawerDescription,\n}\n","size_bytes":3021},"client/src/components/ui/toast.tsx":{"content":"import * as React from \"react\"\nimport * as ToastPrimitives from \"@radix-ui/react-toast\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ToastProvider = ToastPrimitives.Provider\n\nconst ToastViewport = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Viewport>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Viewport\n    ref={ref}\n    className={cn(\n      \"fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]\",\n      className\n    )}\n    {...props}\n  />\n))\nToastViewport.displayName = ToastPrimitives.Viewport.displayName\n\nconst toastVariants = cva(\n  \"group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full\",\n  {\n    variants: {\n      variant: {\n        default: \"border bg-background text-foreground\",\n        destructive:\n          \"destructive group border-destructive bg-destructive text-destructive-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Toast = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &\n    VariantProps<typeof toastVariants>\n>(({ className, variant, ...props }, ref) => {\n  return (\n    <ToastPrimitives.Root\n      ref={ref}\n      className={cn(toastVariants({ variant }), className)}\n      {...props}\n    />\n  )\n})\nToast.displayName = ToastPrimitives.Root.displayName\n\nconst ToastAction = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Action>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Action\n    ref={ref}\n    className={cn(\n      \"inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive\",\n      className\n    )}\n    {...props}\n  />\n))\nToastAction.displayName = ToastPrimitives.Action.displayName\n\nconst ToastClose = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Close>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Close\n    ref={ref}\n    className={cn(\n      \"absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600\",\n      className\n    )}\n    toast-close=\"\"\n    {...props}\n  >\n    <X className=\"h-4 w-4\" />\n  </ToastPrimitives.Close>\n))\nToastClose.displayName = ToastPrimitives.Close.displayName\n\nconst ToastTitle = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Title>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Title\n    ref={ref}\n    className={cn(\"text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nToastTitle.displayName = ToastPrimitives.Title.displayName\n\nconst ToastDescription = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Description>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Description\n    ref={ref}\n    className={cn(\"text-sm opacity-90\", className)}\n    {...props}\n  />\n))\nToastDescription.displayName = ToastPrimitives.Description.displayName\n\ntype ToastProps = React.ComponentPropsWithoutRef<typeof Toast>\n\ntype ToastActionElement = React.ReactElement<typeof ToastAction>\n\nexport {\n  type ToastProps,\n  type ToastActionElement,\n  ToastProvider,\n  ToastViewport,\n  Toast,\n  ToastTitle,\n  ToastDescription,\n  ToastClose,\n  ToastAction,\n}\n","size_bytes":4845},"client/src/components/ui/tooltip.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as TooltipPrimitive from \"@radix-ui/react-tooltip\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst TooltipProvider = TooltipPrimitive.Provider\n\nconst Tooltip = TooltipPrimitive.Root\n\nconst TooltipTrigger = TooltipPrimitive.Trigger\n\nconst TooltipContent = React.forwardRef<\n  React.ElementRef<typeof TooltipPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <TooltipPrimitive.Content\n    ref={ref}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nTooltipContent.displayName = TooltipPrimitive.Content.displayName\n\nexport { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }\n","size_bytes":1209},"client/src/hooks/use-mobile.tsx":{"content":"import * as React from \"react\"\n\nconst MOBILE_BREAKPOINT = 768\n\nexport function useIsMobile() {\n  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)\n\n  React.useEffect(() => {\n    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)\n    const onChange = () => {\n      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    }\n    mql.addEventListener(\"change\", onChange)\n    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    return () => mql.removeEventListener(\"change\", onChange)\n  }, [])\n\n  return !!isMobile\n}\n","size_bytes":565},"client/src/components/ui/chart.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as RechartsPrimitive from \"recharts\"\n\nimport { cn } from \"@/lib/utils\"\n\n// Format: { THEME_NAME: CSS_SELECTOR }\nconst THEMES = { light: \"\", dark: \".dark\" } as const\n\nexport type ChartConfig = {\n  [k in string]: {\n    label?: React.ReactNode\n    icon?: React.ComponentType\n  } & (\n    | { color?: string; theme?: never }\n    | { color?: never; theme: Record<keyof typeof THEMES, string> }\n  )\n}\n\ntype ChartContextProps = {\n  config: ChartConfig\n}\n\nconst ChartContext = React.createContext<ChartContextProps | null>(null)\n\nfunction useChart() {\n  const context = React.useContext(ChartContext)\n\n  if (!context) {\n    throw new Error(\"useChart must be used within a <ChartContainer />\")\n  }\n\n  return context\n}\n\nconst ChartContainer = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    config: ChartConfig\n    children: React.ComponentProps<\n      typeof RechartsPrimitive.ResponsiveContainer\n    >[\"children\"]\n  }\n>(({ id, className, children, config, ...props }, ref) => {\n  const uniqueId = React.useId()\n  const chartId = `chart-${id || uniqueId.replace(/:/g, \"\")}`\n\n  return (\n    <ChartContext.Provider value={{ config }}>\n      <div\n        data-chart={chartId}\n        ref={ref}\n        className={cn(\n          \"flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none\",\n          className\n        )}\n        {...props}\n      >\n        <ChartStyle id={chartId} config={config} />\n        <RechartsPrimitive.ResponsiveContainer>\n          {children}\n        </RechartsPrimitive.ResponsiveContainer>\n      </div>\n    </ChartContext.Provider>\n  )\n})\nChartContainer.displayName = \"Chart\"\n\nconst ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {\n  const colorConfig = Object.entries(config).filter(\n    ([, config]) => config.theme || config.color\n  )\n\n  if (!colorConfig.length) {\n    return null\n  }\n\n  return (\n    <style\n      dangerouslySetInnerHTML={{\n        __html: Object.entries(THEMES)\n          .map(\n            ([theme, prefix]) => `\n${prefix} [data-chart=${id}] {\n${colorConfig\n  .map(([key, itemConfig]) => {\n    const color =\n      itemConfig.theme?.[theme as keyof typeof itemConfig.theme] ||\n      itemConfig.color\n    return color ? `  --color-${key}: ${color};` : null\n  })\n  .join(\"\\n\")}\n}\n`\n          )\n          .join(\"\\n\"),\n      }}\n    />\n  )\n}\n\nconst ChartTooltip = RechartsPrimitive.Tooltip\n\nconst ChartTooltipContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<typeof RechartsPrimitive.Tooltip> &\n    React.ComponentProps<\"div\"> & {\n      hideLabel?: boolean\n      hideIndicator?: boolean\n      indicator?: \"line\" | \"dot\" | \"dashed\"\n      nameKey?: string\n      labelKey?: string\n    }\n>(\n  (\n    {\n      active,\n      payload,\n      className,\n      indicator = \"dot\",\n      hideLabel = false,\n      hideIndicator = false,\n      label,\n      labelFormatter,\n      labelClassName,\n      formatter,\n      color,\n      nameKey,\n      labelKey,\n    },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    const tooltipLabel = React.useMemo(() => {\n      if (hideLabel || !payload?.length) {\n        return null\n      }\n\n      const [item] = payload\n      const key = `${labelKey || item?.dataKey || item?.name || \"value\"}`\n      const itemConfig = getPayloadConfigFromPayload(config, item, key)\n      const value =\n        !labelKey && typeof label === \"string\"\n          ? config[label as keyof typeof config]?.label || label\n          : itemConfig?.label\n\n      if (labelFormatter) {\n        return (\n          <div className={cn(\"font-medium\", labelClassName)}>\n            {labelFormatter(value, payload)}\n          </div>\n        )\n      }\n\n      if (!value) {\n        return null\n      }\n\n      return <div className={cn(\"font-medium\", labelClassName)}>{value}</div>\n    }, [\n      label,\n      labelFormatter,\n      payload,\n      hideLabel,\n      labelClassName,\n      config,\n      labelKey,\n    ])\n\n    if (!active || !payload?.length) {\n      return null\n    }\n\n    const nestLabel = payload.length === 1 && indicator !== \"dot\"\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl\",\n          className\n        )}\n      >\n        {!nestLabel ? tooltipLabel : null}\n        <div className=\"grid gap-1.5\">\n          {payload.map((item, index) => {\n            const key = `${nameKey || item.name || item.dataKey || \"value\"}`\n            const itemConfig = getPayloadConfigFromPayload(config, item, key)\n            const indicatorColor = color || item.payload.fill || item.color\n\n            return (\n              <div\n                key={item.dataKey}\n                className={cn(\n                  \"flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground\",\n                  indicator === \"dot\" && \"items-center\"\n                )}\n              >\n                {formatter && item?.value !== undefined && item.name ? (\n                  formatter(item.value, item.name, item, index, item.payload)\n                ) : (\n                  <>\n                    {itemConfig?.icon ? (\n                      <itemConfig.icon />\n                    ) : (\n                      !hideIndicator && (\n                        <div\n                          className={cn(\n                            \"shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]\",\n                            {\n                              \"h-2.5 w-2.5\": indicator === \"dot\",\n                              \"w-1\": indicator === \"line\",\n                              \"w-0 border-[1.5px] border-dashed bg-transparent\":\n                                indicator === \"dashed\",\n                              \"my-0.5\": nestLabel && indicator === \"dashed\",\n                            }\n                          )}\n                          style={\n                            {\n                              \"--color-bg\": indicatorColor,\n                              \"--color-border\": indicatorColor,\n                            } as React.CSSProperties\n                          }\n                        />\n                      )\n                    )}\n                    <div\n                      className={cn(\n                        \"flex flex-1 justify-between leading-none\",\n                        nestLabel ? \"items-end\" : \"items-center\"\n                      )}\n                    >\n                      <div className=\"grid gap-1.5\">\n                        {nestLabel ? tooltipLabel : null}\n                        <span className=\"text-muted-foreground\">\n                          {itemConfig?.label || item.name}\n                        </span>\n                      </div>\n                      {item.value && (\n                        <span className=\"font-mono font-medium tabular-nums text-foreground\">\n                          {item.value.toLocaleString()}\n                        </span>\n                      )}\n                    </div>\n                  </>\n                )}\n              </div>\n            )\n          })}\n        </div>\n      </div>\n    )\n  }\n)\nChartTooltipContent.displayName = \"ChartTooltip\"\n\nconst ChartLegend = RechartsPrimitive.Legend\n\nconst ChartLegendContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> &\n    Pick<RechartsPrimitive.LegendProps, \"payload\" | \"verticalAlign\"> & {\n      hideIcon?: boolean\n      nameKey?: string\n    }\n>(\n  (\n    { className, hideIcon = false, payload, verticalAlign = \"bottom\", nameKey },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    if (!payload?.length) {\n      return null\n    }\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"flex items-center justify-center gap-4\",\n          verticalAlign === \"top\" ? \"pb-3\" : \"pt-3\",\n          className\n        )}\n      >\n        {payload.map((item) => {\n          const key = `${nameKey || item.dataKey || \"value\"}`\n          const itemConfig = getPayloadConfigFromPayload(config, item, key)\n\n          return (\n            <div\n              key={item.value}\n              className={cn(\n                \"flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground\"\n              )}\n            >\n              {itemConfig?.icon && !hideIcon ? (\n                <itemConfig.icon />\n              ) : (\n                <div\n                  className=\"h-2 w-2 shrink-0 rounded-[2px]\"\n                  style={{\n                    backgroundColor: item.color,\n                  }}\n                />\n              )}\n              {itemConfig?.label}\n            </div>\n          )\n        })}\n      </div>\n    )\n  }\n)\nChartLegendContent.displayName = \"ChartLegend\"\n\n// Helper to extract item config from a payload.\nfunction getPayloadConfigFromPayload(\n  config: ChartConfig,\n  payload: unknown,\n  key: string\n) {\n  if (typeof payload !== \"object\" || payload === null) {\n    return undefined\n  }\n\n  const payloadPayload =\n    \"payload\" in payload &&\n    typeof payload.payload === \"object\" &&\n    payload.payload !== null\n      ? payload.payload\n      : undefined\n\n  let configLabelKey: string = key\n\n  if (\n    key in payload &&\n    typeof payload[key as keyof typeof payload] === \"string\"\n  ) {\n    configLabelKey = payload[key as keyof typeof payload] as string\n  } else if (\n    payloadPayload &&\n    key in payloadPayload &&\n    typeof payloadPayload[key as keyof typeof payloadPayload] === \"string\"\n  ) {\n    configLabelKey = payloadPayload[\n      key as keyof typeof payloadPayload\n    ] as string\n  }\n\n  return configLabelKey in config\n    ? config[configLabelKey]\n    : config[key as keyof typeof config]\n}\n\nexport {\n  ChartContainer,\n  ChartTooltip,\n  ChartTooltipContent,\n  ChartLegend,\n  ChartLegendContent,\n  ChartStyle,\n}\n","size_bytes":10481},"client/src/components/ui/table.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Table = React.forwardRef<\n  HTMLTableElement,\n  React.HTMLAttributes<HTMLTableElement>\n>(({ className, ...props }, ref) => (\n  <div className=\"relative w-full overflow-auto\">\n    <table\n      ref={ref}\n      className={cn(\"w-full caption-bottom text-sm\", className)}\n      {...props}\n    />\n  </div>\n))\nTable.displayName = \"Table\"\n\nconst TableHeader = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <thead ref={ref} className={cn(\"[&_tr]:border-b\", className)} {...props} />\n))\nTableHeader.displayName = \"TableHeader\"\n\nconst TableBody = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tbody\n    ref={ref}\n    className={cn(\"[&_tr:last-child]:border-0\", className)}\n    {...props}\n  />\n))\nTableBody.displayName = \"TableBody\"\n\nconst TableFooter = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tfoot\n    ref={ref}\n    className={cn(\n      \"border-t bg-muted/50 font-medium [&>tr]:last:border-b-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableFooter.displayName = \"TableFooter\"\n\nconst TableRow = React.forwardRef<\n  HTMLTableRowElement,\n  React.HTMLAttributes<HTMLTableRowElement>\n>(({ className, ...props }, ref) => (\n  <tr\n    ref={ref}\n    className={cn(\n      \"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nTableRow.displayName = \"TableRow\"\n\nconst TableHead = React.forwardRef<\n  HTMLTableCellElement,\n  React.ThHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <th\n    ref={ref}\n    className={cn(\n      \"h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableHead.displayName = \"TableHead\"\n\nconst TableCell = React.forwardRef<\n  HTMLTableCellElement,\n  React.TdHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <td\n    ref={ref}\n    className={cn(\"p-4 align-middle [&:has([role=checkbox])]:pr-0\", className)}\n    {...props}\n  />\n))\nTableCell.displayName = \"TableCell\"\n\nconst TableCaption = React.forwardRef<\n  HTMLTableCaptionElement,\n  React.HTMLAttributes<HTMLTableCaptionElement>\n>(({ className, ...props }, ref) => (\n  <caption\n    ref={ref}\n    className={cn(\"mt-4 text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nTableCaption.displayName = \"TableCaption\"\n\nexport {\n  Table,\n  TableHeader,\n  TableBody,\n  TableFooter,\n  TableHead,\n  TableRow,\n  TableCell,\n  TableCaption,\n}\n","size_bytes":2765},"client/src/components/ThemeProvider.tsx":{"content":"import { createContext, useContext, useEffect, useState, ReactNode } from \"react\";\n\ntype Theme = \"light\" | \"dark\";\n\ntype ThemeContextType = {\n  theme: Theme;\n  toggleTheme: () => void;\n};\n\nconst ThemeContext = createContext<ThemeContextType | undefined>(undefined);\n\nexport function ThemeProvider({ children }: { children: ReactNode }) {\n  const [theme, setTheme] = useState<Theme>(() => {\n    const stored = localStorage.getItem(\"theme\");\n    return (stored as Theme) || \"light\";\n  });\n\n  useEffect(() => {\n    const root = document.documentElement;\n    if (theme === \"dark\") {\n      root.classList.add(\"dark\");\n    } else {\n      root.classList.remove(\"dark\");\n    }\n    localStorage.setItem(\"theme\", theme);\n  }, [theme]);\n\n  const toggleTheme = () => {\n    setTheme((prev) => (prev === \"light\" ? \"dark\" : \"light\"));\n  };\n\n  return (\n    <ThemeContext.Provider value={{ theme, toggleTheme }}>\n      {children}\n    </ThemeContext.Provider>\n  );\n}\n\nexport function useTheme() {\n  const context = useContext(ThemeContext);\n  if (context === undefined) {\n    throw new Error(\"useTheme must be used within a ThemeProvider\");\n  }\n  return context;\n}\n","size_bytes":1147},"client/src/components/ui/alert-dialog.tsx":{"content":"import * as React from \"react\"\nimport * as AlertDialogPrimitive from \"@radix-ui/react-alert-dialog\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nconst AlertDialog = AlertDialogPrimitive.Root\n\nconst AlertDialogTrigger = AlertDialogPrimitive.Trigger\n\nconst AlertDialogPortal = AlertDialogPrimitive.Portal\n\nconst AlertDialogOverlay = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nAlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName\n\nconst AlertDialogContent = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPortal>\n    <AlertDialogOverlay />\n    <AlertDialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    />\n  </AlertDialogPortal>\n))\nAlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName\n\nconst AlertDialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogHeader.displayName = \"AlertDialogHeader\"\n\nconst AlertDialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogFooter.displayName = \"AlertDialogFooter\"\n\nconst AlertDialogTitle = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold\", className)}\n    {...props}\n  />\n))\nAlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName\n\nconst AlertDialogDescription = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nAlertDialogDescription.displayName =\n  AlertDialogPrimitive.Description.displayName\n\nconst AlertDialogAction = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Action>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Action\n    ref={ref}\n    className={cn(buttonVariants(), className)}\n    {...props}\n  />\n))\nAlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName\n\nconst AlertDialogCancel = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Cancel\n    ref={ref}\n    className={cn(\n      buttonVariants({ variant: \"outline\" }),\n      \"mt-2 sm:mt-0\",\n      className\n    )}\n    {...props}\n  />\n))\nAlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName\n\nexport {\n  AlertDialog,\n  AlertDialogPortal,\n  AlertDialogOverlay,\n  AlertDialogTrigger,\n  AlertDialogContent,\n  AlertDialogHeader,\n  AlertDialogFooter,\n  AlertDialogTitle,\n  AlertDialogDescription,\n  AlertDialogAction,\n  AlertDialogCancel,\n}\n","size_bytes":4420},"client/src/components/ui/hover-card.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as HoverCardPrimitive from \"@radix-ui/react-hover-card\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst HoverCard = HoverCardPrimitive.Root\n\nconst HoverCardTrigger = HoverCardPrimitive.Trigger\n\nconst HoverCardContent = React.forwardRef<\n  React.ElementRef<typeof HoverCardPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof HoverCardPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <HoverCardPrimitive.Content\n    ref={ref}\n    align={align}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 w-64 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-hover-card-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nHoverCardContent.displayName = HoverCardPrimitive.Content.displayName\n\nexport { HoverCard, HoverCardTrigger, HoverCardContent }\n","size_bytes":1251},"client/src/components/ui/scroll-area.tsx":{"content":"import * as React from \"react\"\nimport * as ScrollAreaPrimitive from \"@radix-ui/react-scroll-area\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ScrollArea = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <ScrollAreaPrimitive.Root\n    ref={ref}\n    className={cn(\"relative overflow-hidden\", className)}\n    {...props}\n  >\n    <ScrollAreaPrimitive.Viewport className=\"h-full w-full rounded-[inherit]\">\n      {children}\n    </ScrollAreaPrimitive.Viewport>\n    <ScrollBar />\n    <ScrollAreaPrimitive.Corner />\n  </ScrollAreaPrimitive.Root>\n))\nScrollArea.displayName = ScrollAreaPrimitive.Root.displayName\n\nconst ScrollBar = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>\n>(({ className, orientation = \"vertical\", ...props }, ref) => (\n  <ScrollAreaPrimitive.ScrollAreaScrollbar\n    ref={ref}\n    orientation={orientation}\n    className={cn(\n      \"flex touch-none select-none transition-colors\",\n      orientation === \"vertical\" &&\n        \"h-full w-2.5 border-l border-l-transparent p-[1px]\",\n      orientation === \"horizontal\" &&\n        \"h-2.5 flex-col border-t border-t-transparent p-[1px]\",\n      className\n    )}\n    {...props}\n  >\n    <ScrollAreaPrimitive.ScrollAreaThumb className=\"relative flex-1 rounded-full bg-border\" />\n  </ScrollAreaPrimitive.ScrollAreaScrollbar>\n))\nScrollBar.displayName = ScrollAreaPrimitive.ScrollAreaScrollbar.displayName\n\nexport { ScrollArea, ScrollBar }\n","size_bytes":1642},"client/src/components/ui/alert.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst alertVariants = cva(\n  \"relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-background text-foreground\",\n        destructive:\n          \"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Alert = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>\n>(({ className, variant, ...props }, ref) => (\n  <div\n    ref={ref}\n    role=\"alert\"\n    className={cn(alertVariants({ variant }), className)}\n    {...props}\n  />\n))\nAlert.displayName = \"Alert\"\n\nconst AlertTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h5\n    ref={ref}\n    className={cn(\"mb-1 font-medium leading-none tracking-tight\", className)}\n    {...props}\n  />\n))\nAlertTitle.displayName = \"AlertTitle\"\n\nconst AlertDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm [&_p]:leading-relaxed\", className)}\n    {...props}\n  />\n))\nAlertDescription.displayName = \"AlertDescription\"\n\nexport { Alert, AlertTitle, AlertDescription }\n","size_bytes":1584},"client/src/components/players/VideoPlayer.tsx":{"content":"import { useState, useEffect, useRef } from \"react\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { Play, Pause, Volume2, VolumeX, Maximize, SkipForward, Check, X } from \"lucide-react\";\nimport { youtubeLoader } from \"@/lib/youtube-loader\";\nimport type { InteractiveVideoData, VideoHotspot } from \"@shared/schema\";\nimport { useProgressTracker } from \"@/hooks/use-progress-tracker\";\n\ntype VideoPlayerProps = {\n  data: InteractiveVideoData;\n  contentId: string;\n};\n\nexport function VideoPlayer({ data, contentId }: VideoPlayerProps) {\n  const [currentHotspot, setCurrentHotspot] = useState<VideoHotspot | null>(null);\n  const [selectedAnswer, setSelectedAnswer] = useState<number | null>(null);\n  const [completedHotspots, setCompletedHotspots] = useState<Set<string>>(new Set());\n  const [showFeedback, setShowFeedback] = useState(false);\n  const playerRef = useRef<any>(null);\n  const playerContainerRef = useRef<HTMLDivElement>(null);\n  const intervalRef = useRef<NodeJS.Timeout | null>(null);\n  const [currentTime, setCurrentTime] = useState(0);\n  const [duration, setDuration] = useState(0);\n  const [isPlaying, setIsPlaying] = useState(false);\n  const [isMuted, setIsMuted] = useState(false);\n\n  const { progress: savedProgress, isProgressFetched, updateProgress, logInteraction, isAuthenticated } = useProgressTracker(contentId);\n  const [highestProgress, setHighestProgress] = useState<number>(0);\n  const [isProgressInitialized, setIsProgressInitialized] = useState(false);\n  const pendingMilestoneRef = useRef<number | null>(null);\n  const pendingTimeoutRef = useRef<NodeJS.Timeout | null>(null);\n  const previousAuthRef = useRef<boolean>(isAuthenticated);\n\n  // Reset initialization when auth changes from false → true\n  useEffect(() => {\n    if (!previousAuthRef.current && isAuthenticated) {\n      // User just logged in - reset to wait for progress fetch\n      setIsProgressInitialized(false);\n      setHighestProgress(0);\n      pendingMilestoneRef.current = null;\n      if (pendingTimeoutRef.current) {\n        clearTimeout(pendingTimeoutRef.current);\n        pendingTimeoutRef.current = null;\n      }\n    }\n    previousAuthRef.current = isAuthenticated;\n  }, [isAuthenticated]);\n\n  // Initialize from persisted progress and reconcile when savedProgress updates\n  useEffect(() => {\n    if (!isProgressInitialized) {\n      if (!isAuthenticated) {\n        setIsProgressInitialized(true);\n      } else if (isProgressFetched) {\n        if (savedProgress) {\n          setHighestProgress(savedProgress.completionPercentage);\n        }\n        setIsProgressInitialized(true);\n      }\n    } else if (savedProgress) {\n      // After initialization, reconcile: server can only raise, never lower\n      // Only update if savedProgress is truthy (skip null refetches)\n      setHighestProgress(prev => Math.max(prev, savedProgress.completionPercentage));\n      // Clear pending milestone if it's been saved\n      if (pendingMilestoneRef.current !== null && savedProgress.completionPercentage >= pendingMilestoneRef.current) {\n        pendingMilestoneRef.current = null;\n        if (pendingTimeoutRef.current) {\n          clearTimeout(pendingTimeoutRef.current);\n          pendingTimeoutRef.current = null;\n        }\n      }\n    }\n  }, [savedProgress, isProgressFetched, isAuthenticated, isProgressInitialized]);\n\n  // Track video progress (monotonic - only increase, never decrease, wait for init)\n  useEffect(() => {\n    if (!isProgressInitialized || !isAuthenticated) return;\n    \n    if (duration > 0 && currentTime > 0) {\n      const watchPercentage = Math.round((currentTime / duration) * 100);\n      const milestone = Math.floor(watchPercentage / 10) * 10;\n      \n      // Only update if this milestone is higher than local high water mark and not already pending\n      if (milestone > highestProgress && milestone > 0 && milestone !== pendingMilestoneRef.current) {\n        pendingMilestoneRef.current = milestone;\n        updateProgress(milestone);\n        // Clear pending after 5 seconds to allow retry on failure\n        if (pendingTimeoutRef.current) {\n          clearTimeout(pendingTimeoutRef.current);\n        }\n        pendingTimeoutRef.current = setTimeout(() => {\n          pendingMilestoneRef.current = null;\n          pendingTimeoutRef.current = null;\n        }, 5000);\n      }\n    }\n  }, [currentTime, duration, highestProgress, isProgressInitialized, isAuthenticated]);\n\n  // Track hotspot completion (monotonic - only send if higher, wait for init)\n  useEffect(() => {\n    if (!isProgressInitialized || !isAuthenticated) return;\n    \n    if (data.hotspots.length > 0) {\n      const completionPercentage = Math.round((completedHotspots.size / data.hotspots.length) * 100);\n      \n      // Only update if hotspot completion exceeds local high water mark and not already pending\n      if (completionPercentage > highestProgress && completionPercentage > 0 && completionPercentage !== pendingMilestoneRef.current) {\n        pendingMilestoneRef.current = completionPercentage;\n        updateProgress(completionPercentage);\n        // Clear pending after 5 seconds to allow retry on failure\n        if (pendingTimeoutRef.current) {\n          clearTimeout(pendingTimeoutRef.current);\n        }\n        pendingTimeoutRef.current = setTimeout(() => {\n          pendingMilestoneRef.current = null;\n          pendingTimeoutRef.current = null;\n        }, 5000);\n      }\n    }\n  }, [completedHotspots.size, highestProgress, isProgressInitialized, isAuthenticated]);\n\n  const getYouTubeVideoId = (url: string) => {\n    const match = url.match(/(?:youtube\\.com\\/watch\\?v=|youtu\\.be\\/)([^&]+)/);\n    return match ? match[1] : null;\n  };\n\n  const videoId = getYouTubeVideoId(data.videoUrl);\n\n  useEffect(() => {\n    if (!videoId) return;\n\n    const initializePlayer = () => {\n      if (!playerContainerRef.current) return;\n\n      // Destroy existing player if any\n      if (playerRef.current) {\n        playerRef.current.destroy();\n        playerRef.current = null;\n      }\n\n      playerRef.current = new window.YT.Player(playerContainerRef.current, {\n        videoId: videoId,\n        playerVars: {\n          controls: 0,\n          modestbranding: 1,\n          rel: 0,\n        },\n        events: {\n          onReady: (event: any) => {\n            setDuration(event.target.getDuration());\n          },\n          onStateChange: (event: any) => {\n            if (event.data === window.YT.PlayerState.PLAYING) {\n              setIsPlaying(true);\n              startTimeTracking();\n            } else {\n              setIsPlaying(false);\n              stopTimeTracking();\n            }\n          },\n        },\n      });\n    };\n\n    // Use shared YouTube loader\n    youtubeLoader.load(initializePlayer);\n\n    return () => {\n      stopTimeTracking();\n      if (playerRef.current) {\n        playerRef.current.destroy();\n        playerRef.current = null;\n      }\n    };\n  }, [videoId]);\n\n  const startTimeTracking = () => {\n    if (intervalRef.current) return;\n    intervalRef.current = setInterval(() => {\n      if (playerRef.current && playerRef.current.getCurrentTime) {\n        const time = playerRef.current.getCurrentTime();\n        setCurrentTime(time);\n        checkForHotspots(time);\n      }\n    }, 100);\n  };\n\n  const stopTimeTracking = () => {\n    if (intervalRef.current) {\n      clearInterval(intervalRef.current);\n      intervalRef.current = null;\n    }\n  };\n\n  const checkForHotspots = (time: number) => {\n    const hotspot = data.hotspots.find(\n      (h) => Math.abs(h.timestamp - time) < 0.5 && !completedHotspots.has(h.id) && !currentHotspot\n    );\n\n    if (hotspot) {\n      setCurrentHotspot(hotspot);\n      playerRef.current?.pauseVideo();\n      setIsPlaying(false);\n    }\n  };\n\n  const handlePlayPause = () => {\n    if (!playerRef.current) return;\n    if (isPlaying) {\n      playerRef.current.pauseVideo();\n    } else {\n      playerRef.current.playVideo();\n    }\n  };\n\n  const handleMute = () => {\n    if (!playerRef.current) return;\n    if (isMuted) {\n      playerRef.current.unMute();\n    } else {\n      playerRef.current.mute();\n    }\n    setIsMuted(!isMuted);\n  };\n\n  const handleSeek = (percentage: number) => {\n    if (!playerRef.current || !duration) return;\n    const time = (percentage / 100) * duration;\n    playerRef.current.seekTo(time, true);\n    setCurrentTime(time);\n  };\n\n  const handleFullscreen = () => {\n    if (!playerRef.current) return;\n    const iframe = playerRef.current.getIframe();\n    if (iframe && iframe.requestFullscreen) {\n      iframe.requestFullscreen();\n    }\n  };\n\n  const jumpToHotspot = (hotspot: VideoHotspot) => {\n    if (!playerRef.current) return;\n    playerRef.current.seekTo(hotspot.timestamp, true);\n    setCurrentTime(hotspot.timestamp);\n    playerRef.current.playVideo();\n  };\n\n  const handleAnswerSubmit = () => {\n    if (!currentHotspot || currentHotspot.type !== \"question\") return;\n    setShowFeedback(true);\n  };\n\n  const handleContinue = () => {\n    if (!currentHotspot) return;\n    \n    // Log hotspot interaction\n    logInteraction(\"hotspot_completed\", {\n      hotspotId: currentHotspot.id,\n      hotspotType: currentHotspot.type,\n      timestamp: currentHotspot.timestamp,\n      ...(currentHotspot.type === \"question\" && {\n        selectedAnswer,\n        isCorrect: currentHotspot.correctAnswer === selectedAnswer,\n      }),\n    });\n    \n    setCompletedHotspots(prev => new Set(Array.from(prev).concat(currentHotspot.id)));\n    setCurrentHotspot(null);\n    setSelectedAnswer(null);\n    setShowFeedback(false);\n    if (playerRef.current) {\n      playerRef.current.playVideo();\n    }\n  };\n\n  const formatTime = (seconds: number) => {\n    const mins = Math.floor(seconds / 60);\n    const secs = Math.floor(seconds % 60);\n    return `${mins}:${secs.toString().padStart(2, \"0\")}`;\n  };\n\n  const progressPercentage = duration > 0 ? (currentTime / duration) * 100 : 0;\n\n  return (\n    <div className=\"space-y-4\">\n      {/* Video Container with Overlay */}\n      <div className=\"relative bg-black rounded-lg overflow-hidden\" style={{ aspectRatio: \"16/9\" }}>\n        <div ref={playerContainerRef} className=\"w-full h-full\" data-testid=\"video-iframe\" />\n\n        {/* Hotspot Overlay */}\n        {currentHotspot && (\n          <div className=\"absolute inset-0 bg-black/80 flex items-center justify-center p-6 z-10\">\n            <Card className=\"w-full max-w-2xl\">\n              <CardContent className=\"pt-6\">\n                <div className=\"space-y-4\">\n                  <div className=\"flex items-center gap-2\">\n                    <Badge variant={currentHotspot.type === \"question\" ? \"default\" : \"outline\"}>\n                      {currentHotspot.type}\n                    </Badge>\n                    <span className=\"text-sm font-mono text-muted-foreground\">\n                      {formatTime(currentHotspot.timestamp)}\n                    </span>\n                  </div>\n\n                  <h3 className=\"text-xl font-semibold\">{currentHotspot.title}</h3>\n                  <p className=\"text-muted-foreground\">{currentHotspot.content}</p>\n\n                  {currentHotspot.type === \"question\" && currentHotspot.options && currentHotspot.options.length > 0 && (\n                    <div className=\"space-y-3\">\n                      {currentHotspot.options.map((option, index) => {\n                        const isCorrect = currentHotspot.correctAnswer === index;\n                        const isSelected = selectedAnswer === index;\n                        const showResult = showFeedback;\n\n                        return (\n                          <button\n                            key={index}\n                            onClick={() => !showFeedback && setSelectedAnswer(index)}\n                            disabled={showFeedback}\n                            aria-label={`Answer option ${index + 1}: ${option}`}\n                            className={`w-full p-4 rounded-lg border-2 text-left transition-all hover-elevate ${\n                              showResult\n                                ? isCorrect\n                                  ? \"border-green-600 bg-green-50 dark:bg-green-950\"\n                                  : isSelected\n                                  ? \"border-red-600 bg-red-50 dark:bg-red-950\"\n                                  : \"border-border\"\n                                : isSelected\n                                ? \"border-primary bg-primary/10\"\n                                : \"border-border\"\n                            }`}\n                            data-testid={`hotspot-option-${index}`}\n                          >\n                            <div className=\"flex items-center justify-between\">\n                              <span>{option}</span>\n                              {showResult && isCorrect && <Check className=\"h-5 w-5 text-green-600\" />}\n                              {showResult && isSelected && !isCorrect && <X className=\"h-5 w-5 text-red-600\" />}\n                            </div>\n                          </button>\n                        );\n                      })}\n                    </div>\n                  )}\n\n                  <div className=\"flex justify-end gap-2 pt-2\">\n                    {currentHotspot.type === \"question\" && currentHotspot.options && currentHotspot.options.length > 0 && !showFeedback && (\n                      <Button\n                        onClick={handleAnswerSubmit}\n                        disabled={selectedAnswer === null}\n                        data-testid=\"button-submit-answer\"\n                      >\n                        Submit Answer\n                      </Button>\n                    )}\n                    {(currentHotspot.type !== \"question\" || !currentHotspot.options || currentHotspot.options.length === 0 || showFeedback) && (\n                      <Button onClick={handleContinue} data-testid=\"button-continue\">\n                        Continue\n                        <SkipForward className=\"h-4 w-4 ml-2\" />\n                      </Button>\n                    )}\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          </div>\n        )}\n\n        {/* Custom Controls */}\n        <div className=\"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/90 to-transparent p-4\">\n          <div className=\"space-y-2\">\n            {/* Progress Bar with Hotspot Markers */}\n            <div className=\"relative\">\n              <div\n                role=\"slider\"\n                aria-label=\"Video progress\"\n                aria-valuemin={0}\n                aria-valuemax={100}\n                aria-valuenow={Math.floor(progressPercentage)}\n                tabIndex={0}\n                className=\"h-2 bg-white/20 rounded-full cursor-pointer hover-elevate\"\n                onClick={(e) => {\n                  const rect = e.currentTarget.getBoundingClientRect();\n                  const x = e.clientX - rect.left;\n                  const percentage = (x / rect.width) * 100;\n                  handleSeek(percentage);\n                }}\n                onKeyDown={(e) => {\n                  if (e.key === \"ArrowLeft\") {\n                    handleSeek(Math.max(0, progressPercentage - 5));\n                  } else if (e.key === \"ArrowRight\") {\n                    handleSeek(Math.min(100, progressPercentage + 5));\n                  }\n                }}\n                data-testid=\"video-progress-bar\"\n              >\n                <div\n                  className=\"h-full bg-primary rounded-full transition-all\"\n                  style={{ width: `${progressPercentage}%` }}\n                />\n                {/* Hotspot Markers */}\n                {data.hotspots.map((hotspot) => {\n                  const position = duration > 0 ? (hotspot.timestamp / duration) * 100 : 0;\n                  const isCompleted = completedHotspots.has(hotspot.id);\n                  return (\n                    <button\n                      key={hotspot.id}\n                      className={`absolute top-0 w-3 h-3 rounded-full -translate-y-1/2 -translate-x-1/2 cursor-pointer transition-all ${\n                        isCompleted ? \"bg-green-500\" : \"bg-yellow-500\"\n                      } hover:scale-125`}\n                      style={{ left: `${position}%`, top: \"50%\" }}\n                      onClick={(e) => {\n                        e.stopPropagation();\n                        jumpToHotspot(hotspot);\n                      }}\n                      aria-label={`Jump to ${hotspot.title} at ${formatTime(hotspot.timestamp)}`}\n                      title={`${hotspot.title} at ${formatTime(hotspot.timestamp)}`}\n                      data-testid={`marker-${hotspot.id}`}\n                    />\n                  );\n                })}\n              </div>\n            </div>\n\n            {/* Controls */}\n            <div className=\"flex items-center justify-between text-white\">\n              <div className=\"flex items-center gap-2\">\n                <Button\n                  variant=\"ghost\"\n                  size=\"icon\"\n                  onClick={handlePlayPause}\n                  className=\"text-white hover:bg-white/20\"\n                  aria-label={isPlaying ? \"Pause video\" : \"Play video\"}\n                  data-testid=\"button-play-pause\"\n                >\n                  {isPlaying ? <Pause className=\"h-5 w-5\" /> : <Play className=\"h-5 w-5\" />}\n                </Button>\n                <Button\n                  variant=\"ghost\"\n                  size=\"icon\"\n                  onClick={handleMute}\n                  className=\"text-white hover:bg-white/20\"\n                  aria-label={isMuted ? \"Unmute video\" : \"Mute video\"}\n                  data-testid=\"button-mute\"\n                >\n                  {isMuted ? <VolumeX className=\"h-5 w-5\" /> : <Volume2 className=\"h-5 w-5\" />}\n                </Button>\n                <span className=\"text-sm font-mono\">\n                  {formatTime(currentTime)} / {formatTime(duration)}\n                </span>\n              </div>\n              <Button\n                variant=\"ghost\"\n                size=\"icon\"\n                onClick={handleFullscreen}\n                className=\"text-white hover:bg-white/20\"\n                aria-label=\"Enter fullscreen\"\n                data-testid=\"button-fullscreen\"\n              >\n                <Maximize className=\"h-5 w-5\" />\n              </Button>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* Hotspot Progress */}\n      {data.hotspots.length > 0 && (\n        <Card>\n          <CardContent className=\"pt-6\">\n            <div className=\"flex items-center justify-between mb-3\">\n              <h3 className=\"font-semibold\">Interactive Moments</h3>\n              <Badge variant=\"outline\">\n                {completedHotspots.size}/{data.hotspots.length} Completed\n              </Badge>\n            </div>\n            <Progress value={(completedHotspots.size / data.hotspots.length) * 100} className=\"mb-4\" />\n            <div className=\"space-y-2\">\n              {data.hotspots\n                .sort((a, b) => a.timestamp - b.timestamp)\n                .map((hotspot) => {\n                  const isCompleted = completedHotspots.has(hotspot.id);\n                  return (\n                    <button\n                      key={hotspot.id}\n                      className={`w-full p-3 rounded-lg border cursor-pointer transition-all hover-elevate text-left ${\n                        isCompleted ? \"border-green-600 bg-green-50 dark:bg-green-950\" : \"border-border\"\n                      }`}\n                      onClick={() => jumpToHotspot(hotspot)}\n                      aria-label={`Jump to ${hotspot.type} at ${formatTime(hotspot.timestamp)}: ${hotspot.title}`}\n                      data-testid={`hotspot-item-${hotspot.id}`}\n                    >\n                      <div className=\"flex items-center justify-between\">\n                        <div className=\"flex items-center gap-3\">\n                          {isCompleted && <Check className=\"h-4 w-4 text-green-600\" />}\n                          <div>\n                            <div className=\"flex items-center gap-2\">\n                              <Badge variant=\"secondary\" className=\"text-xs\">\n                                {formatTime(hotspot.timestamp)}\n                              </Badge>\n                              <span className=\"text-sm font-medium\">{hotspot.title}</span>\n                            </div>\n                          </div>\n                        </div>\n                        <Badge variant={hotspot.type === \"question\" ? \"default\" : \"outline\"}>\n                          {hotspot.type}\n                        </Badge>\n                      </div>\n                    </button>\n                  );\n                })}\n            </div>\n          </CardContent>\n        </Card>\n      )}\n\n      {data.hotspots.length === 0 && (\n        <Card className=\"text-center py-12\">\n          <CardContent>\n            <p className=\"text-muted-foreground\">No interactive hotspots added yet.</p>\n          </CardContent>\n        </Card>\n      )}\n    </div>\n  );\n}\n","size_bytes":21201},"client/src/components/ui/input-otp.tsx":{"content":"import * as React from \"react\"\nimport { OTPInput, OTPInputContext } from \"input-otp\"\nimport { Dot } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst InputOTP = React.forwardRef<\n  React.ElementRef<typeof OTPInput>,\n  React.ComponentPropsWithoutRef<typeof OTPInput>\n>(({ className, containerClassName, ...props }, ref) => (\n  <OTPInput\n    ref={ref}\n    containerClassName={cn(\n      \"flex items-center gap-2 has-[:disabled]:opacity-50\",\n      containerClassName\n    )}\n    className={cn(\"disabled:cursor-not-allowed\", className)}\n    {...props}\n  />\n))\nInputOTP.displayName = \"InputOTP\"\n\nconst InputOTPGroup = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"flex items-center\", className)} {...props} />\n))\nInputOTPGroup.displayName = \"InputOTPGroup\"\n\nconst InputOTPSlot = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\"> & { index: number }\n>(({ index, className, ...props }, ref) => {\n  const inputOTPContext = React.useContext(OTPInputContext)\n  const { char, hasFakeCaret, isActive } = inputOTPContext.slots[index]\n\n  return (\n    <div\n      ref={ref}\n      className={cn(\n        \"relative flex h-10 w-10 items-center justify-center border-y border-r border-input text-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md\",\n        isActive && \"z-10 ring-2 ring-ring ring-offset-background\",\n        className\n      )}\n      {...props}\n    >\n      {char}\n      {hasFakeCaret && (\n        <div className=\"pointer-events-none absolute inset-0 flex items-center justify-center\">\n          <div className=\"h-4 w-px animate-caret-blink bg-foreground duration-1000\" />\n        </div>\n      )}\n    </div>\n  )\n})\nInputOTPSlot.displayName = \"InputOTPSlot\"\n\nconst InputOTPSeparator = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ ...props }, ref) => (\n  <div ref={ref} role=\"separator\" {...props}>\n    <Dot />\n  </div>\n))\nInputOTPSeparator.displayName = \"InputOTPSeparator\"\n\nexport { InputOTP, InputOTPGroup, InputOTPSlot, InputOTPSeparator }\n","size_bytes":2154},"server/storage.ts":{"content":"import { db } from \"../db\";\nimport { profiles, h5pContent, contentShares, learnerProgress, quizAttempts, interactionEvents, chatMessages } from \"@shared/schema\";\nimport type { \n  Profile, InsertProfile, \n  H5pContent, InsertH5pContent, \n  ContentShare, InsertContentShare,\n  LearnerProgress, InsertLearnerProgress,\n  QuizAttempt, InsertQuizAttempt,\n  InteractionEvent, InsertInteractionEvent,\n  ChatMessage, InsertChatMessage\n} from \"@shared/schema\";\nimport { eq, and, desc, sql, count, avg, sum } from \"drizzle-orm\";\nimport bcrypt from \"bcryptjs\";\n\nexport interface IStorage {\n  // Profile methods\n  createProfile(profile: InsertProfile): Promise<Profile>;\n  updateProfile(id: string, updates: Partial<InsertProfile>): Promise<Profile | undefined>;\n  getProfileById(id: string): Promise<Profile | undefined>;\n  getProfileByEmail(email: string): Promise<Profile | undefined>;\n  \n  // Content methods\n  createContent(content: InsertH5pContent): Promise<H5pContent>;\n  updateContent(id: string, updates: Partial<InsertH5pContent>): Promise<H5pContent | undefined>;\n  deleteContent(id: string): Promise<void>;\n  getContentById(id: string): Promise<H5pContent | undefined>;\n  getContentByUserId(userId: string): Promise<H5pContent[]>;\n  getPublishedContent(id: string): Promise<H5pContent | undefined>;\n  getPublicContent(): Promise<H5pContent[]>;\n  copyContent(contentId: string, userId: string): Promise<H5pContent>;\n  \n  // Share methods\n  createShare(share: InsertContentShare): Promise<ContentShare>;\n  getSharesByContentId(contentId: string): Promise<ContentShare[]>;\n  \n  // Progress tracking methods\n  upsertLearnerProgress(progress: InsertLearnerProgress): Promise<LearnerProgress>;\n  getLearnerProgress(userId: string, contentId: string): Promise<LearnerProgress | undefined>;\n  getUserProgressByContentId(contentId: string): Promise<LearnerProgress[]>;\n  getAllUserProgress(userId: string): Promise<LearnerProgress[]>;\n  \n  // Quiz attempt methods\n  createQuizAttempt(attempt: InsertQuizAttempt): Promise<QuizAttempt>;\n  getQuizAttempts(userId: string, contentId: string): Promise<QuizAttempt[]>;\n  \n  // Interaction event methods\n  createInteractionEvent(event: InsertInteractionEvent): Promise<InteractionEvent>;\n  getInteractionEvents(userId: string, contentId: string): Promise<InteractionEvent[]>;\n  \n  // Analytics methods\n  getContentAnalytics(contentId: string): Promise<any>;\n  getUserContentAnalytics(userId: string): Promise<any[]>;\n  getContentLearners(contentId: string): Promise<any[]>;\n  \n  // Chat message methods\n  createChatMessage(message: InsertChatMessage): Promise<ChatMessage>;\n  getChatHistory(userId: string, limit?: number): Promise<ChatMessage[]>;\n  deleteChatHistory(userId: string): Promise<void>;\n}\n\nexport class DbStorage implements IStorage {\n  async createProfile(insertProfile: InsertProfile): Promise<Profile> {\n    // Only hash password if it's provided and not already hashed (OAuth users come with pre-hashed sentinel)\n    const password = insertProfile.password \n      ? (insertProfile.password.startsWith('$2') ? insertProfile.password : await bcrypt.hash(insertProfile.password, 10))\n      : null;\n    \n    const [profile] = await db\n      .insert(profiles)\n      .values({ ...insertProfile, password })\n      .returning();\n    return profile;\n  }\n\n  async updateProfile(id: string, updates: Partial<InsertProfile>): Promise<Profile | undefined> {\n    const [profile] = await db\n      .update(profiles)\n      .set(updates)\n      .where(eq(profiles.id, id))\n      .returning();\n    return profile;\n  }\n\n  async getProfileById(id: string): Promise<Profile | undefined> {\n    const [profile] = await db.select().from(profiles).where(eq(profiles.id, id)).limit(1);\n    return profile;\n  }\n\n  async getProfileByEmail(email: string): Promise<Profile | undefined> {\n    const [profile] = await db.select().from(profiles).where(eq(profiles.email, email)).limit(1);\n    return profile;\n  }\n\n  async createContent(insertContent: InsertH5pContent): Promise<H5pContent> {\n    const [content] = await db.insert(h5pContent).values(insertContent).returning();\n    return content;\n  }\n\n  async updateContent(id: string, updates: Partial<InsertH5pContent>): Promise<H5pContent | undefined> {\n    const [content] = await db\n      .update(h5pContent)\n      .set({ ...updates, updatedAt: new Date() })\n      .where(eq(h5pContent.id, id))\n      .returning();\n    return content;\n  }\n\n  async deleteContent(id: string): Promise<void> {\n    await db.delete(h5pContent).where(eq(h5pContent.id, id));\n  }\n\n  async getContentById(id: string): Promise<H5pContent | undefined> {\n    const [content] = await db.select().from(h5pContent).where(eq(h5pContent.id, id)).limit(1);\n    return content;\n  }\n\n  async getContentByUserId(userId: string): Promise<H5pContent[]> {\n    return await db.select().from(h5pContent).where(eq(h5pContent.userId, userId));\n  }\n\n  async getPublishedContent(id: string): Promise<H5pContent | undefined> {\n    const [content] = await db\n      .select()\n      .from(h5pContent)\n      .where(and(eq(h5pContent.id, id), eq(h5pContent.isPublished, true)))\n      .limit(1);\n    return content;\n  }\n\n  async getPublicContent(): Promise<any[]> {\n    console.log('[DEBUG] getPublicContent called');\n    const results = await db\n      .select({\n        id: h5pContent.id,\n        title: h5pContent.title,\n        description: h5pContent.description,\n        type: h5pContent.type,\n        data: h5pContent.data,\n        userId: h5pContent.userId,\n        isPublished: h5pContent.isPublished,\n        isPublic: h5pContent.isPublic,\n        tags: h5pContent.tags,\n        createdAt: h5pContent.createdAt,\n        updatedAt: h5pContent.updatedAt,\n        creatorName: profiles.fullName,\n        creatorInstitution: profiles.institution,\n      })\n      .from(h5pContent)\n      .leftJoin(profiles, eq(h5pContent.userId, profiles.id))\n      .where(and(eq(h5pContent.isPublic, true), eq(h5pContent.isPublished, true)))\n      .orderBy(desc(h5pContent.createdAt));\n    console.log(`[DEBUG] getPublicContent returned ${results.length} results`);\n    return results;\n  }\n\n  async copyContent(contentId: string, userId: string): Promise<H5pContent> {\n    // Get the original content - only if it's published and public\n    const [original] = await db\n      .select()\n      .from(h5pContent)\n      .where(and(\n        eq(h5pContent.id, contentId),\n        eq(h5pContent.isPublished, true),\n        eq(h5pContent.isPublic, true)\n      ))\n      .limit(1);\n    \n    if (!original) {\n      throw new Error(\"Content not found or not available for copying\");\n    }\n    \n    // Create a copy with new ownership and reset publication state\n    const copyData: InsertH5pContent = {\n      userId,\n      title: `Copy of ${original.title}`,\n      description: original.description,\n      type: original.type,\n      data: original.data as any,\n      tags: original.tags,\n      isPublished: false,\n      isPublic: false,\n    };\n    \n    const [copiedContent] = await db.insert(h5pContent).values(copyData).returning();\n    return copiedContent;\n  }\n\n  async createShare(insertShare: InsertContentShare): Promise<ContentShare> {\n    const [share] = await db.insert(contentShares).values(insertShare).returning();\n    return share;\n  }\n\n  async getSharesByContentId(contentId: string): Promise<ContentShare[]> {\n    return await db.select().from(contentShares).where(eq(contentShares.contentId, contentId));\n  }\n\n  async upsertLearnerProgress(progress: InsertLearnerProgress): Promise<LearnerProgress> {\n    // Try to insert, on conflict update\n    const [result] = await db\n      .insert(learnerProgress)\n      .values(progress)\n      .onConflictDoUpdate({\n        target: [learnerProgress.userId, learnerProgress.contentId],\n        set: {\n          completionPercentage: progress.completionPercentage,\n          completedAt: progress.completedAt,\n          lastAccessedAt: new Date(),\n          updatedAt: new Date(),\n        },\n      })\n      .returning();\n    return result;\n  }\n\n  async getLearnerProgress(userId: string, contentId: string): Promise<LearnerProgress | undefined> {\n    const [progress] = await db\n      .select()\n      .from(learnerProgress)\n      .where(and(\n        eq(learnerProgress.userId, userId),\n        eq(learnerProgress.contentId, contentId)\n      ))\n      .limit(1);\n    return progress;\n  }\n\n  async getUserProgressByContentId(contentId: string): Promise<LearnerProgress[]> {\n    return await db.select().from(learnerProgress).where(eq(learnerProgress.contentId, contentId));\n  }\n\n  async getAllUserProgress(userId: string): Promise<LearnerProgress[]> {\n    return await db.select().from(learnerProgress).where(eq(learnerProgress.userId, userId));\n  }\n\n  async createQuizAttempt(attempt: InsertQuizAttempt): Promise<QuizAttempt> {\n    const [created] = await db.insert(quizAttempts).values(attempt).returning();\n    return created;\n  }\n\n  async getQuizAttempts(userId: string, contentId: string): Promise<QuizAttempt[]> {\n    return await db\n      .select()\n      .from(quizAttempts)\n      .where(and(\n        eq(quizAttempts.userId, userId),\n        eq(quizAttempts.contentId, contentId)\n      ))\n      .orderBy(desc(quizAttempts.completedAt));\n  }\n\n  async createInteractionEvent(event: InsertInteractionEvent): Promise<InteractionEvent> {\n    const [created] = await db.insert(interactionEvents).values(event).returning();\n    return created;\n  }\n\n  async getInteractionEvents(userId: string, contentId: string): Promise<InteractionEvent[]> {\n    return await db\n      .select()\n      .from(interactionEvents)\n      .where(and(\n        eq(interactionEvents.userId, userId),\n        eq(interactionEvents.contentId, contentId)\n      ))\n      .orderBy(desc(interactionEvents.createdAt));\n  }\n\n  async getContentAnalytics(contentId: string): Promise<any> {\n    // Get content info\n    const content = await this.getContentById(contentId);\n    if (!content) return null;\n\n    // Get unique viewers and average completion\n    const progressStats = await db\n      .select({\n        uniqueViewers: count(learnerProgress.userId),\n        avgCompletion: avg(learnerProgress.completionPercentage),\n        totalCompleted: sum(sql`CASE WHEN ${learnerProgress.completionPercentage} >= 100 THEN 1 ELSE 0 END`),\n      })\n      .from(learnerProgress)\n      .where(eq(learnerProgress.contentId, contentId));\n\n    // Get quiz stats if it's a quiz\n    const quizStats = await db\n      .select({\n        totalAttempts: count(quizAttempts.id),\n        avgScore: avg(quizAttempts.score),\n        avgPercentage: sql<number>`AVG(CAST(${quizAttempts.score} AS FLOAT) / NULLIF(${quizAttempts.totalQuestions}, 0) * 100)`,\n      })\n      .from(quizAttempts)\n      .where(eq(quizAttempts.contentId, contentId));\n\n    // Get interaction count\n    const interactionStats = await db\n      .select({\n        totalInteractions: count(interactionEvents.id),\n      })\n      .from(interactionEvents)\n      .where(eq(interactionEvents.contentId, contentId));\n\n    // Get recent progress entries (last 7 days)\n    const recentProgress = await db\n      .select()\n      .from(learnerProgress)\n      .where(eq(learnerProgress.contentId, contentId))\n      .orderBy(desc(learnerProgress.lastAccessedAt))\n      .limit(10);\n\n    return {\n      content,\n      stats: {\n        uniqueViewers: Number(progressStats[0]?.uniqueViewers || 0),\n        avgCompletion: Number(progressStats[0]?.avgCompletion || 0),\n        totalCompleted: Number(progressStats[0]?.totalCompleted || 0),\n        totalAttempts: Number(quizStats[0]?.totalAttempts || 0),\n        avgScore: Number(quizStats[0]?.avgScore || 0),\n        avgPercentage: Number(quizStats[0]?.avgPercentage || 0),\n        totalInteractions: Number(interactionStats[0]?.totalInteractions || 0),\n      },\n      recentProgress,\n    };\n  }\n\n  async getUserContentAnalytics(userId: string): Promise<any[]> {\n    // Get all content owned by user\n    const userContent = await this.getContentByUserId(userId);\n\n    // Get analytics for each content item\n    const analyticsPromises = userContent.map(async (content) => {\n      const progressStats = await db\n        .select({\n          uniqueViewers: count(learnerProgress.userId),\n          avgCompletion: avg(learnerProgress.completionPercentage),\n        })\n        .from(learnerProgress)\n        .where(eq(learnerProgress.contentId, content.id));\n\n      const quizStats = await db\n        .select({\n          totalAttempts: count(quizAttempts.id),\n          avgScore: avg(quizAttempts.score),\n        })\n        .from(quizAttempts)\n        .where(eq(quizAttempts.contentId, content.id));\n\n      const interactionStats = await db\n        .select({\n          totalInteractions: count(interactionEvents.id),\n        })\n        .from(interactionEvents)\n        .where(eq(interactionEvents.contentId, content.id));\n\n      return {\n        contentId: content.id,\n        title: content.title,\n        type: content.type,\n        isPublished: content.isPublished,\n        createdAt: content.createdAt,\n        uniqueViewers: Number(progressStats[0]?.uniqueViewers || 0),\n        avgCompletion: Number(progressStats[0]?.avgCompletion || 0),\n        totalAttempts: Number(quizStats[0]?.totalAttempts || 0),\n        avgScore: Number(quizStats[0]?.avgScore || 0),\n        totalInteractions: Number(interactionStats[0]?.totalInteractions || 0),\n      };\n    });\n\n    return await Promise.all(analyticsPromises);\n  }\n\n  async getContentLearners(contentId: string): Promise<any[]> {\n    // Get all learners with their progress and profile info in one query\n    const learners = await db\n      .select({\n        userId: learnerProgress.userId,\n        fullName: profiles.fullName,\n        email: profiles.email,\n        role: profiles.role,\n        completionPercentage: learnerProgress.completionPercentage,\n        completedAt: learnerProgress.completedAt,\n        lastAccessedAt: learnerProgress.lastAccessedAt,\n        firstAccessedAt: learnerProgress.createdAt,\n      })\n      .from(learnerProgress)\n      .innerJoin(profiles, eq(learnerProgress.userId, profiles.id))\n      .where(eq(learnerProgress.contentId, contentId))\n      .orderBy(desc(learnerProgress.lastAccessedAt));\n\n    // Get all user IDs to fetch quiz attempts and interactions efficiently\n    const userIds = learners.map(l => l.userId);\n    \n    // Batch fetch quiz attempts for all users\n    const allQuizAttempts = userIds.length > 0 ? await db\n      .select({\n        userId: quizAttempts.userId,\n        score: quizAttempts.score,\n        totalQuestions: quizAttempts.totalQuestions,\n        completedAt: quizAttempts.completedAt,\n      })\n      .from(quizAttempts)\n      .where(eq(quizAttempts.contentId, contentId))\n      .orderBy(desc(quizAttempts.completedAt)) : [];\n\n    // Batch fetch interaction counts for all users\n    const allInteractions = userIds.length > 0 ? await db\n      .select({\n        userId: interactionEvents.userId,\n        totalInteractions: count(interactionEvents.id),\n      })\n      .from(interactionEvents)\n      .where(eq(interactionEvents.contentId, contentId))\n      .groupBy(interactionEvents.userId) : [];\n\n    // Create lookup maps\n    const quizAttemptsByUser = allQuizAttempts.reduce((acc, attempt) => {\n      if (!acc[attempt.userId]) acc[attempt.userId] = [];\n      acc[attempt.userId].push(attempt);\n      return acc;\n    }, {} as Record<string, typeof allQuizAttempts>);\n\n    const interactionsByUser = allInteractions.reduce((acc, stat) => {\n      acc[stat.userId] = stat.totalInteractions;\n      return acc;\n    }, {} as Record<string, number>);\n\n    // Combine data\n    return learners.map((learner) => {\n      const userAttempts = (quizAttemptsByUser[learner.userId] || []).slice(0, 5);\n      return {\n        userId: learner.userId,\n        displayName: learner.fullName,\n        email: learner.email,\n        role: learner.role,\n        completionPercentage: learner.completionPercentage,\n        completedAt: learner.completedAt,\n        lastAccessedAt: learner.lastAccessedAt,\n        firstAccessedAt: learner.firstAccessedAt,\n        quizAttempts: userAttempts.map(attempt => ({\n          score: attempt.score,\n          totalQuestions: attempt.totalQuestions,\n          percentage: (attempt.score / attempt.totalQuestions * 100).toFixed(1),\n          completedAt: attempt.completedAt,\n        })),\n        totalInteractions: Number(interactionsByUser[learner.userId] || 0),\n      };\n    });\n  }\n\n  async createChatMessage(message: InsertChatMessage): Promise<ChatMessage> {\n    const [chatMessage] = await db.insert(chatMessages).values(message).returning();\n    return chatMessage;\n  }\n\n  async getChatHistory(userId: string, limit: number = 50): Promise<ChatMessage[]> {\n    return await db\n      .select()\n      .from(chatMessages)\n      .where(eq(chatMessages.userId, userId))\n      .orderBy(desc(chatMessages.createdAt))\n      .limit(limit);\n  }\n\n  async deleteChatHistory(userId: string): Promise<void> {\n    await db.delete(chatMessages).where(eq(chatMessages.userId, userId));\n  }\n}\n\nexport const storage = new DbStorage();\n","size_bytes":17038},"client/src/index.css":{"content":"@tailwind base;\n@tailwind components;\n@tailwind utilities;\n\n/* LIGHT MODE - OECS Color Palette */\n:root {\n  --button-outline: rgba(0,0,0, .10);\n  --badge-outline: rgba(0,0,0, .05);\n  --opaque-button-border-intensity: -8;\n  --elevate-1: rgba(0,0,0, .03);\n  --elevate-2: rgba(0,0,0, .08);\n  --background: 0 0% 98%;\n  --foreground: 222 49% 21%;\n  --border: 222 20% 88%;\n  --card: 0 0% 100%;\n  --card-foreground: 222 49% 21%;\n  --card-border: 222 20% 92%;\n  --sidebar: 82 15% 95%;\n  --sidebar-foreground: 222 49% 21%;\n  --sidebar-border: 82 15% 88%;\n  --sidebar-primary: 82 64% 59%;\n  --sidebar-primary-foreground: 0 0% 100%;\n  --sidebar-accent: 82 30% 90%;\n  --sidebar-accent-foreground: 222 49% 21%;\n  --sidebar-ring: 82 64% 59%;\n  --popover: 0 0% 100%;\n  --popover-foreground: 222 49% 21%;\n  --popover-border: 222 20% 88%;\n  --primary: 82 64% 59%;\n  --primary-foreground: 0 0% 100%;\n  --secondary: 222 49% 21%;\n  --secondary-foreground: 0 0% 100%;\n  --muted: 222 15% 92%;\n  --muted-foreground: 222 25% 50%;\n  --accent: 36 100% 65%;\n  --accent-foreground: 222 49% 21%;\n  --destructive: 0 84% 60%;\n  --destructive-foreground: 0 0% 100%;\n  --input: 222 20% 85%;\n  --ring: 82 64% 59%;\n  --chart-1: 82 64% 59%;\n  --chart-2: 36 100% 65%;\n  --chart-3: 222 49% 45%;\n  --chart-4: 173 60% 45%;\n  --chart-5: 280 55% 58%;\n  --font-sans: Inter, -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif;\n  --font-serif: Georgia, serif;\n  --font-mono: \"JetBrains Mono\", \"Courier New\", monospace;\n  --radius: .5rem;\n  --shadow-2xs: 0px 2px 0px 0px hsl(220 13% 13% / 0.00);\n  --shadow-xs: 0px 2px 0px 0px hsl(220 13% 13% / 0.00);\n  --shadow-sm: 0px 2px 0px 0px hsl(220 13% 13% / 0.00), 0px 1px 2px -1px hsl(220 13% 13% / 0.00);\n  --shadow: 0px 2px 0px 0px hsl(220 13% 13% / 0.00), 0px 1px 2px -1px hsl(220 13% 13% / 0.00);\n  --shadow-md: 0px 2px 0px 0px hsl(220 13% 13% / 0.00), 0px 2px 4px -1px hsl(220 13% 13% / 0.00);\n  --shadow-lg: 0px 2px 0px 0px hsl(220 13% 13% / 0.00), 0px 4px 6px -1px hsl(220 13% 13% / 0.00);\n  --shadow-xl: 0px 2px 0px 0px hsl(220 13% 13% / 0.00), 0px 8px 10px -1px hsl(220 13% 13% / 0.00);\n  --shadow-2xl: 0px 2px 0px 0px hsl(220 13% 13% / 0.00);\n  --tracking-normal: 0em;\n  --spacing: 0.25rem;\n\n/* Fallback for older browsers */\n  --sidebar-primary-border: hsl(var(--sidebar-primary));\n  --sidebar-primary-border: hsl(from hsl(var(--sidebar-primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --sidebar-accent-border: hsl(var(--sidebar-accent));\n  --sidebar-accent-border: hsl(from hsl(var(--sidebar-accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --primary-border: hsl(var(--primary));\n  --primary-border: hsl(from hsl(var(--primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --secondary-border: hsl(var(--secondary));\n  --secondary-border: hsl(from hsl(var(--secondary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --muted-border: hsl(var(--muted));\n  --muted-border: hsl(from hsl(var(--muted)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --accent-border: hsl(var(--accent));\n  --accent-border: hsl(from hsl(var(--accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --destructive-border: hsl(var(--destructive));\n  --destructive-border: hsl(from hsl(var(--destructive)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n}\n\n.dark {\n  --button-outline: rgba(255,255,255, .10);\n  --badge-outline: rgba(255,255,255, .05);\n  --opaque-button-border-intensity: 9;\n  --elevate-1: rgba(255,255,255, .04);\n  --elevate-2: rgba(255,255,255, .09);\n  --background: 222 35% 10%;\n  --foreground: 82 30% 92%;\n  --border: 222 25% 20%;\n  --card: 222 30% 13%;\n  --card-foreground: 82 30% 92%;\n  --card-border: 222 25% 16%;\n  --sidebar: 222 35% 15%;\n  --sidebar-foreground: 82 30% 92%;\n  --sidebar-border: 222 25% 18%;\n  --sidebar-primary: 82 64% 59%;\n  --sidebar-primary-foreground: 222 49% 21%;\n  --sidebar-accent: 222 30% 20%;\n  --sidebar-accent-foreground: 82 30% 92%;\n  --sidebar-ring: 82 64% 59%;\n  --popover: 222 30% 16%;\n  --popover-foreground: 82 30% 92%;\n  --popover-border: 222 25% 20%;\n  --primary: 82 64% 59%;\n  --primary-foreground: 222 49% 21%;\n  --secondary: 222 30% 22%;\n  --secondary-foreground: 82 30% 92%;\n  --muted: 222 25% 20%;\n  --muted-foreground: 222 15% 65%;\n  --accent: 36 100% 65%;\n  --accent-foreground: 222 35% 10%;\n  --destructive: 0 84% 60%;\n  --destructive-foreground: 0 0% 100%;\n  --input: 222 25% 28%;\n  --ring: 82 64% 59%;\n  --chart-1: 82 64% 65%;\n  --chart-2: 36 100% 70%;\n  --chart-3: 222 49% 55%;\n  --chart-4: 173 60% 55%;\n  --chart-5: 280 55% 68%;\n  --shadow-2xs: 0px 2px 0px 0px hsl(220 13% 5% / 0.00);\n  --shadow-xs: 0px 2px 0px 0px hsl(220 13% 5% / 0.00);\n  --shadow-sm: 0px 2px 0px 0px hsl(220 13% 5% / 0.00), 0px 1px 2px -1px hsl(220 13% 5% / 0.00);\n  --shadow: 0px 2px 0px 0px hsl(220 13% 5% / 0.00), 0px 1px 2px -1px hsl(220 13% 5% / 0.00);\n  --shadow-md: 0px 2px 0px 0px hsl(220 13% 5% / 0.00), 0px 2px 4px -1px hsl(220 13% 5% / 0.00);\n  --shadow-lg: 0px 2px 0px 0px hsl(220 13% 5% / 0.00), 0px 4px 6px -1px hsl(220 13% 5% / 0.00);\n  --shadow-xl: 0px 2px 0px 0px hsl(220 13% 5% / 0.00), 0px 8px 10px -1px hsl(220 13% 5% / 0.00);\n  --shadow-2xl: 0px 2px 0px 0px hsl(220 13% 5% / 0.00);\n\n/* Fallback for older browsers */\n  --sidebar-primary-border: hsl(var(--sidebar-primary));\n  --sidebar-primary-border: hsl(from hsl(var(--sidebar-primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --sidebar-accent-border: hsl(var(--sidebar-accent));\n  --sidebar-accent-border: hsl(from hsl(var(--sidebar-accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --primary-border: hsl(var(--primary));\n  --primary-border: hsl(from hsl(var(--primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --secondary-border: hsl(var(--secondary));\n  --secondary-border: hsl(from hsl(var(--secondary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --muted-border: hsl(var(--muted));\n  --muted-border: hsl(from hsl(var(--muted)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --accent-border: hsl(var(--accent));\n  --accent-border: hsl(from hsl(var(--accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --destructive-border: hsl(var(--destructive));\n  --destructive-border: hsl(from hsl(var(--destructive)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n}\n\n@layer base {\n  * {\n    @apply border-border;\n  }\n\n  body {\n    @apply font-sans antialiased bg-background text-foreground;\n  }\n}\n\n/**\n * Using the elevate system.\n * Automatic contrast adjustment.\n *\n * <element className=\"hover-elevate\" />\n * <element className=\"active-elevate-2\" />\n *\n * // Using the tailwind utility when a data attribute is \"on\"\n * <element className=\"toggle-elevate data-[state=on]:toggle-elevated\" />\n * // Or manually controlling the toggle state\n * <element className=\"toggle-elevate toggle-elevated\" />\n *\n * Elevation systems have to handle many states.\n * - not-hovered, vs. hovered vs. active  (three mutually exclusive states)\n * - toggled or not\n * - focused or not (this is not handled with these utilities)\n *\n * Even without handling focused or not, this is six possible combinations that\n * need to be distinguished from eachother visually.\n */\n@layer utilities {\n\n  /* ACCESSIBILITY: Visible focus indicator for keyboard navigation - interactive elements only */\n  button:focus-visible,\n  a:focus-visible,\n  input:focus-visible,\n  textarea:focus-visible,\n  select:focus-visible,\n  [role=\"button\"]:focus-visible,\n  [role=\"link\"]:focus-visible,\n  [role=\"radio\"]:focus-visible,\n  [role=\"checkbox\"]:focus-visible,\n  [role=\"tab\"]:focus-visible,\n  [tabindex]:focus-visible {\n    outline: 2px solid hsl(var(--ring));\n    outline-offset: 2px;\n  }\n\n  /* ACCESSIBILITY: Screen reader only text */\n  .sr-only {\n    position: absolute;\n    width: 1px;\n    height: 1px;\n    padding: 0;\n    margin: -1px;\n    overflow: hidden;\n    clip: rect(0, 0, 0, 0);\n    white-space: nowrap;\n    border-width: 0;\n  }\n\n  /* ACCESSIBILITY: Skip to main content link */\n  .skip-to-content {\n    position: absolute;\n    left: -9999px;\n    z-index: 999;\n    padding: 1rem 1.5rem;\n    background-color: hsl(var(--primary));\n    color: hsl(var(--primary-foreground));\n    text-decoration: none;\n    border-radius: var(--radius);\n  }\n\n  .skip-to-content:focus {\n    left: 1rem;\n    top: 1rem;\n  }\n\n  /* ACCESSIBILITY: Reduced motion support */\n  @media (prefers-reduced-motion: reduce) {\n    *,\n    *::before,\n    *::after {\n      animation-duration: 0.01ms !important;\n      animation-iteration-count: 1 !important;\n      transition-duration: 0.01ms !important;\n      scroll-behavior: auto !important;\n    }\n  }\n\n  /* Hide ugly search cancel button in Chrome until we can style it properly */\n  input[type=\"search\"]::-webkit-search-cancel-button {\n    @apply hidden;\n  }\n\n  /* Placeholder styling for contentEditable div */\n  [contenteditable][data-placeholder]:empty::before {\n    content: attr(data-placeholder);\n    color: hsl(var(--muted-foreground));\n    pointer-events: none;\n  }\n\n  /* .no-default-hover-elevate/no-default-active-elevate is an escape hatch so consumers of\n   * buttons/badges can remove the automatic brightness adjustment on interactions\n   * and program their own. */\n  .no-default-hover-elevate {}\n\n  .no-default-active-elevate {}\n\n\n  /**\n   * Toggleable backgrounds go behind the content. Hoverable/active goes on top.\n   * This way they can stack/compound. Both will overlap the parent's borders!\n   * So borders will be automatically adjusted both on toggle, and hover/active,\n   * and they will be compounded.\n   */\n  .toggle-elevate::before,\n  .toggle-elevate-2::before {\n    content: \"\";\n    pointer-events: none;\n    position: absolute;\n    inset: 0px;\n    /*border-radius: inherit;   match rounded corners */\n    border-radius: inherit;\n    z-index: -1;\n    /* sits behind content but above backdrop */\n  }\n\n  .toggle-elevate.toggle-elevated::before {\n    background-color: var(--elevate-2);\n  }\n\n  /* If there's a 1px border, adjust the inset so that it covers that parent's border */\n  .border.toggle-elevate::before {\n    inset: -1px;\n  }\n\n  /* Does not work on elements with overflow:hidden! */\n  .hover-elevate:not(.no-default-hover-elevate),\n  .active-elevate:not(.no-default-active-elevate),\n  .hover-elevate-2:not(.no-default-hover-elevate),\n  .active-elevate-2:not(.no-default-active-elevate) {\n    position: relative;\n    z-index: 0;\n  }\n\n  .hover-elevate:not(.no-default-hover-elevate)::after,\n  .active-elevate:not(.no-default-active-elevate)::after,\n  .hover-elevate-2:not(.no-default-hover-elevate)::after,\n  .active-elevate-2:not(.no-default-active-elevate)::after {\n    content: \"\";\n    pointer-events: none;\n    position: absolute;\n    inset: 0px;\n    /*border-radius: inherit;   match rounded corners */\n    border-radius: inherit;\n    z-index: 999;\n    /* sits in front of content */\n  }\n\n  .hover-elevate:hover:not(.no-default-hover-elevate)::after,\n  .active-elevate:active:not(.no-default-active-elevate)::after {\n    background-color: var(--elevate-1);\n  }\n\n  .hover-elevate-2:hover:not(.no-default-hover-elevate)::after,\n  .active-elevate-2:active:not(.no-default-active-elevate)::after {\n    background-color: var(--elevate-2);\n  }\n\n  /* If there's a 1px border, adjust the inset so that it covers that parent's border */\n  .border.hover-elevate:not(.no-hover-interaction-elevate)::after,\n  .border.active-elevate:not(.no-active-interaction-elevate)::after,\n  .border.hover-elevate-2:not(.no-hover-interaction-elevate)::after,\n  .border.active-elevate-2:not(.no-active-interaction-elevate)::after,\n  .border.hover-elevate:not(.no-hover-interaction-elevate)::after {\n    inset: -1px;\n  }\n}\n\n/* Chat markdown styling */\n.prose {\n  color: inherit;\n  font-size: 0.875rem;\n  line-height: 1.5;\n}\n\n.prose p {\n  margin-top: 0.5em;\n  margin-bottom: 0.5em;\n}\n\n.prose p:first-child {\n  margin-top: 0;\n}\n\n.prose p:last-child {\n  margin-bottom: 0;\n}\n\n.prose ul, .prose ol {\n  margin-top: 0.5em;\n  margin-bottom: 0.5em;\n  padding-left: 1.5em;\n}\n\n.prose li {\n  margin-top: 0.25em;\n  margin-bottom: 0.25em;\n}\n\n.prose code {\n  background-color: hsl(var(--muted));\n  color: hsl(var(--foreground));\n  padding: 0.125rem 0.375rem;\n  border-radius: 0.25rem;\n  font-size: 0.85em;\n  font-family: var(--font-mono);\n}\n\n.prose pre {\n  background-color: hsl(var(--muted));\n  padding: 0.75rem;\n  border-radius: 0.375rem;\n  overflow-x: auto;\n  margin-top: 0.5em;\n  margin-bottom: 0.5em;\n}\n\n.prose pre code {\n  background-color: transparent;\n  padding: 0;\n  font-size: 0.875em;\n}\n\n.prose strong {\n  font-weight: 600;\n  color: hsl(var(--foreground));\n}\n\n.prose em {\n  font-style: italic;\n}\n\n.prose h1, .prose h2, .prose h3, .prose h4, .prose h5, .prose h6 {\n  font-weight: 600;\n  margin-top: 0.75em;\n  margin-bottom: 0.5em;\n  color: hsl(var(--foreground));\n}\n\n.prose h1 {\n  font-size: 1.125em;\n}\n\n.prose h2 {\n  font-size: 1em;\n}\n\n.prose h3, .prose h4, .prose h5, .prose h6 {\n  font-size: 0.875em;\n}\n\n.prose a {\n  color: hsl(var(--primary));\n  text-decoration: underline;\n  text-underline-offset: 2px;\n}\n\n.prose a:hover {\n  text-decoration: none;\n}\n\n.prose blockquote {\n  border-left: 2px solid hsl(var(--border));\n  padding-left: 1em;\n  font-style: italic;\n  margin-top: 0.5em;\n  margin-bottom: 0.5em;\n  color: hsl(var(--muted-foreground));\n}\n\n.prose hr {\n  border-color: hsl(var(--border));\n  margin: 1em 0;\n}\n","size_bytes":13938},"postcss.config.js":{"content":"export default {\n  plugins: {\n    tailwindcss: {},\n    autoprefixer: {},\n  },\n}\n","size_bytes":80},"client/src/components/players/FlashcardPlayer.tsx":{"content":"import { useState, useEffect, useRef } from \"react\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { ChevronLeft, ChevronRight, RotateCcw, Shuffle, ImageOff } from \"lucide-react\";\nimport type { FlashcardData } from \"@shared/schema\";\nimport { useProgressTracker } from \"@/hooks/use-progress-tracker\";\n\ntype FlashcardPlayerProps = {\n  data: FlashcardData;\n  contentId: string;\n};\n\nexport function FlashcardPlayer({ data, contentId }: FlashcardPlayerProps) {\n  const [cards, setCards] = useState(data.cards);\n  const [currentIndex, setCurrentIndex] = useState(0);\n  const [isFlipped, setIsFlipped] = useState(false);\n  const [viewedCards, setViewedCards] = useState<Set<number>>(new Set());\n  const [frontImageError, setFrontImageError] = useState(false);\n  const [backImageError, setBackImageError] = useState(false);\n\n  const { progress: savedProgress, isProgressFetched, updateProgress, logInteraction, isAuthenticated } = useProgressTracker(contentId);\n  const [lastSentProgress, setLastSentProgress] = useState<number>(-1);\n  const [isProgressInitialized, setIsProgressInitialized] = useState(false);\n  const pendingMilestoneRef = useRef<number | null>(null);\n  const pendingTimeoutRef = useRef<NodeJS.Timeout | null>(null);\n  const previousAuthRef = useRef<boolean>(isAuthenticated);\n\n  const currentCard = cards[currentIndex];\n  const progressPercentage = ((currentIndex + 1) / cards.length) * 100;\n\n  // Sync local cards state with prop changes (e.g., from auto-save updates)\n  // NOTE: Only depends on data.cards to preserve local shuffle order\n  useEffect(() => {\n    setCards(data.cards);\n    \n    // Clamp currentIndex if deck shrunk\n    if (currentIndex >= data.cards.length && data.cards.length > 0) {\n      setCurrentIndex(data.cards.length - 1);\n      setIsFlipped(false);\n      setFrontImageError(false);\n      setBackImageError(false);\n    }\n    \n    // Reset to 0 if deck became empty\n    if (data.cards.length === 0) {\n      setCurrentIndex(0);\n      setIsFlipped(false);\n      setViewedCards(new Set());\n      setFrontImageError(false);\n      setBackImageError(false);\n    } else {\n      // Clean up viewedCards: remove indices that no longer exist\n      setViewedCards(prev => {\n        const validIndices = new Set<number>();\n        prev.forEach(index => {\n          if (index < data.cards.length) {\n            validIndices.add(index);\n          }\n        });\n        \n        // Recalculate progress after cleanup\n        if (isAuthenticated && isProgressInitialized && validIndices.size > 0) {\n          const newCompletionPercentage = Math.round((validIndices.size / data.cards.length) * 100);\n          // If progress increased, update backend\n          if (newCompletionPercentage > lastSentProgress && newCompletionPercentage !== pendingMilestoneRef.current) {\n            setLastSentProgress(newCompletionPercentage);\n            pendingMilestoneRef.current = newCompletionPercentage;\n            updateProgress(newCompletionPercentage);\n            // Clear pending after 5 seconds\n            if (pendingTimeoutRef.current) {\n              clearTimeout(pendingTimeoutRef.current);\n            }\n            pendingTimeoutRef.current = setTimeout(() => {\n              pendingMilestoneRef.current = null;\n              pendingTimeoutRef.current = null;\n            }, 5000);\n          }\n        }\n        \n        return validIndices;\n      });\n    }\n  }, [data.cards, isAuthenticated, isProgressInitialized, lastSentProgress, updateProgress]);\n\n  // Reset image errors when current card's images change (e.g., after auto-save update)\n  useEffect(() => {\n    setFrontImageError(false);\n    setBackImageError(false);\n  }, [currentCard?.frontImageUrl, currentCard?.backImageUrl]);\n\n  // Reset initialization when auth changes from false → true\n  useEffect(() => {\n    if (!previousAuthRef.current && isAuthenticated) {\n      // User just logged in - reset to wait for progress fetch\n      setIsProgressInitialized(false);\n      setLastSentProgress(-1);\n      pendingMilestoneRef.current = null;\n      if (pendingTimeoutRef.current) {\n        clearTimeout(pendingTimeoutRef.current);\n        pendingTimeoutRef.current = null;\n      }\n    }\n    previousAuthRef.current = isAuthenticated;\n  }, [isAuthenticated]);\n\n  // Initialize from persisted progress and reconcile when savedProgress updates\n  useEffect(() => {\n    if (!isProgressInitialized) {\n      if (!isAuthenticated) {\n        setIsProgressInitialized(true);\n      } else if (isProgressFetched) {\n        if (savedProgress) {\n          setLastSentProgress(savedProgress.completionPercentage);\n        }\n        setIsProgressInitialized(true);\n      }\n    } else if (savedProgress) {\n      // After initialization, reconcile: server can only raise, never lower\n      // Only update if savedProgress is truthy (skip null refetches)\n      setLastSentProgress(prev => Math.max(prev, savedProgress.completionPercentage));\n      // Clear pending milestone if it's been saved\n      if (pendingMilestoneRef.current !== null && savedProgress.completionPercentage >= pendingMilestoneRef.current) {\n        pendingMilestoneRef.current = null;\n        if (pendingTimeoutRef.current) {\n          clearTimeout(pendingTimeoutRef.current);\n          pendingTimeoutRef.current = null;\n        }\n      }\n    }\n  }, [savedProgress, isProgressFetched, isAuthenticated, isProgressInitialized]);\n\n  // Track when cards are viewed (flipped) - monotonic, only after initialization\n  useEffect(() => {\n    if (!isProgressInitialized || !isAuthenticated) return;\n    \n    if (isFlipped && !viewedCards.has(currentIndex)) {\n      const newViewedCards = new Set(viewedCards).add(currentIndex);\n      setViewedCards(newViewedCards);\n      \n      // Update progress based on cards viewed (only if higher than local high water mark and not pending)\n      const completionPercentage = Math.round((newViewedCards.size / cards.length) * 100);\n      if (completionPercentage > lastSentProgress && completionPercentage !== pendingMilestoneRef.current) {\n        pendingMilestoneRef.current = completionPercentage;\n        updateProgress(completionPercentage);\n        // Clear pending after 5 seconds to allow retry on failure\n        if (pendingTimeoutRef.current) {\n          clearTimeout(pendingTimeoutRef.current);\n        }\n        pendingTimeoutRef.current = setTimeout(() => {\n          pendingMilestoneRef.current = null;\n          pendingTimeoutRef.current = null;\n        }, 5000);\n      }\n      \n      logInteraction(\"card_flipped\", { cardIndex: currentIndex });\n    }\n  }, [isFlipped, currentIndex, lastSentProgress, isProgressInitialized, isAuthenticated]);\n\n  const handleNext = () => {\n    setIsFlipped(false);\n    setFrontImageError(false);\n    setBackImageError(false);\n    if (currentIndex < cards.length - 1) {\n      setCurrentIndex(currentIndex + 1);\n    } else {\n      setCurrentIndex(0);\n    }\n  };\n\n  const handlePrevious = () => {\n    setIsFlipped(false);\n    setFrontImageError(false);\n    setBackImageError(false);\n    if (currentIndex > 0) {\n      setCurrentIndex(currentIndex - 1);\n    } else {\n      setCurrentIndex(cards.length - 1);\n    }\n  };\n\n  const handleShuffle = () => {\n    const shuffled = [...cards].sort(() => Math.random() - 0.5);\n    setCards(shuffled);\n    setCurrentIndex(0);\n    setIsFlipped(false);\n    setFrontImageError(false);\n    setBackImageError(false);\n    logInteraction(\"cards_shuffled\");\n  };\n\n  const handleRestart = () => {\n    setCards(data.cards);\n    setCurrentIndex(0);\n    setIsFlipped(false);\n    setViewedCards(new Set());\n    setFrontImageError(false);\n    setBackImageError(false);\n    // Don't reset lastSentProgress - keep high water mark to prevent regression\n    logInteraction(\"cards_restarted\");\n  };\n\n  // Defensive check: prevent crashes when no cards or currentCard is undefined\n  if (cards.length === 0 || !currentCard) {\n    return (\n      <div className=\"max-w-2xl mx-auto space-y-6 text-center py-12\">\n        <p className=\"text-muted-foreground\">No flashcards available.</p>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"max-w-2xl mx-auto space-y-6\">\n      {/* Progress */}\n      {data.settings.showProgress && (\n        <div className=\"space-y-2\">\n          <div className=\"flex items-center justify-between text-sm\">\n            <span className=\"text-muted-foreground\">\n              Card {currentIndex + 1} of {cards.length}\n            </span>\n            <span className=\"font-medium\">{Math.round(progressPercentage)}%</span>\n          </div>\n          <Progress value={progressPercentage} className=\"h-2\" />\n        </div>\n      )}\n\n      {/* Flashcard */}\n      <div\n        className=\"relative cursor-pointer\"\n        style={{ aspectRatio: \"3/2\" }}\n        onClick={() => setIsFlipped(!isFlipped)}\n        data-testid=\"flashcard\"\n      >\n        <div\n          className={`absolute inset-0 transition-all duration-500 transform preserve-3d ${\n            isFlipped ? \"rotate-y-180\" : \"\"\n          }`}\n        >\n          {/* Front */}\n          <Card\n            className={`absolute inset-0 backface-hidden ${\n              isFlipped ? \"invisible\" : \"visible\"\n            } flex items-center justify-center hover-elevate overflow-hidden`}\n          >\n            <CardContent className=\"p-8 text-center w-full\">\n              <div className=\"space-y-4\">\n                <div className=\"text-xs uppercase tracking-wide text-muted-foreground\">Front</div>\n                {currentCard.frontImageUrl && !frontImageError && (\n                  <div className=\"mb-4\">\n                    <img \n                      src={currentCard.frontImageUrl} \n                      alt={currentCard.frontImageAlt || currentCard.front || \"Flashcard front image\"} \n                      className=\"max-w-full max-h-48 mx-auto rounded-md object-contain\"\n                      loading=\"lazy\"\n                      onError={() => setFrontImageError(true)}\n                    />\n                  </div>\n                )}\n                {currentCard.frontImageUrl && frontImageError && (\n                  <div className=\"mb-4 flex items-center justify-center gap-2 text-muted-foreground p-8 border border-dashed rounded-md\">\n                    <ImageOff className=\"h-5 w-5\" />\n                    <span className=\"text-sm\">Image failed to load</span>\n                  </div>\n                )}\n                {currentCard.front && (\n                  <div className=\"text-2xl font-semibold\">{currentCard.front}</div>\n                )}\n                {currentCard.category && (\n                  <div className=\"inline-block px-3 py-1 rounded-full bg-primary/10 text-primary text-xs\">\n                    {currentCard.category}\n                  </div>\n                )}\n                <div className=\"text-sm text-muted-foreground pt-4\">Click to flip</div>\n              </div>\n            </CardContent>\n          </Card>\n\n          {/* Back */}\n          <Card\n            className={`absolute inset-0 backface-hidden ${\n              !isFlipped ? \"invisible\" : \"visible\"\n            } flex items-center justify-center bg-primary/5 hover-elevate overflow-hidden`}\n            style={{ transform: \"rotateY(180deg)\" }}\n          >\n            <CardContent className=\"p-8 text-center w-full\">\n              <div className=\"space-y-4\">\n                <div className=\"text-xs uppercase tracking-wide text-muted-foreground\">Back</div>\n                {currentCard.backImageUrl && !backImageError && (\n                  <div className=\"mb-4\">\n                    <img \n                      src={currentCard.backImageUrl} \n                      alt={currentCard.backImageAlt || currentCard.back || \"Flashcard back image\"} \n                      className=\"max-w-full max-h-48 mx-auto rounded-md object-contain\"\n                      loading=\"lazy\"\n                      onError={() => setBackImageError(true)}\n                    />\n                  </div>\n                )}\n                {currentCard.backImageUrl && backImageError && (\n                  <div className=\"mb-4 flex items-center justify-center gap-2 text-muted-foreground p-8 border border-dashed rounded-md\">\n                    <ImageOff className=\"h-5 w-5\" />\n                    <span className=\"text-sm\">Image failed to load</span>\n                  </div>\n                )}\n                {currentCard.back && (\n                  <div className=\"text-2xl font-semibold\">{currentCard.back}</div>\n                )}\n                {currentCard.category && (\n                  <div className=\"inline-block px-3 py-1 rounded-full bg-primary/10 text-primary text-xs\">\n                    {currentCard.category}\n                  </div>\n                )}\n                <div className=\"text-sm text-muted-foreground pt-4\">Click to flip</div>\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n\n      {/* Controls */}\n      <div className=\"flex items-center justify-between gap-4\">\n        <Button variant=\"outline\" size=\"icon\" onClick={handlePrevious} data-testid=\"button-previous\">\n          <ChevronLeft className=\"h-5 w-5\" />\n        </Button>\n\n        <div className=\"flex gap-2\">\n          {data.settings.shuffleCards && (\n            <Button variant=\"outline\" size=\"sm\" onClick={handleShuffle} data-testid=\"button-shuffle\">\n              <Shuffle className=\"h-4 w-4 mr-2\" />\n              Shuffle\n            </Button>\n          )}\n          <Button variant=\"outline\" size=\"sm\" onClick={handleRestart} data-testid=\"button-restart\">\n            <RotateCcw className=\"h-4 w-4 mr-2\" />\n            Restart\n          </Button>\n        </div>\n\n        <Button variant=\"outline\" size=\"icon\" onClick={handleNext} data-testid=\"button-next\">\n          <ChevronRight className=\"h-5 w-5\" />\n        </Button>\n      </div>\n    </div>\n  );\n}\n","size_bytes":13911},"client/src/components/ui/progress.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ProgressPrimitive from \"@radix-ui/react-progress\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Progress = React.forwardRef<\n  React.ElementRef<typeof ProgressPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root>\n>(({ className, value, ...props }, ref) => (\n  <ProgressPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative h-4 w-full overflow-hidden rounded-full bg-secondary\",\n      className\n    )}\n    {...props}\n  >\n    <ProgressPrimitive.Indicator\n      className=\"h-full w-full flex-1 bg-primary transition-all\"\n      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}\n    />\n  </ProgressPrimitive.Root>\n))\nProgress.displayName = ProgressPrimitive.Root.displayName\n\nexport { Progress }\n","size_bytes":791},"client/src/components/ui/input.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Input = React.forwardRef<HTMLInputElement, React.ComponentProps<\"input\">>(\n  ({ className, type, ...props }, ref) => {\n    // h-9 to match icon buttons and default buttons.\n    return (\n      <input\n        type={type}\n        className={cn(\n          \"flex h-9 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nInput.displayName = \"Input\"\n\nexport { Input }\n","size_bytes":844},"client/src/pages/SharePage.tsx":{"content":"import { useState } from \"react\";\nimport { useParams, useLocation } from \"wouter\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { Breadcrumbs } from \"@/components/Breadcrumbs\";\nimport { useBreadcrumbs } from \"@/hooks/useBreadcrumbs\";\nimport { ArrowLeft, Copy, Check, Share2, Globe } from \"lucide-react\";\nimport type { H5pContent } from \"@shared/schema\";\n\nexport default function SharePage() {\n  const params = useParams();\n  const [_, navigate] = useLocation();\n  const { toast } = useToast();\n  const contentId = params.id;\n  const [copied, setCopied] = useState(false);\n\n  const { data: content } = useQuery<H5pContent>({\n    queryKey: [\"/api/content\", contentId],\n  });\n\n  const breadcrumbs = useBreadcrumbs(contentId);\n\n  const shareMutation = useMutation({\n    mutationFn: async () => {\n      return await apiRequest(\"POST\", `/api/content/${contentId}/share`, {});\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/content\", contentId] });\n      toast({ title: \"Share link created!\", description: \"Content is now publicly accessible.\" });\n    },\n  });\n\n  const shareUrl = content?.isPublished\n    ? `${window.location.origin}/public/${contentId}`\n    : null;\n\n  const handleCopy = async () => {\n    if (shareUrl) {\n      await navigator.clipboard.writeText(shareUrl);\n      setCopied(true);\n      toast({ title: \"Copied!\", description: \"Share link copied to clipboard.\" });\n      setTimeout(() => setCopied(false), 2000);\n    }\n  };\n\n  const handleCreateShare = async () => {\n    await shareMutation.mutateAsync();\n  };\n\n  if (!content) {\n    return null;\n  }\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      {/* Header */}\n      <div className=\"border-b bg-card\">\n        <div className=\"max-w-7xl mx-auto px-6 h-16 flex items-center gap-4\">\n          <Button variant=\"ghost\" size=\"icon\" onClick={() => navigate(\"/\")} data-testid=\"button-back\">\n            <ArrowLeft className=\"h-5 w-5\" />\n          </Button>\n          <div>\n            <h1 className=\"text-xl font-bold text-foreground\">Share Content</h1>\n          </div>\n        </div>\n      </div>\n\n      {/* Breadcrumbs */}\n      <div className=\"bg-background border-b\">\n        <div className=\"max-w-7xl mx-auto px-6 py-3\">\n          <Breadcrumbs items={breadcrumbs} />\n        </div>\n      </div>\n\n      {/* Main Content */}\n      <main className=\"max-w-3xl mx-auto px-6 py-12\">\n        <Card>\n          <CardHeader>\n            <div className=\"flex items-center gap-3 mb-2\">\n              <div className=\"h-12 w-12 bg-primary/10 rounded-lg flex items-center justify-center\">\n                <Share2 className=\"h-6 w-6 text-primary\" />\n              </div>\n              <div>\n                <CardTitle>{content.title}</CardTitle>\n                <CardDescription>Share this content with others</CardDescription>\n              </div>\n            </div>\n          </CardHeader>\n          <CardContent className=\"space-y-6\">\n            {!content.isPublished ? (\n              <div className=\"bg-muted/50 rounded-lg p-6 text-center space-y-4\">\n                <Globe className=\"h-12 w-12 text-muted-foreground mx-auto\" />\n                <div>\n                  <h3 className=\"font-semibold text-foreground mb-2\">Content is not published</h3>\n                  <p className=\"text-sm text-muted-foreground mb-4\">\n                    Publish your content to make it publicly accessible via a shareable link.\n                  </p>\n                  <Button onClick={handleCreateShare} disabled={shareMutation.isPending} data-testid=\"button-publish-share\">\n                    {shareMutation.isPending ? \"Publishing...\" : \"Publish & Create Share Link\"}\n                  </Button>\n                </div>\n              </div>\n            ) : (\n              <div className=\"space-y-4\">\n                <div>\n                  <h3 className=\"font-semibold text-foreground mb-3\">Public Share Link</h3>\n                  <p className=\"text-sm text-muted-foreground mb-4\">\n                    Anyone with this link can view your content. No account required.\n                  </p>\n                  <div className=\"flex gap-2\">\n                    <Input value={shareUrl || \"\"} readOnly className=\"font-mono text-sm\" data-testid=\"input-share-url\" />\n                    <Button onClick={handleCopy} variant=\"outline\" data-testid=\"button-copy-link\">\n                      {copied ? (\n                        <>\n                          <Check className=\"h-4 w-4 mr-2\" />\n                          Copied\n                        </>\n                      ) : (\n                        <>\n                          <Copy className=\"h-4 w-4 mr-2\" />\n                          Copy\n                        </>\n                      )}\n                    </Button>\n                  </div>\n                </div>\n\n                <div className=\"pt-4 border-t\">\n                  <h3 className=\"font-semibold text-foreground mb-3\">Quick Actions</h3>\n                  <div className=\"flex gap-2\">\n                    <Button variant=\"outline\" size=\"sm\" asChild data-testid=\"button-preview\">\n                      <a href={shareUrl || \"#\"} target=\"_blank\" rel=\"noopener noreferrer\">\n                        Preview in New Tab\n                      </a>\n                    </Button>\n                  </div>\n                </div>\n\n                <div className=\"bg-muted/30 rounded-lg p-4\">\n                  <p className=\"text-xs text-muted-foreground\">\n                    <strong>Note:</strong> To make this content private again, unpublish it from the editor page.\n                  </p>\n                </div>\n              </div>\n            )}\n          </CardContent>\n        </Card>\n      </main>\n    </div>\n  );\n}\n","size_bytes":6056},"client/src/components/ui/form.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport {\n  Controller,\n  FormProvider,\n  useFormContext,\n  type ControllerProps,\n  type FieldPath,\n  type FieldValues,\n} from \"react-hook-form\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Label } from \"@/components/ui/label\"\n\nconst Form = FormProvider\n\ntype FormFieldContextValue<\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n> = {\n  name: TName\n}\n\nconst FormFieldContext = React.createContext<FormFieldContextValue>(\n  {} as FormFieldContextValue\n)\n\nconst FormField = <\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n>({\n  ...props\n}: ControllerProps<TFieldValues, TName>) => {\n  return (\n    <FormFieldContext.Provider value={{ name: props.name }}>\n      <Controller {...props} />\n    </FormFieldContext.Provider>\n  )\n}\n\nconst useFormField = () => {\n  const fieldContext = React.useContext(FormFieldContext)\n  const itemContext = React.useContext(FormItemContext)\n  const { getFieldState, formState } = useFormContext()\n\n  const fieldState = getFieldState(fieldContext.name, formState)\n\n  if (!fieldContext) {\n    throw new Error(\"useFormField should be used within <FormField>\")\n  }\n\n  const { id } = itemContext\n\n  return {\n    id,\n    name: fieldContext.name,\n    formItemId: `${id}-form-item`,\n    formDescriptionId: `${id}-form-item-description`,\n    formMessageId: `${id}-form-item-message`,\n    ...fieldState,\n  }\n}\n\ntype FormItemContextValue = {\n  id: string\n}\n\nconst FormItemContext = React.createContext<FormItemContextValue>(\n  {} as FormItemContextValue\n)\n\nconst FormItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const id = React.useId()\n\n  return (\n    <FormItemContext.Provider value={{ id }}>\n      <div ref={ref} className={cn(\"space-y-2\", className)} {...props} />\n    </FormItemContext.Provider>\n  )\n})\nFormItem.displayName = \"FormItem\"\n\nconst FormLabel = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  const { error, formItemId } = useFormField()\n\n  return (\n    <Label\n      ref={ref}\n      className={cn(error && \"text-destructive\", className)}\n      htmlFor={formItemId}\n      {...props}\n    />\n  )\n})\nFormLabel.displayName = \"FormLabel\"\n\nconst FormControl = React.forwardRef<\n  React.ElementRef<typeof Slot>,\n  React.ComponentPropsWithoutRef<typeof Slot>\n>(({ ...props }, ref) => {\n  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()\n\n  return (\n    <Slot\n      ref={ref}\n      id={formItemId}\n      aria-describedby={\n        !error\n          ? `${formDescriptionId}`\n          : `${formDescriptionId} ${formMessageId}`\n      }\n      aria-invalid={!!error}\n      {...props}\n    />\n  )\n})\nFormControl.displayName = \"FormControl\"\n\nconst FormDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => {\n  const { formDescriptionId } = useFormField()\n\n  return (\n    <p\n      ref={ref}\n      id={formDescriptionId}\n      className={cn(\"text-sm text-muted-foreground\", className)}\n      {...props}\n    />\n  )\n})\nFormDescription.displayName = \"FormDescription\"\n\nconst FormMessage = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, children, ...props }, ref) => {\n  const { error, formMessageId } = useFormField()\n  const body = error ? String(error?.message ?? \"\") : children\n\n  if (!body) {\n    return null\n  }\n\n  return (\n    <p\n      ref={ref}\n      id={formMessageId}\n      className={cn(\"text-sm font-medium text-destructive\", className)}\n      {...props}\n    >\n      {body}\n    </p>\n  )\n})\nFormMessage.displayName = \"FormMessage\"\n\nexport {\n  useFormField,\n  Form,\n  FormItem,\n  FormLabel,\n  FormControl,\n  FormDescription,\n  FormMessage,\n  FormField,\n}\n","size_bytes":4120},"client/src/pages/Dashboard.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardDescription, CardFooter, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Avatar, AvatarFallback } from \"@/components/ui/avatar\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Input } from \"@/components/ui/input\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { AlertDialog, AlertDialogAction, AlertDialogCancel, AlertDialogContent, AlertDialogDescription, AlertDialogFooter, AlertDialogHeader, AlertDialogTitle } from \"@/components/ui/alert-dialog\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { ThemeToggle } from \"@/components/ThemeToggle\";\nimport { \n  FileQuestion, \n  Layers, \n  Video, \n  Image as ImageIcon, \n  Move,\n  PenTool,\n  Brain,\n  BookOpenCheck,\n  Plus, \n  Edit, \n  Play, \n  Share2, \n  Trash2,\n  LogOut,\n  Grid3x3,\n  List,\n  BookOpen,\n  Search,\n  Filter,\n  X,\n  HelpCircle,\n  BarChart3,\n  Presentation,\n  Users\n} from \"lucide-react\";\nimport { useLocation } from \"wouter\";\nimport type { H5pContent, ContentType } from \"@shared/schema\";\nimport { format } from \"date-fns\";\n\nconst contentTypeConfig: Record<ContentType, { icon: typeof FileQuestion; label: string; pluralLabel: string; color: string }> = {\n  quiz: { icon: FileQuestion, label: \"Quiz\", pluralLabel: \"Quizzes\", color: \"bg-blue-100 text-blue-700 dark:bg-blue-900 dark:text-blue-300\" },\n  flashcard: { icon: Layers, label: \"Flashcard\", pluralLabel: \"Flashcards\", color: \"bg-purple-100 text-purple-700 dark:bg-purple-900 dark:text-purple-300\" },\n  \"interactive-video\": { icon: Video, label: \"Interactive Video\", pluralLabel: \"Interactive Videos\", color: \"bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-300\" },\n  \"image-hotspot\": { icon: ImageIcon, label: \"Image Hotspot\", pluralLabel: \"Image Hotspots\", color: \"bg-orange-100 text-orange-700 dark:bg-orange-900 dark:text-orange-300\" },\n  \"drag-drop\": { icon: Move, label: \"Drag & Drop\", pluralLabel: \"Drag & Drop\", color: \"bg-pink-100 text-pink-700 dark:bg-pink-900 dark:text-pink-300\" },\n  \"fill-blanks\": { icon: PenTool, label: \"Fill in the Blanks\", pluralLabel: \"Fill in the Blanks\", color: \"bg-cyan-100 text-cyan-700 dark:bg-cyan-900 dark:text-cyan-300\" },\n  \"memory-game\": { icon: Brain, label: \"Memory Game\", pluralLabel: \"Memory Games\", color: \"bg-yellow-100 text-yellow-700 dark:bg-yellow-900 dark:text-yellow-300\" },\n  \"interactive-book\": { icon: BookOpenCheck, label: \"Interactive Book\", pluralLabel: \"Interactive Books\", color: \"bg-indigo-100 text-indigo-700 dark:bg-indigo-900 dark:text-indigo-300\" },\n  \"video-finder\": { icon: Search, label: \"Video Finder\", pluralLabel: \"Video Finders\", color: \"bg-emerald-100 text-emerald-700 dark:bg-emerald-900 dark:text-emerald-300\" },\n  \"google-slides\": { icon: Presentation, label: \"Google Slides\", pluralLabel: \"Google Slides\", color: \"bg-sky-100 text-sky-700 dark:bg-sky-900 dark:text-sky-300\" },\n};\n\nexport default function Dashboard() {\n  const { user, logout } = useAuth();\n  const { toast } = useToast();\n  const [_, navigate] = useLocation();\n  const [viewMode, setViewMode] = useState<\"grid\" | \"list\">(\"grid\");\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [typeFilter, setTypeFilter] = useState<string>(\"all\");\n  const [tagFilter, setTagFilter] = useState(\"\");\n  const [startDate, setStartDate] = useState(\"\");\n  const [endDate, setEndDate] = useState(\"\");\n  const [showFilters, setShowFilters] = useState(false);\n  const [deleteDialogOpen, setDeleteDialogOpen] = useState(false);\n  const [contentToDelete, setContentToDelete] = useState<{ id: string; title: string } | null>(null);\n\n  // Build query key with filters\n  const filters: Record<string, string> = {};\n  if (searchQuery) filters.search = searchQuery;\n  if (typeFilter !== \"all\") filters.type = typeFilter;\n  if (tagFilter) filters.tags = tagFilter;\n  if (startDate) filters.startDate = startDate;\n  if (endDate) filters.endDate = endDate;\n\n  const hasFilters = Object.keys(filters).length > 0;\n\n  const { data: contents, isLoading } = useQuery<H5pContent[]>({\n    queryKey: hasFilters ? [\"/api/content\", filters] : [\"/api/content\"],\n  });\n\n  const clearFilters = () => {\n    setSearchQuery(\"\");\n    setTypeFilter(\"all\");\n    setTagFilter(\"\");\n    setStartDate(\"\");\n    setEndDate(\"\");\n  };\n\n  const hasActiveFilters = searchQuery || typeFilter !== \"all\" || tagFilter || startDate || endDate;\n\n  const getInitials = (name?: string) => {\n    if (!name) return \"??\";\n    return name\n      .split(\" \")\n      .map((n) => n[0])\n      .join(\"\")\n      .toUpperCase()\n      .slice(0, 2);\n  };\n\n  const handleCreate = (type: ContentType) => {\n    navigate(`/create/${type}`);\n  };\n\n  const handleEdit = (id: string, type: ContentType) => {\n    navigate(`/create/${type}/${id}`);\n  };\n\n  const handlePlay = (id: string) => {\n    navigate(`/preview/${id}`);\n  };\n\n  const handleShare = (id: string) => {\n    navigate(`/share/${id}`);\n  };\n\n  const handleLogout = async () => {\n    await logout();\n  };\n\n  const deleteMutation = useMutation({\n    mutationFn: async (contentId: string) => {\n      await apiRequest(\"DELETE\", `/api/content/${contentId}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ \n        predicate: (query) => {\n          const queryKey = query.queryKey;\n          return Array.isArray(queryKey) && queryKey[0] === \"/api/content\";\n        }\n      });\n      toast({\n        title: \"Content deleted\",\n        description: \"Your content has been permanently deleted.\",\n      });\n      setDeleteDialogOpen(false);\n      setContentToDelete(null);\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Delete failed\",\n        description: error.message || \"Failed to delete content. Please try again.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleDeleteClick = (id: string, title: string) => {\n    setContentToDelete({ id, title });\n    setDeleteDialogOpen(true);\n  };\n\n  const handleDeleteConfirm = () => {\n    if (contentToDelete) {\n      deleteMutation.mutate(contentToDelete.id);\n    }\n  };\n\n  const groupedContents = contents?.reduce((acc, content) => {\n    const type = content.type as ContentType;\n    if (!acc[type]) {\n      acc[type] = [];\n    }\n    acc[type].push(content);\n    return acc;\n  }, {} as Record<ContentType, H5pContent[]>);\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      {/* Skip to main content for keyboard navigation */}\n      <a href=\"#main-content\" className=\"skip-to-content\">\n        Skip to main content\n      </a>\n      \n      {/* Header */}\n      <header className=\"border-b bg-card\" role=\"banner\">\n        <div className=\"max-w-7xl mx-auto px-6 h-16 flex items-center justify-between\">\n          <div className=\"flex items-center gap-3\">\n            <img \n              src=\"/favicon.png\" \n              alt=\"OECS Content Creator Logo\" \n              className=\"h-10 w-10 rounded-lg\"\n            />\n            <div>\n              <h1 className=\"text-xl font-bold text-foreground\">OECS Content Creator</h1>\n            </div>\n          </div>\n          <div className=\"flex items-center gap-4\">\n            <Button\n              variant=\"ghost\"\n              size=\"icon\"\n              onClick={() => navigate(\"/shared-resources\")}\n              data-testid=\"button-shared-resources\"\n              aria-label=\"Browse shared resources\"\n            >\n              <Users className=\"h-5 w-5\" />\n            </Button>\n            <Button\n              variant=\"ghost\"\n              size=\"icon\"\n              onClick={() => navigate(\"/analytics\")}\n              data-testid=\"button-analytics\"\n              aria-label=\"View analytics dashboard\"\n            >\n              <BarChart3 className=\"h-5 w-5\" />\n            </Button>\n            <Button\n              variant=\"ghost\"\n              size=\"icon\"\n              onClick={() => navigate(\"/help\")}\n              data-testid=\"button-help\"\n              aria-label=\"Open help documentation\"\n            >\n              <HelpCircle className=\"h-5 w-5\" />\n            </Button>\n            <ThemeToggle />\n            <div className=\"flex items-center gap-3\">\n              <Avatar className=\"h-10 w-10\">\n                <AvatarFallback className=\"bg-primary text-primary-foreground\">\n                  {user ? getInitials(user.fullName) : \"U\"}\n                </AvatarFallback>\n              </Avatar>\n              <div className=\"hidden md:block\">\n                <p className=\"text-sm font-medium text-foreground\">{user?.fullName}</p>\n                <p className=\"text-xs text-muted-foreground\">{user?.role}</p>\n              </div>\n            </div>\n            <Button \n              variant=\"ghost\" \n              size=\"icon\" \n              onClick={handleLogout} \n              data-testid=\"button-logout\"\n              aria-label=\"Log out\"\n            >\n              <LogOut className=\"h-5 w-5\" />\n            </Button>\n          </div>\n        </div>\n      </header>\n\n      {/* Main Content */}\n      <main id=\"main-content\" className=\"max-w-7xl mx-auto px-6 py-8\" role=\"main\">\n        {/* Welcome Section */}\n        <div className=\"mb-8\">\n          <h2 className=\"text-3xl font-bold text-foreground mb-2\">\n            Welcome back, {user?.fullName?.split(\" \")[0]}!\n          </h2>\n          <p className=\"text-muted-foreground\">\n            Create and manage your interactive educational content\n          </p>\n        </div>\n\n        {/* Create Content Buttons */}\n        <div className=\"mb-8\">\n          <h3 className=\"text-lg font-semibold text-foreground mb-4\">Create New Content</h3>\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n            {Object.entries(contentTypeConfig).map(([type, config]) => {\n              const Icon = config.icon;\n              return (\n                <Card\n                  key={type}\n                  className=\"hover-elevate active-elevate-2 cursor-pointer transition-all\"\n                  onClick={() => handleCreate(type as ContentType)}\n                  data-testid={`button-create-${type}`}\n                >\n                  <CardHeader className=\"pb-3\">\n                    <div className={`h-12 w-12 rounded-lg ${config.color} flex items-center justify-center mb-3`}>\n                      <Icon className=\"h-6 w-6\" />\n                    </div>\n                    <CardTitle className=\"text-lg\">{config.label}</CardTitle>\n                  </CardHeader>\n                </Card>\n              );\n            })}\n          </div>\n        </div>\n\n        {/* Search and Filters */}\n        <div className=\"mb-6 space-y-4\">\n          <div className=\"flex gap-2\">\n            <div className=\"relative flex-1\">\n              <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-muted-foreground\" />\n              <Input\n                placeholder=\"Search by title or description...\"\n                value={searchQuery}\n                onChange={(e) => setSearchQuery(e.target.value)}\n                className=\"pl-10\"\n                data-testid=\"input-search\"\n              />\n            </div>\n            <Button\n              variant={showFilters ? \"secondary\" : \"outline\"}\n              onClick={() => setShowFilters(!showFilters)}\n              data-testid=\"button-toggle-filters\"\n            >\n              <Filter className=\"h-5 w-5 mr-2\" />\n              Filters\n            </Button>\n            {hasActiveFilters && (\n              <Button\n                variant=\"ghost\"\n                onClick={clearFilters}\n                data-testid=\"button-clear-filters\"\n              >\n                <X className=\"h-5 w-5 mr-2\" />\n                Clear\n              </Button>\n            )}\n          </div>\n\n          {showFilters && (\n            <Card>\n              <CardContent className=\"pt-6 space-y-4\">\n                <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n                  <div>\n                    <label className=\"text-sm font-medium text-foreground mb-2 block\">Content Type</label>\n                    <Select value={typeFilter} onValueChange={setTypeFilter}>\n                      <SelectTrigger data-testid=\"select-type-filter\">\n                        <SelectValue placeholder=\"All types\" />\n                      </SelectTrigger>\n                      <SelectContent>\n                        <SelectItem value=\"all\">All types</SelectItem>\n                        <SelectItem value=\"quiz\">Quiz</SelectItem>\n                        <SelectItem value=\"flashcard\">Flashcard</SelectItem>\n                        <SelectItem value=\"interactive-video\">Interactive Video</SelectItem>\n                        <SelectItem value=\"image-hotspot\">Image Hotspot</SelectItem>\n                      </SelectContent>\n                    </Select>\n                  </div>\n\n                  <div>\n                    <label className=\"text-sm font-medium text-foreground mb-2 block\">Tags</label>\n                    <Input\n                      placeholder=\"e.g., science, math\"\n                      value={tagFilter}\n                      onChange={(e) => setTagFilter(e.target.value)}\n                      data-testid=\"input-tag-filter\"\n                    />\n                    <p className=\"text-xs text-muted-foreground mt-1\">Comma-separated</p>\n                  </div>\n\n                  <div>\n                    <label className=\"text-sm font-medium text-foreground mb-2 block\">From Date</label>\n                    <Input\n                      type=\"date\"\n                      value={startDate}\n                      onChange={(e) => setStartDate(e.target.value)}\n                      data-testid=\"input-start-date\"\n                    />\n                  </div>\n\n                  <div>\n                    <label className=\"text-sm font-medium text-foreground mb-2 block\">To Date</label>\n                    <Input\n                      type=\"date\"\n                      value={endDate}\n                      onChange={(e) => setEndDate(e.target.value)}\n                      data-testid=\"input-end-date\"\n                    />\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          )}\n        </div>\n\n        {/* View Mode Toggle */}\n        <div className=\"flex items-center justify-between mb-4\">\n          <div>\n            <h3 className=\"text-lg font-semibold text-foreground\">My Content</h3>\n            {contents && (\n              <p className=\"text-sm text-muted-foreground\">\n                {contents.length} {contents.length === 1 ? \"item\" : \"items\"} found\n              </p>\n            )}\n          </div>\n          <div className=\"flex items-center gap-2\">\n            <Button\n              variant={viewMode === \"grid\" ? \"secondary\" : \"ghost\"}\n              size=\"icon\"\n              onClick={() => setViewMode(\"grid\")}\n              data-testid=\"button-view-grid\"\n            >\n              <Grid3x3 className=\"h-5 w-5\" />\n            </Button>\n            <Button\n              variant={viewMode === \"list\" ? \"secondary\" : \"ghost\"}\n              size=\"icon\"\n              onClick={() => setViewMode(\"list\")}\n              data-testid=\"button-view-list\"\n            >\n              <List className=\"h-5 w-5\" />\n            </Button>\n          </div>\n        </div>\n\n        {/* Content Library */}\n        {isLoading ? (\n          <div className={viewMode === \"grid\" ? \"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\" : \"space-y-4\"}>\n            {[1, 2, 3, 4, 5, 6].map((i) => (\n              <Card key={i}>\n                <CardHeader>\n                  <Skeleton className=\"h-12 w-12 rounded-lg mb-3\" />\n                  <Skeleton className=\"h-6 w-3/4\" />\n                  <Skeleton className=\"h-4 w-1/2\" />\n                </CardHeader>\n                <CardFooter>\n                  <Skeleton className=\"h-9 w-full\" />\n                </CardFooter>\n              </Card>\n            ))}\n          </div>\n        ) : !contents || contents.length === 0 ? (\n          <Card className=\"text-center py-12\">\n            <CardContent>\n              <div className=\"flex flex-col items-center\">\n                <div className=\"h-24 w-24 bg-muted rounded-full flex items-center justify-center mb-6\">\n                  <BookOpen className=\"h-12 w-12 text-muted-foreground\" />\n                </div>\n                <h3 className=\"text-xl font-semibold text-foreground mb-2\">No content yet</h3>\n                <p className=\"text-muted-foreground mb-6 max-w-md\">\n                  Get started by creating your first piece of interactive content. Choose from quizzes, flashcards,\n                  interactive videos, or image hotspots.\n                </p>\n                <Button onClick={() => handleCreate(\"quiz\")} data-testid=\"button-create-first\">\n                  <Plus className=\"h-5 w-5 mr-2\" />\n                  Create Your First Content\n                </Button>\n              </div>\n            </CardContent>\n          </Card>\n        ) : (\n          <div className=\"space-y-8\">\n            {Object.entries(contentTypeConfig).map(([type, config]) => {\n              const typeContents = groupedContents?.[type as ContentType] || [];\n              if (typeContents.length === 0) return null;\n\n              const Icon = config.icon;\n\n              return (\n                <div key={type}>\n                  <h4 className=\"text-lg font-medium text-foreground mb-4 flex items-center gap-2\">\n                    <Icon className=\"h-5 w-5\" />\n                    {config.pluralLabel}\n                    <Badge variant=\"secondary\">{typeContents.length}</Badge>\n                  </h4>\n                  <div className={viewMode === \"grid\" ? \"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\" : \"space-y-4\"}>\n                    {typeContents.map((content) => (\n                      <Card key={content.id} className=\"hover-elevate transition-all\" data-testid={`card-content-${content.id}`}>\n                        <CardHeader>\n                          <div className=\"flex items-start justify-between mb-2\">\n                            <div className={`h-12 w-12 rounded-lg ${config.color} flex items-center justify-center`}>\n                              <Icon className=\"h-6 w-6\" />\n                            </div>\n                            {content.isPublished && (\n                              <Badge variant=\"default\" className=\"bg-green-600 hover:bg-green-600\">Published</Badge>\n                            )}\n                          </div>\n                          <CardTitle className=\"text-xl\">{content.title}</CardTitle>\n                          {content.description && (\n                            <CardDescription className=\"line-clamp-2\">{content.description}</CardDescription>\n                          )}\n                        </CardHeader>\n                        <CardContent>\n                          <div className=\"flex items-center gap-2 text-xs text-muted-foreground\">\n                            <span>Updated {format(new Date(content.updatedAt), \"MMM d, yyyy\")}</span>\n                            {content.tags && content.tags.length > 0 && (\n                              <>\n                                <span>•</span>\n                                <div className=\"flex gap-1 flex-wrap\">\n                                  {content.tags.slice(0, 2).map((tag, i) => (\n                                    <Badge key={i} variant=\"outline\" className=\"text-xs\">\n                                      {tag}\n                                    </Badge>\n                                  ))}\n                                </div>\n                              </>\n                            )}\n                          </div>\n                        </CardContent>\n                        <CardFooter className=\"flex gap-2\">\n                          <Button\n                            variant=\"default\"\n                            size=\"sm\"\n                            className=\"flex-1\"\n                            onClick={() => handleEdit(content.id, content.type as ContentType)}\n                            data-testid={`button-edit-${content.id}`}\n                          >\n                            <Edit className=\"h-4 w-4 mr-1\" />\n                            Edit\n                          </Button>\n                          <Button\n                            variant=\"outline\"\n                            size=\"icon\"\n                            onClick={() => handlePlay(content.id)}\n                            data-testid={`button-play-${content.id}`}\n                            aria-label=\"Preview content\"\n                          >\n                            <Play className=\"h-4 w-4\" />\n                          </Button>\n                          <Button\n                            variant=\"outline\"\n                            size=\"icon\"\n                            onClick={() => handleShare(content.id)}\n                            data-testid={`button-share-${content.id}`}\n                            aria-label=\"Share content\"\n                          >\n                            <Share2 className=\"h-4 w-4\" />\n                          </Button>\n                          <Button\n                            variant=\"outline\"\n                            size=\"icon\"\n                            onClick={() => handleDeleteClick(content.id, content.title)}\n                            data-testid={`button-delete-${content.id}`}\n                            aria-label=\"Delete content\"\n                          >\n                            <Trash2 className=\"h-4 w-4\" />\n                          </Button>\n                        </CardFooter>\n                      </Card>\n                    ))}\n                  </div>\n                </div>\n              );\n            })}\n          </div>\n        )}\n      </main>\n\n      {/* Delete Confirmation Dialog */}\n      <AlertDialog open={deleteDialogOpen} onOpenChange={setDeleteDialogOpen}>\n        <AlertDialogContent data-testid=\"dialog-delete-confirmation\">\n          <AlertDialogHeader>\n            <AlertDialogTitle>Delete Content?</AlertDialogTitle>\n            <AlertDialogDescription>\n              Are you sure you want to delete \"{contentToDelete?.title}\"? This action cannot be undone and will permanently remove this content and all associated data.\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel data-testid=\"button-cancel-delete\" disabled={deleteMutation.isPending}>\n              Cancel\n            </AlertDialogCancel>\n            <AlertDialogAction\n              onClick={handleDeleteConfirm}\n              disabled={deleteMutation.isPending}\n              data-testid=\"button-confirm-delete\"\n              className=\"bg-destructive text-destructive-foreground hover:bg-destructive/90\"\n            >\n              {deleteMutation.isPending ? \"Deleting...\" : \"Delete\"}\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n    </div>\n  );\n}\n","size_bytes":23366},"client/src/components/ui/sheet.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SheetPrimitive from \"@radix-ui/react-dialog\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Sheet = SheetPrimitive.Root\n\nconst SheetTrigger = SheetPrimitive.Trigger\n\nconst SheetClose = SheetPrimitive.Close\n\nconst SheetPortal = SheetPrimitive.Portal\n\nconst SheetOverlay = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nSheetOverlay.displayName = SheetPrimitive.Overlay.displayName\n\nconst sheetVariants = cva(\n  \"fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500\",\n  {\n    variants: {\n      side: {\n        top: \"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top\",\n        bottom:\n          \"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom\",\n        left: \"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm\",\n        right:\n          \"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm\",\n      },\n    },\n    defaultVariants: {\n      side: \"right\",\n    },\n  }\n)\n\ninterface SheetContentProps\n  extends React.ComponentPropsWithoutRef<typeof SheetPrimitive.Content>,\n    VariantProps<typeof sheetVariants> {}\n\nconst SheetContent = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Content>,\n  SheetContentProps\n>(({ side = \"right\", className, children, ...props }, ref) => (\n  <SheetPortal>\n    <SheetOverlay />\n    <SheetPrimitive.Content\n      ref={ref}\n      className={cn(sheetVariants({ side }), className)}\n      {...props}\n    >\n      {children}\n      <SheetPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </SheetPrimitive.Close>\n    </SheetPrimitive.Content>\n  </SheetPortal>\n))\nSheetContent.displayName = SheetPrimitive.Content.displayName\n\nconst SheetHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetHeader.displayName = \"SheetHeader\"\n\nconst SheetFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetFooter.displayName = \"SheetFooter\"\n\nconst SheetTitle = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold text-foreground\", className)}\n    {...props}\n  />\n))\nSheetTitle.displayName = SheetPrimitive.Title.displayName\n\nconst SheetDescription = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nSheetDescription.displayName = SheetPrimitive.Description.displayName\n\nexport {\n  Sheet,\n  SheetPortal,\n  SheetOverlay,\n  SheetTrigger,\n  SheetClose,\n  SheetContent,\n  SheetHeader,\n  SheetFooter,\n  SheetTitle,\n  SheetDescription,\n}\n","size_bytes":4281},"client/src/lib/utils.ts":{"content":"import { clsx, type ClassValue } from \"clsx\"\nimport { twMerge } from \"tailwind-merge\"\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n","size_bytes":166},"client/src/components/ui/slider.tsx":{"content":"import * as React from \"react\"\nimport * as SliderPrimitive from \"@radix-ui/react-slider\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Slider = React.forwardRef<\n  React.ElementRef<typeof SliderPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SliderPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <SliderPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex w-full touch-none select-none items-center\",\n      className\n    )}\n    {...props}\n  >\n    <SliderPrimitive.Track className=\"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary\">\n      <SliderPrimitive.Range className=\"absolute h-full bg-primary\" />\n    </SliderPrimitive.Track>\n    <SliderPrimitive.Thumb className=\"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50\" />\n  </SliderPrimitive.Root>\n))\nSlider.displayName = SliderPrimitive.Root.displayName\n\nexport { Slider }\n","size_bytes":1077},"design_guidelines.md":{"content":"# Design Guidelines: OECS Content Creator\n\n**Tagline:** \"Create. Engage. Educate.\"\n\n## Brand Identity\n\n**Application Name:** OECS Content Creator\n**Mission:** Empowering educators across the Organization of Eastern Caribbean States to create engaging, interactive educational content.\n\n**Color Philosophy:** The color palette is inspired by the vibrant OECS logo, combining the energy of Caribbean education (lime green), the trust and stability of academic excellence (navy blue), and the warmth of learning engagement (amber gold).\n\n## Color Palette\n\n### Primary Colors (from OECS Logo)\n\n**Lime Green (Primary Brand Color):**\n- Light mode: `#9DD84E` - Vibrant, energetic, representing growth and learning\n- Use for: Primary buttons, active states, brand elements, navigation highlights\n- Symbolizes: Innovation, growth, Caribbean vitality\n\n**Navy Blue (Authority Color):**\n- `#1B2A4E` - Professional, trustworthy, academic\n- Use for: Text, headers, secondary elements, professional accents\n- Symbolizes: Knowledge, trust, educational excellence\n\n**Amber Gold (Accent Color):**\n- `#FFB74D` - Warm, engaging, approachable\n- Use for: Highlights, success states, interactive elements, warmth\n- Symbolizes: Achievement, warmth, engagement\n\n### Supporting Colors\n\n**Neutral Backgrounds:**\n- Light mode background: `#FAFAFA` - Soft white for reduced eye strain\n- Dark mode background: `#0F1419` - Deep charcoal\n- Card backgrounds: Slightly elevated from base background\n\n**Text Hierarchy:**\n- Primary text: Navy blue in light mode, off-white in dark mode\n- Secondary text: Muted variants for supporting information\n- Tertiary text: Further muted for labels and metadata\n\n**Semantic Colors:**\n- Success: Derived from lime green\n- Warning: Amber gold variants\n- Error: Coral red `#EF4444`\n- Info: Sky blue `#3B82F6`\n\n## Design Approach\n\n**Selected System:** Material Design 3 with Caribbean-inspired vibrant accents, maintaining the productivity focus of tools like Notion while incorporating the energetic OECS brand colors.\n\n**Rationale:** Educational content creation requires clear hierarchy and robust components, enhanced with the vibrant, welcoming OECS brand identity to create an engaging yet professional environment.\n\n## Typography System\n\n**Font Family:** \n- Primary: Inter (via Google Fonts CDN) for UI elements and body text\n- Monospace: JetBrains Mono for code snippets or technical content\n\n**Hierarchy:**\n- Page Titles: text-3xl font-bold (48px) in navy blue\n- Section Headers: text-2xl font-semibold (32px)\n- Card/Component Titles: text-xl font-semibold (24px)\n- Subheadings: text-lg font-medium (20px)\n- Body Text: text-base (16px)\n- Helper Text/Labels: text-sm text-gray-600 (14px)\n- Micro-copy: text-xs (12px)\n\n## Layout System\n\n**Spacing Primitives:** Use Tailwind units of 2, 4, 6, 8, 12, 16, 20 for consistent rhythm\n- Component padding: p-6 or p-8\n- Section spacing: space-y-8 or space-y-12\n- Card gaps: gap-6\n- Form field spacing: space-y-4\n\n**Grid System:**\n- Dashboard content library: grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\n- Creator layouts: Two-column split (8-4 or 7-5 ratio) for editor + preview\n- Form layouts: Single column max-w-2xl for focused input\n\n**Container Widths:**\n- Full app wrapper: max-w-7xl mx-auto px-6\n- Content creators: Full-width with internal constraints\n- Forms and modals: max-w-2xl\n\n## Component Library\n\n### Navigation & App Shell\n\n**Top Navigation Bar:**\n- Full-width with max-w-7xl container\n- Height: h-16\n- OECS logo/brand (left) with lime green accent, user profile menu (right)\n- Subtle bottom border in navy blue tint\n\n**Sidebar (for Dashboard):**\n- Fixed width: w-64 on desktop, collapsible drawer on mobile\n- Content type filters with icons in lime green when active\n- Navy blue accents for professional feel\n\n### Dashboard Components\n\n**Content Cards:**\n- Elevated containers with rounded-xl borders\n- Header area with type icon (h-12 w-12 rounded-lg with lime green background), title, status badge\n- Status badge uses lime green for published, amber for draft\n- Metadata row: Last modified, completion percentage\n- Action buttons row at bottom (Edit, Preview, Share, Delete)\n- Hover state: subtle lime green glow\n\n**Empty State:**\n- Centered layout with large icon (h-24 w-24) in lime green\n- Heading in navy blue + description + prominent lime green CTA button\n- Welcoming, Caribbean-inspired messaging\n\n### Content Creator Components\n\n**Toolbar:**\n- Sticky top position (sticky top-0 z-10)\n- Height: h-14\n- Contains: Back button, auto-save indicator (amber when saving), publish toggle (lime green when on), AI generate button (lime green accent), settings icon\n- Background with backdrop blur and navy blue text\n\n**Editor Panels:**\n- Left panel (w-2/3): Main editing area with form inputs\n- Right panel (w-1/3): Live preview or settings\n- Resizable divider with navy blue accent\n\n**Question/Card Items:**\n- Each item in bordered container with rounded-lg\n- Drag handle icon in muted navy, content (center), action buttons (right)\n- Active state uses lime green accent\n- Spacing: space-y-4 between items\n\n**Form Inputs:**\n- Labels above inputs (text-sm font-medium in navy)\n- Inputs with rounded-lg borders, focus ring in lime green\n- Helper text below (text-xs text-gray-500)\n- Consistent height: h-10 for single-line, h-24 for textareas\n\n### Modals & Overlays\n\n**AI Generation Modal:**\n- Centered overlay (max-w-2xl)\n- Header with title in navy + close button (h-16)\n- Content area with form fields (space-y-6 p-6)\n- Footer with cancel (outlined) + generate button (lime green solid) (h-16)\n\n**Share Modal:**\n- Similar structure to AI modal (max-w-lg)\n- Shareable link with lime green copy button\n- Share options as icon buttons in row\n\n### Buttons & Actions\n\n**Primary CTA:** Lime green background, rounded-lg, px-6 py-3, font-medium, white text\n**Secondary:** Navy blue outlined variant with same sizing\n**Tertiary/Ghost:** Text only with hover background in lime green tint\n**Icon Buttons:** Square (h-10 w-10), rounded-lg, centered icon, lime green on hover\n\n### Content Players\n\n**Quiz Player:**\n- Question card centered (max-w-2xl)\n- Options as selectable cards (lime green border when selected)\n- Navigation: Previous/Next at bottom\n- Progress indicator at top (lime green progress bar, thin h-1)\n\n**Flashcard Player:**\n- Card centered (aspect-ratio-[3/2], max-w-xl)\n- Flip animation on click with lime green accent on active side\n- Card counter below in navy (e.g., \"5 / 20\")\n- Shuffle and restart controls with lime green icons\n\n**Interactive Video:**\n- YouTube embed full-width in container\n- Hotspot overlays with lime green pulsing indicators\n- Timeline scrubber below video with lime green hotspot markers\n\n**Image Hotspot:**\n- Image container with relative positioning\n- Clickable hotspot dots (lime green circles with pulse animation)\n- Tooltip/popup on click with navy blue headers and descriptions\n\n### Status & Feedback\n\n**Loading States:** Skeleton screens with lime green pulse animation\n**Toasts:** Top-right corner, rounded-xl, auto-dismiss, max-w-sm\n  - Success: Lime green background\n  - Warning: Amber background\n  - Error: Coral red background\n**Error States:** Alert boxes with icon, rounded-lg, appropriate color treatment\n**Success States:** Lime green checkmark icon with confirmation message\n\n## Animations\n\nUse sparingly and purposefully:\n- Page transitions: Fade (200ms)\n- Modal enter/exit: Scale + fade (150ms)\n- Drag and drop: Visual lift with lime green shadow\n- Card hovers: Subtle lime green glow (100ms)\n- Button interactions: Lime green ripple effect\n**NO:** Scroll-triggered animations, decorative motion, auto-playing effects\n\n## Images\n\n**Dashboard Empty State:**\n- Illustration of content creation tools (quiz, flashcards, video) in Caribbean-inspired style with lime green and amber accents\n- Placement: Center of empty content grid\n- Size: max-w-md\n\n**OECS Logo:**\n- Use official OECS logo in navigation header\n- Always maintain proper spacing and sizing\n- Logo should be prominently displayed with lime green accent\n\n**Content Type Icons:**\n- Use Lucide icons consistently with lime green coloring: FileQuestion (quiz), Layers (flashcard), Video (video), Image (image hotspot)\n- Size: h-5 w-5 in cards, h-6 w-6 in headers\n\n## Responsive Behavior\n\n- Mobile (< 768px): Single column, collapsible navigation with lime green active states, stacked creator panels\n- Tablet (768-1024px): Two columns for dashboard, maintain split for creators\n- Desktop (1024px+): Full three-column dashboard grid, side-by-side creator layout\n\n## Accessibility Notes\n\n- All interactive elements keyboard navigable\n- Focus indicators with 2px lime green ring\n- ARIA labels for icon-only buttons\n- Color contrast minimum WCAG AA (lime green text only on dark backgrounds)\n- Form validation messages with icons + text\n- Never use lime green for body text on white backgrounds (contrast issue)\n\n## Brand Voice\n\n- Professional yet approachable\n- Caribbean warmth combined with educational excellence\n- Empowering and inclusive\n- Innovation-focused\n\nThis design system creates a vibrant, professional educational content creation environment that reflects the OECS mission of excellence in Caribbean education while maintaining usability and accessibility standards.\n","size_bytes":9262},"client/src/components/ui/accordion.tsx":{"content":"import * as React from \"react\"\nimport * as AccordionPrimitive from \"@radix-ui/react-accordion\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Accordion = AccordionPrimitive.Root\n\nconst AccordionItem = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <AccordionPrimitive.Item\n    ref={ref}\n    className={cn(\"border-b\", className)}\n    {...props}\n  />\n))\nAccordionItem.displayName = \"AccordionItem\"\n\nconst AccordionTrigger = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Header className=\"flex\">\n    <AccordionPrimitive.Trigger\n      ref={ref}\n      className={cn(\n        \"flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <ChevronDown className=\"h-4 w-4 shrink-0 transition-transform duration-200\" />\n    </AccordionPrimitive.Trigger>\n  </AccordionPrimitive.Header>\n))\nAccordionTrigger.displayName = AccordionPrimitive.Trigger.displayName\n\nconst AccordionContent = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Content\n    ref={ref}\n    className=\"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down\"\n    {...props}\n  >\n    <div className={cn(\"pb-4 pt-0\", className)}>{children}</div>\n  </AccordionPrimitive.Content>\n))\n\nAccordionContent.displayName = AccordionPrimitive.Content.displayName\n\nexport { Accordion, AccordionItem, AccordionTrigger, AccordionContent }\n","size_bytes":1977},"client/src/components/ui/checkbox.tsx":{"content":"import * as React from \"react\"\nimport * as CheckboxPrimitive from \"@radix-ui/react-checkbox\"\nimport { Check } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Checkbox = React.forwardRef<\n  React.ElementRef<typeof CheckboxPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <CheckboxPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground\",\n      className\n    )}\n    {...props}\n  >\n    <CheckboxPrimitive.Indicator\n      className={cn(\"flex items-center justify-center text-current\")}\n    >\n      <Check className=\"h-4 w-4\" />\n    </CheckboxPrimitive.Indicator>\n  </CheckboxPrimitive.Root>\n))\nCheckbox.displayName = CheckboxPrimitive.Root.displayName\n\nexport { Checkbox }\n","size_bytes":1056},"client/src/hooks/use-toast.ts":{"content":"import * as React from \"react\"\n\nimport type {\n  ToastActionElement,\n  ToastProps,\n} from \"@/components/ui/toast\"\n\nconst TOAST_LIMIT = 1\nconst TOAST_REMOVE_DELAY = 1000000\n\ntype ToasterToast = ToastProps & {\n  id: string\n  title?: React.ReactNode\n  description?: React.ReactNode\n  action?: ToastActionElement\n}\n\nconst actionTypes = {\n  ADD_TOAST: \"ADD_TOAST\",\n  UPDATE_TOAST: \"UPDATE_TOAST\",\n  DISMISS_TOAST: \"DISMISS_TOAST\",\n  REMOVE_TOAST: \"REMOVE_TOAST\",\n} as const\n\nlet count = 0\n\nfunction genId() {\n  count = (count + 1) % Number.MAX_SAFE_INTEGER\n  return count.toString()\n}\n\ntype ActionType = typeof actionTypes\n\ntype Action =\n  | {\n      type: ActionType[\"ADD_TOAST\"]\n      toast: ToasterToast\n    }\n  | {\n      type: ActionType[\"UPDATE_TOAST\"]\n      toast: Partial<ToasterToast>\n    }\n  | {\n      type: ActionType[\"DISMISS_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n  | {\n      type: ActionType[\"REMOVE_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n\ninterface State {\n  toasts: ToasterToast[]\n}\n\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()\n\nconst addToRemoveQueue = (toastId: string) => {\n  if (toastTimeouts.has(toastId)) {\n    return\n  }\n\n  const timeout = setTimeout(() => {\n    toastTimeouts.delete(toastId)\n    dispatch({\n      type: \"REMOVE_TOAST\",\n      toastId: toastId,\n    })\n  }, TOAST_REMOVE_DELAY)\n\n  toastTimeouts.set(toastId, timeout)\n}\n\nexport const reducer = (state: State, action: Action): State => {\n  switch (action.type) {\n    case \"ADD_TOAST\":\n      return {\n        ...state,\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\n      }\n\n    case \"UPDATE_TOAST\":\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === action.toast.id ? { ...t, ...action.toast } : t\n        ),\n      }\n\n    case \"DISMISS_TOAST\": {\n      const { toastId } = action\n\n      // ! Side effects ! - This could be extracted into a dismissToast() action,\n      // but I'll keep it here for simplicity\n      if (toastId) {\n        addToRemoveQueue(toastId)\n      } else {\n        state.toasts.forEach((toast) => {\n          addToRemoveQueue(toast.id)\n        })\n      }\n\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === toastId || toastId === undefined\n            ? {\n                ...t,\n                open: false,\n              }\n            : t\n        ),\n      }\n    }\n    case \"REMOVE_TOAST\":\n      if (action.toastId === undefined) {\n        return {\n          ...state,\n          toasts: [],\n        }\n      }\n      return {\n        ...state,\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\n      }\n  }\n}\n\nconst listeners: Array<(state: State) => void> = []\n\nlet memoryState: State = { toasts: [] }\n\nfunction dispatch(action: Action) {\n  memoryState = reducer(memoryState, action)\n  listeners.forEach((listener) => {\n    listener(memoryState)\n  })\n}\n\ntype Toast = Omit<ToasterToast, \"id\">\n\nfunction toast({ ...props }: Toast) {\n  const id = genId()\n\n  const update = (props: ToasterToast) =>\n    dispatch({\n      type: \"UPDATE_TOAST\",\n      toast: { ...props, id },\n    })\n  const dismiss = () => dispatch({ type: \"DISMISS_TOAST\", toastId: id })\n\n  dispatch({\n    type: \"ADD_TOAST\",\n    toast: {\n      ...props,\n      id,\n      open: true,\n      onOpenChange: (open) => {\n        if (!open) dismiss()\n      },\n    },\n  })\n\n  return {\n    id: id,\n    dismiss,\n    update,\n  }\n}\n\nfunction useToast() {\n  const [state, setState] = React.useState<State>(memoryState)\n\n  React.useEffect(() => {\n    listeners.push(setState)\n    return () => {\n      const index = listeners.indexOf(setState)\n      if (index > -1) {\n        listeners.splice(index, 1)\n      }\n    }\n  }, [state])\n\n  return {\n    ...state,\n    toast,\n    dismiss: (toastId?: string) => dispatch({ type: \"DISMISS_TOAST\", toastId }),\n  }\n}\n\nexport { useToast, toast }\n","size_bytes":3895},"client/src/components/ui/popover.tsx":{"content":"import * as React from \"react\"\nimport * as PopoverPrimitive from \"@radix-ui/react-popover\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Popover = PopoverPrimitive.Root\n\nconst PopoverTrigger = PopoverPrimitive.Trigger\n\nconst PopoverContent = React.forwardRef<\n  React.ElementRef<typeof PopoverPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <PopoverPrimitive.Portal>\n    <PopoverPrimitive.Content\n      ref={ref}\n      align={align}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </PopoverPrimitive.Portal>\n))\nPopoverContent.displayName = PopoverPrimitive.Content.displayName\n\nexport { Popover, PopoverTrigger, PopoverContent }\n","size_bytes":1280},"client/src/components/AIGenerationModal.tsx":{"content":"import { useState } from \"react\";\nimport { Dialog, DialogContent, DialogDescription, DialogFooter, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { Sparkles, Loader2 } from \"lucide-react\";\nimport type { ContentType } from \"@shared/schema\";\n\ntype AIGenerationModalProps = {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  contentType: ContentType;\n  onGenerated: (data: any) => void;\n};\n\nexport function AIGenerationModal({ open, onOpenChange, contentType, onGenerated }: AIGenerationModalProps) {\n  const { toast } = useToast();\n  const [isGenerating, setIsGenerating] = useState(false);\n  const [formData, setFormData] = useState({\n    topic: \"\",\n    difficulty: \"intermediate\",\n    gradeLevel: \"\",\n    numberOfItems: 5,\n    language: \"English\",\n    additionalContext: \"\",\n  });\n\n  const contentTypeLabels: Record<ContentType, string> = {\n    quiz: \"quiz questions\",\n    flashcard: \"flashcard pairs\",\n    \"interactive-video\": \"video hotspots\",\n    \"image-hotspot\": \"image hotspots\",\n    \"drag-drop\": \"drag and drop items\",\n    \"fill-blanks\": \"fill in the blanks\",\n    \"memory-game\": \"memory cards\",\n    \"interactive-book\": \"book pages\",\n    \"video-finder\": \"video lessons\",\n    \"google-slides\": \"presentation slides\",\n  };\n\n  const handleGenerate = async () => {\n    if (!formData.topic.trim()) {\n      toast({\n        title: \"Topic required\",\n        description: \"Please enter a topic for content generation.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    setIsGenerating(true);\n    try {\n      const response = await apiRequest(\"POST\", \"/api/ai/generate\", {\n        contentType,\n        ...formData,\n      });\n\n      const data = await response.json();\n      onGenerated(data);\n      onOpenChange(false);\n      toast({\n        title: \"Content generated!\",\n        description: `Successfully generated ${formData.numberOfItems} ${contentTypeLabels[contentType]} using AI.`,\n      });\n      \n      // Reset form\n      setFormData({\n        topic: \"\",\n        difficulty: \"intermediate\",\n        gradeLevel: \"\",\n        numberOfItems: 5,\n        language: \"English\",\n        additionalContext: \"\",\n      });\n    } catch (error: any) {\n      toast({\n        title: \"Generation failed\",\n        description: error.message || \"Failed to generate content. Please try again.\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsGenerating(false);\n    }\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"max-w-2xl\" data-testid=\"modal-ai-generation\">\n        <DialogHeader>\n          <div className=\"flex items-center gap-2\">\n            <div className=\"h-10 w-10 bg-primary/10 rounded-lg flex items-center justify-center\">\n              <Sparkles className=\"h-6 w-6 text-primary\" />\n            </div>\n            <div>\n              <DialogTitle>AI Content Generation</DialogTitle>\n              <DialogDescription>\n                Generate {contentTypeLabels[contentType]} using AI\n              </DialogDescription>\n            </div>\n          </div>\n        </DialogHeader>\n\n        <div className=\"space-y-6 py-4\">\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"topic\">Topic *</Label>\n            <Input\n              id=\"topic\"\n              placeholder=\"e.g., Photosynthesis, World War II, Python Programming\"\n              value={formData.topic}\n              onChange={(e) => setFormData({ ...formData, topic: e.target.value })}\n              data-testid=\"input-ai-topic\"\n            />\n          </div>\n\n          <div className=\"grid grid-cols-2 gap-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"difficulty\">Difficulty Level</Label>\n              <Select\n                value={formData.difficulty}\n                onValueChange={(value) => setFormData({ ...formData, difficulty: value })}\n              >\n                <SelectTrigger id=\"difficulty\" data-testid=\"select-ai-difficulty\">\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"beginner\">Beginner</SelectItem>\n                  <SelectItem value=\"intermediate\">Intermediate</SelectItem>\n                  <SelectItem value=\"advanced\">Advanced</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"numberOfItems\">Number of Items</Label>\n              <Input\n                id=\"numberOfItems\"\n                type=\"number\"\n                min=\"1\"\n                max=\"20\"\n                value={formData.numberOfItems}\n                onChange={(e) => setFormData({ ...formData, numberOfItems: parseInt(e.target.value) || 5 })}\n                data-testid=\"input-ai-number\"\n              />\n            </div>\n          </div>\n\n          <div className=\"grid grid-cols-2 gap-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"gradeLevel\">Grade Level (Optional)</Label>\n              <Select value={formData.gradeLevel || undefined} onValueChange={(value) => setFormData({ ...formData, gradeLevel: value })}>\n                <SelectTrigger id=\"gradeLevel\" data-testid=\"select-ai-grade\">\n                  <SelectValue placeholder=\"Select grade level\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"Pre-K\">Pre-K</SelectItem>\n                  <SelectItem value=\"Kindergarten\">Kindergarten</SelectItem>\n                  <SelectItem value=\"K-2\">K-2 (Grades K-2)</SelectItem>\n                  <SelectItem value=\"3-5\">3-5 (Grades 3-5)</SelectItem>\n                  <SelectItem value=\"6-8\">6-8 (Grades 6-8)</SelectItem>\n                  <SelectItem value=\"9-12\">9-12 (Grades 9-12)</SelectItem>\n                  <SelectItem value=\"Higher Education\">Higher Education</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"language\">Language</Label>\n              <Input\n                id=\"language\"\n                value={formData.language}\n                onChange={(e) => setFormData({ ...formData, language: e.target.value })}\n                data-testid=\"input-ai-language\"\n              />\n            </div>\n          </div>\n\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"additionalContext\">Additional Context (Optional)</Label>\n            <Textarea\n              id=\"additionalContext\"\n              placeholder=\"Any specific requirements, focus areas, or additional instructions...\"\n              value={formData.additionalContext}\n              onChange={(e) => setFormData({ ...formData, additionalContext: e.target.value })}\n              className=\"h-24 resize-none\"\n              data-testid=\"textarea-ai-context\"\n            />\n          </div>\n        </div>\n\n        <DialogFooter>\n          <Button variant=\"outline\" onClick={() => onOpenChange(false)} disabled={isGenerating} data-testid=\"button-ai-cancel\">\n            Cancel\n          </Button>\n          <Button onClick={handleGenerate} disabled={isGenerating} data-testid=\"button-ai-generate\">\n            {isGenerating ? (\n              <>\n                <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\n                Generating...\n              </>\n            ) : (\n              <>\n                <Sparkles className=\"h-4 w-4 mr-2\" />\n                Generate\n              </>\n            )}\n          </Button>\n        </DialogFooter>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","size_bytes":7989},"client/src/components/ui/breadcrumb.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Breadcrumb = React.forwardRef<\n  HTMLElement,\n  React.ComponentPropsWithoutRef<\"nav\"> & {\n    separator?: React.ReactNode\n  }\n>(({ ...props }, ref) => <nav ref={ref} aria-label=\"breadcrumb\" {...props} />)\nBreadcrumb.displayName = \"Breadcrumb\"\n\nconst BreadcrumbList = React.forwardRef<\n  HTMLOListElement,\n  React.ComponentPropsWithoutRef<\"ol\">\n>(({ className, ...props }, ref) => (\n  <ol\n    ref={ref}\n    className={cn(\n      \"flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5\",\n      className\n    )}\n    {...props}\n  />\n))\nBreadcrumbList.displayName = \"BreadcrumbList\"\n\nconst BreadcrumbItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentPropsWithoutRef<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    className={cn(\"inline-flex items-center gap-1.5\", className)}\n    {...props}\n  />\n))\nBreadcrumbItem.displayName = \"BreadcrumbItem\"\n\nconst BreadcrumbLink = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentPropsWithoutRef<\"a\"> & {\n    asChild?: boolean\n  }\n>(({ asChild, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      className={cn(\"transition-colors hover:text-foreground\", className)}\n      {...props}\n    />\n  )\n})\nBreadcrumbLink.displayName = \"BreadcrumbLink\"\n\nconst BreadcrumbPage = React.forwardRef<\n  HTMLSpanElement,\n  React.ComponentPropsWithoutRef<\"span\">\n>(({ className, ...props }, ref) => (\n  <span\n    ref={ref}\n    role=\"link\"\n    aria-disabled=\"true\"\n    aria-current=\"page\"\n    className={cn(\"font-normal text-foreground\", className)}\n    {...props}\n  />\n))\nBreadcrumbPage.displayName = \"BreadcrumbPage\"\n\nconst BreadcrumbSeparator = ({\n  children,\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) => (\n  <li\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"[&>svg]:w-3.5 [&>svg]:h-3.5\", className)}\n    {...props}\n  >\n    {children ?? <ChevronRight />}\n  </li>\n)\nBreadcrumbSeparator.displayName = \"BreadcrumbSeparator\"\n\nconst BreadcrumbEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More</span>\n  </span>\n)\nBreadcrumbEllipsis.displayName = \"BreadcrumbElipssis\"\n\nexport {\n  Breadcrumb,\n  BreadcrumbList,\n  BreadcrumbItem,\n  BreadcrumbLink,\n  BreadcrumbPage,\n  BreadcrumbSeparator,\n  BreadcrumbEllipsis,\n}\n","size_bytes":2712},"client/src/components/ui/textarea.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Textarea = React.forwardRef<\n  HTMLTextAreaElement,\n  React.ComponentProps<\"textarea\">\n>(({ className, ...props }, ref) => {\n  return (\n    <textarea\n      className={cn(\n        \"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  )\n})\nTextarea.displayName = \"Textarea\"\n\nexport { Textarea }\n","size_bytes":689},"client/src/components/ui/collapsible.tsx":{"content":"\"use client\"\n\nimport * as CollapsiblePrimitive from \"@radix-ui/react-collapsible\"\n\nconst Collapsible = CollapsiblePrimitive.Root\n\nconst CollapsibleTrigger = CollapsiblePrimitive.CollapsibleTrigger\n\nconst CollapsibleContent = CollapsiblePrimitive.CollapsibleContent\n\nexport { Collapsible, CollapsibleTrigger, CollapsibleContent }\n","size_bytes":329},"client/src/pages/ImageHotspotCreator.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useParams, useLocation } from \"wouter\";\nimport { Breadcrumbs } from \"@/components/Breadcrumbs\";\nimport { useBreadcrumbs } from \"@/hooks/useBreadcrumbs\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { AIGenerationModal } from \"@/components/AIGenerationModal\";\nimport { \n  ArrowLeft, \n  Sparkles, \n  Plus, \n  Trash2,\n  Globe,\n  Image as ImageIcon\n} from \"lucide-react\";\nimport type { H5pContent, ImageHotspotData, ImageHotspot } from \"@shared/schema\";\nimport ShareToClassroomDialog from \"@/components/ShareToClassroomDialog\";\n\nexport default function ImageHotspotCreator() {\n  const params = useParams();\n  const [_, navigate] = useLocation();\n  const { toast } = useToast();\n  const contentId = params.id;\n  const breadcrumbs = useBreadcrumbs(contentId);\n  const isEditing = !!contentId;\n\n  const [title, setTitle] = useState(\"\");\n  const [description, setDescription] = useState(\"\");\n  const [imageUrl, setImageUrl] = useState(\"\");\n  const [hotspots, setHotspots] = useState<ImageHotspot[]>([]);\n  const [isPublished, setIsPublished] = useState(false);\n  const [isPublic, setIsPublic] = useState(false);\n  const [showAIModal, setShowAIModal] = useState(false);\n  const [isSaving, setIsSaving] = useState(false);\n\n  const { data: content } = useQuery<H5pContent>({\n    queryKey: [\"/api/content\", contentId],\n    enabled: isEditing,\n  });\n\n  useEffect(() => {\n    if (content && content.type === \"image-hotspot\") {\n      setTitle(content.title);\n      setDescription(content.description || \"\");\n      const imageData = content.data as ImageHotspotData;\n      setImageUrl(imageData.imageUrl || \"\");\n      setHotspots(imageData.hotspots || []);\n      setIsPublished(content.isPublished);\n      setIsPublic(content.isPublic || false);\n    }\n  }, [content]);\n\n  const saveMutation = useMutation({\n    mutationFn: async (publish: boolean = false) => {\n      const data: ImageHotspotData = { imageUrl, hotspots };\n      \n      if (isEditing) {\n        const response = await apiRequest(\"PUT\", `/api/content/${contentId}`, {\n          title,\n          description,\n          data,\n          isPublished: publish,\n          isPublic,\n        });\n        return await response.json();\n      } else {\n        const response = await apiRequest(\"POST\", \"/api/content\", {\n          title,\n          description,\n          type: \"image-hotspot\",\n          data,\n          isPublished: publish,\n          isPublic,\n        });\n        return await response.json();\n      }\n    },\n    onSuccess: (data) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/content\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/content/public\"] });\n      if (!isEditing) {\n        navigate(`/create/image-hotspot/${data.id}`);\n      }\n      toast({ title: \"Saved!\", description: \"Image hotspot saved successfully.\" });\n      setIsSaving(false);\n    },\n  });\n\n  useEffect(() => {\n    if (!title || !imageUrl) return;\n    \n    const timer = setTimeout(() => {\n      setIsSaving(true);\n      saveMutation.mutate(isPublished);\n    }, 2000);\n\n    return () => clearTimeout(timer);\n  }, [title, description, imageUrl, hotspots, isPublic]);\n\n  const addHotspot = () => {\n    const newHotspot: ImageHotspot = {\n      id: Date.now().toString(),\n      x: 50,\n      y: 50,\n      title: \"\",\n      description: \"\",\n    };\n    setHotspots([...hotspots, newHotspot]);\n  };\n\n  const updateHotspot = (index: number, updates: Partial<ImageHotspot>) => {\n    const updated = [...hotspots];\n    updated[index] = { ...updated[index], ...updates };\n    setHotspots(updated);\n  };\n\n  const removeHotspot = (index: number) => {\n    setHotspots(hotspots.filter((_, i) => i !== index));\n  };\n\n  const handleAIGenerated = (data: any) => {\n    if (data.hotspots) {\n      setHotspots(prev => [...prev, ...data.hotspots]);\n    }\n  };\n\n  const handlePublish = async () => {\n    setIsPublished(!isPublished);\n    await saveMutation.mutateAsync(!isPublished);\n    toast({\n      title: isPublished ? \"Unpublished\" : \"Published!\",\n      description: isPublished\n        ? \"Image hotspot is now private.\"\n        : \"Image hotspot is now publicly accessible via share link.\",\n    });\n  };\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      {/* Toolbar */}\n      <div className=\"sticky top-0 z-10 bg-card/95 backdrop-blur border-b\">\n        <div className=\"max-w-7xl mx-auto px-6 h-14 flex items-center justify-between\">\n          <div className=\"flex items-center gap-4\">\n            <Button variant=\"ghost\" size=\"icon\" onClick={() => navigate(\"/\")} data-testid=\"button-back\">\n              <ArrowLeft className=\"h-5 w-5\" />\n            </Button>\n            <div className=\"flex items-center gap-2\">\n              <h1 className=\"text-lg font-semibold\">Image Hotspot Creator</h1>\n              {isSaving && <Badge variant=\"outline\">Saving...</Badge>}\n            </div>\n          </div>\n\n      {/* Breadcrumbs */}\n      <div className=\"bg-background border-b\">\n        <div className=\"max-w-7xl mx-auto px-6 py-3\">\n          <Breadcrumbs items={breadcrumbs} />\n        </div>\n      </div>\n          <div className=\"flex items-center gap-2\">\n            <Button variant=\"outline\" size=\"sm\" onClick={() => setShowAIModal(true)} data-testid=\"button-ai-generate\">\n              <Sparkles className=\"h-4 w-4 mr-1\" />\n              AI Generate\n            </Button>\n            {contentId && isPublished && (\n              <ShareToClassroomDialog\n                contentTitle={title}\n                contentDescription={description}\n                materialLink={`${window.location.origin}/public/${contentId}`}\n              />\n            )}\n            <Button\n              variant={isPublished ? \"outline\" : \"default\"}\n              size=\"sm\"\n              onClick={handlePublish}\n              disabled={!title || !imageUrl}\n              data-testid=\"button-publish\"\n            >\n              <Globe className=\"h-4 w-4 mr-1\" />\n              {isPublished ? \"Unpublish\" : \"Publish\"}\n            </Button>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"max-w-7xl mx-auto px-6 py-8\">\n        <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-8\">\n          {/* Editor */}\n          <div className=\"space-y-6\">\n            {/* Title & Description */}\n            <Card>\n              <CardHeader>\n                <CardTitle>Image Details</CardTitle>\n              </CardHeader>\n              <CardContent className=\"space-y-4\">\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"title\">Title *</Label>\n                  <Input\n                    id=\"title\"\n                    placeholder=\"e.g., Parts of a Cell\"\n                    value={title}\n                    onChange={(e) => setTitle(e.target.value)}\n                    data-testid=\"input-title\"\n                  />\n                </div>\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"description\">Description (Optional)</Label>\n                  <Textarea\n                    id=\"description\"\n                    placeholder=\"Brief description of this image hotspot...\"\n                    value={description}\n                    onChange={(e) => setDescription(e.target.value)}\n                    className=\"h-20 resize-none\"\n                    data-testid=\"textarea-description\"\n                  />\n                </div>\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"imageUrl\">Image URL *</Label>\n                  <Input\n                    id=\"imageUrl\"\n                    placeholder=\"https://example.com/image.jpg\"\n                    value={imageUrl}\n                    onChange={(e) => setImageUrl(e.target.value)}\n                    data-testid=\"input-image-url\"\n                  />\n                  <p className=\"text-xs text-muted-foreground\">\n                    Paste an image URL to add interactive hotspots\n                  </p>\n                </div>\n                <div className=\"flex items-center justify-between p-4 bg-muted/50 rounded-lg\">\n                  <div className=\"space-y-0.5\">\n                    <Label htmlFor=\"isPublic\" className=\"text-base\">Share as Public Resource</Label>\n                    <p className=\"text-sm text-muted-foreground\">\n                      Allow other teachers to discover and use this image hotspot on the Shared Resources page. Content will be automatically published when shared.\n                    </p>\n                  </div>\n                  <Switch\n                    id=\"isPublic\"\n                    checked={isPublic}\n                    onCheckedChange={(checked) => {\n                      setIsPublic(checked);\n                      if (checked) {\n                        setIsPublished(true);\n                      }\n                    }}\n                    data-testid=\"switch-public\"\n                  />\n                </div>\n              </CardContent>\n            </Card>\n\n            {/* Hotspots List */}\n            <div className=\"space-y-4\">\n              <div className=\"flex items-center justify-between\">\n                <h3 className=\"text-lg font-semibold\">Hotspots ({hotspots.length})</h3>\n                <Button onClick={addHotspot} size=\"sm\" data-testid=\"button-add-hotspot\">\n                  <Plus className=\"h-4 w-4 mr-1\" />\n                  Add Hotspot\n                </Button>\n              </div>\n\n              {hotspots.length === 0 ? (\n                <Card className=\"text-center py-8\">\n                  <CardContent>\n                    <p className=\"text-muted-foreground mb-4\">\n                      No hotspots yet. Add interactive points to your image.\n                    </p>\n                    <Button onClick={addHotspot} size=\"sm\" data-testid=\"button-add-first-hotspot\">\n                      <Plus className=\"h-4 w-4 mr-2\" />\n                      Add Hotspot\n                    </Button>\n                  </CardContent>\n                </Card>\n              ) : (\n                hotspots.map((hotspot, index) => (\n                  <Card key={hotspot.id} data-testid={`hotspot-${index}`}>\n                    <CardContent className=\"pt-6 space-y-4\">\n                      <div className=\"flex items-start justify-between\">\n                        <h4 className=\"font-medium\">Hotspot {index + 1}</h4>\n                        <Button\n                          variant=\"destructive\"\n                          size=\"icon\"\n                          onClick={() => removeHotspot(index)}\n                          data-testid={`button-delete-${index}`}\n                        >\n                          <Trash2 className=\"h-4 w-4\" />\n                        </Button>\n                      </div>\n\n                      <div className=\"grid grid-cols-2 gap-4\">\n                        <div className=\"space-y-2\">\n                          <Label>X Position (%)</Label>\n                          <Input\n                            type=\"number\"\n                            min=\"0\"\n                            max=\"100\"\n                            value={hotspot.x}\n                            onChange={(e) => updateHotspot(index, { x: parseInt(e.target.value) || 0 })}\n                            data-testid={`input-x-${index}`}\n                          />\n                        </div>\n                        <div className=\"space-y-2\">\n                          <Label>Y Position (%)</Label>\n                          <Input\n                            type=\"number\"\n                            min=\"0\"\n                            max=\"100\"\n                            value={hotspot.y}\n                            onChange={(e) => updateHotspot(index, { y: parseInt(e.target.value) || 0 })}\n                            data-testid={`input-y-${index}`}\n                          />\n                        </div>\n                      </div>\n\n                      <div className=\"space-y-2\">\n                        <Label>Title</Label>\n                        <Input\n                          placeholder=\"Hotspot title...\"\n                          value={hotspot.title}\n                          onChange={(e) => updateHotspot(index, { title: e.target.value })}\n                          data-testid={`input-title-${index}`}\n                        />\n                      </div>\n\n                      <div className=\"space-y-2\">\n                        <Label>Description</Label>\n                        <Textarea\n                          placeholder=\"Hotspot description...\"\n                          value={hotspot.description}\n                          onChange={(e) => updateHotspot(index, { description: e.target.value })}\n                          className=\"h-20 resize-none\"\n                          data-testid={`textarea-description-${index}`}\n                        />\n                      </div>\n                    </CardContent>\n                  </Card>\n                ))\n              )}\n            </div>\n          </div>\n\n          {/* Preview */}\n          <div className=\"lg:sticky lg:top-20 h-fit\">\n            <Card>\n              <CardHeader>\n                <CardTitle>Preview</CardTitle>\n              </CardHeader>\n              <CardContent>\n                {imageUrl ? (\n                  <div className=\"relative bg-muted rounded-lg overflow-hidden\" style={{ aspectRatio: \"16/9\" }}>\n                    <img src={imageUrl} alt=\"Hotspot image\" className=\"w-full h-full object-contain\" />\n                    {hotspots.map((hotspot, index) => (\n                      <div\n                        key={hotspot.id}\n                        className=\"absolute w-6 h-6 bg-primary rounded-full border-2 border-primary-foreground cursor-pointer transform -translate-x-1/2 -translate-y-1/2 hover-elevate transition-all\"\n                        style={{\n                          left: `${hotspot.x}%`,\n                          top: `${hotspot.y}%`,\n                        }}\n                        title={hotspot.title}\n                      >\n                        <div className=\"absolute top-full left-1/2 transform -translate-x-1/2 mt-2 bg-card text-card-foreground px-2 py-1 rounded text-xs whitespace-nowrap opacity-0 hover:opacity-100 transition-opacity shadow-lg\">\n                          {hotspot.title || `Hotspot ${index + 1}`}\n                        </div>\n                      </div>\n                    ))}\n                  </div>\n                ) : (\n                  <div\n                    className=\"flex items-center justify-center bg-muted rounded-lg\"\n                    style={{ aspectRatio: \"16/9\" }}\n                  >\n                    <div className=\"text-center\">\n                      <ImageIcon className=\"h-12 w-12 text-muted-foreground mx-auto mb-2\" />\n                      <p className=\"text-sm text-muted-foreground\">Enter an image URL to see preview</p>\n                    </div>\n                  </div>\n                )}\n              </CardContent>\n            </Card>\n          </div>\n        </div>\n      </div>\n\n      <AIGenerationModal\n        open={showAIModal}\n        onOpenChange={setShowAIModal}\n        contentType=\"image-hotspot\"\n        onGenerated={handleAIGenerated}\n      />\n    </div>\n  );\n}\n","size_bytes":15736},"client/src/pages/InteractiveVideoCreator.tsx":{"content":"import { useState, useEffect, useRef } from \"react\";\nimport { useParams, useLocation } from \"wouter\";\nimport { Breadcrumbs } from \"@/components/Breadcrumbs\";\nimport { useBreadcrumbs } from \"@/hooks/useBreadcrumbs\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Collapsible, CollapsibleContent, CollapsibleTrigger } from \"@/components/ui/collapsible\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { youtubeLoader } from \"@/lib/youtube-loader\";\nimport { AIGenerationModal } from \"@/components/AIGenerationModal\";\nimport { \n  ArrowLeft, \n  Sparkles, \n  Plus, \n  Trash2,\n  Globe,\n  ChevronDown,\n  Play\n} from \"lucide-react\";\nimport type { H5pContent, InteractiveVideoData, VideoHotspot } from \"@shared/schema\";\nimport ShareToClassroomDialog from \"@/components/ShareToClassroomDialog\";\n\nexport default function InteractiveVideoCreator() {\n  const params = useParams();\n  const [_, navigate] = useLocation();\n  const { toast } = useToast();\n  const contentId = params.id;\n  const breadcrumbs = useBreadcrumbs(contentId);\n  const isEditing = !!contentId;\n\n  const [title, setTitle] = useState(\"\");\n  const [description, setDescription] = useState(\"\");\n  const [videoUrl, setVideoUrl] = useState(\"\");\n  const [hotspots, setHotspots] = useState<VideoHotspot[]>([]);\n  const [isPublished, setIsPublished] = useState(false);\n  const [isPublic, setIsPublic] = useState(false);\n  const [showAIModal, setShowAIModal] = useState(false);\n  const [isSaving, setIsSaving] = useState(false);\n  const [showPreview, setShowPreview] = useState(false);\n  const [videoDuration, setVideoDuration] = useState(0);\n  const previewPlayerRef = useRef<any>(null);\n  const previewContainerRef = useRef<HTMLDivElement>(null);\n\n  const { data: content } = useQuery<H5pContent>({\n    queryKey: [\"/api/content\", contentId],\n    enabled: isEditing,\n  });\n\n  useEffect(() => {\n    if (content && content.type === \"interactive-video\") {\n      setTitle(content.title);\n      setDescription(content.description || \"\");\n      const videoData = content.data as InteractiveVideoData;\n      setVideoUrl(videoData.videoUrl || \"\");\n      setHotspots(videoData.hotspots || []);\n      setIsPublished(content.isPublished);\n      setIsPublic(content.isPublic || false);\n    }\n  }, [content]);\n\n  const saveMutation = useMutation({\n    mutationFn: async (publish: boolean = false) => {\n      const data: InteractiveVideoData = { videoUrl, hotspots };\n      \n      if (isEditing) {\n        const response = await apiRequest(\"PUT\", `/api/content/${contentId}`, {\n          title,\n          description,\n          data,\n          isPublished: publish,\n          isPublic,\n        });\n        return await response.json();\n      } else {\n        const response = await apiRequest(\"POST\", \"/api/content\", {\n          title,\n          description,\n          type: \"interactive-video\",\n          data,\n          isPublished: publish,\n          isPublic,\n        });\n        return await response.json();\n      }\n    },\n    onSuccess: (data) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/content\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/content/public\"] });\n      if (!isEditing) {\n        navigate(`/create/interactive-video/${data.id}`);\n      }\n      toast({ title: \"Saved!\", description: \"Interactive video saved successfully.\" });\n      setIsSaving(false);\n    },\n  });\n\n  useEffect(() => {\n    if (!title || !videoUrl) return;\n    \n    const timer = setTimeout(() => {\n      setIsSaving(true);\n      saveMutation.mutate(isPublished);\n    }, 2000);\n\n    return () => clearTimeout(timer);\n  }, [title, description, videoUrl, hotspots, isPublic]);\n\n  const addHotspot = () => {\n    const newHotspot: VideoHotspot = {\n      id: Date.now().toString(),\n      timestamp: 0,\n      type: \"question\",\n      title: \"\",\n      content: \"\",\n    };\n    setHotspots([...hotspots, newHotspot]);\n  };\n\n  const updateHotspot = (index: number, updates: Partial<VideoHotspot>) => {\n    const updated = [...hotspots];\n    updated[index] = { ...updated[index], ...updates };\n    setHotspots(updated);\n  };\n\n  const removeHotspot = (index: number) => {\n    setHotspots(hotspots.filter((_, i) => i !== index));\n  };\n\n  const handleAIGenerated = (data: any) => {\n    if (data.hotspots) {\n      setHotspots(prev => [...prev, ...data.hotspots]);\n    }\n  };\n\n  const handlePublish = async () => {\n    setIsPublished(!isPublished);\n    await saveMutation.mutateAsync(!isPublished);\n    toast({\n      title: isPublished ? \"Unpublished\" : \"Published!\",\n      description: isPublished\n        ? \"Interactive video is now private.\"\n        : \"Interactive video is now publicly accessible via share link.\",\n    });\n  };\n\n  const formatTime = (seconds: number) => {\n    const mins = Math.floor(seconds / 60);\n    const secs = seconds % 60;\n    return `${mins}:${secs.toString().padStart(2, \"0\")}`;\n  };\n\n  const getYouTubeVideoId = (url: string) => {\n    const match = url.match(/(?:youtube\\.com\\/watch\\?v=|youtu\\.be\\/)([^&]+)/);\n    return match ? match[1] : null;\n  };\n\n  useEffect(() => {\n    if (!showPreview || !videoUrl) return;\n\n    const videoId = getYouTubeVideoId(videoUrl);\n    if (!videoId) return;\n\n    const initializePreviewPlayer = () => {\n      if (!previewContainerRef.current) return;\n\n      if (previewPlayerRef.current) {\n        previewPlayerRef.current.destroy();\n        previewPlayerRef.current = null;\n      }\n\n      previewPlayerRef.current = new window.YT.Player(previewContainerRef.current, {\n        videoId: videoId,\n        playerVars: {\n          controls: 1,\n          modestbranding: 1,\n          rel: 0,\n        },\n        events: {\n          onReady: (event: any) => {\n            setVideoDuration(event.target.getDuration());\n          },\n        },\n      });\n    };\n\n    // Use shared YouTube loader\n    youtubeLoader.load(initializePreviewPlayer);\n\n    return () => {\n      if (previewPlayerRef.current) {\n        previewPlayerRef.current.destroy();\n        previewPlayerRef.current = null;\n      }\n    };\n  }, [showPreview, videoUrl]);\n\n  const jumpToTimestamp = (timestamp: number) => {\n    if (!previewPlayerRef.current) return;\n    previewPlayerRef.current.seekTo(timestamp, true);\n    previewPlayerRef.current.playVideo();\n  };\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      {/* Toolbar */}\n      <div className=\"sticky top-0 z-10 bg-card/95 backdrop-blur border-b\">\n        <div className=\"max-w-7xl mx-auto px-6 h-14 flex items-center justify-between\">\n          <div className=\"flex items-center gap-4\">\n            <Button variant=\"ghost\" size=\"icon\" onClick={() => navigate(\"/\")} data-testid=\"button-back\">\n              <ArrowLeft className=\"h-5 w-5\" />\n            </Button>\n            <div className=\"flex items-center gap-2\">\n              <h1 className=\"text-lg font-semibold\">Interactive Video Creator</h1>\n              {isSaving && <Badge variant=\"outline\">Saving...</Badge>}\n            </div>\n          </div>\n\n      {/* Breadcrumbs */}\n      <div className=\"bg-background border-b\">\n        <div className=\"max-w-7xl mx-auto px-6 py-3\">\n          <Breadcrumbs items={breadcrumbs} />\n        </div>\n      </div>\n          <div className=\"flex items-center gap-2\">\n            <Button variant=\"outline\" size=\"sm\" onClick={() => setShowAIModal(true)} data-testid=\"button-ai-generate\">\n              <Sparkles className=\"h-4 w-4 mr-1\" />\n              AI Generate\n            </Button>\n            {contentId && isPublished && (\n              <ShareToClassroomDialog\n                contentTitle={title}\n                contentDescription={description}\n                materialLink={`${window.location.origin}/public/${contentId}`}\n              />\n            )}\n            <Button\n              variant={isPublished ? \"outline\" : \"default\"}\n              size=\"sm\"\n              onClick={handlePublish}\n              disabled={!title || !videoUrl}\n              data-testid=\"button-publish\"\n            >\n              <Globe className=\"h-4 w-4 mr-1\" />\n              {isPublished ? \"Unpublish\" : \"Publish\"}\n            </Button>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"max-w-7xl mx-auto px-6 py-8\">\n        <div className=\"space-y-6\">\n          {/* Title & Description */}\n          <Card>\n            <CardHeader>\n              <CardTitle>Video Details</CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"title\">Title *</Label>\n                <Input\n                  id=\"title\"\n                  placeholder=\"e.g., Cell Division Explained\"\n                  value={title}\n                  onChange={(e) => setTitle(e.target.value)}\n                  data-testid=\"input-title\"\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"description\">Description (Optional)</Label>\n                <Textarea\n                  id=\"description\"\n                  placeholder=\"Brief description of this interactive video...\"\n                  value={description}\n                  onChange={(e) => setDescription(e.target.value)}\n                  className=\"h-20 resize-none\"\n                  data-testid=\"textarea-description\"\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"videoUrl\">YouTube Video URL *</Label>\n                <Input\n                  id=\"videoUrl\"\n                  placeholder=\"https://www.youtube.com/watch?v=...\"\n                  value={videoUrl}\n                  onChange={(e) => setVideoUrl(e.target.value)}\n                  data-testid=\"input-video-url\"\n                />\n                <p className=\"text-xs text-muted-foreground\">\n                  Paste a YouTube video URL to add interactive hotspots\n                </p>\n              </div>\n              <div className=\"flex items-center justify-between p-4 bg-muted/50 rounded-lg\">\n                <div className=\"space-y-0.5\">\n                  <Label htmlFor=\"isPublic\" className=\"text-base\">Share as Public Resource</Label>\n                  <p className=\"text-sm text-muted-foreground\">\n                    Allow other teachers to discover and use this interactive video on the Shared Resources page. Content will be automatically published when shared.\n                  </p>\n                </div>\n                <Switch\n                  id=\"isPublic\"\n                  checked={isPublic}\n                  onCheckedChange={(checked) => {\n                    setIsPublic(checked);\n                    if (checked) {\n                      setIsPublished(true);\n                    }\n                  }}\n                  data-testid=\"switch-public\"\n                />\n              </div>\n            </CardContent>\n          </Card>\n\n          {/* Video Preview */}\n          {videoUrl && (\n            <Collapsible open={showPreview} onOpenChange={setShowPreview}>\n              <Card>\n                <CardHeader>\n                  <CollapsibleTrigger className=\"flex items-center justify-between w-full hover-elevate rounded-lg -mx-2 px-2\">\n                    <div className=\"flex items-center gap-2\">\n                      <Play className=\"h-5 w-5\" />\n                      <CardTitle>Video Preview</CardTitle>\n                    </div>\n                    <ChevronDown\n                      className={`h-5 w-5 transition-transform ${showPreview ? \"rotate-180\" : \"\"}`}\n                    />\n                  </CollapsibleTrigger>\n                </CardHeader>\n                <CollapsibleContent>\n                  <CardContent className=\"space-y-4\">\n                    {/* Video Player */}\n                    <div className=\"relative bg-black rounded-lg overflow-hidden\" style={{ aspectRatio: \"16/9\" }}>\n                      <div ref={previewContainerRef} className=\"w-full h-full\" />\n                    </div>\n\n                    {/* Hotspot Timeline */}\n                    {hotspots.length > 0 && videoDuration > 0 && (\n                      <div className=\"space-y-2\">\n                        <h4 className=\"text-sm font-medium\">Hotspot Timeline</h4>\n                        <div className=\"relative h-12 bg-muted rounded-lg\">\n                          {hotspots.map((hotspot, index) => {\n                            const position = (hotspot.timestamp / videoDuration) * 100;\n                            return (\n                              <button\n                                key={hotspot.id}\n                                className={`absolute top-1/2 -translate-y-1/2 -translate-x-1/2 w-8 h-8 rounded-full flex items-center justify-center text-xs font-medium cursor-pointer transition-all hover:scale-125 ${\n                                  hotspot.type === \"question\"\n                                    ? \"bg-primary text-primary-foreground\"\n                                    : hotspot.type === \"info\"\n                                    ? \"bg-blue-500 text-white\"\n                                    : \"bg-green-500 text-white\"\n                                }`}\n                                style={{ left: `${position}%` }}\n                                onClick={() => jumpToTimestamp(hotspot.timestamp)}\n                                title={`${hotspot.title} at ${formatTime(hotspot.timestamp)}`}\n                                aria-label={`Jump to ${hotspot.title} at ${formatTime(hotspot.timestamp)}`}\n                                data-testid={`preview-marker-${index}`}\n                              >\n                                {index + 1}\n                              </button>\n                            );\n                          })}\n                        </div>\n                        <div className=\"flex items-center gap-4 text-xs text-muted-foreground\">\n                          <div className=\"flex items-center gap-2\">\n                            <div className=\"w-4 h-4 rounded-full bg-primary\" />\n                            <span>Question</span>\n                          </div>\n                          <div className=\"flex items-center gap-2\">\n                            <div className=\"w-4 h-4 rounded-full bg-blue-500\" />\n                            <span>Information</span>\n                          </div>\n                          <div className=\"flex items-center gap-2\">\n                            <div className=\"w-4 h-4 rounded-full bg-green-500\" />\n                            <span>Navigation</span>\n                          </div>\n                        </div>\n                      </div>\n                    )}\n                  </CardContent>\n                </CollapsibleContent>\n              </Card>\n            </Collapsible>\n          )}\n\n          {/* Hotspots */}\n          <div className=\"space-y-4\">\n            <div className=\"flex items-center justify-between\">\n              <h3 className=\"text-lg font-semibold\">Hotspots ({hotspots.length})</h3>\n              <Button onClick={addHotspot} size=\"sm\" data-testid=\"button-add-hotspot\">\n                <Plus className=\"h-4 w-4 mr-1\" />\n                Add Hotspot\n              </Button>\n            </div>\n\n            {hotspots.length === 0 ? (\n              <Card className=\"text-center py-12\">\n                <CardContent>\n                  <p className=\"text-muted-foreground mb-4\">\n                    No hotspots yet. Add interactive moments to your video.\n                  </p>\n                  <Button onClick={addHotspot} data-testid=\"button-add-first-hotspot\">\n                    <Plus className=\"h-4 w-4 mr-2\" />\n                    Add Hotspot\n                  </Button>\n                </CardContent>\n              </Card>\n            ) : (\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                {hotspots.map((hotspot, index) => (\n                  <Card key={hotspot.id} data-testid={`hotspot-${index}`}>\n                    <CardHeader>\n                      <div className=\"flex items-start justify-between\">\n                        <div>\n                          <h4 className=\"font-medium\">Hotspot {index + 1}</h4>\n                          <p className=\"text-sm text-muted-foreground\">\n                            {formatTime(hotspot.timestamp)}\n                          </p>\n                        </div>\n                        <Button\n                          variant=\"destructive\"\n                          size=\"icon\"\n                          onClick={() => removeHotspot(index)}\n                          data-testid={`button-delete-${index}`}\n                        >\n                          <Trash2 className=\"h-4 w-4\" />\n                        </Button>\n                      </div>\n                    </CardHeader>\n                    <CardContent className=\"space-y-4\">\n                      <div className=\"space-y-2\">\n                        <Label>Timestamp (seconds)</Label>\n                        <Input\n                          type=\"number\"\n                          min=\"0\"\n                          value={hotspot.timestamp}\n                          onChange={(e) => updateHotspot(index, { timestamp: parseInt(e.target.value) || 0 })}\n                          data-testid={`input-timestamp-${index}`}\n                        />\n                      </div>\n\n                      <div className=\"space-y-2\">\n                        <Label>Type</Label>\n                        <Select\n                          value={hotspot.type}\n                          onValueChange={(value: any) => updateHotspot(index, { type: value })}\n                        >\n                          <SelectTrigger data-testid={`select-type-${index}`}>\n                            <SelectValue />\n                          </SelectTrigger>\n                          <SelectContent>\n                            <SelectItem value=\"question\">Question</SelectItem>\n                            <SelectItem value=\"info\">Information</SelectItem>\n                            <SelectItem value=\"navigation\">Navigation</SelectItem>\n                          </SelectContent>\n                        </Select>\n                      </div>\n\n                      <div className=\"space-y-2\">\n                        <Label>Title</Label>\n                        <Input\n                          placeholder=\"Hotspot title...\"\n                          value={hotspot.title}\n                          onChange={(e) => updateHotspot(index, { title: e.target.value })}\n                          data-testid={`input-title-${index}`}\n                        />\n                      </div>\n\n                      <div className=\"space-y-2\">\n                        <Label>Content</Label>\n                        <Textarea\n                          placeholder=\"Description or question...\"\n                          value={hotspot.content}\n                          onChange={(e) => updateHotspot(index, { content: e.target.value })}\n                          className=\"h-20 resize-none\"\n                          data-testid={`textarea-content-${index}`}\n                        />\n                      </div>\n\n                      {hotspot.type === \"question\" && (\n                        <>\n                          <div className=\"space-y-2\">\n                            <Label>Options (comma-separated)</Label>\n                            <Input\n                              placeholder=\"Option 1, Option 2, Option 3\"\n                              value={hotspot.options?.join(\", \") || \"\"}\n                              onChange={(e) =>\n                                updateHotspot(index, { options: e.target.value.split(\",\").map((s) => s.trim()) })\n                              }\n                              data-testid={`input-options-${index}`}\n                            />\n                          </div>\n                          <div className=\"space-y-2\">\n                            <Label>Correct Answer (index, 0-based)</Label>\n                            <Input\n                              type=\"number\"\n                              min=\"0\"\n                              value={hotspot.correctAnswer || 0}\n                              onChange={(e) => updateHotspot(index, { correctAnswer: parseInt(e.target.value) || 0 })}\n                              data-testid={`input-correct-${index}`}\n                            />\n                          </div>\n                        </>\n                      )}\n                    </CardContent>\n                  </Card>\n                ))}\n              </div>\n            )}\n          </div>\n        </div>\n      </div>\n\n      <AIGenerationModal\n        open={showAIModal}\n        onOpenChange={setShowAIModal}\n        contentType=\"interactive-video\"\n        onGenerated={handleAIGenerated}\n      />\n    </div>\n  );\n}\n","size_bytes":21367},"client/src/components/ui/context-menu.tsx":{"content":"import * as React from \"react\"\nimport * as ContextMenuPrimitive from \"@radix-ui/react-context-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ContextMenu = ContextMenuPrimitive.Root\n\nconst ContextMenuTrigger = ContextMenuPrimitive.Trigger\n\nconst ContextMenuGroup = ContextMenuPrimitive.Group\n\nconst ContextMenuPortal = ContextMenuPrimitive.Portal\n\nconst ContextMenuSub = ContextMenuPrimitive.Sub\n\nconst ContextMenuRadioGroup = ContextMenuPrimitive.RadioGroup\n\nconst ContextMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <ContextMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </ContextMenuPrimitive.SubTrigger>\n))\nContextMenuSubTrigger.displayName = ContextMenuPrimitive.SubTrigger.displayName\n\nconst ContextMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuSubContent.displayName = ContextMenuPrimitive.SubContent.displayName\n\nconst ContextMenuContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Portal>\n    <ContextMenuPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"z-50 max-h-[--radix-context-menu-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md animate-in fade-in-80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </ContextMenuPrimitive.Portal>\n))\nContextMenuContent.displayName = ContextMenuPrimitive.Content.displayName\n\nconst ContextMenuItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuItem.displayName = ContextMenuPrimitive.Item.displayName\n\nconst ContextMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <ContextMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.CheckboxItem>\n))\nContextMenuCheckboxItem.displayName =\n  ContextMenuPrimitive.CheckboxItem.displayName\n\nconst ContextMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <ContextMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.RadioItem>\n))\nContextMenuRadioItem.displayName = ContextMenuPrimitive.RadioItem.displayName\n\nconst ContextMenuLabel = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold text-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuLabel.displayName = ContextMenuPrimitive.Label.displayName\n\nconst ContextMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nContextMenuSeparator.displayName = ContextMenuPrimitive.Separator.displayName\n\nconst ContextMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nContextMenuShortcut.displayName = \"ContextMenuShortcut\"\n\nexport {\n  ContextMenu,\n  ContextMenuTrigger,\n  ContextMenuContent,\n  ContextMenuItem,\n  ContextMenuCheckboxItem,\n  ContextMenuRadioItem,\n  ContextMenuLabel,\n  ContextMenuSeparator,\n  ContextMenuShortcut,\n  ContextMenuGroup,\n  ContextMenuPortal,\n  ContextMenuSub,\n  ContextMenuSubContent,\n  ContextMenuSubTrigger,\n  ContextMenuRadioGroup,\n}\n","size_bytes":7428},"client/src/components/ui/select.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SelectPrimitive from \"@radix-ui/react-select\"\nimport { Check, ChevronDown, ChevronUp } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Select = SelectPrimitive.Root\n\nconst SelectGroup = SelectPrimitive.Group\n\nconst SelectValue = SelectPrimitive.Value\n\nconst SelectTrigger = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex h-9 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <SelectPrimitive.Icon asChild>\n      <ChevronDown className=\"h-4 w-4 opacity-50\" />\n    </SelectPrimitive.Icon>\n  </SelectPrimitive.Trigger>\n))\nSelectTrigger.displayName = SelectPrimitive.Trigger.displayName\n\nconst SelectScrollUpButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollUpButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronUp className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollUpButton>\n))\nSelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName\n\nconst SelectScrollDownButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollDownButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronDown className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollDownButton>\n))\nSelectScrollDownButton.displayName =\n  SelectPrimitive.ScrollDownButton.displayName\n\nconst SelectContent = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>\n>(({ className, children, position = \"popper\", ...props }, ref) => (\n  <SelectPrimitive.Portal>\n    <SelectPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]\",\n        position === \"popper\" &&\n          \"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1\",\n        className\n      )}\n      position={position}\n      {...props}\n    >\n      <SelectScrollUpButton />\n      <SelectPrimitive.Viewport\n        className={cn(\n          \"p-1\",\n          position === \"popper\" &&\n            \"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]\"\n        )}\n      >\n        {children}\n      </SelectPrimitive.Viewport>\n      <SelectScrollDownButton />\n    </SelectPrimitive.Content>\n  </SelectPrimitive.Portal>\n))\nSelectContent.displayName = SelectPrimitive.Content.displayName\n\nconst SelectLabel = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Label\n    ref={ref}\n    className={cn(\"py-1.5 pl-8 pr-2 text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nSelectLabel.displayName = SelectPrimitive.Label.displayName\n\nconst SelectItem = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <SelectPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </SelectPrimitive.ItemIndicator>\n    </span>\n\n    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>\n  </SelectPrimitive.Item>\n))\nSelectItem.displayName = SelectPrimitive.Item.displayName\n\nconst SelectSeparator = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nSelectSeparator.displayName = SelectPrimitive.Separator.displayName\n\nexport {\n  Select,\n  SelectGroup,\n  SelectValue,\n  SelectTrigger,\n  SelectContent,\n  SelectLabel,\n  SelectItem,\n  SelectSeparator,\n  SelectScrollUpButton,\n  SelectScrollDownButton,\n}\n","size_bytes":5741},"drizzle.config.ts":{"content":"import { defineConfig } from \"drizzle-kit\";\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\"DATABASE_URL, ensure the database is provisioned\");\n}\n\nexport default defineConfig({\n  out: \"./migrations\",\n  schema: \"./shared/schema.ts\",\n  dialect: \"postgresql\",\n  dbCredentials: {\n    url: process.env.DATABASE_URL,\n  },\n});\n","size_bytes":325},"client/src/components/ui/toggle-group.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ToggleGroupPrimitive from \"@radix-ui/react-toggle-group\"\nimport { type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { toggleVariants } from \"@/components/ui/toggle\"\n\nconst ToggleGroupContext = React.createContext<\n  VariantProps<typeof toggleVariants>\n>({\n  size: \"default\",\n  variant: \"default\",\n})\n\nconst ToggleGroup = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, children, ...props }, ref) => (\n  <ToggleGroupPrimitive.Root\n    ref={ref}\n    className={cn(\"flex items-center justify-center gap-1\", className)}\n    {...props}\n  >\n    <ToggleGroupContext.Provider value={{ variant, size }}>\n      {children}\n    </ToggleGroupContext.Provider>\n  </ToggleGroupPrimitive.Root>\n))\n\nToggleGroup.displayName = ToggleGroupPrimitive.Root.displayName\n\nconst ToggleGroupItem = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Item> &\n    VariantProps<typeof toggleVariants>\n>(({ className, children, variant, size, ...props }, ref) => {\n  const context = React.useContext(ToggleGroupContext)\n\n  return (\n    <ToggleGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        toggleVariants({\n          variant: context.variant || variant,\n          size: context.size || size,\n        }),\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </ToggleGroupPrimitive.Item>\n  )\n})\n\nToggleGroupItem.displayName = ToggleGroupPrimitive.Item.displayName\n\nexport { ToggleGroup, ToggleGroupItem }\n","size_bytes":1753},"client/src/hooks/use-progress-tracker.ts":{"content":"import { useMutation, useQuery, useQueryClient } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useAuth } from \"@/hooks/useAuth\";\n\ntype ProgressData = {\n  id: string;\n  userId: string;\n  contentId: string;\n  completionPercentage: number;\n  completedAt: string | null;\n  lastAccessedAt: string;\n  createdAt: string;\n  updatedAt: string;\n};\n\ntype QuizAttempt = {\n  id: string;\n  userId: string;\n  contentId: string;\n  score: number;\n  totalQuestions: number;\n  answers: Array<{\n    questionId: string;\n    answer: string | number | boolean;\n    isCorrect: boolean;\n  }>;\n  completedAt: string;\n};\n\ntype InteractionEvent = {\n  id: string;\n  userId: string;\n  contentId: string;\n  eventType: string;\n  eventData: Record<string, any> | null;\n  createdAt: string;\n};\n\nexport function useProgressTracker(contentId: string) {\n  const queryClient = useQueryClient();\n  const { toast } = useToast();\n  const { user } = useAuth();\n\n  // Only track progress for authenticated users\n  const isAuthenticated = !!user;\n\n  // Get current progress\n  const { data: progress, isFetched } = useQuery<ProgressData | null>({\n    queryKey: [\"/api/progress\", contentId],\n    enabled: !!contentId && isAuthenticated,\n  });\n\n  // Update progress mutation\n  const updateProgressMutation = useMutation({\n    mutationFn: async ({ completionPercentage }: { completionPercentage: number }) => {\n      return await apiRequest(\"POST\", `/api/progress`, {\n        contentId,\n        completionPercentage,\n      });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/progress\", contentId] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/progress\"] });\n    },\n    onError: (error: any) => {\n      console.error(\"Failed to save progress:\", error);\n      toast({\n        title: \"Error\",\n        description: \"Failed to save your progress. Please try again.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Save quiz attempt mutation\n  const saveQuizAttemptMutation = useMutation({\n    mutationFn: async ({\n      score,\n      totalQuestions,\n      answers,\n    }: {\n      score: number;\n      totalQuestions: number;\n      answers: Array<{ questionId: string; answer: string | number | boolean; isCorrect: boolean }>;\n    }) => {\n      return await apiRequest(\"POST\", `/api/quiz-attempts`, {\n        contentId,\n        score,\n        totalQuestions,\n        answers,\n      });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/quiz-attempts\", contentId] });\n      // Also update progress to 100%\n      updateProgressMutation.mutate({ completionPercentage: 100 });\n    },\n    onError: (error: any) => {\n      console.error(\"Failed to save quiz attempt:\", error);\n      toast({\n        title: \"Error\",\n        description: \"Failed to save your quiz results. Please try again.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Log interaction event mutation\n  const logInteractionMutation = useMutation({\n    mutationFn: async ({ eventType, eventData }: { eventType: string; eventData?: Record<string, any> }) => {\n      return await apiRequest(\"POST\", `/api/interaction-events`, {\n        contentId,\n        eventType,\n        eventData: eventData || null,\n      });\n    },\n    onError: (error: any) => {\n      console.error(\"Failed to log interaction:\", error);\n    },\n  });\n\n  return {\n    progress,\n    isProgressFetched: isFetched,\n    updateProgress: (completionPercentage: number) => {\n      if (!isAuthenticated) return;\n      updateProgressMutation.mutate({ completionPercentage });\n    },\n    saveQuizAttempt: (\n      score: number,\n      totalQuestions: number,\n      answers: Array<{ questionId: string; answer: string | number | boolean; isCorrect: boolean }>\n    ) => {\n      if (!isAuthenticated) return;\n      saveQuizAttemptMutation.mutate({ score, totalQuestions, answers });\n    },\n    logInteraction: (eventType: string, eventData?: Record<string, any>) => {\n      if (!isAuthenticated) return;\n      logInteractionMutation.mutate({ eventType, eventData });\n    },\n    isLoading:\n      updateProgressMutation.isPending || saveQuizAttemptMutation.isPending || logInteractionMutation.isPending,\n    isAuthenticated,\n  };\n}\n","size_bytes":4291},"client/src/components/players/MemoryGamePlayer.tsx":{"content":"import { useState, useEffect, useRef } from \"react\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { RotateCcw, Trophy } from \"lucide-react\";\nimport type { MemoryGameData, MemoryCard } from \"@shared/schema\";\nimport { useProgressTracker } from \"@/hooks/use-progress-tracker\";\n\ntype MemoryGamePlayerProps = {\n  data: MemoryGameData;\n  contentId: string;\n};\n\nexport function MemoryGamePlayer({ data, contentId }: MemoryGamePlayerProps) {\n  const [shuffledCards, setShuffledCards] = useState<MemoryCard[]>([]);\n  const [flippedIndices, setFlippedIndices] = useState<number[]>([]);\n  const [matchedPairs, setMatchedPairs] = useState<Set<string>>(new Set());\n  const [moves, setMoves] = useState(0);\n  const [startTime, setStartTime] = useState<number>(Date.now());\n  const [elapsedTime, setElapsedTime] = useState(0);\n  const [isComplete, setIsComplete] = useState(false);\n\n  const { progress: savedProgress, isProgressFetched, updateProgress, logInteraction, isAuthenticated } = useProgressTracker(contentId);\n  const [lastSentProgress, setLastSentProgress] = useState<number>(-1);\n  const [isProgressInitialized, setIsProgressInitialized] = useState(false);\n  const pendingMilestoneRef = useRef<number | null>(null);\n  const pendingTimeoutRef = useRef<NodeJS.Timeout | null>(null);\n  const previousAuthRef = useRef<boolean>(isAuthenticated);\n\n  useEffect(() => {\n    if (!previousAuthRef.current && isAuthenticated) {\n      setIsProgressInitialized(false);\n      setLastSentProgress(-1);\n      pendingMilestoneRef.current = null;\n      if (pendingTimeoutRef.current) {\n        clearTimeout(pendingTimeoutRef.current);\n        pendingTimeoutRef.current = null;\n      }\n    }\n    previousAuthRef.current = isAuthenticated;\n  }, [isAuthenticated]);\n\n  useEffect(() => {\n    if (!isProgressInitialized) {\n      if (!isAuthenticated) {\n        setIsProgressInitialized(true);\n      } else if (isProgressFetched) {\n        if (savedProgress) {\n          setLastSentProgress(savedProgress.completionPercentage);\n        }\n        setIsProgressInitialized(true);\n      }\n    } else if (savedProgress) {\n      setLastSentProgress(prev => Math.max(prev, savedProgress.completionPercentage));\n      if (pendingMilestoneRef.current !== null && savedProgress.completionPercentage >= pendingMilestoneRef.current) {\n        pendingMilestoneRef.current = null;\n        if (pendingTimeoutRef.current) {\n          clearTimeout(pendingTimeoutRef.current);\n          pendingTimeoutRef.current = null;\n        }\n      }\n    }\n  }, [savedProgress, isProgressFetched, isAuthenticated, isProgressInitialized]);\n\n  useEffect(() => {\n    if (!isProgressInitialized || !isAuthenticated) return;\n\n    const uniqueMatches = matchedPairs.size;\n    const totalPairs = data.cards.length / 2;\n    if (uniqueMatches > 0 && totalPairs > 0) {\n      const completionPercentage = Math.round((uniqueMatches / totalPairs) * 100);\n      if (completionPercentage > lastSentProgress && completionPercentage !== pendingMilestoneRef.current) {\n        pendingMilestoneRef.current = completionPercentage;\n        updateProgress(completionPercentage);\n        if (pendingTimeoutRef.current) {\n          clearTimeout(pendingTimeoutRef.current);\n        }\n        pendingTimeoutRef.current = setTimeout(() => {\n          pendingMilestoneRef.current = null;\n          pendingTimeoutRef.current = null;\n        }, 5000);\n      }\n    }\n  }, [matchedPairs.size, lastSentProgress, isProgressInitialized, isAuthenticated]);\n\n  useEffect(() => {\n    const shuffled = [...data.cards].sort(() => Math.random() - 0.5);\n    setShuffledCards(shuffled);\n    setStartTime(Date.now());\n  }, [data.cards]);\n\n  useEffect(() => {\n    if (data.settings.showTimer && !isComplete) {\n      const interval = setInterval(() => {\n        setElapsedTime(Math.floor((Date.now() - startTime) / 1000));\n      }, 1000);\n      return () => clearInterval(interval);\n    }\n  }, [data.settings.showTimer, isComplete, startTime]);\n\n  useEffect(() => {\n    if (flippedIndices.length === 2) {\n      const [first, second] = flippedIndices;\n      const firstCard = shuffledCards[first];\n      const secondCard = shuffledCards[second];\n\n      if (firstCard.matchId === secondCard.matchId) {\n        setMatchedPairs(prev => new Set(prev).add(firstCard.matchId));\n        setFlippedIndices([]);\n        logInteraction(\"cards_matched\", { matchId: firstCard.matchId });\n      } else {\n        setTimeout(() => {\n          setFlippedIndices([]);\n        }, 1000);\n      }\n      setMoves(prev => prev + 1);\n    }\n  }, [flippedIndices]);\n\n  useEffect(() => {\n    if (matchedPairs.size > 0 && matchedPairs.size === data.cards.length / 2) {\n      setIsComplete(true);\n      logInteraction(\"game_completed\", {\n        moves,\n        time: elapsedTime,\n      });\n    }\n  }, [matchedPairs.size]);\n\n  const handleCardClick = (index: number) => {\n    if (flippedIndices.length === 2) return;\n    if (flippedIndices.includes(index)) return;\n    if (matchedPairs.has(shuffledCards[index].matchId)) return;\n\n    setFlippedIndices([...flippedIndices, index]);\n  };\n\n  const reset = () => {\n    const shuffled = [...data.cards].sort(() => Math.random() - 0.5);\n    setShuffledCards(shuffled);\n    setFlippedIndices([]);\n    setMatchedPairs(new Set());\n    setMoves(0);\n    setStartTime(Date.now());\n    setElapsedTime(0);\n    setIsComplete(false);\n  };\n\n  const formatTime = (seconds: number) => {\n    const mins = Math.floor(seconds / 60);\n    const secs = seconds % 60;\n    return `${mins}:${secs.toString().padStart(2, \"0\")}`;\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex items-center justify-between\">\n        <div className=\"flex gap-4\">\n          {data.settings.showTimer && (\n            <Badge variant=\"secondary\" data-testid=\"badge-timer\">\n              Time: {formatTime(elapsedTime)}\n            </Badge>\n          )}\n          {data.settings.showMoves && (\n            <Badge variant=\"secondary\" data-testid=\"badge-moves\">\n              Moves: {moves}\n            </Badge>\n          )}\n        </div>\n        <Button onClick={reset} variant=\"outline\" size=\"sm\" data-testid=\"button-reset\">\n          <RotateCcw className=\"h-4 w-4 mr-2\" />\n          Reset\n        </Button>\n      </div>\n\n      {isComplete && (\n        <Card>\n          <CardContent className=\"pt-6\">\n            <div className=\"text-center\">\n              <Trophy className=\"h-12 w-12 mx-auto mb-4 text-yellow-500\" />\n              <p className=\"text-2xl font-bold mb-2\">Congratulations!</p>\n              <p className=\"text-muted-foreground\">\n                You completed the game in {moves} moves and {formatTime(elapsedTime)}\n              </p>\n            </div>\n          </CardContent>\n        </Card>\n      )}\n\n      <div\n        className=\"grid gap-4\"\n        style={{\n          gridTemplateColumns: `repeat(${data.settings.columns || 4}, minmax(0, 1fr))`,\n        }}\n      >\n        {shuffledCards.map((card, index) => {\n          const isFlipped = flippedIndices.includes(index) || matchedPairs.has(card.matchId);\n          return (\n            <Card\n              key={card.id}\n              onClick={() => handleCardClick(index)}\n              className={`aspect-square cursor-pointer transition-all ${\n                isFlipped ? \"bg-primary text-primary-foreground\" : \"hover-elevate active-elevate-2\"\n              }`}\n              data-testid={`card-${index}`}\n            >\n              <CardContent className=\"h-full flex items-center justify-center p-2\">\n                {isFlipped ? (\n                  <p className=\"text-center text-sm font-medium break-words\">{card.content}</p>\n                ) : (\n                  <p className=\"text-muted-foreground\">?</p>\n                )}\n              </CardContent>\n            </Card>\n          );\n        })}\n      </div>\n    </div>\n  );\n}\n","size_bytes":7922},"client/src/pages/MemoryGameCreator.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useParams, useLocation } from \"wouter\";\nimport { Breadcrumbs } from \"@/components/Breadcrumbs\";\nimport { useBreadcrumbs } from \"@/hooks/useBreadcrumbs\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { AIGenerationModal } from \"@/components/AIGenerationModal\";\nimport { ArrowLeft, Sparkles, Plus, Trash2, Globe } from \"lucide-react\";\nimport type { H5pContent, MemoryGameData } from \"@shared/schema\";\nimport ShareToClassroomDialog from \"@/components/ShareToClassroomDialog\";\n\nexport default function MemoryGameCreator() {\n  const params = useParams();\n  const [_, navigate] = useLocation();\n  const { toast } = useToast();\n  const contentId = params.id;\n  const breadcrumbs = useBreadcrumbs(contentId);\n  const isEditing = !!contentId;\n\n  const [title, setTitle] = useState(\"\");\n  const [description, setDescription] = useState(\"\");\n  const [cards, setCards] = useState<MemoryGameData[\"cards\"]>([]);\n  const [settings, setSettings] = useState({\n    rows: 4,\n    columns: 4,\n    showTimer: true,\n    showMoves: true,\n  });\n  const [isPublished, setIsPublished] = useState(false);\n  const [isPublic, setIsPublic] = useState(false);\n  const [showAIModal, setShowAIModal] = useState(false);\n  const [isSaving, setIsSaving] = useState(false);\n\n  const { data: content } = useQuery<H5pContent>({\n    queryKey: [\"/api/content\", contentId],\n    enabled: isEditing,\n  });\n\n  useEffect(() => {\n    if (content && content.type === \"memory-game\") {\n      setTitle(content.title);\n      setDescription(content.description || \"\");\n      const data = content.data as MemoryGameData;\n      setCards(data.cards || []);\n      setSettings(data.settings || settings);\n      setIsPublished(content.isPublished);\n      setIsPublic(content.isPublic || false);\n    }\n  }, [content]);\n\n  const saveMutation = useMutation({\n    mutationFn: async (publish: boolean = false) => {\n      const data: MemoryGameData = { cards, settings };\n      \n      if (isEditing) {\n        const response = await apiRequest(\"PUT\", `/api/content/${contentId}`, {\n          title, description, data, isPublished: publish, isPublic,\n        });\n        return await response.json();\n      } else {\n        const response = await apiRequest(\"POST\", \"/api/content\", {\n          title, description, type: \"memory-game\", data, isPublished: publish, isPublic,\n        });\n        return await response.json();\n      }\n    },\n    onSuccess: (data) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/content\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/content/public\"] });\n      if (!isEditing) navigate(`/create/memory-game/${data.id}`);\n      toast({ title: \"Saved!\", description: \"Memory Game saved successfully.\" });\n      setIsSaving(false);\n    },\n  });\n\n  useEffect(() => {\n    if (!title || cards.length === 0) return;\n    const timer = setTimeout(() => {\n      setIsSaving(true);\n      saveMutation.mutate(isPublished);\n    }, 2000);\n    return () => clearTimeout(timer);\n  }, [title, description, cards, settings, isPublic]);\n\n  const addPair = () => {\n    const matchId = Date.now().toString();\n    setCards([\n      ...cards,\n      { id: `${matchId}-1`, content: \"\", matchId, type: \"text\" },\n      { id: `${matchId}-2`, content: \"\", matchId, type: \"text\" },\n    ]);\n  };\n\n  const handleAIGenerated = (data: any) => {\n    if (data.cards) setCards(data.cards);\n    setShowAIModal(false);\n  };\n\n  const pairs = [];\n  for (let i = 0; i < cards.length; i += 2) {\n    if (cards[i] && cards[i + 1]) {\n      pairs.push([cards[i], cards[i + 1]]);\n    }\n  }\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      <div className=\"border-b\">\n        <div className=\"container mx-auto px-4 py-4 flex items-center justify-between\">\n          <div className=\"flex items-center gap-4\">\n            <Button variant=\"ghost\" size=\"icon\" onClick={() => navigate(\"/\")} data-testid=\"button-back\">\n              <ArrowLeft className=\"h-5 w-5\" />\n            </Button>\n            <div>\n              <h1 className=\"text-2xl font-bold\">Memory Game</h1>\n              <p className=\"text-sm text-muted-foreground\">\n                {isSaving ? \"Saving...\" : isEditing ? \"Editing game\" : \"Create new game\"}\n              </p>\n            </div>\n          </div>\n          <div className=\"flex items-center gap-2\">\n            <Button variant=\"outline\" onClick={() => setShowAIModal(true)} data-testid=\"button-ai-generate\">\n              <Sparkles className=\"h-4 w-4 mr-2\" />\n              AI Generate\n            </Button>\n            {contentId && isPublished && (\n              <ShareToClassroomDialog\n                contentTitle={title}\n                contentDescription={description}\n                materialLink={`${window.location.origin}/public/${contentId}`}\n              />\n            )}\n            <Button\n              variant={isPublished ? \"default\" : \"outline\"}\n              onClick={() => {\n                setIsPublished(!isPublished);\n                saveMutation.mutate(!isPublished);\n              }}\n              data-testid=\"button-publish\"\n            >\n              <Globe className=\"h-4 w-4 mr-2\" />\n              {isPublished ? \"Published\" : \"Publish\"}\n            </Button>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"container mx-auto px-4 py-8\">\n        <div className=\"max-w-4xl mx-auto space-y-6\">\n          <Card>\n            <CardHeader>\n              <CardTitle>Basic Information</CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <div>\n                <Label htmlFor=\"title\">Title</Label>\n                <Input\n                  id=\"title\"\n                  value={title}\n                  onChange={(e) => setTitle(e.target.value)}\n                  placeholder=\"Enter game title\"\n                  data-testid=\"input-title\"\n                />\n              </div>\n              <div>\n                <Label htmlFor=\"description\">Description</Label>\n                <Input\n                  id=\"description\"\n                  value={description}\n                  onChange={(e) => setDescription(e.target.value)}\n                  placeholder=\"Enter game description\"\n                  data-testid=\"input-description\"\n                />\n              </div>\n              <div className=\"flex items-center justify-between p-4 bg-muted/50 rounded-lg\">\n                <div className=\"space-y-0.5\">\n                  <Label htmlFor=\"isPublic\" className=\"text-base\">Share as Public Resource</Label>\n                  <p className=\"text-sm text-muted-foreground\">\n                    Allow other teachers to discover and use this memory game on the Shared Resources page. Content will be automatically published when shared.\n                  </p>\n                </div>\n                <Switch\n                  id=\"isPublic\"\n                  checked={isPublic}\n                  onCheckedChange={(checked) => {\n                    setIsPublic(checked);\n                    if (checked) {\n                      setIsPublished(true);\n                    }\n                  }}\n                  data-testid=\"switch-public\"\n                />\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader>\n              <div className=\"flex items-center justify-between\">\n                <CardTitle>Card Pairs</CardTitle>\n                <Button onClick={addPair} size=\"sm\" data-testid=\"button-add-pair\">\n                  <Plus className=\"h-4 w-4 mr-2\" />\n                  Add Pair\n                </Button>\n              </div>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              {pairs.map(([card1, card2], idx) => (\n                <div key={card1.matchId} className=\"border rounded-lg p-4 space-y-3\">\n                  <div className=\"flex items-center justify-between\">\n                    <Label>Pair {idx + 1}</Label>\n                    <Button\n                      variant=\"ghost\"\n                      size=\"sm\"\n                      onClick={() => setCards(cards.filter(c => c.matchId !== card1.matchId))}\n                      data-testid={`button-remove-pair-${idx}`}\n                    >\n                      <Trash2 className=\"h-4 w-4\" />\n                    </Button>\n                  </div>\n                  <div className=\"grid grid-cols-2 gap-4\">\n                    <div>\n                      <Label>Card 1</Label>\n                      <Input\n                        value={card1.content}\n                        onChange={(e) => {\n                          const updated = [...cards];\n                          const index = updated.findIndex(c => c.id === card1.id);\n                          updated[index] = { ...updated[index], content: e.target.value };\n                          setCards(updated);\n                        }}\n                        placeholder=\"Card content\"\n                        data-testid={`input-card1-${idx}`}\n                      />\n                    </div>\n                    <div>\n                      <Label>Card 2</Label>\n                      <Input\n                        value={card2.content}\n                        onChange={(e) => {\n                          const updated = [...cards];\n                          const index = updated.findIndex(c => c.id === card2.id);\n                          updated[index] = { ...updated[index], content: e.target.value };\n                          setCards(updated);\n                        }}\n                        placeholder=\"Matching content\"\n                        data-testid={`input-card2-${idx}`}\n                      />\n                    </div>\n                  </div>\n                </div>\n              ))}\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader>\n              <CardTitle>Settings</CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <div className=\"flex items-center justify-between\">\n                <Label>Show timer</Label>\n                <Switch\n                  checked={settings.showTimer}\n                  onCheckedChange={(checked) => setSettings({ ...settings, showTimer: checked })}\n                  data-testid=\"switch-show-timer\"\n                />\n              </div>\n              <div className=\"flex items-center justify-between\">\n                <Label>Show move counter</Label>\n                <Switch\n                  checked={settings.showMoves}\n                  onCheckedChange={(checked) => setSettings({ ...settings, showMoves: checked })}\n                  data-testid=\"switch-show-moves\"\n                />\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n\n      {showAIModal && (\n        <AIGenerationModal\n          contentType=\"memory-game\"\n          onClose={() => setShowAIModal(false)}\n          onGenerated={handleAIGenerated}\n        />\n      )}\n    </div>\n  );\n}\n","size_bytes":11399},"client/src/components/players/DragDropPlayer.tsx":{"content":"import { useState, useEffect, useRef } from \"react\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { CheckCircle2, XCircle, RotateCcw } from \"lucide-react\";\nimport type { DragAndDropData } from \"@shared/schema\";\nimport { useProgressTracker } from \"@/hooks/use-progress-tracker\";\n\ntype DragDropPlayerProps = {\n  data: DragAndDropData;\n  contentId: string;\n};\n\nexport function DragDropPlayer({ data, contentId }: DragDropPlayerProps) {\n  const [draggedItem, setDraggedItem] = useState<string | null>(null);\n  const [placements, setPlacements] = useState<Record<string, string>>({});\n  const [feedback, setFeedback] = useState<Record<string, boolean>>({});\n  const [showResults, setShowResults] = useState(false);\n\n  const { progress: savedProgress, isProgressFetched, updateProgress, logInteraction, isAuthenticated } = useProgressTracker(contentId);\n  const [lastSentProgress, setLastSentProgress] = useState<number>(-1);\n  const [isProgressInitialized, setIsProgressInitialized] = useState(false);\n  const pendingMilestoneRef = useRef<number | null>(null);\n  const pendingTimeoutRef = useRef<NodeJS.Timeout | null>(null);\n  const previousAuthRef = useRef<boolean>(isAuthenticated);\n\n  useEffect(() => {\n    if (!previousAuthRef.current && isAuthenticated) {\n      setIsProgressInitialized(false);\n      setLastSentProgress(-1);\n      pendingMilestoneRef.current = null;\n      if (pendingTimeoutRef.current) {\n        clearTimeout(pendingTimeoutRef.current);\n        pendingTimeoutRef.current = null;\n      }\n    }\n    previousAuthRef.current = isAuthenticated;\n  }, [isAuthenticated]);\n\n  useEffect(() => {\n    if (!isProgressInitialized) {\n      if (!isAuthenticated) {\n        setIsProgressInitialized(true);\n      } else if (isProgressFetched) {\n        if (savedProgress) {\n          setLastSentProgress(savedProgress.completionPercentage);\n        }\n        setIsProgressInitialized(true);\n      }\n    } else if (savedProgress) {\n      setLastSentProgress(prev => Math.max(prev, savedProgress.completionPercentage));\n      if (pendingMilestoneRef.current !== null && savedProgress.completionPercentage >= pendingMilestoneRef.current) {\n        pendingMilestoneRef.current = null;\n        if (pendingTimeoutRef.current) {\n          clearTimeout(pendingTimeoutRef.current);\n          pendingTimeoutRef.current = null;\n        }\n      }\n    }\n  }, [savedProgress, isProgressFetched, isAuthenticated, isProgressInitialized]);\n\n  useEffect(() => {\n    if (!isProgressInitialized || !isAuthenticated) return;\n\n    const placedCount = Object.keys(placements).length;\n    if (placedCount > 0 && data.items.length > 0) {\n      const completionPercentage = Math.round((placedCount / data.items.length) * 100);\n      if (completionPercentage > lastSentProgress && completionPercentage !== pendingMilestoneRef.current) {\n        pendingMilestoneRef.current = completionPercentage;\n        updateProgress(completionPercentage);\n        if (pendingTimeoutRef.current) {\n          clearTimeout(pendingTimeoutRef.current);\n        }\n        pendingTimeoutRef.current = setTimeout(() => {\n          pendingMilestoneRef.current = null;\n          pendingTimeoutRef.current = null;\n        }, 5000);\n      }\n    }\n  }, [placements, lastSentProgress, isProgressInitialized, isAuthenticated]);\n\n  const handleDragStart = (itemId: string) => {\n    setDraggedItem(itemId);\n  };\n\n  const handleDragOver = (e: React.DragEvent) => {\n    e.preventDefault();\n  };\n\n  const handleDrop = (zoneId: string) => {\n    if (!draggedItem) return;\n\n    const zone = data.zones.find(z => z.id === zoneId);\n    if (!zone) return;\n\n    if (!zone.allowMultiple) {\n      const existingInZone = Object.entries(placements).find(([_, z]) => z === zoneId);\n      if (existingInZone && existingInZone[0] !== draggedItem) return;\n    }\n\n    setPlacements(prev => ({ ...prev, [draggedItem]: zoneId }));\n\n    if (data.settings.instantFeedback) {\n      const item = data.items.find(i => i.id === draggedItem);\n      const isCorrect = item?.correctZone === zoneId;\n      setFeedback(prev => ({ ...prev, [draggedItem]: isCorrect }));\n      logInteraction(\"item_dropped\", {\n        itemId: draggedItem,\n        zoneId,\n        isCorrect,\n      });\n    }\n\n    setDraggedItem(null);\n  };\n\n  const checkAnswers = () => {\n    const newFeedback: Record<string, boolean> = {};\n    data.items.forEach(item => {\n      const placedZone = placements[item.id];\n      newFeedback[item.id] = placedZone === item.correctZone;\n    });\n    setFeedback(newFeedback);\n    setShowResults(true);\n\n    const correct = Object.values(newFeedback).filter(Boolean).length;\n    logInteraction(\"check_answers\", {\n      score: correct,\n      total: data.items.length,\n    });\n  };\n\n  const reset = () => {\n    setPlacements({});\n    setFeedback({});\n    setShowResults(false);\n    setDraggedItem(null);\n  };\n\n  const score = Object.values(feedback).filter(Boolean).length;\n  const total = data.items.length;\n  const completionPercentage = Object.keys(placements).length > 0 ? (Object.keys(placements).length / total) * 100 : 0;\n\n  const unplacedItems = data.items.filter(item => !placements[item.id]);\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <Progress value={completionPercentage} className=\"w-48\" data-testid=\"progress-bar\" />\n          <p className=\"text-sm text-muted-foreground mt-1\">\n            {Object.keys(placements).length} of {total} items placed\n          </p>\n        </div>\n        <div className=\"flex gap-2\">\n          {!data.settings.instantFeedback && !showResults && (\n            <Button onClick={checkAnswers} disabled={Object.keys(placements).length !== total} data-testid=\"button-check\">\n              Check Answers\n            </Button>\n          )}\n          {showResults && data.settings.allowRetry && (\n            <Button onClick={reset} variant=\"outline\" data-testid=\"button-retry\">\n              <RotateCcw className=\"h-4 w-4 mr-2\" />\n              Try Again\n            </Button>\n          )}\n        </div>\n      </div>\n\n      {showResults && (\n        <Card>\n          <CardContent className=\"pt-6\">\n            <div className=\"text-center\">\n              <p className=\"text-2xl font-bold\">\n                Score: {score}/{total}\n              </p>\n              <p className=\"text-muted-foreground\">\n                {score === total ? \"Perfect! Well done!\" : `You got ${score} out of ${total} correct.`}\n              </p>\n            </div>\n          </CardContent>\n        </Card>\n      )}\n\n      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n        <Card>\n          <CardContent className=\"p-6\">\n            <h3 className=\"font-semibold mb-4\">Items to Drag</h3>\n            <div className=\"space-y-2\">\n              {unplacedItems.map(item => (\n                <div\n                  key={item.id}\n                  draggable\n                  onDragStart={() => handleDragStart(item.id)}\n                  className=\"p-3 bg-card border-2 border-border rounded-lg cursor-move hover-elevate active-elevate-2 select-none\"\n                  data-testid={`drag-item-${item.id}`}\n                >\n                  {item.content}\n                </div>\n              ))}\n            </div>\n          </CardContent>\n        </Card>\n\n        <div className=\"space-y-4\">\n          <h3 className=\"font-semibold\">Drop Zones</h3>\n          {data.zones.map(zone => {\n            const itemsInZone = data.items.filter(item => placements[item.id] === zone.id);\n            return (\n              <Card\n                key={zone.id}\n                onDragOver={handleDragOver}\n                onDrop={() => handleDrop(zone.id)}\n                className=\"min-h-32 border-2 border-dashed\"\n                data-testid={`drop-zone-${zone.id}`}\n              >\n                <CardContent className=\"p-4\">\n                  {data.settings.showZoneLabels && (\n                    <h4 className=\"font-medium mb-2\">{zone.label}</h4>\n                  )}\n                  <div className=\"space-y-2\">\n                    {itemsInZone.map(item => (\n                      <div\n                        key={item.id}\n                        className=\"p-3 bg-accent border-2 border-border rounded-lg flex items-center justify-between\"\n                        data-testid={`placed-item-${item.id}`}\n                      >\n                        <span>{item.content}</span>\n                        {feedback[item.id] !== undefined && (\n                          feedback[item.id] ? (\n                            <CheckCircle2 className=\"h-5 w-5 text-green-500\" data-testid={`correct-${item.id}`} />\n                          ) : (\n                            <XCircle className=\"h-5 w-5 text-destructive\" data-testid={`incorrect-${item.id}`} />\n                          )\n                        )}\n                      </div>\n                    ))}\n                    {itemsInZone.length === 0 && (\n                      <p className=\"text-sm text-muted-foreground text-center py-4\">\n                        Drop items here\n                      </p>\n                    )}\n                  </div>\n                </CardContent>\n              </Card>\n            );\n          })}\n        </div>\n      </div>\n    </div>\n  );\n}\n","size_bytes":9430},"client/src/pages/FillBlanksCreator.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useParams, useLocation } from \"wouter\";\nimport { Breadcrumbs } from \"@/components/Breadcrumbs\";\nimport { useBreadcrumbs } from \"@/hooks/useBreadcrumbs\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { AIGenerationModal } from \"@/components/AIGenerationModal\";\nimport { ArrowLeft, Sparkles, Plus, Trash2, Globe, HelpCircle } from \"lucide-react\";\nimport type { H5pContent, FillInBlanksData } from \"@shared/schema\";\nimport ShareToClassroomDialog from \"@/components/ShareToClassroomDialog\";\n\nexport default function FillBlanksCreator() {\n  const params = useParams();\n  const [_, navigate] = useLocation();\n  const { toast } = useToast();\n  const contentId = params.id;\n  const breadcrumbs = useBreadcrumbs(contentId);\n  const isEditing = !!contentId;\n\n  const [title, setTitle] = useState(\"\");\n  const [description, setDescription] = useState(\"\");\n  const [text, setText] = useState(\"\");\n  const [blanks, setBlanks] = useState<FillInBlanksData[\"blanks\"]>([]);\n  const [settings, setSettings] = useState({\n    caseSensitive: false,\n    showHints: true,\n    allowRetry: true,\n  });\n  const [isPublished, setIsPublished] = useState(false);\n  const [isPublic, setIsPublic] = useState(false);\n  const [showAIModal, setShowAIModal] = useState(false);\n  const [isSaving, setIsSaving] = useState(false);\n\n  const { data: content } = useQuery<H5pContent>({\n    queryKey: [\"/api/content\", contentId],\n    enabled: isEditing,\n  });\n\n  useEffect(() => {\n    if (content && content.type === \"fill-blanks\") {\n      setTitle(content.title);\n      setDescription(content.description || \"\");\n      const data = content.data as FillInBlanksData;\n      setText(data.text || \"\");\n      setBlanks(data.blanks || []);\n      setSettings(data.settings || settings);\n      setIsPublished(content.isPublished);\n      setIsPublic(content.isPublic || false);\n    }\n  }, [content]);\n\n  const saveMutation = useMutation({\n    mutationFn: async (publish: boolean = false) => {\n      const data: FillInBlanksData = { text, blanks, settings };\n      \n      if (isEditing) {\n        const response = await apiRequest(\"PUT\", `/api/content/${contentId}`, {\n          title, description, data, isPublished: publish, isPublic,\n        });\n        return await response.json();\n      } else {\n        const response = await apiRequest(\"POST\", \"/api/content\", {\n          title, description, type: \"fill-blanks\", data, isPublished: publish, isPublic,\n        });\n        return await response.json();\n      }\n    },\n    onSuccess: (data) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/content\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/content/public\"] });\n      if (!isEditing) navigate(`/create/fill-blanks/${data.id}`);\n      toast({ title: \"Saved!\", description: \"Fill in the Blanks activity saved successfully.\" });\n      setIsSaving(false);\n    },\n  });\n\n  useEffect(() => {\n    if (!title || !text || blanks.length === 0) return;\n    const timer = setTimeout(() => {\n      setIsSaving(true);\n      saveMutation.mutate(isPublished);\n    }, 2000);\n    return () => clearTimeout(timer);\n  }, [title, description, text, blanks, settings, isPublic]);\n\n  const addBlank = () => {\n    setBlanks([...blanks, {\n      id: Date.now().toString(),\n      correctAnswers: [\"\"],\n      caseSensitive: settings.caseSensitive,\n      showHint: \"\",\n    }]);\n  };\n\n  const handleAIGenerated = (data: any) => {\n    if (data.text) setText(data.text);\n    if (data.blanks) setBlanks(data.blanks);\n    setShowAIModal(false);\n  };\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      <div className=\"border-b\">\n        <div className=\"container mx-auto px-4 py-4 flex items-center justify-between\">\n          <div className=\"flex items-center gap-4\">\n            <Button variant=\"ghost\" size=\"icon\" onClick={() => navigate(\"/\")} data-testid=\"button-back\">\n              <ArrowLeft className=\"h-5 w-5\" />\n            </Button>\n            <div>\n              <h1 className=\"text-2xl font-bold\">Fill in the Blanks</h1>\n              <p className=\"text-sm text-muted-foreground\">\n                {isSaving ? \"Saving...\" : isEditing ? \"Editing activity\" : \"Create new activity\"}\n              </p>\n            </div>\n          </div>\n          <div className=\"flex items-center gap-2\">\n            <Button variant=\"outline\" onClick={() => setShowAIModal(true)} data-testid=\"button-ai-generate\">\n              <Sparkles className=\"h-4 w-4 mr-2\" />\n              AI Generate\n            </Button>\n            {contentId && isPublished && (\n              <ShareToClassroomDialog\n                contentTitle={title}\n                contentDescription={description}\n                materialLink={`${window.location.origin}/public/${contentId}`}\n              />\n            )}\n            <Button\n              variant={isPublished ? \"default\" : \"outline\"}\n              onClick={() => {\n                setIsPublished(!isPublished);\n                saveMutation.mutate(!isPublished);\n              }}\n              data-testid=\"button-publish\"\n            >\n              <Globe className=\"h-4 w-4 mr-2\" />\n              {isPublished ? \"Published\" : \"Publish\"}\n            </Button>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"container mx-auto px-4 py-8\">\n        <div className=\"max-w-4xl mx-auto space-y-6\">\n          <Card>\n            <CardHeader>\n              <CardTitle>Basic Information</CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <div>\n                <Label htmlFor=\"title\">Title</Label>\n                <Input\n                  id=\"title\"\n                  value={title}\n                  onChange={(e) => setTitle(e.target.value)}\n                  placeholder=\"Enter activity title\"\n                  data-testid=\"input-title\"\n                />\n              </div>\n              <div>\n                <Label htmlFor=\"description\">Description</Label>\n                <Input\n                  id=\"description\"\n                  value={description}\n                  onChange={(e) => setDescription(e.target.value)}\n                  placeholder=\"Enter activity description\"\n                  data-testid=\"input-description\"\n                />\n              </div>\n              <div className=\"flex items-center justify-between p-4 bg-muted/50 rounded-lg\">\n                <div className=\"space-y-0.5\">\n                  <Label htmlFor=\"isPublic\" className=\"text-base\">Share as Public Resource</Label>\n                  <p className=\"text-sm text-muted-foreground\">\n                    Allow other teachers to discover and use this fill in the blanks activity on the Shared Resources page. Content will be automatically published when shared.\n                  </p>\n                </div>\n                <Switch\n                  id=\"isPublic\"\n                  checked={isPublic}\n                  onCheckedChange={(checked) => {\n                    setIsPublic(checked);\n                    if (checked) {\n                      setIsPublished(true);\n                    }\n                  }}\n                  data-testid=\"switch-public\"\n                />\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader>\n              <CardTitle>Text with Blanks</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <Label htmlFor=\"text\">\n                Enter text and use *blank* to mark where blanks should appear\n              </Label>\n              <Textarea\n                id=\"text\"\n                value={text}\n                onChange={(e) => setText(e.target.value)}\n                placeholder=\"Example: The capital of France is *blank*.\"\n                className=\"min-h-32 mt-2\"\n                data-testid=\"textarea-text\"\n              />\n              <p className=\"text-sm text-muted-foreground mt-2\">\n                Blanks detected: {(text.match(/\\*blank\\*/g) || []).length}\n              </p>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader>\n              <div className=\"flex items-center justify-between\">\n                <CardTitle>Blank Answers</CardTitle>\n                <Button onClick={addBlank} size=\"sm\" data-testid=\"button-add-blank\">\n                  <Plus className=\"h-4 w-4 mr-2\" />\n                  Add Blank\n                </Button>\n              </div>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <p className=\"text-sm text-muted-foreground\">\n                Define correct answers for each blank in order of appearance\n              </p>\n              {blanks.map((blank, idx) => (\n                <div key={blank.id} className=\"border rounded-lg p-4 space-y-3\">\n                  <div className=\"flex items-center justify-between\">\n                    <Label>Blank {idx + 1}</Label>\n                    <Button\n                      variant=\"ghost\"\n                      size=\"sm\"\n                      onClick={() => setBlanks(blanks.filter((_, i) => i !== idx))}\n                      data-testid={`button-remove-blank-${idx}`}\n                    >\n                      <Trash2 className=\"h-4 w-4\" />\n                    </Button>\n                  </div>\n                  <div>\n                    <Label>Correct Answers (comma-separated)</Label>\n                    <Input\n                      value={blank.correctAnswers.join(\", \")}\n                      onChange={(e) => {\n                        const updated = [...blanks];\n                        updated[idx] = { \n                          ...updated[idx], \n                          correctAnswers: e.target.value.split(\",\").map(a => a.trim()).filter(Boolean)\n                        };\n                        setBlanks(updated);\n                      }}\n                      placeholder=\"Paris, paris\"\n                      data-testid={`input-answers-${idx}`}\n                    />\n                  </div>\n                  <div>\n                    <Label>Hint (optional)</Label>\n                    <Input\n                      value={blank.showHint || \"\"}\n                      onChange={(e) => {\n                        const updated = [...blanks];\n                        updated[idx] = { ...updated[idx], showHint: e.target.value };\n                        setBlanks(updated);\n                      }}\n                      placeholder=\"Starts with 'P'\"\n                      data-testid={`input-hint-${idx}`}\n                    />\n                  </div>\n                </div>\n              ))}\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader>\n              <CardTitle>Settings</CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <div className=\"flex items-center justify-between\">\n                <Label>Case sensitive answers</Label>\n                <Switch\n                  checked={settings.caseSensitive}\n                  onCheckedChange={(checked) => setSettings({ ...settings, caseSensitive: checked })}\n                  data-testid=\"switch-case-sensitive\"\n                />\n              </div>\n              <div className=\"flex items-center justify-between\">\n                <Label>Show hints</Label>\n                <Switch\n                  checked={settings.showHints}\n                  onCheckedChange={(checked) => setSettings({ ...settings, showHints: checked })}\n                  data-testid=\"switch-show-hints\"\n                />\n              </div>\n              <div className=\"flex items-center justify-between\">\n                <Label>Allow retry</Label>\n                <Switch\n                  checked={settings.allowRetry}\n                  onCheckedChange={(checked) => setSettings({ ...settings, allowRetry: checked })}\n                  data-testid=\"switch-allow-retry\"\n                />\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n\n      {showAIModal && (\n        <AIGenerationModal\n          contentType=\"fill-blanks\"\n          onClose={() => setShowAIModal(false)}\n          onGenerated={handleAIGenerated}\n        />\n      )}\n    </div>\n  );\n}\n","size_bytes":12680},"client/src/pages/InteractiveBookCreator.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useParams, useLocation } from \"wouter\";\nimport { Breadcrumbs } from \"@/components/Breadcrumbs\";\nimport { useBreadcrumbs } from \"@/hooks/useBreadcrumbs\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { RichTextEditor } from \"@/components/RichTextEditor\";\nimport { AIGenerationModal } from \"@/components/AIGenerationModal\";\nimport { ArrowLeft, Plus, Trash2, Globe, ChevronLeft, ChevronRight, Layers, X, Sparkles, Save } from \"lucide-react\";\nimport type { H5pContent, InteractiveBookData, ContentType } from \"@shared/schema\";\nimport ShareToClassroomDialog from \"@/components/ShareToClassroomDialog\";\n\nexport default function InteractiveBookCreator() {\n  const params = useParams();\n  const [_, navigate] = useLocation();\n  const { toast } = useToast();\n  const contentId = params.id;\n  const breadcrumbs = useBreadcrumbs(contentId);\n  const isEditing = !!contentId;\n\n  const [title, setTitle] = useState(\"\");\n  const [description, setDescription] = useState(\"\");\n  const [pages, setPages] = useState<InteractiveBookData[\"pages\"]>([]);\n  const [currentPageIndex, setCurrentPageIndex] = useState(0);\n  const [settings, setSettings] = useState({\n    showNavigation: true,\n    showProgress: true,\n    requireCompletion: false,\n  });\n  const [isPublished, setIsPublished] = useState(false);\n  const [isPublic, setIsPublic] = useState(false);\n  const [showEmbedDialog, setShowEmbedDialog] = useState(false);\n  const [showAIModal, setShowAIModal] = useState(false);\n\n  const { data: content } = useQuery<H5pContent>({\n    queryKey: [\"/api/content\", contentId],\n    enabled: isEditing,\n  });\n\n  const { data: availableContent } = useQuery<H5pContent[]>({\n    queryKey: [\"/api/content\"],\n  });\n\n  useEffect(() => {\n    if (content && content.type === \"interactive-book\") {\n      setTitle(content.title);\n      setDescription(content.description || \"\");\n      const data = content.data as InteractiveBookData;\n      setPages(data.pages || []);\n      setSettings(data.settings || settings);\n      setIsPublished(content.isPublished);\n      setIsPublic(content.isPublic || false);\n    }\n  }, [content]);\n\n  const saveMutation = useMutation({\n    mutationFn: async (publish: boolean = false) => {\n      const data: InteractiveBookData = { pages, settings };\n      \n      if (isEditing) {\n        const response = await apiRequest(\"PUT\", `/api/content/${contentId}`, {\n          title, description, data, isPublished: publish, isPublic,\n        });\n        return await response.json();\n      } else {\n        const response = await apiRequest(\"POST\", \"/api/content\", {\n          title, description, type: \"interactive-book\", data, isPublished: publish, isPublic,\n        });\n        return await response.json();\n      }\n    },\n    onSuccess: (data) => {\n      // Only invalidate the list queries, not the current content\n      queryClient.invalidateQueries({ \n        queryKey: [\"/api/content\"],\n        exact: true,\n      });\n      queryClient.invalidateQueries({ queryKey: [\"/api/content/public\"] });\n      if (!isEditing) navigate(`/create/interactive-book/${data.id}`);\n      toast({\n        title: \"Saved successfully!\",\n        description: \"Your interactive book has been saved.\",\n      });\n    },\n    onError: (error) => {\n      toast({\n        title: \"Failed to save\",\n        description: \"There was an error saving your book. Please try again.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const addPage = () => {\n    setPages([...pages, {\n      id: Date.now().toString(),\n      title: \"\",\n      content: \"\",\n    }]);\n  };\n\n  const embedContent = (selectedContent: H5pContent) => {\n    const updated = [...pages];\n    updated[currentPageIndex] = {\n      ...updated[currentPageIndex],\n      embeddedContentId: selectedContent.id,\n    };\n    setPages(updated);\n    setShowEmbedDialog(false);\n    toast({ title: \"Embedded!\", description: `${selectedContent.title} has been embedded in this page.` });\n  };\n\n  const removeEmbeddedContent = () => {\n    const updated = [...pages];\n    updated[currentPageIndex] = {\n      ...updated[currentPageIndex],\n      embeddedContentId: undefined,\n      embeddedContent: undefined,\n    };\n    setPages(updated);\n    toast({ title: \"Removed\", description: \"Embedded content has been removed from this page.\" });\n  };\n\n  const getContentTypeLabel = (type: ContentType) => {\n    const labels: Record<ContentType, string> = {\n      \"quiz\": \"Quiz\",\n      \"flashcard\": \"Flashcard\",\n      \"interactive-video\": \"Interactive Video\",\n      \"image-hotspot\": \"Image Hotspot\",\n      \"drag-drop\": \"Drag & Drop\",\n      \"fill-blanks\": \"Fill in the Blanks\",\n      \"memory-game\": \"Memory Game\",\n      \"interactive-book\": \"Interactive Book\",\n      \"video-finder\": \"Video Finder\",\n      \"google-slides\": \"Google Slides\",\n    };\n    return labels[type] || type;\n  };\n\n  const handleAIGenerated = (data: any) => {\n    if (!data.pages || !Array.isArray(data.pages)) {\n      toast({\n        title: \"Error\",\n        description: \"Invalid response from AI. Please try again.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    try {\n      const validPages = data.pages.filter((page: any) => \n        page != null && typeof page === 'object'\n      );\n\n      if (validPages.length === 0) {\n        toast({\n          title: \"Error\",\n          description: \"No valid pages generated. Please try again.\",\n          variant: \"destructive\",\n        });\n        return;\n      }\n\n      const normalizedPages = validPages.map((page: any, index: number) => ({\n        id: page.id || `page-${Date.now()}-${index}`,\n        title: String(page.title ?? \"Untitled Page\").trim(),\n        content: String(page.content ?? \"\").trim(),\n      }));\n      \n      setPages(prev => {\n        const firstNewPageIndex = prev.length;\n        setCurrentPageIndex(firstNewPageIndex);\n        return [...prev, ...normalizedPages];\n      });\n      \n      setShowAIModal(false);\n      toast({ \n        title: \"Pages Generated!\", \n        description: `${normalizedPages.length} pages have been added to your book.` \n      });\n    } catch (error) {\n      toast({\n        title: \"Error\",\n        description: \"Failed to process AI response. Please try again.\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      <div className=\"border-b\">\n        <div className=\"container mx-auto px-4 py-4 flex items-center justify-between\">\n          <div className=\"flex items-center gap-4\">\n            <Button variant=\"ghost\" size=\"icon\" onClick={() => navigate(\"/\")} data-testid=\"button-back\">\n              <ArrowLeft className=\"h-5 w-5\" />\n            </Button>\n            <div>\n              <h1 className=\"text-2xl font-bold\">Interactive Book</h1>\n              <p className=\"text-sm text-muted-foreground\">\n                {isEditing ? \"Editing book\" : \"Create new book\"}\n              </p>\n            </div>\n          </div>\n          <div className=\"flex items-center gap-2\">\n            <Button \n              variant=\"outline\" \n              onClick={() => setShowAIModal(true)} \n              data-testid=\"button-ai-generate\"\n            >\n              <Sparkles className=\"h-4 w-4 mr-2\" />\n              AI Generate Pages\n            </Button>\n            <Button\n              variant=\"outline\"\n              onClick={() => saveMutation.mutate(isPublished)}\n              disabled={saveMutation.isPending || !title || pages.length === 0}\n              data-testid=\"button-save\"\n            >\n              <Save className=\"h-4 w-4 mr-2\" />\n              {saveMutation.isPending ? \"Saving...\" : \"Save\"}\n            </Button>\n            {contentId && isPublished && (\n              <ShareToClassroomDialog\n                contentTitle={title}\n                contentDescription={description}\n                materialLink={`${window.location.origin}/public/${contentId}`}\n              />\n            )}\n            <Button\n              variant={isPublished ? \"default\" : \"outline\"}\n              onClick={() => {\n                setIsPublished(!isPublished);\n                saveMutation.mutate(!isPublished);\n              }}\n              data-testid=\"button-publish\"\n            >\n              <Globe className=\"h-4 w-4 mr-2\" />\n              {isPublished ? \"Published\" : \"Publish\"}\n            </Button>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"container mx-auto px-4 py-8\">\n        <div className=\"max-w-4xl mx-auto space-y-6\">\n          <Card>\n            <CardHeader>\n              <CardTitle>Basic Information</CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <div>\n                <Label htmlFor=\"title\">Title</Label>\n                <Input\n                  id=\"title\"\n                  value={title}\n                  onChange={(e) => setTitle(e.target.value)}\n                  placeholder=\"Enter book title\"\n                  data-testid=\"input-title\"\n                />\n              </div>\n              <div>\n                <Label htmlFor=\"description\">Description</Label>\n                <Input\n                  id=\"description\"\n                  value={description}\n                  onChange={(e) => setDescription(e.target.value)}\n                  placeholder=\"Enter book description\"\n                  data-testid=\"input-description\"\n                />\n              </div>\n              <div className=\"flex items-center justify-between p-4 bg-muted/50 rounded-lg\">\n                <div className=\"space-y-0.5\">\n                  <Label htmlFor=\"isPublic\" className=\"text-base\">Share as Public Resource</Label>\n                  <p className=\"text-sm text-muted-foreground\">\n                    Allow other teachers to discover and use this interactive book on the Shared Resources page. Content will be automatically published when shared.\n                  </p>\n                </div>\n                <Switch\n                  id=\"isPublic\"\n                  checked={isPublic}\n                  onCheckedChange={(checked) => {\n                    setIsPublic(checked);\n                    if (checked) {\n                      setIsPublished(true);\n                    }\n                  }}\n                  data-testid=\"switch-public\"\n                />\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader>\n              <div className=\"flex items-center justify-between\">\n                <CardTitle>Pages ({pages.length})</CardTitle>\n                <Button onClick={addPage} size=\"sm\" data-testid=\"button-add-page\">\n                  <Plus className=\"h-4 w-4 mr-2\" />\n                  Add Page\n                </Button>\n              </div>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              {pages.length > 0 && (\n                <>\n                  <div className=\"flex items-center justify-between\">\n                    <Button\n                      variant=\"outline\"\n                      size=\"sm\"\n                      onClick={() => setCurrentPageIndex(Math.max(0, currentPageIndex - 1))}\n                      disabled={currentPageIndex === 0}\n                      data-testid=\"button-prev-page\"\n                    >\n                      <ChevronLeft className=\"h-4 w-4\" />\n                    </Button>\n                    <span className=\"text-sm text-muted-foreground\">\n                      Page {currentPageIndex + 1} of {pages.length}\n                    </span>\n                    <Button\n                      variant=\"outline\"\n                      size=\"sm\"\n                      onClick={() => setCurrentPageIndex(Math.min(pages.length - 1, currentPageIndex + 1))}\n                      disabled={currentPageIndex === pages.length - 1}\n                      data-testid=\"button-next-page\"\n                    >\n                      <ChevronRight className=\"h-4 w-4\" />\n                    </Button>\n                  </div>\n\n                  {pages[currentPageIndex] && (\n                    <div className=\"border rounded-lg p-4 space-y-4\">\n                      <div className=\"flex items-center justify-between\">\n                        <Label>Editing Page {currentPageIndex + 1}</Label>\n                        <Button\n                          variant=\"ghost\"\n                          size=\"sm\"\n                          onClick={() => {\n                            setPages(pages.filter((_, i) => i !== currentPageIndex));\n                            setCurrentPageIndex(Math.max(0, currentPageIndex - 1));\n                          }}\n                          data-testid={`button-remove-page-${currentPageIndex}`}\n                        >\n                          <Trash2 className=\"h-4 w-4\" />\n                        </Button>\n                      </div>\n                      <div>\n                        <Label>Page Title</Label>\n                        <Input\n                          value={pages[currentPageIndex].title}\n                          onChange={(e) => {\n                            const updated = [...pages];\n                            updated[currentPageIndex] = { ...updated[currentPageIndex], title: e.target.value };\n                            setPages(updated);\n                          }}\n                          placeholder=\"Page title\"\n                          data-testid={`input-page-title-${currentPageIndex}`}\n                        />\n                      </div>\n                      <div>\n                        <Label>Page Content</Label>\n                        <RichTextEditor\n                          key={`editor-${currentPageIndex}-${pages[currentPageIndex].id}`}\n                          content={pages[currentPageIndex].content}\n                          onChange={(html) => {\n                            const updated = [...pages];\n                            updated[currentPageIndex] = { ...updated[currentPageIndex], content: html };\n                            setPages(updated);\n                          }}\n                          placeholder=\"Write your page content here. Use the toolbar to format text and add images...\"\n                        />\n                      </div>\n\n                      <div>\n                        <div className=\"flex items-center justify-between mb-2\">\n                          <Label>Interactive Content (Optional)</Label>\n                          {!pages[currentPageIndex].embeddedContentId && !pages[currentPageIndex].embeddedContent && (\n                            <Dialog open={showEmbedDialog} onOpenChange={setShowEmbedDialog}>\n                              <DialogTrigger asChild>\n                                <Button variant=\"outline\" size=\"sm\" data-testid=\"button-embed-content\">\n                                  <Layers className=\"h-4 w-4 mr-2\" />\n                                  Embed Content\n                                </Button>\n                              </DialogTrigger>\n                              <DialogContent className=\"max-w-2xl max-h-[80vh] overflow-y-auto\">\n                                <DialogHeader>\n                                  <DialogTitle>Select Content to Embed</DialogTitle>\n                                </DialogHeader>\n                                <div className=\"space-y-2\">\n                                  {availableContent?.filter(c => c.type !== \"interactive-book\" && c.id !== contentId).map((c) => (\n                                    <Card\n                                      key={c.id}\n                                      className=\"cursor-pointer hover-elevate\"\n                                      onClick={() => embedContent(c)}\n                                      data-testid={`embed-option-${c.id}`}\n                                    >\n                                      <CardContent className=\"p-4 flex items-center justify-between\">\n                                        <div>\n                                          <h4 className=\"font-medium\">{c.title}</h4>\n                                          <p className=\"text-sm text-muted-foreground\">{getContentTypeLabel(c.type as ContentType)}</p>\n                                        </div>\n                                      </CardContent>\n                                    </Card>\n                                  ))}\n                                  {(!availableContent || availableContent.filter(c => c.type !== \"interactive-book\").length === 0) && (\n                                    <p className=\"text-sm text-muted-foreground text-center py-4\">\n                                      No content available to embed. Create some quizzes, flashcards, or other interactive content first!\n                                    </p>\n                                  )}\n                                </div>\n                              </DialogContent>\n                            </Dialog>\n                          )}\n                        </div>\n                        {(pages[currentPageIndex].embeddedContentId || pages[currentPageIndex].embeddedContent) && (\n                          <Card className=\"bg-accent/10\">\n                            <CardContent className=\"p-4 flex items-center justify-between\">\n                              <div>\n                                <p className=\"font-medium text-sm\">\n                                  Embedded: {\n                                    pages[currentPageIndex].embeddedContentId \n                                      ? (availableContent?.find(c => c.id === pages[currentPageIndex].embeddedContentId)?.title || \"Content\")\n                                      : (pages[currentPageIndex].embeddedContent ? `${getContentTypeLabel(pages[currentPageIndex].embeddedContent!.type as ContentType)} (Legacy)` : \"Content\")\n                                  }\n                                </p>\n                                <p className=\"text-xs text-muted-foreground\">This interactive element will appear after the page content</p>\n                              </div>\n                              <Button\n                                variant=\"ghost\"\n                                size=\"sm\"\n                                onClick={removeEmbeddedContent}\n                                data-testid=\"button-remove-embedded-content\"\n                              >\n                                <X className=\"h-4 w-4\" />\n                              </Button>\n                            </CardContent>\n                          </Card>\n                        )}\n                      </div>\n                    </div>\n                  )}\n                </>\n              )}\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader>\n              <CardTitle>Settings</CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <div className=\"flex items-center justify-between\">\n                <Label>Show navigation</Label>\n                <Switch\n                  checked={settings.showNavigation}\n                  onCheckedChange={(checked) => setSettings({ ...settings, showNavigation: checked })}\n                  data-testid=\"switch-show-navigation\"\n                />\n              </div>\n              <div className=\"flex items-center justify-between\">\n                <Label>Show progress</Label>\n                <Switch\n                  checked={settings.showProgress}\n                  onCheckedChange={(checked) => setSettings({ ...settings, showProgress: checked })}\n                  data-testid=\"switch-show-progress\"\n                />\n              </div>\n              <div className=\"flex items-center justify-between\">\n                <Label>Require completion to proceed</Label>\n                <Switch\n                  checked={settings.requireCompletion}\n                  onCheckedChange={(checked) => setSettings({ ...settings, requireCompletion: checked })}\n                  data-testid=\"switch-require-completion\"\n                />\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n\n      <AIGenerationModal\n        open={showAIModal}\n        onOpenChange={setShowAIModal}\n        contentType=\"interactive-book\"\n        onGenerated={handleAIGenerated}\n      />\n    </div>\n  );\n}\n","size_bytes":20845},"client/src/pages/DragDropCreator.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useParams, useLocation } from \"wouter\";\nimport { Breadcrumbs } from \"@/components/Breadcrumbs\";\nimport { useBreadcrumbs } from \"@/hooks/useBreadcrumbs\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { AIGenerationModal } from \"@/components/AIGenerationModal\";\nimport { ArrowLeft, Sparkles, Plus, Trash2, Globe } from \"lucide-react\";\nimport type { H5pContent, DragAndDropData } from \"@shared/schema\";\nimport ShareToClassroomDialog from \"@/components/ShareToClassroomDialog\";\n\nexport default function DragDropCreator() {\n  const params = useParams();\n  const [_, navigate] = useLocation();\n  const { toast } = useToast();\n  const contentId = params.id;\n  const breadcrumbs = useBreadcrumbs(contentId);\n  const isEditing = !!contentId;\n\n  const [title, setTitle] = useState(\"\");\n  const [description, setDescription] = useState(\"\");\n  const [items, setItems] = useState<DragAndDropData[\"items\"]>([]);\n  const [zones, setZones] = useState<DragAndDropData[\"zones\"]>([]);\n  const [settings, setSettings] = useState({\n    showZoneLabels: true,\n    instantFeedback: true,\n    allowRetry: true,\n  });\n  const [isPublished, setIsPublished] = useState(false);\n  const [isPublic, setIsPublic] = useState(false);\n  const [showAIModal, setShowAIModal] = useState(false);\n  const [isSaving, setIsSaving] = useState(false);\n\n  const { data: content } = useQuery<H5pContent>({\n    queryKey: [\"/api/content\", contentId],\n    enabled: isEditing,\n  });\n\n  useEffect(() => {\n    if (content && content.type === \"drag-drop\") {\n      setTitle(content.title);\n      setDescription(content.description || \"\");\n      const data = content.data as DragAndDropData;\n      setItems(data.items || []);\n      setZones(data.zones || []);\n      setSettings(data.settings || settings);\n      setIsPublished(content.isPublished);\n      setIsPublic(content.isPublic || false);\n    }\n  }, [content]);\n\n  const saveMutation = useMutation({\n    mutationFn: async (publish: boolean = false) => {\n      const data: DragAndDropData = { items, zones, settings };\n      \n      if (isEditing) {\n        const response = await apiRequest(\"PUT\", `/api/content/${contentId}`, {\n          title, description, data, isPublished: publish, isPublic,\n        });\n        return await response.json();\n      } else {\n        const response = await apiRequest(\"POST\", \"/api/content\", {\n          title, description, type: \"drag-drop\", data, isPublished: publish, isPublic,\n        });\n        return await response.json();\n      }\n    },\n    onSuccess: (data) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/content\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/content/public\"] });\n      if (!isEditing) navigate(`/create/drag-drop/${data.id}`);\n      toast({ title: \"Saved!\", description: \"Drag & Drop activity saved successfully.\" });\n      setIsSaving(false);\n    },\n  });\n\n  useEffect(() => {\n    if (!title || items.length === 0 || zones.length === 0) return;\n    const timer = setTimeout(() => {\n      setIsSaving(true);\n      saveMutation.mutate(isPublished);\n    }, 2000);\n    return () => clearTimeout(timer);\n  }, [title, description, items, zones, settings, isPublic]);\n\n  const addZone = () => {\n    setZones([...zones, {\n      id: Date.now().toString(),\n      label: \"\",\n      allowMultiple: true,\n    }]);\n  };\n\n  const addItem = () => {\n    setItems([...items, {\n      id: Date.now().toString(),\n      content: \"\",\n      correctZone: zones[0]?.id || \"\",\n    }]);\n  };\n\n  const handleAIGenerated = (data: any) => {\n    if (data.zones) setZones(data.zones);\n    if (data.items) setItems(data.items);\n    setShowAIModal(false);\n  };\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      <div className=\"border-b\">\n        <div className=\"container mx-auto px-4 py-4 flex items-center justify-between\">\n          <div className=\"flex items-center gap-4\">\n            <Button variant=\"ghost\" size=\"icon\" onClick={() => navigate(\"/\")} data-testid=\"button-back\">\n              <ArrowLeft className=\"h-5 w-5\" />\n            </Button>\n            <div>\n              <h1 className=\"text-2xl font-bold\">Drag & Drop Activity</h1>\n              <p className=\"text-sm text-muted-foreground\">\n                {isSaving ? \"Saving...\" : isEditing ? \"Editing activity\" : \"Create new activity\"}\n              </p>\n            </div>\n          </div>\n          <div className=\"flex items-center gap-2\">\n            <Button variant=\"outline\" onClick={() => setShowAIModal(true)} data-testid=\"button-ai-generate\">\n              <Sparkles className=\"h-4 w-4 mr-2\" />\n              AI Generate\n            </Button>\n            {contentId && isPublished && (\n              <ShareToClassroomDialog\n                contentTitle={title}\n                contentDescription={description}\n                materialLink={`${window.location.origin}/public/${contentId}`}\n              />\n            )}\n            <Button\n              variant={isPublished ? \"default\" : \"outline\"}\n              onClick={() => {\n                setIsPublished(!isPublished);\n                saveMutation.mutate(!isPublished);\n              }}\n              data-testid=\"button-publish\"\n            >\n              <Globe className=\"h-4 w-4 mr-2\" />\n              {isPublished ? \"Published\" : \"Publish\"}\n            </Button>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"container mx-auto px-4 py-8\">\n        <div className=\"max-w-4xl mx-auto space-y-6\">\n          <Card>\n            <CardHeader>\n              <CardTitle>Basic Information</CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <div>\n                <Label htmlFor=\"title\">Title</Label>\n                <Input\n                  id=\"title\"\n                  value={title}\n                  onChange={(e) => setTitle(e.target.value)}\n                  placeholder=\"Enter activity title\"\n                  data-testid=\"input-title\"\n                />\n              </div>\n              <div>\n                <Label htmlFor=\"description\">Description</Label>\n                <Input\n                  id=\"description\"\n                  value={description}\n                  onChange={(e) => setDescription(e.target.value)}\n                  placeholder=\"Enter activity description\"\n                  data-testid=\"input-description\"\n                />\n              </div>\n              <div className=\"flex items-center justify-between p-4 bg-muted/50 rounded-lg\">\n                <div className=\"space-y-0.5\">\n                  <Label htmlFor=\"isPublic\" className=\"text-base\">Share as Public Resource</Label>\n                  <p className=\"text-sm text-muted-foreground\">\n                    Allow other teachers to discover and use this drag & drop activity on the Shared Resources page. Content will be automatically published when shared.\n                  </p>\n                </div>\n                <Switch\n                  id=\"isPublic\"\n                  checked={isPublic}\n                  onCheckedChange={(checked) => {\n                    setIsPublic(checked);\n                    if (checked) {\n                      setIsPublished(true);\n                    }\n                  }}\n                  data-testid=\"switch-public\"\n                />\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader>\n              <div className=\"flex items-center justify-between\">\n                <CardTitle>Drop Zones</CardTitle>\n                <Button onClick={addZone} size=\"sm\" data-testid=\"button-add-zone\">\n                  <Plus className=\"h-4 w-4 mr-2\" />\n                  Add Zone\n                </Button>\n              </div>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              {zones.map((zone, idx) => (\n                <div key={zone.id} className=\"border rounded-lg p-4 space-y-3\">\n                  <div className=\"flex items-center justify-between\">\n                    <Label>Zone {idx + 1}</Label>\n                    <Button\n                      variant=\"ghost\"\n                      size=\"sm\"\n                      onClick={() => setZones(zones.filter((_, i) => i !== idx))}\n                      data-testid={`button-remove-zone-${idx}`}\n                    >\n                      <Trash2 className=\"h-4 w-4\" />\n                    </Button>\n                  </div>\n                  <Input\n                    value={zone.label}\n                    onChange={(e) => {\n                      const updated = [...zones];\n                      updated[idx] = { ...updated[idx], label: e.target.value };\n                      setZones(updated);\n                    }}\n                    placeholder=\"Zone label\"\n                    data-testid={`input-zone-label-${idx}`}\n                  />\n                  <div className=\"flex items-center gap-2\">\n                    <Switch\n                      checked={zone.allowMultiple}\n                      onCheckedChange={(checked) => {\n                        const updated = [...zones];\n                        updated[idx] = { ...updated[idx], allowMultiple: checked };\n                        setZones(updated);\n                      }}\n                      data-testid={`switch-allow-multiple-${idx}`}\n                    />\n                    <Label>Allow multiple items</Label>\n                  </div>\n                </div>\n              ))}\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader>\n              <div className=\"flex items-center justify-between\">\n                <CardTitle>Draggable Items</CardTitle>\n                <Button onClick={addItem} size=\"sm\" disabled={zones.length === 0} data-testid=\"button-add-item\">\n                  <Plus className=\"h-4 w-4 mr-2\" />\n                  Add Item\n                </Button>\n              </div>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              {items.map((item, idx) => (\n                <div key={item.id} className=\"border rounded-lg p-4 space-y-3\">\n                  <div className=\"flex items-center justify-between\">\n                    <Label>Item {idx + 1}</Label>\n                    <Button\n                      variant=\"ghost\"\n                      size=\"sm\"\n                      onClick={() => setItems(items.filter((_, i) => i !== idx))}\n                      data-testid={`button-remove-item-${idx}`}\n                    >\n                      <Trash2 className=\"h-4 w-4\" />\n                    </Button>\n                  </div>\n                  <Input\n                    value={item.content}\n                    onChange={(e) => {\n                      const updated = [...items];\n                      updated[idx] = { ...updated[idx], content: e.target.value };\n                      setItems(updated);\n                    }}\n                    placeholder=\"Item content\"\n                    data-testid={`input-item-content-${idx}`}\n                  />\n                  <div>\n                    <Label>Correct Zone</Label>\n                    <select\n                      className=\"w-full border rounded-md p-2\"\n                      value={item.correctZone}\n                      onChange={(e) => {\n                        const updated = [...items];\n                        updated[idx] = { ...updated[idx], correctZone: e.target.value };\n                        setItems(updated);\n                      }}\n                      data-testid={`select-correct-zone-${idx}`}\n                    >\n                      {zones.map((zone) => (\n                        <option key={zone.id} value={zone.id}>\n                          {zone.label || `Zone ${zones.indexOf(zone) + 1}`}\n                        </option>\n                      ))}\n                    </select>\n                  </div>\n                </div>\n              ))}\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader>\n              <CardTitle>Settings</CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <div className=\"flex items-center justify-between\">\n                <Label>Show zone labels</Label>\n                <Switch\n                  checked={settings.showZoneLabels}\n                  onCheckedChange={(checked) => setSettings({ ...settings, showZoneLabels: checked })}\n                  data-testid=\"switch-show-zone-labels\"\n                />\n              </div>\n              <div className=\"flex items-center justify-between\">\n                <Label>Instant feedback</Label>\n                <Switch\n                  checked={settings.instantFeedback}\n                  onCheckedChange={(checked) => setSettings({ ...settings, instantFeedback: checked })}\n                  data-testid=\"switch-instant-feedback\"\n                />\n              </div>\n              <div className=\"flex items-center justify-between\">\n                <Label>Allow retry</Label>\n                <Switch\n                  checked={settings.allowRetry}\n                  onCheckedChange={(checked) => setSettings({ ...settings, allowRetry: checked })}\n                  data-testid=\"switch-allow-retry\"\n                />\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n\n      {showAIModal && (\n        <AIGenerationModal\n          contentType=\"drag-drop\"\n          onClose={() => setShowAIModal(false)}\n          onGenerated={handleAIGenerated}\n        />\n      )}\n    </div>\n  );\n}\n","size_bytes":13961},"client/src/components/players/FillBlanksPlayer.tsx":{"content":"import { useState, useEffect, useRef } from \"react\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { CheckCircle2, XCircle, RotateCcw, HelpCircle } from \"lucide-react\";\nimport type { FillInBlanksData } from \"@shared/schema\";\nimport { useProgressTracker } from \"@/hooks/use-progress-tracker\";\n\ntype FillBlanksPlayerProps = {\n  data: FillInBlanksData;\n  contentId: string;\n};\n\nexport function FillBlanksPlayer({ data, contentId }: FillBlanksPlayerProps) {\n  const [answers, setAnswers] = useState<string[]>(new Array(data.blanks.length).fill(\"\"));\n  const [feedback, setFeedback] = useState<boolean[]>([]);\n  const [showResults, setShowResults] = useState(false);\n  const [showHints, setShowHints] = useState<boolean[]>(new Array(data.blanks.length).fill(false));\n\n  const { progress: savedProgress, isProgressFetched, updateProgress, logInteraction, isAuthenticated } = useProgressTracker(contentId);\n  const [lastSentProgress, setLastSentProgress] = useState<number>(-1);\n  const [isProgressInitialized, setIsProgressInitialized] = useState(false);\n  const pendingMilestoneRef = useRef<number | null>(null);\n  const pendingTimeoutRef = useRef<NodeJS.Timeout | null>(null);\n  const previousAuthRef = useRef<boolean>(isAuthenticated);\n\n  useEffect(() => {\n    if (!previousAuthRef.current && isAuthenticated) {\n      setIsProgressInitialized(false);\n      setLastSentProgress(-1);\n      pendingMilestoneRef.current = null;\n      if (pendingTimeoutRef.current) {\n        clearTimeout(pendingTimeoutRef.current);\n        pendingTimeoutRef.current = null;\n      }\n    }\n    previousAuthRef.current = isAuthenticated;\n  }, [isAuthenticated]);\n\n  useEffect(() => {\n    if (!isProgressInitialized) {\n      if (!isAuthenticated) {\n        setIsProgressInitialized(true);\n      } else if (isProgressFetched) {\n        if (savedProgress) {\n          setLastSentProgress(savedProgress.completionPercentage);\n        }\n        setIsProgressInitialized(true);\n      }\n    } else if (savedProgress) {\n      setLastSentProgress(prev => Math.max(prev, savedProgress.completionPercentage));\n      if (pendingMilestoneRef.current !== null && savedProgress.completionPercentage >= pendingMilestoneRef.current) {\n        pendingMilestoneRef.current = null;\n        if (pendingTimeoutRef.current) {\n          clearTimeout(pendingTimeoutRef.current);\n          pendingTimeoutRef.current = null;\n        }\n      }\n    }\n  }, [savedProgress, isProgressFetched, isAuthenticated, isProgressInitialized]);\n\n  useEffect(() => {\n    if (!isProgressInitialized || !isAuthenticated) return;\n\n    const filledCount = answers.filter(a => a.trim() !== \"\").length;\n    if (filledCount > 0 && data.blanks.length > 0) {\n      const completionPercentage = Math.round((filledCount / data.blanks.length) * 100);\n      if (completionPercentage > lastSentProgress && completionPercentage !== pendingMilestoneRef.current) {\n        pendingMilestoneRef.current = completionPercentage;\n        updateProgress(completionPercentage);\n        if (pendingTimeoutRef.current) {\n          clearTimeout(pendingTimeoutRef.current);\n        }\n        pendingTimeoutRef.current = setTimeout(() => {\n          pendingMilestoneRef.current = null;\n          pendingTimeoutRef.current = null;\n        }, 5000);\n      }\n    }\n  }, [answers, lastSentProgress, isProgressInitialized, isAuthenticated]);\n\n  const checkAnswers = () => {\n    const newFeedback = answers.map((answer, idx) => {\n      const blank = data.blanks[idx];\n      const userAnswer = data.settings.caseSensitive ? answer.trim() : answer.trim().toLowerCase();\n      return blank.correctAnswers.some(correctAnswer => {\n        const correct = data.settings.caseSensitive ? correctAnswer.trim() : correctAnswer.trim().toLowerCase();\n        return userAnswer === correct;\n      });\n    });\n    setFeedback(newFeedback);\n    setShowResults(true);\n\n    const correct = newFeedback.filter(Boolean).length;\n    logInteraction(\"check_answers\", {\n      score: correct,\n      total: data.blanks.length,\n    });\n  };\n\n  const reset = () => {\n    setAnswers(new Array(data.blanks.length).fill(\"\"));\n    setFeedback([]);\n    setShowResults(false);\n    setShowHints(new Array(data.blanks.length).fill(false));\n  };\n\n  const renderTextWithBlanks = () => {\n    const parts = data.text.split(/\\*blank\\*/i);\n    const result: JSX.Element[] = [];\n\n    parts.forEach((part, idx) => {\n      result.push(<span key={`text-${idx}`}>{part}</span>);\n      if (idx < data.blanks.length) {\n        result.push(\n          <span key={`blank-${idx}`} className=\"inline-flex flex-col gap-1 mx-1\">\n            <div className=\"inline-flex items-center gap-2\">\n              <Input\n                value={answers[idx]}\n                onChange={(e) => {\n                  const newAnswers = [...answers];\n                  newAnswers[idx] = e.target.value;\n                  setAnswers(newAnswers);\n                }}\n                className={`w-32 inline-block ${\n                  feedback[idx] !== undefined\n                    ? feedback[idx]\n                      ? \"border-green-500\"\n                      : \"border-destructive\"\n                    : \"\"\n                }`}\n                disabled={showResults && !data.settings.allowRetry}\n                data-testid={`input-blank-${idx}`}\n              />\n              {feedback[idx] !== undefined && (\n                feedback[idx] ? (\n                  <CheckCircle2 className=\"h-4 w-4 text-green-500\" data-testid={`correct-${idx}`} />\n                ) : (\n                  <XCircle className=\"h-4 w-4 text-destructive\" data-testid={`incorrect-${idx}`} />\n                )\n              )}\n              {data.settings.showHints && data.blanks[idx].showHint && (\n                <Button\n                  variant=\"ghost\"\n                  size=\"sm\"\n                  onClick={() => {\n                    const newHints = [...showHints];\n                    newHints[idx] = !newHints[idx];\n                    setShowHints(newHints);\n                  }}\n                  data-testid={`button-hint-${idx}`}\n                >\n                  <HelpCircle className=\"h-4 w-4\" />\n                </Button>\n              )}\n            </div>\n            {showHints[idx] && data.blanks[idx].showHint && (\n              <span className=\"text-xs text-muted-foreground italic\" data-testid={`hint-${idx}`}>\n                Hint: {data.blanks[idx].showHint}\n              </span>\n            )}\n          </span>\n        );\n      }\n    });\n\n    return result;\n  };\n\n  const score = feedback.filter(Boolean).length;\n  const total = data.blanks.length;\n  const completionPercentage = answers.filter(a => a.trim() !== \"\").length > 0 \n    ? (answers.filter(a => a.trim() !== \"\").length / total) * 100 \n    : 0;\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <Progress value={completionPercentage} className=\"w-48\" data-testid=\"progress-bar\" />\n          <p className=\"text-sm text-muted-foreground mt-1\">\n            {answers.filter(a => a.trim() !== \"\").length} of {total} blanks filled\n          </p>\n        </div>\n        <div className=\"flex gap-2\">\n          {!showResults && (\n            <Button \n              onClick={checkAnswers} \n              disabled={answers.some(a => a.trim() === \"\")}\n              data-testid=\"button-check\"\n            >\n              Check Answers\n            </Button>\n          )}\n          {showResults && data.settings.allowRetry && (\n            <Button onClick={reset} variant=\"outline\" data-testid=\"button-retry\">\n              <RotateCcw className=\"h-4 w-4 mr-2\" />\n              Try Again\n            </Button>\n          )}\n        </div>\n      </div>\n\n      {showResults && (\n        <Card>\n          <CardContent className=\"pt-6\">\n            <div className=\"text-center\">\n              <p className=\"text-2xl font-bold\">\n                Score: {score}/{total}\n              </p>\n              <p className=\"text-muted-foreground\">\n                {score === total ? \"Perfect! Well done!\" : `You got ${score} out of ${total} correct.`}\n              </p>\n            </div>\n          </CardContent>\n        </Card>\n      )}\n\n      <Card>\n        <CardContent className=\"p-6\">\n          <div className=\"text-lg leading-relaxed\">\n            {renderTextWithBlanks()}\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":8607},"client/src/components/players/InteractiveBookPlayer.tsx":{"content":"import { useState, useEffect, useRef } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport DOMPurify from \"dompurify\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { ChevronLeft, ChevronRight, BookOpen, Check } from \"lucide-react\";\nimport type { InteractiveBookData, H5pContent } from \"@shared/schema\";\nimport { useProgressTracker } from \"@/hooks/use-progress-tracker\";\nimport { QuizPlayer } from \"./QuizPlayer\";\nimport { FlashcardPlayer } from \"./FlashcardPlayer\";\nimport { VideoPlayer } from \"./VideoPlayer\";\nimport { ImageHotspotPlayer } from \"./ImageHotspotPlayer\";\nimport { DragDropPlayer } from \"./DragDropPlayer\";\nimport { FillBlanksPlayer } from \"./FillBlanksPlayer\";\nimport { MemoryGamePlayer } from \"./MemoryGamePlayer\";\n\ntype InteractiveBookPlayerProps = {\n  data: InteractiveBookData;\n  contentId: string;\n};\n\nexport function InteractiveBookPlayer({ data, contentId }: InteractiveBookPlayerProps) {\n  const [currentPageIndex, setCurrentPageIndex] = useState(0);\n  const [viewedPages, setViewedPages] = useState<Set<number>>(new Set([0]));\n\n  const currentPage = data.pages[currentPageIndex];\n  \n  const { data: embeddedContent, isLoading: isLoadingEmbedded, error: embeddedError } = useQuery<H5pContent>({\n    queryKey: [\"/api/content\", currentPage.embeddedContentId],\n    enabled: !!currentPage.embeddedContentId,\n  });\n\n  const hasLegacySnapshot = !!currentPage.embeddedContent;\n  const shouldUseFetched = embeddedContent && !embeddedError;\n  const shouldFallbackToLegacy = hasLegacySnapshot && (!currentPage.embeddedContentId || embeddedError || (!isLoadingEmbedded && !embeddedContent));\n  \n  const effectiveEmbeddedData = shouldUseFetched \n    ? embeddedContent.data \n    : (shouldFallbackToLegacy ? currentPage.embeddedContent!.data : null);\n  const effectiveEmbeddedType = shouldUseFetched \n    ? embeddedContent.type \n    : (shouldFallbackToLegacy ? currentPage.embeddedContent!.type : null);\n  const effectiveEmbeddedId = shouldUseFetched \n    ? embeddedContent.id \n    : contentId;\n  const effectiveEmbeddedTitle = shouldUseFetched \n    ? embeddedContent.title \n    : \"Embedded Activity\";\n\n  const { progress: savedProgress, isProgressFetched, updateProgress, logInteraction, isAuthenticated } = useProgressTracker(contentId);\n  const [lastSentProgress, setLastSentProgress] = useState<number>(-1);\n  const [isProgressInitialized, setIsProgressInitialized] = useState(false);\n  const pendingMilestoneRef = useRef<number | null>(null);\n  const pendingTimeoutRef = useRef<NodeJS.Timeout | null>(null);\n  const previousAuthRef = useRef<boolean>(isAuthenticated);\n\n  useEffect(() => {\n    if (!previousAuthRef.current && isAuthenticated) {\n      setIsProgressInitialized(false);\n      setLastSentProgress(-1);\n      pendingMilestoneRef.current = null;\n      if (pendingTimeoutRef.current) {\n        clearTimeout(pendingTimeoutRef.current);\n        pendingTimeoutRef.current = null;\n      }\n    }\n    previousAuthRef.current = isAuthenticated;\n  }, [isAuthenticated]);\n\n  useEffect(() => {\n    if (!isProgressInitialized) {\n      if (!isAuthenticated) {\n        setIsProgressInitialized(true);\n      } else if (isProgressFetched) {\n        if (savedProgress) {\n          setLastSentProgress(savedProgress.completionPercentage);\n        }\n        setIsProgressInitialized(true);\n      }\n    } else if (savedProgress) {\n      setLastSentProgress(prev => Math.max(prev, savedProgress.completionPercentage));\n      if (pendingMilestoneRef.current !== null && savedProgress.completionPercentage >= pendingMilestoneRef.current) {\n        pendingMilestoneRef.current = null;\n        if (pendingTimeoutRef.current) {\n          clearTimeout(pendingTimeoutRef.current);\n          pendingTimeoutRef.current = null;\n        }\n      }\n    }\n  }, [savedProgress, isProgressFetched, isAuthenticated, isProgressInitialized]);\n\n  useEffect(() => {\n    if (!isProgressInitialized || !isAuthenticated) return;\n\n    if (viewedPages.size > 0 && data.pages.length > 0) {\n      const completionPercentage = Math.round((viewedPages.size / data.pages.length) * 100);\n      if (completionPercentage > lastSentProgress && completionPercentage !== pendingMilestoneRef.current) {\n        pendingMilestoneRef.current = completionPercentage;\n        updateProgress(completionPercentage);\n        if (pendingTimeoutRef.current) {\n          clearTimeout(pendingTimeoutRef.current);\n        }\n        pendingTimeoutRef.current = setTimeout(() => {\n          pendingMilestoneRef.current = null;\n          pendingTimeoutRef.current = null;\n        }, 5000);\n      }\n    }\n  }, [viewedPages.size, lastSentProgress, isProgressInitialized, isAuthenticated]);\n\n  const goToPage = (index: number) => {\n    if (index >= 0 && index < data.pages.length) {\n      setCurrentPageIndex(index);\n      setViewedPages(prev => new Set(prev).add(index));\n      logInteraction(\"page_viewed\", { pageIndex: index });\n    }\n  };\n\n  const completionPercentage = (viewedPages.size / data.pages.length) * 100;\n\n  return (\n    <div className=\"flex gap-6\">\n      {/* Sidebar - Desktop Only */}\n      <aside className=\"hidden lg:block w-64 flex-shrink-0\">\n        <Card className=\"sticky top-4\">\n          <CardContent className=\"p-4\">\n            <h3 className=\"text-sm font-semibold mb-3\">Table of Contents</h3>\n            {data.settings.showProgress && (\n              <div className=\"mb-4\">\n                <div className=\"flex items-center justify-between mb-2\">\n                  <span className=\"text-xs text-muted-foreground\">Progress</span>\n                  <span className=\"text-xs text-muted-foreground\">\n                    {viewedPages.size}/{data.pages.length}\n                  </span>\n                </div>\n                <Progress value={completionPercentage} className=\"h-1\" data-testid=\"progress-bar\" />\n              </div>\n            )}\n            <nav className=\"space-y-1\">\n              {data.pages.map((page, idx) => (\n                <button\n                  key={page.id}\n                  onClick={() => goToPage(idx)}\n                  className={`w-full text-left px-3 py-2 rounded-md text-sm transition-colors flex items-center gap-2 ${\n                    idx === currentPageIndex\n                      ? \"bg-primary text-primary-foreground\"\n                      : \"hover-elevate\"\n                  }`}\n                  data-testid={`button-page-${idx}`}\n                >\n                  <span className=\"flex-shrink-0 w-5 h-5 rounded-full border flex items-center justify-center text-xs\">\n                    {viewedPages.has(idx) ? (\n                      <Check className=\"h-3 w-3\" />\n                    ) : (\n                      idx + 1\n                    )}\n                  </span>\n                  <span className=\"truncate\">{page.title || \"Untitled\"}</span>\n                </button>\n              ))}\n            </nav>\n          </CardContent>\n        </Card>\n      </aside>\n\n      {/* Main Content */}\n      <div className=\"flex-1 min-w-0 space-y-6\">\n        {data.settings.showProgress && (\n          <div className=\"lg:hidden\">\n            <div className=\"flex items-center justify-between mb-2\">\n              <span className=\"text-sm text-muted-foreground\">\n                Page {currentPageIndex + 1} of {data.pages.length}\n              </span>\n              <span className=\"text-sm text-muted-foreground\">\n                {viewedPages.size} of {data.pages.length} pages viewed\n              </span>\n            </div>\n            <Progress value={completionPercentage} data-testid=\"progress-bar-mobile\" />\n          </div>\n        )}\n\n        <Card>\n          <CardContent className=\"p-6 md:p-8\">\n            <div className=\"flex items-center gap-3 mb-6\">\n              <BookOpen className=\"h-6 w-6 text-primary\" />\n              <h2 className=\"text-2xl font-bold\">{currentPage.title}</h2>\n            </div>\n            <div \n              className=\"prose prose-slate max-w-none dark:prose-invert\"\n              dangerouslySetInnerHTML={{ __html: DOMPurify.sanitize(currentPage.content) }}\n            />\n          </CardContent>\n        </Card>\n\n        {effectiveEmbeddedData && effectiveEmbeddedType && (\n          <Card>\n            <CardContent className=\"p-6\">\n              <div className=\"mb-4\">\n                <p className=\"text-sm text-muted-foreground uppercase tracking-wide\">Interactive Activity: {effectiveEmbeddedTitle}</p>\n              </div>\n              {effectiveEmbeddedType === \"quiz\" && (\n                <QuizPlayer data={effectiveEmbeddedData as any} contentId={effectiveEmbeddedId} />\n              )}\n              {effectiveEmbeddedType === \"flashcard\" && (\n                <FlashcardPlayer data={effectiveEmbeddedData as any} contentId={effectiveEmbeddedId} />\n              )}\n              {effectiveEmbeddedType === \"interactive-video\" && (\n                <VideoPlayer data={effectiveEmbeddedData as any} contentId={effectiveEmbeddedId} />\n              )}\n              {effectiveEmbeddedType === \"image-hotspot\" && (\n                <ImageHotspotPlayer data={effectiveEmbeddedData as any} contentId={effectiveEmbeddedId} />\n              )}\n              {effectiveEmbeddedType === \"drag-drop\" && (\n                <DragDropPlayer data={effectiveEmbeddedData as any} contentId={effectiveEmbeddedId} />\n              )}\n              {effectiveEmbeddedType === \"fill-blanks\" && (\n                <FillBlanksPlayer data={effectiveEmbeddedData as any} contentId={effectiveEmbeddedId} />\n              )}\n              {effectiveEmbeddedType === \"memory-game\" && (\n                <MemoryGamePlayer data={effectiveEmbeddedData as any} contentId={effectiveEmbeddedId} />\n              )}\n            </CardContent>\n          </Card>\n        )}\n\n        {data.settings.showNavigation && (\n          <div className=\"flex items-center justify-between gap-4\">\n            <Button\n              variant=\"outline\"\n              onClick={() => goToPage(currentPageIndex - 1)}\n              disabled={currentPageIndex === 0}\n              data-testid=\"button-prev\"\n            >\n              <ChevronLeft className=\"h-4 w-4 mr-2\" />\n              <span className=\"hidden sm:inline\">Previous</span>\n            </Button>\n            \n            {/* Mobile Page Selector */}\n            <div className=\"lg:hidden flex-1 max-w-xs\">\n              <Select\n                value={currentPageIndex.toString()}\n                onValueChange={(value) => goToPage(parseInt(value))}\n              >\n                <SelectTrigger data-testid=\"select-page-mobile\">\n                  <SelectValue placeholder=\"Go to page...\" />\n                </SelectTrigger>\n                <SelectContent>\n                  {data.pages.map((page, idx) => (\n                    <SelectItem key={page.id} value={idx.toString()}>\n                      <div className=\"flex items-center gap-2\">\n                        {viewedPages.has(idx) && <Check className=\"h-3 w-3\" />}\n                        <span>\n                          {idx + 1}. {page.title || \"Untitled\"}\n                        </span>\n                      </div>\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </div>\n\n            <Button\n              variant=\"outline\"\n              onClick={() => goToPage(currentPageIndex + 1)}\n              disabled={currentPageIndex === data.pages.length - 1}\n              data-testid=\"button-next\"\n            >\n              <span className=\"hidden sm:inline\">Next</span>\n              <ChevronRight className=\"h-4 w-4 ml-2\" />\n            </Button>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n","size_bytes":11863},"client/src/components/RichTextEditor.tsx":{"content":"import { useEditor, EditorContent } from \"@tiptap/react\";\nimport StarterKit from \"@tiptap/starter-kit\";\nimport Image from \"@tiptap/extension-image\";\nimport Placeholder from \"@tiptap/extension-placeholder\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n  DialogFooter,\n} from \"@/components/ui/dialog\";\nimport {\n  Bold,\n  Italic,\n  List,\n  ListOrdered,\n  Quote,\n  Undo,\n  Redo,\n  ImageIcon,\n  Heading1,\n  Heading2,\n  Heading3,\n  Upload,\n  Sparkles,\n} from \"lucide-react\";\nimport { useState, useRef, useEffect } from \"react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { ImageGeneratorDialog } from \"./ImageGeneratorDialog\";\nimport { ImageEditorDialog } from \"./ImageEditorDialog\";\n\ntype RichTextEditorProps = {\n  content: string;\n  onChange: (content: string) => void;\n  placeholder?: string;\n};\n\nconst MAX_IMAGE_SIZE = 2 * 1024 * 1024; // 2MB\n\nexport function RichTextEditor({ content, onChange, placeholder }: RichTextEditorProps) {\n  const { toast } = useToast();\n  const [imageUrl, setImageUrl] = useState(\"\");\n  const [showImageDialog, setShowImageDialog] = useState(false);\n  const [showAIImageDialog, setShowAIImageDialog] = useState(false);\n  const [showImageEditorDialog, setShowImageEditorDialog] = useState(false);\n  const [pendingImageUrl, setPendingImageUrl] = useState(\"\");\n  const [isUploading, setIsUploading] = useState(false);\n  const fileInputRef = useRef<HTMLInputElement>(null);\n\n  const editor = useEditor({\n    extensions: [\n      StarterKit,\n      Image.configure({\n        inline: true,\n        allowBase64: true,\n      }),\n      Placeholder.configure({\n        placeholder: placeholder || \"Start writing...\",\n      }),\n    ],\n    content,\n    onUpdate: ({ editor }) => {\n      onChange(editor.getHTML());\n    },\n    editorProps: {\n      attributes: {\n        class: \"prose max-w-none focus:outline-none min-h-48 p-4\",\n      },\n    },\n  });\n\n  // Update editor content when content prop changes, but only if editor is not focused\n  useEffect(() => {\n    if (editor && content !== editor.getHTML()) {\n      // Only update if editor is not currently focused (user is not typing)\n      if (!editor.isFocused) {\n        editor.commands.setContent(content);\n      }\n    }\n  }, [content, editor]);\n\n  if (!editor) return null;\n\n  const addImage = () => {\n    if (imageUrl) {\n      setPendingImageUrl(imageUrl);\n      setImageUrl(\"\");\n      setShowImageDialog(false);\n      setShowImageEditorDialog(true);\n    }\n  };\n\n  const handleFileUpload = (event: React.ChangeEvent<HTMLInputElement>) => {\n    const file = event.target.files?.[0];\n    if (!file) return;\n\n    // Check file type\n    if (!file.type.startsWith(\"image/\")) {\n      toast({\n        title: \"Invalid file type\",\n        description: \"Please select an image file (JPG, PNG, GIF, etc.)\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    // Check file size (2MB limit)\n    if (file.size > MAX_IMAGE_SIZE) {\n      toast({\n        title: \"File too large\",\n        description: `Image must be smaller than ${MAX_IMAGE_SIZE / (1024 * 1024)}MB. Your image is ${(file.size / (1024 * 1024)).toFixed(2)}MB.`,\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    setIsUploading(true);\n\n    // Convert to base64\n    const reader = new FileReader();\n    reader.onload = (e) => {\n      const base64 = e.target?.result as string;\n      setPendingImageUrl(base64);\n      setShowImageDialog(false);\n      setShowImageEditorDialog(true);\n      setIsUploading(false);\n      \n      // Reset file input\n      if (fileInputRef.current) {\n        fileInputRef.current.value = \"\";\n      }\n    };\n    reader.onerror = () => {\n      toast({\n        title: \"Upload failed\",\n        description: \"Failed to read the image file. Please try again.\",\n        variant: \"destructive\",\n      });\n      setIsUploading(false);\n    };\n    reader.readAsDataURL(file);\n  };\n\n  const handleAIImageGenerated = (imageUrl: string) => {\n    setPendingImageUrl(imageUrl);\n    setShowAIImageDialog(false);\n    setShowImageEditorDialog(true);\n  };\n\n  const handleImageEdited = (editedImageUrl: string) => {\n    editor.chain().focus().setImage({ src: editedImageUrl }).run();\n    toast({\n      title: \"Image inserted\",\n      description: \"Your image has been added to the content.\",\n    });\n  };\n\n  return (\n    <div className=\"border rounded-lg overflow-hidden\">\n      <div className=\"border-b bg-muted/50 p-2 flex flex-wrap gap-1\">\n        <Button\n          type=\"button\"\n          variant=\"ghost\"\n          size=\"sm\"\n          onClick={() => editor.chain().focus().toggleBold().run()}\n          className={editor.isActive(\"bold\") ? \"bg-accent\" : \"\"}\n          data-testid=\"button-bold\"\n        >\n          <Bold className=\"h-4 w-4\" />\n        </Button>\n        <Button\n          type=\"button\"\n          variant=\"ghost\"\n          size=\"sm\"\n          onClick={() => editor.chain().focus().toggleItalic().run()}\n          className={editor.isActive(\"italic\") ? \"bg-accent\" : \"\"}\n          data-testid=\"button-italic\"\n        >\n          <Italic className=\"h-4 w-4\" />\n        </Button>\n        <Button\n          type=\"button\"\n          variant=\"ghost\"\n          size=\"sm\"\n          onClick={() => editor.chain().focus().toggleHeading({ level: 1 }).run()}\n          className={editor.isActive(\"heading\", { level: 1 }) ? \"bg-accent\" : \"\"}\n          data-testid=\"button-h1\"\n        >\n          <Heading1 className=\"h-4 w-4\" />\n        </Button>\n        <Button\n          type=\"button\"\n          variant=\"ghost\"\n          size=\"sm\"\n          onClick={() => editor.chain().focus().toggleHeading({ level: 2 }).run()}\n          className={editor.isActive(\"heading\", { level: 2 }) ? \"bg-accent\" : \"\"}\n          data-testid=\"button-h2\"\n        >\n          <Heading2 className=\"h-4 w-4\" />\n        </Button>\n        <Button\n          type=\"button\"\n          variant=\"ghost\"\n          size=\"sm\"\n          onClick={() => editor.chain().focus().toggleHeading({ level: 3 }).run()}\n          className={editor.isActive(\"heading\", { level: 3 }) ? \"bg-accent\" : \"\"}\n          data-testid=\"button-h3\"\n        >\n          <Heading3 className=\"h-4 w-4\" />\n        </Button>\n        <Button\n          type=\"button\"\n          variant=\"ghost\"\n          size=\"sm\"\n          onClick={() => editor.chain().focus().toggleBulletList().run()}\n          className={editor.isActive(\"bulletList\") ? \"bg-accent\" : \"\"}\n          data-testid=\"button-bullet-list\"\n        >\n          <List className=\"h-4 w-4\" />\n        </Button>\n        <Button\n          type=\"button\"\n          variant=\"ghost\"\n          size=\"sm\"\n          onClick={() => editor.chain().focus().toggleOrderedList().run()}\n          className={editor.isActive(\"orderedList\") ? \"bg-accent\" : \"\"}\n          data-testid=\"button-ordered-list\"\n        >\n          <ListOrdered className=\"h-4 w-4\" />\n        </Button>\n        <Button\n          type=\"button\"\n          variant=\"ghost\"\n          size=\"sm\"\n          onClick={() => editor.chain().focus().toggleBlockquote().run()}\n          className={editor.isActive(\"blockquote\") ? \"bg-accent\" : \"\"}\n          data-testid=\"button-blockquote\"\n        >\n          <Quote className=\"h-4 w-4\" />\n        </Button>\n\n        <div className=\"border-l mx-1\" />\n\n        <Dialog open={showImageDialog} onOpenChange={setShowImageDialog}>\n          <DialogTrigger asChild>\n            <Button type=\"button\" variant=\"ghost\" size=\"sm\" data-testid=\"button-image\">\n              <ImageIcon className=\"h-4 w-4\" />\n            </Button>\n          </DialogTrigger>\n          <DialogContent>\n            <DialogHeader>\n              <DialogTitle>Insert Image</DialogTitle>\n            </DialogHeader>\n            <Tabs defaultValue=\"upload\" className=\"py-4\">\n              <TabsList className=\"grid w-full grid-cols-3\">\n                <TabsTrigger value=\"upload\">Upload</TabsTrigger>\n                <TabsTrigger value=\"url\">URL</TabsTrigger>\n                <TabsTrigger value=\"ai\">AI Generate</TabsTrigger>\n              </TabsList>\n              <TabsContent value=\"upload\" className=\"space-y-4 pt-4\">\n                <div>\n                  <Label htmlFor=\"image-file\">Choose an image file</Label>\n                  <Input\n                    ref={fileInputRef}\n                    id=\"image-file\"\n                    type=\"file\"\n                    accept=\"image/*\"\n                    onChange={handleFileUpload}\n                    disabled={isUploading}\n                    className=\"mt-2\"\n                    data-testid=\"input-image-file\"\n                  />\n                  <p className=\"text-sm text-muted-foreground mt-2\">\n                    Maximum file size: 2MB. Supported formats: JPG, PNG, GIF, WebP\n                  </p>\n                </div>\n                {isUploading && (\n                  <p className=\"text-sm text-muted-foreground\">\n                    Uploading image...\n                  </p>\n                )}\n              </TabsContent>\n              <TabsContent value=\"url\" className=\"space-y-4 pt-4\">\n                <div>\n                  <Label htmlFor=\"image-url\">Image URL</Label>\n                  <Input\n                    id=\"image-url\"\n                    value={imageUrl}\n                    onChange={(e) => setImageUrl(e.target.value)}\n                    placeholder=\"https://example.com/image.jpg\"\n                    data-testid=\"input-image-url\"\n                  />\n                  <p className=\"text-sm text-muted-foreground mt-2\">\n                    Enter the URL of an image hosted online\n                  </p>\n                </div>\n                <DialogFooter>\n                  <Button onClick={addImage} data-testid=\"button-insert-image\">\n                    Insert Image\n                  </Button>\n                </DialogFooter>\n              </TabsContent>\n              <TabsContent value=\"ai\" className=\"space-y-4 pt-4\">\n                <div className=\"text-center space-y-4 py-4\">\n                  <p className=\"text-sm text-muted-foreground\">\n                    Generate custom images using AI based on your description\n                  </p>\n                  <Button\n                    onClick={() => {\n                      setShowImageDialog(false);\n                      setShowAIImageDialog(true);\n                    }}\n                    data-testid=\"button-open-ai-generator\"\n                  >\n                    <Sparkles className=\"h-4 w-4 mr-2\" />\n                    Open AI Image Generator\n                  </Button>\n                </div>\n              </TabsContent>\n            </Tabs>\n          </DialogContent>\n        </Dialog>\n\n        <div className=\"border-l mx-1\" />\n\n        <Button\n          type=\"button\"\n          variant=\"ghost\"\n          size=\"sm\"\n          onClick={() => editor.chain().focus().undo().run()}\n          disabled={!editor.can().undo()}\n          data-testid=\"button-undo\"\n        >\n          <Undo className=\"h-4 w-4\" />\n        </Button>\n        <Button\n          type=\"button\"\n          variant=\"ghost\"\n          size=\"sm\"\n          onClick={() => editor.chain().focus().redo().run()}\n          disabled={!editor.can().redo()}\n          data-testid=\"button-redo\"\n        >\n          <Redo className=\"h-4 w-4\" />\n        </Button>\n      </div>\n      <EditorContent editor={editor} />\n      \n      <ImageGeneratorDialog\n        open={showAIImageDialog}\n        onOpenChange={setShowAIImageDialog}\n        onImageGenerated={handleAIImageGenerated}\n      />\n\n      <ImageEditorDialog\n        open={showImageEditorDialog}\n        onOpenChange={setShowImageEditorDialog}\n        imageUrl={pendingImageUrl}\n        onImageEdited={handleImageEdited}\n      />\n    </div>\n  );\n}\n","size_bytes":11902},"client/src/pages/AnalyticsPage.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Avatar, AvatarFallback } from \"@/components/ui/avatar\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { ThemeToggle } from \"@/components/ThemeToggle\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Breadcrumbs } from \"@/components/Breadcrumbs\";\nimport { useBreadcrumbs } from \"@/hooks/useBreadcrumbs\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport {\n  BookOpen,\n  LogOut,\n  ArrowLeft,\n  TrendingUp,\n  Users,\n  Target,\n  Activity,\n  Eye,\n  HelpCircle,\n  BarChart3,\n  FileQuestion,\n  Layers,\n  Video,\n  Image as ImageIcon,\n  Move,\n  PenTool,\n  Brain,\n  BookOpenCheck,\n  CheckCircle2,\n  Clock,\n} from \"lucide-react\";\nimport { useLocation } from \"wouter\";\nimport { format } from \"date-fns\";\nimport { BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, Legend } from 'recharts';\nimport { useState } from \"react\";\n\nfunction getInitials(name: string): string {\n  return name\n    .split(\" \")\n    .map((n) => n[0])\n    .join(\"\")\n    .toUpperCase()\n    .slice(0, 2);\n}\n\nconst contentTypeConfig: Record<string, { icon: typeof FileQuestion; label: string; color: string }> = {\n  quiz: { icon: FileQuestion, label: \"Quiz\", color: \"bg-blue-100 text-blue-700 dark:bg-blue-900 dark:text-blue-300\" },\n  flashcard: { icon: Layers, label: \"Flashcard\", color: \"bg-purple-100 text-purple-700 dark:bg-purple-900 dark:text-purple-300\" },\n  \"interactive-video\": { icon: Video, label: \"Interactive Video\", color: \"bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-300\" },\n  \"image-hotspot\": { icon: ImageIcon, label: \"Image Hotspot\", color: \"bg-orange-100 text-orange-700 dark:bg-orange-900 dark:text-orange-300\" },\n  \"drag-drop\": { icon: Move, label: \"Drag & Drop\", color: \"bg-pink-100 text-pink-700 dark:bg-pink-900 dark:text-pink-300\" },\n  \"fill-blanks\": { icon: PenTool, label: \"Fill in the Blanks\", color: \"bg-cyan-100 text-cyan-700 dark:bg-cyan-900 dark:text-cyan-300\" },\n  \"memory-game\": { icon: Brain, label: \"Memory Game\", color: \"bg-yellow-100 text-yellow-700 dark:bg-yellow-900 dark:text-yellow-300\" },\n  \"interactive-book\": { icon: BookOpenCheck, label: \"Interactive Book\", color: \"bg-indigo-100 text-indigo-700 dark:bg-indigo-900 dark:text-indigo-300\" },\n};\n\nexport default function AnalyticsPage() {\n  const { user, logout } = useAuth();\n  const [_, navigate] = useLocation();\n  const [selectedContentId, setSelectedContentId] = useState<string | null>(null);\n  const breadcrumbs = useBreadcrumbs();\n\n  const { data: analytics, isLoading } = useQuery<any[]>({\n    queryKey: [\"/api/analytics/overview\"],\n  });\n\n  const { data: learners, isLoading: isLoadingLearners } = useQuery<any[]>({\n    queryKey: [\"/api/analytics/content\", selectedContentId, \"learners\"],\n    enabled: !!selectedContentId,\n  });\n\n  const handleLogout = async () => {\n    await logout();\n  };\n\n  const selectedContent = analytics?.find(item => item.contentId === selectedContentId);\n\n  // Calculate summary statistics\n  const totalViews = analytics?.reduce((sum, item) => sum + item.uniqueViewers, 0) || 0;\n  const totalContent = analytics?.length || 0;\n  const publishedContent = analytics?.filter(item => item.isPublished).length || 0;\n  const avgCompletion = analytics && analytics.length > 0\n    ? analytics.reduce((sum, item) => sum + item.avgCompletion, 0) / analytics.length\n    : 0;\n  const totalInteractions = analytics?.reduce((sum, item) => sum + item.totalInteractions, 0) || 0;\n\n  // Prepare chart data - top 10 by views\n  const chartData = analytics\n    ?.slice()\n    .sort((a, b) => b.uniqueViewers - a.uniqueViewers)\n    .slice(0, 10)\n    .map(item => ({\n      name: item.title.length > 20 ? item.title.substring(0, 20) + '...' : item.title,\n      viewers: item.uniqueViewers,\n      completion: Math.round(item.avgCompletion),\n    })) || [];\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      {/* Skip to main content */}\n      <a href=\"#main-content\" className=\"skip-to-content\">\n        Skip to main content\n      </a>\n      \n      {/* Header */}\n      <header className=\"border-b bg-card sticky top-0 z-50\" role=\"banner\">\n        <div className=\"max-w-7xl mx-auto px-6 h-16 flex items-center justify-between\">\n          <div className=\"flex items-center gap-4\">\n            <Button\n              variant=\"ghost\"\n              size=\"icon\"\n              onClick={() => navigate(\"/dashboard\")}\n              data-testid=\"button-back-dashboard\"\n              aria-label=\"Back to dashboard\"\n            >\n              <ArrowLeft className=\"h-5 w-5\" />\n            </Button>\n            <div className=\"flex items-center gap-3\">\n              <img \n                src=\"/favicon.png\" \n                alt=\"OECS Content Creator Logo\" \n                className=\"h-10 w-10 rounded-lg\"\n              />\n              <div>\n                <h1 className=\"text-xl font-bold text-foreground\">OECS Content Creator</h1>\n              </div>\n            </div>\n          </div>\n          <div className=\"flex items-center gap-4\">\n            <Button\n              variant=\"ghost\"\n              size=\"icon\"\n              onClick={() => navigate(\"/help\")}\n              data-testid=\"button-help\"\n              aria-label=\"Open help documentation\"\n            >\n              <HelpCircle className=\"h-5 w-5\" />\n            </Button>\n            <ThemeToggle />\n            <div className=\"flex items-center gap-3\">\n              <Avatar className=\"h-10 w-10\">\n                <AvatarFallback className=\"bg-primary text-primary-foreground\">\n                  {user ? getInitials(user.fullName) : \"U\"}\n                </AvatarFallback>\n              </Avatar>\n              <div className=\"hidden md:block\">\n                <p className=\"text-sm font-medium text-foreground\">{user?.fullName}</p>\n                <p className=\"text-xs text-muted-foreground\">{user?.role}</p>\n              </div>\n            </div>\n            <Button \n              variant=\"ghost\" \n              size=\"icon\" \n              onClick={handleLogout} \n              data-testid=\"button-logout\"\n              aria-label=\"Log out\"\n            >\n              <LogOut className=\"h-5 w-5\" />\n            </Button>\n          </div>\n        </div>\n      </header>\n\n      {/* Breadcrumbs */}\n      <div className=\"bg-background border-b\">\n        <div className=\"max-w-7xl mx-auto px-6 py-3\">\n          <Breadcrumbs items={breadcrumbs} />\n        </div>\n      </div>\n\n      {/* Main Content */}\n      <main id=\"main-content\" className=\"max-w-7xl mx-auto px-6 py-8\" role=\"main\">\n        <div className=\"mb-8\">\n          <h2 className=\"text-3xl font-bold text-foreground mb-2\">Analytics Dashboard</h2>\n          <p className=\"text-muted-foreground\">\n            Track performance and engagement for your educational content\n          </p>\n        </div>\n\n        {isLoading ? (\n          <div className=\"space-y-6\">\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6\">\n              {[1, 2, 3, 4].map(i => (\n                <Skeleton key={i} className=\"h-32\" />\n              ))}\n            </div>\n            <Skeleton className=\"h-96\" />\n          </div>\n        ) : (\n          <>\n            {/* Summary Cards */}\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8\">\n              <Card>\n                <CardHeader className=\"flex flex-row items-center justify-between gap-2 space-y-0 pb-2\">\n                  <CardTitle className=\"text-sm font-medium\">Total Content</CardTitle>\n                  <BarChart3 className=\"h-4 w-4 text-muted-foreground\" />\n                </CardHeader>\n                <CardContent>\n                  <div className=\"text-2xl font-bold\" data-testid=\"text-total-content\">{totalContent}</div>\n                  <p className=\"text-xs text-muted-foreground\">\n                    {publishedContent} published\n                  </p>\n                </CardContent>\n              </Card>\n\n              <Card>\n                <CardHeader className=\"flex flex-row items-center justify-between gap-2 space-y-0 pb-2\">\n                  <CardTitle className=\"text-sm font-medium\">Total Views</CardTitle>\n                  <Eye className=\"h-4 w-4 text-muted-foreground\" />\n                </CardHeader>\n                <CardContent>\n                  <div className=\"text-2xl font-bold\" data-testid=\"text-total-views\">{totalViews}</div>\n                  <p className=\"text-xs text-muted-foreground\">\n                    Unique learners\n                  </p>\n                </CardContent>\n              </Card>\n\n              <Card>\n                <CardHeader className=\"flex flex-row items-center justify-between gap-2 space-y-0 pb-2\">\n                  <CardTitle className=\"text-sm font-medium\">Avg Completion</CardTitle>\n                  <Target className=\"h-4 w-4 text-muted-foreground\" />\n                </CardHeader>\n                <CardContent>\n                  <div className=\"text-2xl font-bold\" data-testid=\"text-avg-completion\">\n                    {avgCompletion.toFixed(1)}%\n                  </div>\n                  <p className=\"text-xs text-muted-foreground\">\n                    Across all content\n                  </p>\n                </CardContent>\n              </Card>\n\n              <Card>\n                <CardHeader className=\"flex flex-row items-center justify-between gap-2 space-y-0 pb-2\">\n                  <CardTitle className=\"text-sm font-medium\">Total Interactions</CardTitle>\n                  <Activity className=\"h-4 w-4 text-muted-foreground\" />\n                </CardHeader>\n                <CardContent>\n                  <div className=\"text-2xl font-bold\" data-testid=\"text-total-interactions\">\n                    {totalInteractions}\n                  </div>\n                  <p className=\"text-xs text-muted-foreground\">\n                    All engagement events\n                  </p>\n                </CardContent>\n              </Card>\n            </div>\n\n            {/* Chart */}\n            {chartData.length > 0 && (\n              <Card className=\"mb-8\">\n                <CardHeader>\n                  <CardTitle>Top Content by Views</CardTitle>\n                  <CardDescription>Viewer count and average completion for your most popular content</CardDescription>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"h-80\">\n                    <ResponsiveContainer width=\"100%\" height=\"100%\">\n                      <BarChart data={chartData}>\n                        <CartesianGrid strokeDasharray=\"3 3\" className=\"stroke-muted\" />\n                        <XAxis \n                          dataKey=\"name\" \n                          className=\"text-xs\"\n                          tick={{ fill: 'hsl(var(--muted-foreground))' }}\n                        />\n                        <YAxis \n                          className=\"text-xs\"\n                          tick={{ fill: 'hsl(var(--muted-foreground))' }}\n                        />\n                        <Tooltip \n                          contentStyle={{ \n                            backgroundColor: 'hsl(var(--card))',\n                            border: '1px solid hsl(var(--border))',\n                            borderRadius: '6px',\n                            color: 'hsl(var(--card-foreground))'\n                          }}\n                        />\n                        <Legend />\n                        <Bar dataKey=\"viewers\" fill=\"hsl(var(--primary))\" name=\"Unique Viewers\" />\n                        <Bar dataKey=\"completion\" fill=\"hsl(var(--accent))\" name=\"Avg Completion %\" />\n                      </BarChart>\n                    </ResponsiveContainer>\n                  </div>\n                </CardContent>\n              </Card>\n            )}\n\n            {/* Content Table */}\n            <Card>\n              <CardHeader>\n                <CardTitle>Content Performance</CardTitle>\n                <CardDescription>Detailed analytics for all your content</CardDescription>\n              </CardHeader>\n              <CardContent>\n                {!analytics || analytics.length === 0 ? (\n                  <div className=\"text-center py-12\">\n                    <TrendingUp className=\"h-12 w-12 text-muted-foreground mx-auto mb-4\" />\n                    <h3 className=\"text-lg font-semibold text-foreground mb-2\">No Analytics Yet</h3>\n                    <p className=\"text-muted-foreground mb-6\">\n                      Create and publish content to start tracking engagement and performance\n                    </p>\n                    <Button onClick={() => navigate(\"/dashboard\")} data-testid=\"button-go-to-dashboard\">\n                      Go to Dashboard\n                    </Button>\n                  </div>\n                ) : (\n                  <div className=\"rounded-md border\">\n                    <Table>\n                      <TableHeader>\n                        <TableRow>\n                          <TableHead>Title</TableHead>\n                          <TableHead>Type</TableHead>\n                          <TableHead>Status</TableHead>\n                          <TableHead className=\"text-right\">Viewers</TableHead>\n                          <TableHead className=\"text-right\">Avg Completion</TableHead>\n                          <TableHead className=\"text-right\">Interactions</TableHead>\n                          <TableHead className=\"text-right\">Created</TableHead>\n                          <TableHead className=\"text-right\">Actions</TableHead>\n                        </TableRow>\n                      </TableHeader>\n                      <TableBody>\n                        {analytics.map((item) => {\n                          const config = contentTypeConfig[item.type] || contentTypeConfig.quiz;\n                          const Icon = config.icon;\n                          return (\n                            <TableRow key={item.contentId} data-testid={`row-analytics-${item.contentId}`}>\n                              <TableCell className=\"font-medium\">\n                                <div className=\"flex items-center gap-2\">\n                                  <div className={`h-8 w-8 rounded ${config.color} flex items-center justify-center flex-shrink-0`}>\n                                    <Icon className=\"h-4 w-4\" />\n                                  </div>\n                                  <span className=\"truncate max-w-xs\">{item.title}</span>\n                                </div>\n                              </TableCell>\n                              <TableCell>\n                                <Badge variant=\"outline\">{config.label}</Badge>\n                              </TableCell>\n                              <TableCell>\n                                {item.isPublished ? (\n                                  <Badge variant=\"default\">Published</Badge>\n                                ) : (\n                                  <Badge variant=\"secondary\">Draft</Badge>\n                                )}\n                              </TableCell>\n                              <TableCell className=\"text-right\" data-testid={`text-viewers-${item.contentId}`}>\n                                {item.uniqueViewers}\n                              </TableCell>\n                              <TableCell className=\"text-right\" data-testid={`text-completion-${item.contentId}`}>\n                                {item.avgCompletion.toFixed(1)}%\n                              </TableCell>\n                              <TableCell className=\"text-right\" data-testid={`text-interactions-${item.contentId}`}>\n                                {item.totalInteractions}\n                              </TableCell>\n                              <TableCell className=\"text-right text-muted-foreground text-sm\">\n                                {format(new Date(item.createdAt), \"MMM d, yyyy\")}\n                              </TableCell>\n                              <TableCell className=\"text-right\">\n                                <Button\n                                  variant=\"ghost\"\n                                  size=\"sm\"\n                                  onClick={() => setSelectedContentId(item.contentId)}\n                                  data-testid={`button-view-learners-${item.contentId}`}\n                                >\n                                  <Users className=\"h-4 w-4 mr-2\" />\n                                  View Learners\n                                </Button>\n                              </TableCell>\n                            </TableRow>\n                          );\n                        })}\n                      </TableBody>\n                    </Table>\n                  </div>\n                )}\n              </CardContent>\n            </Card>\n          </>\n        )}\n      </main>\n\n      {/* Learner Details Dialog */}\n      <Dialog open={!!selectedContentId} onOpenChange={(open) => !open && setSelectedContentId(null)}>\n        <DialogContent className=\"max-w-4xl max-h-[80vh] overflow-y-auto\">\n          <DialogHeader>\n            <DialogTitle className=\"flex items-center gap-2\">\n              <Users className=\"h-5 w-5\" />\n              Individual Learner Performance\n            </DialogTitle>\n            <DialogDescription>\n              {selectedContent && (\n                <span>Viewing learner data for: <strong>{selectedContent.title}</strong></span>\n              )}\n            </DialogDescription>\n          </DialogHeader>\n\n          {isLoadingLearners ? (\n            <div className=\"space-y-4\">\n              {[1, 2, 3].map(i => (\n                <Skeleton key={i} className=\"h-20\" />\n              ))}\n            </div>\n          ) : !learners || learners.length === 0 ? (\n            <div className=\"text-center py-12\">\n              <Users className=\"h-12 w-12 text-muted-foreground mx-auto mb-4\" />\n              <h3 className=\"text-lg font-semibold text-foreground mb-2\">No Learner Data</h3>\n              <p className=\"text-muted-foreground\">\n                No authenticated users have interacted with this content yet\n              </p>\n            </div>\n          ) : (\n            <div className=\"space-y-4\">\n              {learners.map((learner, idx) => (\n                <Card key={learner.userId} data-testid={`card-learner-${idx}`}>\n                  <CardContent className=\"pt-6\">\n                    <div className=\"flex items-start justify-between mb-4\">\n                      <div className=\"flex items-center gap-3\">\n                        <Avatar className=\"h-12 w-12\">\n                          <AvatarFallback className=\"bg-primary text-primary-foreground\">\n                            {getInitials(learner.displayName)}\n                          </AvatarFallback>\n                        </Avatar>\n                        <div>\n                          <h4 className=\"font-semibold text-foreground\" data-testid={`text-learner-name-${idx}`}>\n                            {learner.displayName}\n                          </h4>\n                          <p className=\"text-sm text-muted-foreground\" data-testid={`text-learner-email-${idx}`}>\n                            {learner.email}\n                          </p>\n                          {learner.role && (\n                            <Badge variant=\"outline\" className=\"mt-1\">{learner.role}</Badge>\n                          )}\n                        </div>\n                      </div>\n                      <div className=\"text-right\">\n                        <div className=\"flex items-center gap-2 text-sm text-muted-foreground mb-1\">\n                          <Clock className=\"h-3 w-3\" />\n                          Last accessed: {format(new Date(learner.lastAccessedAt), \"MMM d, yyyy\")}\n                        </div>\n                        <div className=\"text-sm text-muted-foreground\">\n                          First accessed: {format(new Date(learner.firstAccessedAt), \"MMM d, yyyy\")}\n                        </div>\n                      </div>\n                    </div>\n\n                    <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n                      {/* Completion */}\n                      <div className=\"bg-muted rounded-lg p-3\">\n                        <div className=\"flex items-center gap-2 mb-2\">\n                          <Target className=\"h-4 w-4 text-primary\" />\n                          <span className=\"text-sm font-medium\">Completion</span>\n                        </div>\n                        <div className=\"text-2xl font-bold\" data-testid={`text-learner-completion-${idx}`}>\n                          {learner.completionPercentage.toFixed(1)}%\n                        </div>\n                        {learner.completedAt && (\n                          <div className=\"flex items-center gap-1 mt-1 text-xs text-muted-foreground\">\n                            <CheckCircle2 className=\"h-3 w-3\" />\n                            Completed {format(new Date(learner.completedAt), \"MMM d\")}\n                          </div>\n                        )}\n                      </div>\n\n                      {/* Interactions */}\n                      <div className=\"bg-muted rounded-lg p-3\">\n                        <div className=\"flex items-center gap-2 mb-2\">\n                          <Activity className=\"h-4 w-4 text-primary\" />\n                          <span className=\"text-sm font-medium\">Interactions</span>\n                        </div>\n                        <div className=\"text-2xl font-bold\" data-testid={`text-learner-interactions-${idx}`}>\n                          {learner.totalInteractions}\n                        </div>\n                        <div className=\"text-xs text-muted-foreground mt-1\">\n                          Total engagement events\n                        </div>\n                      </div>\n\n                      {/* Quiz Performance */}\n                      <div className=\"bg-muted rounded-lg p-3\">\n                        <div className=\"flex items-center gap-2 mb-2\">\n                          <FileQuestion className=\"h-4 w-4 text-primary\" />\n                          <span className=\"text-sm font-medium\">Quiz Attempts</span>\n                        </div>\n                        <div className=\"text-2xl font-bold\" data-testid={`text-learner-quiz-attempts-${idx}`}>\n                          {learner.quizAttempts.length}\n                        </div>\n                        {learner.quizAttempts.length > 0 && (\n                          <div className=\"text-xs text-muted-foreground mt-1\">\n                            Best: {Math.max(...learner.quizAttempts.map((a: any) => parseFloat(a.percentage)))}%\n                          </div>\n                        )}\n                      </div>\n                    </div>\n\n                    {/* Quiz Attempt Details */}\n                    {learner.quizAttempts.length > 0 && (\n                      <div className=\"mt-4\">\n                        <h5 className=\"text-sm font-semibold mb-2\">Recent Quiz Attempts</h5>\n                        <div className=\"space-y-2\">\n                          {learner.quizAttempts.map((attempt: any, attemptIdx: number) => (\n                            <div \n                              key={attemptIdx} \n                              className=\"flex items-center justify-between bg-muted rounded px-3 py-2 text-sm\"\n                              data-testid={`text-quiz-attempt-${idx}-${attemptIdx}`}\n                            >\n                              <span>\n                                {attempt.score} / {attempt.totalQuestions} correct ({attempt.percentage}%)\n                              </span>\n                              <span className=\"text-muted-foreground\">\n                                {format(new Date(attempt.completedAt), \"MMM d, yyyy h:mm a\")}\n                              </span>\n                            </div>\n                          ))}\n                        </div>\n                      </div>\n                    )}\n                  </CardContent>\n                </Card>\n              ))}\n            </div>\n          )}\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","size_bytes":24512},"client/src/pages/HelpPage.tsx":{"content":"import { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Accordion, AccordionContent, AccordionItem, AccordionTrigger } from \"@/components/ui/accordion\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { ThemeToggle } from \"@/components/ThemeToggle\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { Avatar, AvatarFallback } from \"@/components/ui/avatar\";\nimport { Breadcrumbs } from \"@/components/Breadcrumbs\";\nimport { useBreadcrumbs } from \"@/hooks/useBreadcrumbs\";\nimport { \n  BookOpen, \n  LogOut, \n  FileQuestion, \n  Layers, \n  Video, \n  Image as ImageIcon, \n  Move,\n  PenTool,\n  Brain,\n  BookOpenCheck,\n  Search,\n  Sparkles,\n  Share2,\n  Eye,\n  ArrowLeft,\n  Presentation,\n  GraduationCap\n} from \"lucide-react\";\nimport { useLocation } from \"wouter\";\n\nfunction getInitials(name: string): string {\n  return name\n    .split(\" \")\n    .map((n) => n[0])\n    .join(\"\")\n    .toUpperCase()\n    .slice(0, 2);\n}\n\nexport default function HelpPage() {\n  const { user, logout } = useAuth();\n  const [_, navigate] = useLocation();\n  const breadcrumbs = useBreadcrumbs();\n\n  const handleLogout = async () => {\n    await logout();\n  };\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      {/* Skip to main content */}\n      <a href=\"#main-content\" className=\"skip-to-content\">\n        Skip to main content\n      </a>\n      \n      {/* Header */}\n      <header className=\"border-b bg-card sticky top-0 z-50\" role=\"banner\">\n        <div className=\"max-w-7xl mx-auto px-6 h-16 flex items-center justify-between\">\n          <div className=\"flex items-center gap-4\">\n            <Button\n              variant=\"ghost\"\n              size=\"icon\"\n              onClick={() => navigate(\"/dashboard\")}\n              data-testid=\"button-back-dashboard\"\n              aria-label=\"Back to dashboard\"\n            >\n              <ArrowLeft className=\"h-5 w-5\" />\n            </Button>\n            <div className=\"flex items-center gap-3\">\n              <img \n                src=\"/favicon.png\" \n                alt=\"OECS Content Creator Logo\" \n                className=\"h-10 w-10 rounded-lg\"\n              />\n              <div>\n                <h1 className=\"text-xl font-bold text-foreground\">OECS Content Creator</h1>\n              </div>\n            </div>\n          </div>\n          <div className=\"flex items-center gap-4\">\n            <ThemeToggle />\n            <div className=\"flex items-center gap-3\">\n              <Avatar className=\"h-10 w-10\">\n                <AvatarFallback className=\"bg-primary text-primary-foreground\">\n                  {user ? getInitials(user.fullName) : \"U\"}\n                </AvatarFallback>\n              </Avatar>\n              <div className=\"hidden md:block\">\n                <p className=\"text-sm font-medium text-foreground\">{user?.fullName}</p>\n                <p className=\"text-xs text-muted-foreground\">{user?.role}</p>\n              </div>\n            </div>\n            <Button variant=\"ghost\" size=\"icon\" onClick={handleLogout} data-testid=\"button-logout\" aria-label=\"Log out\">\n              <LogOut className=\"h-5 w-5\" />\n            </Button>\n          </div>\n        </div>\n      </header>\n\n      {/* Breadcrumbs */}\n      <div className=\"bg-background border-b\">\n        <div className=\"max-w-7xl mx-auto px-6 py-3\">\n          <Breadcrumbs items={breadcrumbs} />\n        </div>\n      </div>\n\n      {/* Main Content */}\n      <main id=\"main-content\" className=\"max-w-4xl mx-auto px-6 py-12\" role=\"main\">\n        <div className=\"mb-8\">\n          <h1 className=\"text-4xl font-bold text-foreground mb-4\">Help & User Manual</h1>\n          <p className=\"text-lg text-muted-foreground\">\n            Everything you need to know about creating engaging educational content with OECS Content Creator\n          </p>\n        </div>\n\n        {/* Quick Start Guide */}\n        <Card className=\"mb-8\">\n          <CardHeader>\n            <CardTitle>Quick Start Guide</CardTitle>\n            <CardDescription>Get started with OECS Content Creator in minutes</CardDescription>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <div className=\"flex items-start gap-4\">\n              <div className=\"h-8 w-8 rounded-full bg-primary text-primary-foreground flex items-center justify-center flex-shrink-0 font-bold\">\n                1\n              </div>\n              <div>\n                <h4 className=\"font-semibold text-foreground mb-1\">Choose a Content Type</h4>\n                <p className=\"text-sm text-muted-foreground\">\n                  Select from ten interactive content types on your dashboard: Quiz, Flashcard, Interactive Video, Image Hotspot, Drag & Drop, Fill in the Blanks, Memory Game, Interactive Book, Video Finder, or Google Slides.\n                </p>\n              </div>\n            </div>\n            <div className=\"flex items-start gap-4\">\n              <div className=\"h-8 w-8 rounded-full bg-primary text-primary-foreground flex items-center justify-center flex-shrink-0 font-bold\">\n                2\n              </div>\n              <div>\n                <h4 className=\"font-semibold text-foreground mb-1\">Create or Generate with AI</h4>\n                <p className=\"text-sm text-muted-foreground\">\n                  Build your content manually or use the AI generation feature to automatically create questions, flashcards, and more based on your topic and difficulty level.\n                </p>\n              </div>\n            </div>\n            <div className=\"flex items-start gap-4\">\n              <div className=\"h-8 w-8 rounded-full bg-primary text-primary-foreground flex items-center justify-center flex-shrink-0 font-bold\">\n                3\n              </div>\n              <div>\n                <h4 className=\"font-semibold text-foreground mb-1\">Preview and Publish</h4>\n                <p className=\"text-sm text-muted-foreground\">\n                  Test your content using the preview feature, then publish it to make it accessible to students. Share the link with your class.\n                </p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Content Types */}\n        <div className=\"mb-8\">\n          <h2 className=\"text-2xl font-bold text-foreground mb-6\">Content Types</h2>\n          <div className=\"grid gap-4\">\n            <Card>\n              <CardHeader>\n                <div className=\"flex items-center gap-3\">\n                  <div className=\"h-12 w-12 bg-blue-100 text-blue-700 dark:bg-blue-900 dark:text-blue-300 rounded-lg flex items-center justify-center\">\n                    <FileQuestion className=\"h-6 w-6\" />\n                  </div>\n                  <div>\n                    <CardTitle>Quiz</CardTitle>\n                    <CardDescription>Multiple choice questions with instant feedback</CardDescription>\n                  </div>\n                </div>\n              </CardHeader>\n              <CardContent>\n                <p className=\"text-sm text-muted-foreground mb-3\">\n                  Create engaging quizzes with multiple-choice questions. Each question can have up to four answer options with one correct answer. Students receive immediate feedback on their responses.\n                </p>\n                <p className=\"text-sm font-semibold text-foreground mb-2\">Best Practices:</p>\n                <ul className=\"text-sm text-muted-foreground list-disc list-inside space-y-1\">\n                  <li>Keep questions clear and concise</li>\n                  <li>Use plausible distractors (incorrect answers)</li>\n                  <li>Provide helpful feedback for both correct and incorrect answers</li>\n                  <li>Mix difficulty levels to challenge all learners</li>\n                </ul>\n              </CardContent>\n            </Card>\n\n            <Card>\n              <CardHeader>\n                <div className=\"flex items-center gap-3\">\n                  <div className=\"h-12 w-12 bg-purple-100 text-purple-700 dark:bg-purple-900 dark:text-purple-300 rounded-lg flex items-center justify-center\">\n                    <Layers className=\"h-6 w-6\" />\n                  </div>\n                  <div>\n                    <CardTitle>Flashcard</CardTitle>\n                    <CardDescription>Flip cards for memorization and review</CardDescription>\n                  </div>\n                </div>\n              </CardHeader>\n              <CardContent>\n                <p className=\"text-sm text-muted-foreground mb-3\">\n                  Digital flashcards with front and back sides. Perfect for vocabulary, definitions, formulas, and any content requiring memorization. Students can flip cards to reveal answers.\n                </p>\n                <p className=\"text-sm font-semibold text-foreground mb-2\">Best Practices:</p>\n                <ul className=\"text-sm text-muted-foreground list-disc list-inside space-y-1\">\n                  <li>Keep front side questions brief and focused</li>\n                  <li>Provide comprehensive but concise answers on the back</li>\n                  <li>Group related concepts together</li>\n                  <li>Use images where appropriate to enhance memory retention</li>\n                </ul>\n              </CardContent>\n            </Card>\n\n            <Card>\n              <CardHeader>\n                <div className=\"flex items-center gap-3\">\n                  <div className=\"h-12 w-12 bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-300 rounded-lg flex items-center justify-center\">\n                    <Video className=\"h-6 w-6\" />\n                  </div>\n                  <div>\n                    <CardTitle>Interactive Video</CardTitle>\n                    <CardDescription>Videos with clickable hotspots at specific times</CardDescription>\n                  </div>\n                </div>\n              </CardHeader>\n              <CardContent>\n                <p className=\"text-sm text-muted-foreground mb-3\">\n                  Embed YouTube videos with interactive hotspots that appear at specific timestamps. Add questions, additional information, or links at key moments in the video.\n                </p>\n                <p className=\"text-sm font-semibold text-foreground mb-2\">Best Practices:</p>\n                <ul className=\"text-sm text-muted-foreground list-disc list-inside space-y-1\">\n                  <li>Place hotspots at important moments in the video</li>\n                  <li>Don't overload with too many hotspots</li>\n                  <li>Use hotspots to clarify complex concepts</li>\n                  <li>Test timing to ensure hotspots appear at the right moment</li>\n                </ul>\n              </CardContent>\n            </Card>\n\n            <Card>\n              <CardHeader>\n                <div className=\"flex items-center gap-3\">\n                  <div className=\"h-12 w-12 bg-orange-100 text-orange-700 dark:bg-orange-900 dark:text-orange-300 rounded-lg flex items-center justify-center\">\n                    <ImageIcon className=\"h-6 w-6\" />\n                  </div>\n                  <div>\n                    <CardTitle>Image Hotspot</CardTitle>\n                    <CardDescription>Interactive clickable areas on images</CardDescription>\n                  </div>\n                </div>\n              </CardHeader>\n              <CardContent>\n                <p className=\"text-sm text-muted-foreground mb-3\">\n                  Upload images and add clickable hotspots to different areas. Perfect for anatomy diagrams, maps, infographics, and visual learning materials.\n                </p>\n                <p className=\"text-sm font-semibold text-foreground mb-2\">Best Practices:</p>\n                <ul className=\"text-sm text-muted-foreground list-disc list-inside space-y-1\">\n                  <li>Use high-quality, clear images</li>\n                  <li>Position hotspots precisely on relevant areas</li>\n                  <li>Provide informative descriptions for each hotspot</li>\n                  <li>Ensure hotspots are visually distinct and easy to click</li>\n                </ul>\n              </CardContent>\n            </Card>\n\n            <Card>\n              <CardHeader>\n                <div className=\"flex items-center gap-3\">\n                  <div className=\"h-12 w-12 bg-pink-100 text-pink-700 dark:bg-pink-900 dark:text-pink-300 rounded-lg flex items-center justify-center\">\n                    <Move className=\"h-6 w-6\" />\n                  </div>\n                  <div>\n                    <CardTitle>Drag & Drop</CardTitle>\n                    <CardDescription>Match items by dragging to correct drop zones</CardDescription>\n                  </div>\n                </div>\n              </CardHeader>\n              <CardContent>\n                <p className=\"text-sm text-muted-foreground mb-3\">\n                  Create interactive matching activities where students drag items to their correct categories or positions. Great for classification, sequencing, and matching exercises.\n                </p>\n                <p className=\"text-sm font-semibold text-foreground mb-2\">Best Practices:</p>\n                <ul className=\"text-sm text-muted-foreground list-disc list-inside space-y-1\">\n                  <li>Create clear, unambiguous categories</li>\n                  <li>Use 3-5 drop zones for optimal difficulty</li>\n                  <li>Include 2-4 items per drop zone</li>\n                  <li>Provide immediate feedback on correct/incorrect placements</li>\n                </ul>\n              </CardContent>\n            </Card>\n\n            <Card>\n              <CardHeader>\n                <div className=\"flex items-center gap-3\">\n                  <div className=\"h-12 w-12 bg-cyan-100 text-cyan-700 dark:bg-cyan-900 dark:text-cyan-300 rounded-lg flex items-center justify-center\">\n                    <PenTool className=\"h-6 w-6\" />\n                  </div>\n                  <div>\n                    <CardTitle>Fill in the Blanks</CardTitle>\n                    <CardDescription>Complete sentences with missing words</CardDescription>\n                  </div>\n                </div>\n              </CardHeader>\n              <CardContent>\n                <p className=\"text-sm text-muted-foreground mb-3\">\n                  Create sentences with missing words that students must fill in. Excellent for vocabulary, grammar, and concept reinforcement.\n                </p>\n                <p className=\"text-sm font-semibold text-foreground mb-2\">Best Practices:</p>\n                <ul className=\"text-sm text-muted-foreground list-disc list-inside space-y-1\">\n                  <li>Ensure context provides enough clues</li>\n                  <li>Use 1-3 blanks per sentence for clarity</li>\n                  <li>Accept multiple correct answers where appropriate</li>\n                  <li>Provide hints for challenging terms</li>\n                </ul>\n              </CardContent>\n            </Card>\n\n            <Card>\n              <CardHeader>\n                <div className=\"flex items-center gap-3\">\n                  <div className=\"h-12 w-12 bg-yellow-100 text-yellow-700 dark:bg-yellow-900 dark:text-yellow-300 rounded-lg flex items-center justify-center\">\n                    <Brain className=\"h-6 w-6\" />\n                  </div>\n                  <div>\n                    <CardTitle>Memory Game</CardTitle>\n                    <CardDescription>Match pairs of cards in a memory challenge</CardDescription>\n                  </div>\n                </div>\n              </CardHeader>\n              <CardContent>\n                <p className=\"text-sm text-muted-foreground mb-3\">\n                  Classic memory card game where students flip cards to find matching pairs. Great for vocabulary, definitions, and concept associations.\n                </p>\n                <p className=\"text-sm font-semibold text-foreground mb-2\">Best Practices:</p>\n                <ul className=\"text-sm text-muted-foreground list-disc list-inside space-y-1\">\n                  <li>Use 6-12 pairs for appropriate difficulty</li>\n                  <li>Create clear, memorable associations</li>\n                  <li>Keep card content concise and readable</li>\n                  <li>Use images to enhance visual memory</li>\n                </ul>\n              </CardContent>\n            </Card>\n\n            <Card>\n              <CardHeader>\n                <div className=\"flex items-center gap-3\">\n                  <div className=\"h-12 w-12 bg-indigo-100 text-indigo-700 dark:bg-indigo-900 dark:text-indigo-300 rounded-lg flex items-center justify-center\">\n                    <BookOpenCheck className=\"h-6 w-6\" />\n                  </div>\n                  <div>\n                    <CardTitle>Interactive Book</CardTitle>\n                    <CardDescription>Multi-page books with rich text and embedded content</CardDescription>\n                  </div>\n                </div>\n              </CardHeader>\n              <CardContent>\n                <p className=\"text-sm text-muted-foreground mb-3\">\n                  Create comprehensive learning experiences with multiple pages. Each page can include rich formatted text, images, and embedded interactive content from other content types.\n                </p>\n                <p className=\"text-sm font-semibold text-foreground mb-2\">Best Practices:</p>\n                <ul className=\"text-sm text-muted-foreground list-disc list-inside space-y-1\">\n                  <li>Organize content into logical chapters/sections</li>\n                  <li>Use headings and formatting for readability</li>\n                  <li>Embed quizzes or activities to reinforce learning</li>\n                  <li>Keep pages focused on one topic or concept</li>\n                  <li>Include navigation aids and progress tracking</li>\n                </ul>\n              </CardContent>\n            </Card>\n\n            <Card>\n              <CardHeader>\n                <div className=\"flex items-center gap-3\">\n                  <div className=\"h-12 w-12 bg-emerald-100 text-emerald-700 dark:bg-emerald-900 dark:text-emerald-300 rounded-lg flex items-center justify-center\">\n                    <Search className=\"h-6 w-6\" />\n                  </div>\n                  <div>\n                    <CardTitle>Video Finder</CardTitle>\n                    <CardDescription>Discover educational YouTube videos by topic</CardDescription>\n                  </div>\n                </div>\n              </CardHeader>\n              <CardContent>\n                <p className=\"text-sm text-muted-foreground mb-3\">\n                  Search and curate collections of educational YouTube videos based on specific learning criteria. Specify subject, topic, learning outcomes, grade level, and age range to find relevant video resources.\n                </p>\n                <p className=\"text-sm font-semibold text-foreground mb-2\">Best Practices:</p>\n                <ul className=\"text-sm text-muted-foreground list-disc list-inside space-y-1\">\n                  <li>Be specific with your search criteria for better results</li>\n                  <li>Include clear learning outcomes to focus the search</li>\n                  <li>Specify appropriate grade level and age range</li>\n                  <li>Review videos for content quality and relevance</li>\n                  <li>Share curated video collections with students for independent learning</li>\n                </ul>\n              </CardContent>\n            </Card>\n\n            <Card>\n              <CardHeader>\n                <div className=\"flex items-center gap-3\">\n                  <div className=\"h-12 w-12 bg-red-100 text-red-700 dark:bg-red-900 dark:text-red-300 rounded-lg flex items-center justify-center\">\n                    <Presentation className=\"h-6 w-6\" />\n                  </div>\n                  <div>\n                    <CardTitle>Google Slides</CardTitle>\n                    <CardDescription>AI-generated educational presentations</CardDescription>\n                  </div>\n                </div>\n              </CardHeader>\n              <CardContent>\n                <p className=\"text-sm text-muted-foreground mb-3\">\n                  Create professional educational presentations powered by AI. Specify your topic, grade level, and learning outcomes, and the AI generates a complete slide deck with real educational images from Unsplash. Export directly to Google Slides for editing and presenting.\n                </p>\n                <p className=\"text-sm font-semibold text-foreground mb-2\">Features:</p>\n                <ul className=\"text-sm text-muted-foreground list-disc list-inside space-y-1\">\n                  <li>AI-generated pedagogically sound content following Universal Design for Learning (UDL)</li>\n                  <li>Real educational images automatically sourced from Unsplash</li>\n                  <li>Speaker notes with teaching tips and pedagogical guidance</li>\n                  <li>Guiding questions (recall to analysis to application levels)</li>\n                  <li>Reflection questions for deeper thinking</li>\n                  <li>One-click export to create actual Google Slides presentations</li>\n                  <li>Full editing capability in Google Slides</li>\n                </ul>\n                <p className=\"text-sm font-semibold text-foreground mt-3 mb-2\">Best Practices:</p>\n                <ul className=\"text-sm text-muted-foreground list-disc list-inside space-y-1\">\n                  <li>Provide clear learning outcomes for better AI results</li>\n                  <li>Specify accurate grade level and age range</li>\n                  <li>Review and customize AI-generated content before sharing</li>\n                  <li>Use speaker notes as a teaching guide</li>\n                  <li>Edit in Google Slides for advanced customization</li>\n                </ul>\n              </CardContent>\n            </Card>\n          </div>\n        </div>\n\n        {/* Features Guide */}\n        <div className=\"mb-8\">\n          <h2 className=\"text-2xl font-bold text-foreground mb-6\">Features & Functions</h2>\n          \n          <Accordion type=\"single\" collapsible className=\"w-full\">\n            <AccordionItem value=\"ai-generation\">\n              <AccordionTrigger>\n                <div className=\"flex items-center gap-2\">\n                  <Sparkles className=\"h-5 w-5 text-primary\" />\n                  <span>AI Content Generation</span>\n                </div>\n              </AccordionTrigger>\n              <AccordionContent>\n                <div className=\"space-y-4 pt-2\">\n                  <p className=\"text-sm text-muted-foreground\">\n                    Save time by using AI to automatically generate educational content. The AI can create quizzes, flashcards, video hotspots, and more based on your specifications.\n                  </p>\n                  <div>\n                    <p className=\"text-sm font-semibold text-foreground mb-2\">How to Use AI Generation:</p>\n                    <ol className=\"text-sm text-muted-foreground list-decimal list-inside space-y-1\">\n                      <li>Click the AI generation button when creating content</li>\n                      <li>Enter your topic (e.g., \"Photosynthesis\", \"World War II\")</li>\n                      <li>Select difficulty level (Beginner, Intermediate, Advanced)</li>\n                      <li>Specify grade level and number of items</li>\n                      <li>Add any additional context or requirements</li>\n                      <li>Click Generate and review the AI-created content</li>\n                      <li>Edit and customize as needed before saving</li>\n                    </ol>\n                  </div>\n                  <div className=\"bg-accent/50 rounded-lg p-4\">\n                    <p className=\"text-sm font-semibold text-foreground mb-2\">Tips for Better AI Results:</p>\n                    <ul className=\"text-sm text-muted-foreground list-disc list-inside space-y-1\">\n                      <li>Be specific with your topic</li>\n                      <li>Include learning objectives in additional context</li>\n                      <li>Specify the appropriate grade level</li>\n                      <li>Review and fact-check AI-generated content</li>\n                    </ul>\n                  </div>\n                </div>\n              </AccordionContent>\n            </AccordionItem>\n\n            <AccordionItem value=\"publishing\">\n              <AccordionTrigger>\n                <div className=\"flex items-center gap-2\">\n                  <Share2 className=\"h-5 w-5 text-primary\" />\n                  <span>Publishing & Sharing</span>\n                </div>\n              </AccordionTrigger>\n              <AccordionContent>\n                <div className=\"space-y-4 pt-2\">\n                  <p className=\"text-sm text-muted-foreground\">\n                    Make your content accessible to students by publishing and sharing it. Published content gets a unique link that anyone can access.\n                  </p>\n                  <div>\n                    <p className=\"text-sm font-semibold text-foreground mb-2\">Publishing Process:</p>\n                    <ol className=\"text-sm text-muted-foreground list-decimal list-inside space-y-1\">\n                      <li>Complete and save your content</li>\n                      <li>Toggle the \"Published\" switch to make it live</li>\n                      <li>Click the Share button to get the public link</li>\n                      <li>Copy and share the link with your students</li>\n                      <li>Track student progress and completion</li>\n                    </ol>\n                  </div>\n                  <div className=\"bg-accent/50 rounded-lg p-4\">\n                    <p className=\"text-sm font-semibold text-foreground mb-2\">Privacy & Access:</p>\n                    <ul className=\"text-sm text-muted-foreground list-disc list-inside space-y-1\">\n                      <li>Only published content can be accessed via share links</li>\n                      <li>Unpublished content remains private to you</li>\n                      <li>You can unpublish content at any time</li>\n                      <li>Progress tracking works for both logged-in and anonymous users</li>\n                    </ul>\n                  </div>\n                </div>\n              </AccordionContent>\n            </AccordionItem>\n\n            <AccordionItem value=\"preview\">\n              <AccordionTrigger>\n                <div className=\"flex items-center gap-2\">\n                  <Eye className=\"h-5 w-5 text-primary\" />\n                  <span>Preview & Testing</span>\n                </div>\n              </AccordionTrigger>\n              <AccordionContent>\n                <div className=\"space-y-4 pt-2\">\n                  <p className=\"text-sm text-muted-foreground\">\n                    Always preview your content before publishing to ensure it works correctly and looks professional.\n                  </p>\n                  <div>\n                    <p className=\"text-sm font-semibold text-foreground mb-2\">Preview Features:</p>\n                    <ul className=\"text-sm text-muted-foreground list-disc list-inside space-y-1\">\n                      <li>Test all interactive elements</li>\n                      <li>Check question difficulty and clarity</li>\n                      <li>Verify images and media load correctly</li>\n                      <li>Test on both desktop and mobile devices</li>\n                      <li>Review feedback messages and explanations</li>\n                    </ul>\n                  </div>\n                  <p className=\"text-sm text-muted-foreground\">\n                    Click the \"Preview\" button from the dashboard or during editing to see how students will experience your content.\n                  </p>\n                </div>\n              </AccordionContent>\n            </AccordionItem>\n\n            <AccordionItem value=\"classroom\">\n              <AccordionTrigger>\n                <div className=\"flex items-center gap-2\">\n                  <GraduationCap className=\"h-5 w-5 text-primary\" />\n                  <span>Google Classroom Integration</span>\n                </div>\n              </AccordionTrigger>\n              <AccordionContent>\n                <div className=\"space-y-4 pt-2\">\n                  <p className=\"text-sm text-muted-foreground\">\n                    Share any published content directly to your Google Classroom courses as assignments or announcements. This feature works with all 10 content types.\n                  </p>\n                  <div>\n                    <p className=\"text-sm font-semibold text-foreground mb-2\">How to Share to Google Classroom:</p>\n                    <ol className=\"text-sm text-muted-foreground list-decimal list-inside space-y-1\">\n                      <li>Sign in with your Google account (required for Classroom access)</li>\n                      <li>Publish your content using the \"Published\" toggle</li>\n                      <li>Click the \"Share to Classroom\" button (appears in creator toolbar and preview page)</li>\n                      <li>Select whether to share as an Assignment or Announcement</li>\n                      <li>Choose the course from your list of active Google Classroom courses</li>\n                      <li>For assignments: optionally set a due date, time, and point value</li>\n                      <li>Click \"Share\" to post to Google Classroom</li>\n                    </ol>\n                  </div>\n                  <div className=\"bg-accent/50 rounded-lg p-4\">\n                    <p className=\"text-sm font-semibold text-foreground mb-2\">Supported Content Types:</p>\n                    <ul className=\"text-sm text-muted-foreground list-disc list-inside space-y-1\">\n                      <li>✓ Quizzes</li>\n                      <li>✓ Flashcards</li>\n                      <li>✓ Interactive Videos</li>\n                      <li>✓ Image Hotspots</li>\n                      <li>✓ Drag & Drop Activities</li>\n                      <li>✓ Fill in the Blanks</li>\n                      <li>✓ Memory Games</li>\n                      <li>✓ Interactive Books</li>\n                      <li>✓ Video Finder Collections</li>\n                      <li>✓ Google Slides Presentations</li>\n                    </ul>\n                  </div>\n                  <div>\n                    <p className=\"text-sm font-semibold text-foreground mb-2\">Requirements:</p>\n                    <ul className=\"text-sm text-muted-foreground list-disc list-inside space-y-1\">\n                      <li>Must sign in with a Google account that has access to Google Classroom</li>\n                      <li>Google Classroom API must be enabled in your Google Cloud Console</li>\n                      <li>Content must be published before sharing</li>\n                      <li>You must be the teacher of the course you're sharing to</li>\n                    </ul>\n                  </div>\n                  <div>\n                    <p className=\"text-sm font-semibold text-foreground mb-2\">Share Locations:</p>\n                    <ul className=\"text-sm text-muted-foreground list-disc list-inside space-y-1\">\n                      <li><strong>Creator Pages:</strong> Button appears in the toolbar when content is published</li>\n                      <li><strong>Preview Pages:</strong> Button appears in the header for all published content</li>\n                    </ul>\n                  </div>\n                </div>\n              </AccordionContent>\n            </AccordionItem>\n\n            <AccordionItem value=\"shared-resources\">\n              <AccordionTrigger>\n                <div className=\"flex items-center gap-2\">\n                  <Share2 className=\"h-5 w-5 text-primary\" />\n                  <span>Shared Resources</span>\n                </div>\n              </AccordionTrigger>\n              <AccordionContent>\n                <div className=\"space-y-4 pt-2\">\n                  <p className=\"text-sm text-muted-foreground\">\n                    Share your best educational content with other teachers across the Caribbean, and discover resources created by your colleagues. The Shared Resources feature helps build a collaborative community of educators.\n                  </p>\n                  <div>\n                    <p className=\"text-sm font-semibold text-foreground mb-2\">How to Share Your Content Publicly:</p>\n                    <ol className=\"text-sm text-muted-foreground list-decimal list-inside space-y-1\">\n                      <li>Create and complete your content (any of the 10 content types)</li>\n                      <li>Toggle the \"Published\" switch to make it live</li>\n                      <li>Enable the \"Share as Public Resource\" toggle in the content details</li>\n                      <li>Your content will now appear in the Shared Resources page for all teachers</li>\n                    </ol>\n                  </div>\n                  <div>\n                    <p className=\"text-sm font-semibold text-foreground mb-2\">How to Browse Shared Resources:</p>\n                    <ol className=\"text-sm text-muted-foreground list-decimal list-inside space-y-1\">\n                      <li>Click the \"Shared Resources\" button (Users icon) in the Dashboard header</li>\n                      <li>Browse through content shared by other teachers</li>\n                      <li>Use search to find specific topics or titles</li>\n                      <li>Filter by content type (Quiz, Flashcard, etc.)</li>\n                      <li>Filter by tags to find subject-specific content</li>\n                      <li>Click \"Preview & Use\" to view and interact with any resource</li>\n                    </ol>\n                  </div>\n                  <div className=\"bg-accent/50 rounded-lg p-4\">\n                    <p className=\"text-sm font-semibold text-foreground mb-2\">Privacy & Control:</p>\n                    <ul className=\"text-sm text-muted-foreground list-disc list-inside space-y-1\">\n                      <li>Only content you explicitly mark as public will be shared</li>\n                      <li>You can unpublish or remove public sharing at any time</li>\n                      <li>Content must be published before it can be made public</li>\n                      <li>Your name and basic info appear as the creator</li>\n                    </ul>\n                  </div>\n                  <div>\n                    <p className=\"text-sm font-semibold text-foreground mb-2\">Best Practices for Sharing:</p>\n                    <ul className=\"text-sm text-muted-foreground list-disc list-inside space-y-1\">\n                      <li>Add descriptive titles and clear descriptions</li>\n                      <li>Use relevant tags (subject, grade level, topic)</li>\n                      <li>Preview your content before making it public</li>\n                      <li>Share your best, most polished work</li>\n                      <li>Include learning outcomes in descriptions</li>\n                    </ul>\n                  </div>\n                </div>\n              </AccordionContent>\n            </AccordionItem>\n\n            <AccordionItem value=\"progress\">\n              <AccordionTrigger>\n                <div className=\"flex items-center gap-2\">\n                  <BookOpen className=\"h-5 w-5 text-primary\" />\n                  <span>Progress Tracking</span>\n                </div>\n              </AccordionTrigger>\n              <AccordionContent>\n                <div className=\"space-y-4 pt-2\">\n                  <p className=\"text-sm text-muted-foreground\">\n                    Track student progress automatically as they interact with your content. The system monitors completion, time spent, and performance.\n                  </p>\n                  <div>\n                    <p className=\"text-sm font-semibold text-foreground mb-2\">Tracked Metrics:</p>\n                    <ul className=\"text-sm text-muted-foreground list-disc list-inside space-y-1\">\n                      <li>Completion percentage for each content item</li>\n                      <li>Time spent on activities</li>\n                      <li>Quiz scores and attempt history</li>\n                      <li>Pages viewed in interactive books</li>\n                      <li>Individual interaction events (card flips, hotspot clicks)</li>\n                    </ul>\n                  </div>\n                  <div className=\"bg-accent/50 rounded-lg p-4\">\n                    <p className=\"text-sm font-semibold text-foreground mb-2\">How Progress Works:</p>\n                    <ul className=\"text-sm text-muted-foreground list-disc list-inside space-y-1\">\n                      <li>Progress is saved automatically as students interact</li>\n                      <li>Students can pick up where they left off</li>\n                      <li>Logged-in users get persistent progress across devices</li>\n                      <li>Anonymous users maintain progress during their session</li>\n                    </ul>\n                  </div>\n                </div>\n              </AccordionContent>\n            </AccordionItem>\n\n            <AccordionItem value=\"organization\">\n              <AccordionTrigger>\n                <div className=\"flex items-center gap-2\">\n                  <FileQuestion className=\"h-5 w-5 text-primary\" />\n                  <span>Content Organization</span>\n                </div>\n              </AccordionTrigger>\n              <AccordionContent>\n                <div className=\"space-y-4 pt-2\">\n                  <p className=\"text-sm text-muted-foreground\">\n                    Keep your content library organized with search, filtering, and tagging features.\n                  </p>\n                  <div>\n                    <p className=\"text-sm font-semibold text-foreground mb-2\">Organization Tools:</p>\n                    <ul className=\"text-sm text-muted-foreground list-disc list-inside space-y-1\">\n                      <li><strong>Search:</strong> Find content by title or description</li>\n                      <li><strong>Type Filters:</strong> View only specific content types</li>\n                      <li><strong>Tags:</strong> Add tags to categorize content (e.g., \"science\", \"grade-9\")</li>\n                      <li><strong>Date Filters:</strong> Filter by creation or modification date</li>\n                      <li><strong>View Modes:</strong> Switch between grid and list views</li>\n                    </ul>\n                  </div>\n                  <div className=\"bg-accent/50 rounded-lg p-4\">\n                    <p className=\"text-sm font-semibold text-foreground mb-2\">Tagging Best Practices:</p>\n                    <ul className=\"text-sm text-muted-foreground list-disc list-inside space-y-1\">\n                      <li>Use consistent tag names (e.g., \"biology\" not \"bio\")</li>\n                      <li>Include subject, grade level, and topic tags</li>\n                      <li>Don't over-tag - 3-5 tags per item is ideal</li>\n                      <li>Use lowercase for consistency</li>\n                    </ul>\n                  </div>\n                </div>\n              </AccordionContent>\n            </AccordionItem>\n          </Accordion>\n        </div>\n\n        {/* FAQ */}\n        <Card className=\"mb-8\">\n          <CardHeader>\n            <CardTitle>Frequently Asked Questions</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <Accordion type=\"single\" collapsible className=\"w-full\">\n              <AccordionItem value=\"faq-1\">\n                <AccordionTrigger>How do I delete content I no longer need?</AccordionTrigger>\n                <AccordionContent>\n                  <p className=\"text-sm text-muted-foreground\">\n                    From your dashboard, click the trash icon on any content card. You'll be asked to confirm the deletion. Note that this action cannot be undone, and any shared links will stop working.\n                  </p>\n                </AccordionContent>\n              </AccordionItem>\n\n              <AccordionItem value=\"faq-2\">\n                <AccordionTrigger>Can I edit content after it's published?</AccordionTrigger>\n                <AccordionContent>\n                  <p className=\"text-sm text-muted-foreground\">\n                    Yes! You can edit published content at any time. Changes are saved automatically and will be reflected immediately for anyone accessing the shared link. Student progress is preserved when you make edits.\n                  </p>\n                </AccordionContent>\n              </AccordionItem>\n\n              <AccordionItem value=\"faq-3\">\n                <AccordionTrigger>How accurate is the AI content generation?</AccordionTrigger>\n                <AccordionContent>\n                  <p className=\"text-sm text-muted-foreground\">\n                    The AI uses advanced language models to generate high-quality content, but it's important to always review and fact-check the generated material. The AI works best when you provide clear, specific topics and additional context. Think of it as a helpful assistant that provides a strong starting point that you can refine.\n                  </p>\n                </AccordionContent>\n              </AccordionItem>\n\n              <AccordionItem value=\"faq-4\">\n                <AccordionTrigger>Can students access content without creating an account?</AccordionTrigger>\n                <AccordionContent>\n                  <p className=\"text-sm text-muted-foreground\">\n                    Yes! Published content can be accessed by anyone with the share link, no account required. Anonymous users can complete activities and their progress is tracked during their session, though it won't be saved long-term. Students who create accounts get persistent progress tracking across devices.\n                  </p>\n                </AccordionContent>\n              </AccordionItem>\n\n              <AccordionItem value=\"faq-5\">\n                <AccordionTrigger>What image formats are supported?</AccordionTrigger>\n                <AccordionContent>\n                  <p className=\"text-sm text-muted-foreground\">\n                    You can upload images in JPG, PNG, GIF, and WebP formats. For best results, use high-resolution images (at least 1200px wide) and keep file sizes under 5MB for faster loading.\n                  </p>\n                </AccordionContent>\n              </AccordionItem>\n\n              <AccordionItem value=\"faq-6\">\n                <AccordionTrigger>How do I embed content in an Interactive Book?</AccordionTrigger>\n                <AccordionContent>\n                  <p className=\"text-sm text-muted-foreground\">\n                    When editing an Interactive Book page, use the \"Embed Content\" button to select from your existing quizzes, flashcards, or other content types. The embedded content will appear on that page and students can interact with it directly. Changes to the original content automatically update in the book.\n                  </p>\n                </AccordionContent>\n              </AccordionItem>\n\n              <AccordionItem value=\"faq-7\">\n                <AccordionTrigger>Is there a limit to how much content I can create?</AccordionTrigger>\n                <AccordionContent>\n                  <p className=\"text-sm text-muted-foreground\">\n                    There are no limits on the number of content items you can create. However, individual content items have practical limits (e.g., 50 questions per quiz, 100 flashcards per set) to ensure optimal performance and user experience.\n                  </p>\n                </AccordionContent>\n              </AccordionItem>\n            </Accordion>\n          </CardContent>\n        </Card>\n\n        {/* Support */}\n        <Card>\n          <CardHeader>\n            <CardTitle>Need More Help?</CardTitle>\n            <CardDescription>We're here to support Caribbean educators</CardDescription>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <p className=\"text-sm text-muted-foreground\">\n              OECS Content Creator is designed to empower educators across the Organization of Eastern Caribbean States. If you need additional assistance:\n            </p>\n            <div className=\"space-y-2\">\n              <div className=\"flex items-start gap-3\">\n                <Badge variant=\"outline\" className=\"mt-0.5\">Tip</Badge>\n                <p className=\"text-sm text-muted-foreground\">\n                  Try the AI generation feature with specific, detailed prompts for best results\n                </p>\n              </div>\n              <div className=\"flex items-start gap-3\">\n                <Badge variant=\"outline\" className=\"mt-0.5\">Tip</Badge>\n                <p className=\"text-sm text-muted-foreground\">\n                  Always preview your content before sharing with students\n                </p>\n              </div>\n              <div className=\"flex items-start gap-3\">\n                <Badge variant=\"outline\" className=\"mt-0.5\">Tip</Badge>\n                <p className=\"text-sm text-muted-foreground\">\n                  Use tags to organize content by subject, grade level, and topic\n                </p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        <div className=\"mt-8 text-center\">\n          <Button onClick={() => navigate(\"/dashboard\")} size=\"lg\" data-testid=\"button-back-to-dashboard\">\n            <ArrowLeft className=\"h-5 w-5 mr-2\" />\n            Back to Dashboard\n          </Button>\n        </div>\n      </main>\n    </div>\n  );\n}\n","size_bytes":45610},"client/src/components/LearnerNamePrompt.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { UserCircle, X } from \"lucide-react\";\n\nconst LEARNER_NAME_KEY = \"oecs-learner-name\";\n\ntype LearnerNamePromptProps = {\n  onNameSet: (name: string | null) => void;\n  isAuthenticated: boolean;\n};\n\nexport function LearnerNamePrompt({ onNameSet, isAuthenticated }: LearnerNamePromptProps) {\n  const [showPrompt, setShowPrompt] = useState(false);\n  const [name, setName] = useState(\"\");\n  const [hasDecided, setHasDecided] = useState(false);\n\n  useEffect(() => {\n    if (isAuthenticated) {\n      setShowPrompt(false);\n      setHasDecided(true);\n      return;\n    }\n\n    // Check if user has already provided or declined to provide name\n    const storedName = localStorage.getItem(LEARNER_NAME_KEY);\n    const hasDeclinedKey = localStorage.getItem(`${LEARNER_NAME_KEY}-declined`);\n    \n    if (storedName) {\n      setName(storedName);\n      onNameSet(storedName);\n      setHasDecided(true);\n    } else if (hasDeclinedKey === \"true\") {\n      setHasDecided(true);\n      onNameSet(null);\n    } else {\n      // Show prompt for first-time anonymous users\n      setShowPrompt(true);\n    }\n  }, [isAuthenticated, onNameSet]);\n\n  const handleSubmit = () => {\n    const trimmedName = name.trim();\n    if (trimmedName) {\n      localStorage.setItem(LEARNER_NAME_KEY, trimmedName);\n      localStorage.removeItem(`${LEARNER_NAME_KEY}-declined`);\n      onNameSet(trimmedName);\n    } else {\n      localStorage.setItem(`${LEARNER_NAME_KEY}-declined`, \"true\");\n      localStorage.removeItem(LEARNER_NAME_KEY);\n      onNameSet(null);\n    }\n    setShowPrompt(false);\n    setHasDecided(true);\n  };\n\n  const handleSkip = () => {\n    localStorage.setItem(`${LEARNER_NAME_KEY}-declined`, \"true\");\n    localStorage.removeItem(LEARNER_NAME_KEY);\n    onNameSet(null);\n    setShowPrompt(false);\n    setHasDecided(true);\n  };\n\n  if (!showPrompt || isAuthenticated || hasDecided) {\n    return null;\n  }\n\n  return (\n    <div className=\"fixed inset-0 bg-background/80 backdrop-blur-sm z-50 flex items-center justify-center p-4\">\n      <Card className=\"max-w-md w-full\">\n        <CardHeader>\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center gap-3\">\n              <div className=\"h-10 w-10 bg-primary rounded-lg flex items-center justify-center\">\n                <UserCircle className=\"h-6 w-6 text-primary-foreground\" />\n              </div>\n              <div>\n                <CardTitle>Welcome!</CardTitle>\n                <CardDescription>Optional: Tell us your name</CardDescription>\n              </div>\n            </div>\n            <Button variant=\"ghost\" size=\"icon\" onClick={handleSkip} data-testid=\"button-close-prompt\">\n              <X className=\"h-5 w-5\" />\n            </Button>\n          </div>\n        </CardHeader>\n        <CardContent className=\"space-y-4\">\n          <p className=\"text-sm text-muted-foreground\">\n            Help your instructor track your progress by providing your name. This is completely optional - you can skip this and remain anonymous.\n          </p>\n          <div className=\"space-y-3\">\n            <Input\n              type=\"text\"\n              placeholder=\"Enter your name (optional)\"\n              value={name}\n              onChange={(e) => setName(e.target.value)}\n              onKeyDown={(e) => e.key === \"Enter\" && handleSubmit()}\n              data-testid=\"input-learner-name\"\n              autoFocus\n            />\n            <div className=\"flex gap-2\">\n              <Button \n                onClick={handleSubmit} \n                className=\"flex-1\"\n                data-testid=\"button-submit-name\"\n              >\n                {name.trim() ? \"Continue with Name\" : \"Continue Anonymously\"}\n              </Button>\n              <Button \n                variant=\"outline\" \n                onClick={handleSkip}\n                data-testid=\"button-skip-name\"\n              >\n                Skip\n              </Button>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n\n// Export utility function to get stored learner name\nexport function getStoredLearnerName(): string | null {\n  if (typeof window === \"undefined\") return null;\n  return localStorage.getItem(LEARNER_NAME_KEY);\n}\n\n// Export utility function to clear learner name\nexport function clearLearnerName() {\n  if (typeof window === \"undefined\") return;\n  localStorage.removeItem(LEARNER_NAME_KEY);\n  localStorage.removeItem(`${LEARNER_NAME_KEY}-declined`);\n}\n","size_bytes":4689},"client/src/components/ScreenReaderAnnouncer.tsx":{"content":"import { useEffect, useState } from \"react\";\n\ninterface AnnouncementState {\n  message: string;\n  politeness: \"polite\" | \"assertive\";\n  key: number;\n}\n\ninterface ScreenReaderAnnouncerProps {\n  announcement: AnnouncementState | null;\n}\n\nexport function ScreenReaderAnnouncer({ announcement }: ScreenReaderAnnouncerProps) {\n  const [currentAnnouncement, setCurrentAnnouncement] = useState<string>(\"\");\n  const [currentPoliteness, setCurrentPoliteness] = useState<\"polite\" | \"assertive\">(\"polite\");\n  const [currentKey, setCurrentKey] = useState<number>(0);\n\n  useEffect(() => {\n    if (announcement && announcement.message) {\n      setCurrentAnnouncement(announcement.message);\n      setCurrentPoliteness(announcement.politeness);\n      setCurrentKey(announcement.key);\n      const timer = setTimeout(() => setCurrentAnnouncement(\"\"), 1000);\n      return () => clearTimeout(timer);\n    }\n  }, [announcement]);\n\n  if (!currentAnnouncement) return null;\n\n  return (\n    <div\n      key={currentKey}\n      role=\"status\"\n      aria-live={currentPoliteness}\n      aria-atomic=\"true\"\n      className=\"sr-only\"\n    >\n      {currentAnnouncement}\n    </div>\n  );\n}\n\nexport function useScreenReaderAnnounce() {\n  const [announcement, setAnnouncement] = useState<AnnouncementState | null>(null);\n  const [announcementKey, setAnnouncementKey] = useState(0);\n\n  const announce = (text: string, politeness: \"polite\" | \"assertive\" = \"polite\") => {\n    setAnnouncement(null);\n    setTimeout(() => {\n      setAnnouncementKey(prev => prev + 1);\n      setAnnouncement({ message: text, politeness, key: announcementKey + 1 });\n    }, 100);\n  };\n\n  return { announcement, announce };\n}\n","size_bytes":1661},"client/src/components/ChatAssistant.tsx":{"content":"import { useState, useRef, useEffect } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardFooter, CardHeader } from \"@/components/ui/card\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { \n  MessageCircle, \n  X, \n  Send, \n  Trash2, \n  Loader2,\n  Sparkles,\n  User,\n  Bot\n} from \"lucide-react\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useChatContext } from \"@/hooks/useChatContext\";\nimport ReactMarkdown from \"react-markdown\";\nimport remarkGfm from \"remark-gfm\";\nimport type { ChatMessage } from \"@shared/schema\";\n\ninterface ChatAssistantProps {\n  // No props needed - uses context provider\n}\n\nexport default function ChatAssistant({}: ChatAssistantProps) {\n  const [isOpen, setIsOpen] = useState(false);\n  const [message, setMessage] = useState(\"\");\n  const [streamingMessage, setStreamingMessage] = useState(\"\");\n  const [isStreaming, setIsStreaming] = useState(false);\n  const scrollRef = useRef<HTMLDivElement>(null);\n  const textareaRef = useRef<HTMLTextAreaElement>(null);\n  const activeRequestIdRef = useRef<number>(0);\n  const { toast} = useToast();\n  const chatContext = useChatContext();\n\n  const { data: history = [] } = useQuery<ChatMessage[]>({\n    queryKey: [\"/api/chat/history\"],\n    enabled: isOpen,\n  });\n\n  const clearHistoryMutation = useMutation({\n    mutationFn: () => apiRequest(\"/api/chat/history\", \"DELETE\"),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/chat/history\"] });\n      toast({\n        title: \"Chat history cleared\",\n        description: \"All messages have been removed\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Failed to clear chat history\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const sendMessage = async () => {\n    if (!message.trim() || isStreaming) return;\n\n    // Generate unique request ID to prevent overlapping streams\n    const requestId = ++activeRequestIdRef.current;\n\n    const userMessage = message.trim();\n    setMessage(\"\");\n    setIsStreaming(true);\n    setStreamingMessage(\"\");\n\n    try {\n      const response = await fetch(\"/api/chat\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify({\n          message: userMessage,\n          context: chatContext,\n        }),\n      });\n\n      if (!response.ok) {\n        throw new Error(\"Failed to send message\");\n      }\n\n      const reader = response.body?.getReader();\n      const decoder = new TextDecoder();\n\n      if (!reader) {\n        throw new Error(\"No response stream\");\n      }\n\n      let fullResponse = \"\";\n\n      while (true) {\n        const { done, value } = await reader.read();\n        if (done) break;\n\n        const chunk = decoder.decode(value);\n        const lines = chunk.split(\"\\n\");\n\n        for (const line of lines) {\n          if (line.startsWith(\"data: \")) {\n            const data = line.slice(6);\n            if (data === \"[DONE]\") {\n              break;\n            }\n\n            try {\n              const parsed = JSON.parse(data);\n              if (parsed.content) {\n                fullResponse += parsed.content;\n                setStreamingMessage(fullResponse);\n              } else if (parsed.error) {\n                throw new Error(parsed.error);\n              }\n            } catch (e) {\n              // Ignore parsing errors for incomplete chunks\n            }\n          }\n        }\n      }\n\n      // Verify the assistant message is persisted in history before clearing\n      // This prevents clearing streamingMessage before the message appears in history\n      const verifyMessagePersisted = async (): Promise<boolean> => {\n        const maxAttempts = 10; // Try 10 times max\n        \n        for (let attempt = 0; attempt < maxAttempts; attempt++) {\n          try {\n            // Use fetchQuery to get fresh data from server (not cached)\n            const currentHistory = await queryClient.fetchQuery<ChatMessage[]>({\n              queryKey: [\"/api/chat/history\"],\n            });\n            \n            if (currentHistory && currentHistory.length > 0) {\n              const lastMessage = currentHistory[currentHistory.length - 1];\n              // Check if the last message matches our streamed response (trim for resilience)\n              if (lastMessage.role === \"assistant\" && lastMessage.content.trim() === fullResponse.trim()) {\n                return true; // Message confirmed in history\n              }\n            }\n          } catch (error) {\n            console.error(\"Error fetching chat history during verification:\", error);\n          }\n          \n          // If not the active request anymore, stop checking\n          if (requestId !== activeRequestIdRef.current) {\n            return false;\n          }\n          \n          // Wait before next refetch (except on last attempt)\n          if (attempt < maxAttempts - 1) {\n            await new Promise(resolve => setTimeout(resolve, 200));\n          }\n        }\n        \n        return false; // Timeout\n      };\n      \n      const verified = await verifyMessagePersisted();\n      \n      // Only clear if message is verified AND still the active request\n      if (verified && requestId === activeRequestIdRef.current) {\n        setStreamingMessage(\"\");\n      } else if (!verified && requestId === activeRequestIdRef.current) {\n        // IMPORTANT: Don't clear if verification failed - leave message visible\n        // This prevents the disappearing message bug\n        console.warn(\"Chat message not verified in history - keeping streamingMessage visible\");\n        toast({\n          title: \"Message delivery delayed\",\n          description: \"Your message was sent but may take a moment to appear\",\n          variant: \"default\",\n        });\n      }\n    } catch (error: any) {\n      console.error(\"Chat error:\", error);\n      toast({\n        title: \"Failed to send message\",\n        description: error.message || \"Please try again\",\n        variant: \"destructive\",\n      });\n      setStreamingMessage(\"\");\n    } finally {\n      setIsStreaming(false);\n    }\n  };\n\n  const handleKeyDown = (e: React.KeyboardEvent) => {\n    if (e.key === \"Enter\" && !e.shiftKey) {\n      e.preventDefault();\n      sendMessage();\n    } else if (e.key === \"Escape\") {\n      setIsOpen(false);\n    }\n  };\n\n  useEffect(() => {\n    if (scrollRef.current) {\n      scrollRef.current.scrollTop = scrollRef.current.scrollHeight;\n    }\n  }, [history, streamingMessage]);\n\n  useEffect(() => {\n    if (isOpen && textareaRef.current) {\n      textareaRef.current.focus();\n    }\n  }, [isOpen]);\n\n  if (!isOpen) {\n    return (\n      <Button\n        size=\"icon\"\n        variant=\"default\"\n        className=\"!fixed !bottom-6 !right-6 !h-16 !w-16 !rounded-full !shadow-2xl !z-50 hover-elevate active-elevate-2 !animate-pulse hover:!animate-none\"\n        onClick={() => setIsOpen(true)}\n        data-testid=\"button-open-chat\"\n        aria-label=\"Open AI assistant chat\"\n        style={{ position: 'fixed', bottom: '1.5rem', right: '1.5rem' }}\n      >\n        <MessageCircle className=\"h-7 w-7\" />\n      </Button>\n    );\n  }\n\n  return (\n    <Card \n      className=\"!fixed !bottom-6 !right-6 w-[calc(100%-3rem)] sm:w-96 h-[calc(100vh-3rem)] sm:h-[600px] flex flex-col shadow-2xl !z-50 border-2\"\n      role=\"dialog\"\n      aria-label=\"AI Assistant Chat\"\n      aria-modal=\"false\"\n      data-testid=\"card-chat-assistant\"\n      style={{ position: 'fixed', bottom: '1.5rem', right: '1.5rem' }}\n    >\n      <CardHeader className=\"flex flex-row items-center justify-between gap-2 space-y-0 pb-3 border-b\">\n        <div className=\"flex items-center gap-2\">\n          <div className=\"h-8 w-8 rounded-full bg-primary/10 flex items-center justify-center\">\n            <Sparkles className=\"h-4 w-4 text-primary\" />\n          </div>\n          <div>\n            <h3 className=\"font-semibold text-sm\">AI Assistant</h3>\n            <p className=\"text-xs text-muted-foreground\">Here to help you create</p>\n          </div>\n        </div>\n        <div className=\"flex items-center gap-1\">\n          {history.length > 0 && (\n            <Button\n              size=\"icon\"\n              variant=\"ghost\"\n              onClick={() => clearHistoryMutation.mutate()}\n              disabled={clearHistoryMutation.isPending}\n              data-testid=\"button-clear-chat\"\n              aria-label=\"Clear chat history\"\n            >\n              <Trash2 className=\"h-4 w-4\" />\n            </Button>\n          )}\n          <Button\n            size=\"icon\"\n            variant=\"ghost\"\n            onClick={() => setIsOpen(false)}\n            data-testid=\"button-close-chat\"\n            aria-label=\"Close chat\"\n          >\n            <X className=\"h-4 w-4\" />\n          </Button>\n        </div>\n      </CardHeader>\n\n      <CardContent className=\"flex-1 p-0 overflow-hidden\">\n        <ScrollArea className=\"h-full\" ref={scrollRef}>\n          <div className=\"p-4 space-y-4\" role=\"log\" aria-live=\"polite\" aria-atomic=\"false\">\n            {history.length === 0 && !streamingMessage && (\n              <div className=\"text-center text-sm text-muted-foreground py-8\">\n                <Sparkles className=\"h-12 w-12 mx-auto mb-3 text-primary/30\" />\n                <p className=\"font-medium mb-1\">Welcome to your AI Assistant!</p>\n                <p className=\"text-xs\">\n                  Ask me anything about creating content, using the platform, or\n                  educational best practices.\n                </p>\n              </div>\n            )}\n\n            {history.map((msg) => (\n              <div\n                key={msg.id}\n                className={`flex gap-3 ${\n                  msg.role === \"user\" ? \"justify-end\" : \"justify-start\"\n                }`}\n                data-testid={`chat-message-${msg.role}`}\n              >\n                {msg.role === \"assistant\" && (\n                  <div className=\"h-8 w-8 rounded-full bg-primary/10 flex items-center justify-center flex-shrink-0\">\n                    <Bot className=\"h-4 w-4 text-primary\" />\n                  </div>\n                )}\n                <div\n                  className={`rounded-lg px-3 py-2 max-w-[85%] ${\n                    msg.role === \"user\"\n                      ? \"bg-primary text-primary-foreground\"\n                      : \"bg-muted\"\n                  }`}\n                >\n                  {msg.role === \"assistant\" ? (\n                    <div className=\"prose prose-sm dark:prose-invert max-w-none\">\n                      <ReactMarkdown remarkPlugins={[remarkGfm]}>\n                        {msg.content}\n                      </ReactMarkdown>\n                    </div>\n                  ) : (\n                    <p className=\"text-sm whitespace-pre-wrap\">{msg.content}</p>\n                  )}\n                </div>\n                {msg.role === \"user\" && (\n                  <div className=\"h-8 w-8 rounded-full bg-primary/10 flex items-center justify-center flex-shrink-0\">\n                    <User className=\"h-4 w-4 text-primary\" />\n                  </div>\n                )}\n              </div>\n            ))}\n\n            {streamingMessage && (\n              <div className=\"flex gap-3 justify-start\" data-testid=\"chat-streaming-message\">\n                <div className=\"h-8 w-8 rounded-full bg-primary/10 flex items-center justify-center flex-shrink-0\">\n                  <Bot className=\"h-4 w-4 text-primary\" />\n                </div>\n                <div className=\"rounded-lg px-3 py-2 max-w-[85%] bg-muted\">\n                  <div className=\"prose prose-sm dark:prose-invert max-w-none\">\n                    <ReactMarkdown remarkPlugins={[remarkGfm]}>\n                      {streamingMessage}\n                    </ReactMarkdown>\n                  </div>\n                </div>\n              </div>\n            )}\n\n            {isStreaming && !streamingMessage && (\n              <div className=\"flex gap-3 justify-start\">\n                <div className=\"h-8 w-8 rounded-full bg-primary/10 flex items-center justify-center flex-shrink-0\">\n                  <Bot className=\"h-4 w-4 text-primary\" />\n                </div>\n                <div className=\"rounded-lg px-3 py-2 bg-muted\">\n                  <Loader2 className=\"h-4 w-4 animate-spin text-muted-foreground\" />\n                </div>\n              </div>\n            )}\n          </div>\n        </ScrollArea>\n      </CardContent>\n\n      <CardFooter className=\"flex flex-col gap-2 border-t p-3\">\n        <div className=\"flex gap-2 w-full\">\n          <Textarea\n            ref={textareaRef}\n            placeholder=\"Ask me anything...\"\n            value={message}\n            onChange={(e) => setMessage(e.target.value)}\n            onKeyDown={handleKeyDown}\n            disabled={isStreaming}\n            className=\"min-h-[60px] max-h-[120px] resize-none text-sm\"\n            data-testid=\"input-chat-message\"\n            aria-label=\"Chat message input\"\n          />\n          <Button\n            size=\"icon\"\n            onClick={sendMessage}\n            disabled={!message.trim() || isStreaming}\n            className=\"flex-shrink-0\"\n            data-testid=\"button-send-message\"\n            aria-label=\"Send message\"\n          >\n            {isStreaming ? (\n              <Loader2 className=\"h-4 w-4 animate-spin\" />\n            ) : (\n              <Send className=\"h-4 w-4\" />\n            )}\n          </Button>\n        </div>\n        <p className=\"text-xs text-muted-foreground text-center w-full\">\n          Press Enter to send, Shift+Enter for new line\n        </p>\n      </CardFooter>\n    </Card>\n  );\n}\n","size_bytes":13736},"client/src/hooks/useChatContext.tsx":{"content":"import { createContext, useContext, useMemo } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { useAuth } from \"@/hooks/useAuth\";\n\ninterface ChatContextValue {\n  page: string;\n  contentType?: string;\n  contentId?: string;\n  userRole?: string;\n  institution?: string;\n}\n\nconst ChatContext = createContext<ChatContextValue | null>(null);\n\nexport function ChatContextProvider({ children }: { children: React.ReactNode }) {\n  const [location] = useLocation();\n  const { user } = useAuth();\n\n  const contextValue = useMemo(() => {\n    let page = \"Dashboard\";\n    let contentType: string | undefined;\n    let contentId: string | undefined;\n\n    if (location.startsWith(\"/create/\")) {\n      const parts = location.split(\"/\");\n      contentType = parts[2]?.split(\"?\")[0];\n      contentId = parts[3];\n      page = `${contentType} Creator`;\n    } else if (location.startsWith(\"/preview/\")) {\n      page = \"Preview\";\n      contentId = location.split(\"/\")[2];\n    } else if (location.startsWith(\"/analytics\")) {\n      page = \"Analytics Dashboard\";\n    } else if (location.startsWith(\"/help\")) {\n      page = \"Help Center\";\n    } else if (location.startsWith(\"/share/\")) {\n      page = \"Share\";\n      contentId = location.split(\"/\")[2];\n    } else if (location === \"/\" || location.startsWith(\"/dashboard\")) {\n      page = \"Dashboard\";\n    }\n\n    return {\n      page,\n      contentType,\n      contentId,\n      userRole: user?.role,\n      institution: user?.institution || undefined,\n    };\n  }, [location, user]);\n\n  return (\n    <ChatContext.Provider value={contextValue}>\n      {children}\n    </ChatContext.Provider>\n  );\n}\n\nexport function useChatContext() {\n  const context = useContext(ChatContext);\n  if (!context) {\n    throw new Error(\"useChatContext must be used within ChatContextProvider\");\n  }\n  return context;\n}\n","size_bytes":1823},"client/src/pages/LandingPage.tsx":{"content":"import { useLocation } from \"wouter\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { \n  BookOpen, \n  Layers, \n  Video, \n  Image as ImageIcon, \n  Move, \n  Edit3, \n  Brain, \n  BookText,\n  Search,\n  Presentation,\n  Sparkles,\n  Users,\n  Globe,\n  ArrowRight,\n  CheckCircle2,\n  GraduationCap\n} from \"lucide-react\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { useEffect } from \"react\";\nimport heroBackground from \"@assets/lboard_1763248872214.png\";\n\nexport default function LandingPage() {\n  const [_, navigate] = useLocation();\n  const { user } = useAuth();\n\n  useEffect(() => {\n    if (user) {\n      navigate(\"/dashboard\");\n    }\n  }, [user, navigate]);\n\n  const contentTypes = [\n    { icon: BookOpen, name: \"Quiz\", description: \"Interactive quizzes with instant feedback\", color: \"bg-blue-100 dark:bg-blue-950 text-blue-600 dark:text-blue-400\" },\n    { icon: Layers, name: \"Flashcard\", description: \"Digital flashcards with optional images\", color: \"bg-purple-100 dark:bg-purple-950 text-purple-600 dark:text-purple-400\" },\n    { icon: Video, name: \"Interactive Video\", description: \"Videos with embedded questions\", color: \"bg-green-100 dark:bg-green-950 text-green-600 dark:text-green-400\" },\n    { icon: ImageIcon, name: \"Image Hotspot\", description: \"Clickable areas on images\", color: \"bg-orange-100 dark:bg-orange-950 text-orange-600 dark:text-orange-400\" },\n    { icon: Move, name: \"Drag & Drop\", description: \"Match items by dragging\", color: \"bg-pink-100 dark:bg-pink-950 text-pink-600 dark:text-pink-400\" },\n    { icon: Edit3, name: \"Fill in Blanks\", description: \"Complete sentences with missing words\", color: \"bg-cyan-100 dark:bg-cyan-950 text-cyan-600 dark:text-cyan-400\" },\n    { icon: Brain, name: \"Memory Game\", description: \"Flip cards to find matching pairs\", color: \"bg-yellow-100 dark:bg-yellow-950 text-yellow-600 dark:text-yellow-400\" },\n    { icon: BookText, name: \"Interactive Book\", description: \"Rich multimedia books\", color: \"bg-indigo-100 dark:bg-indigo-950 text-indigo-600 dark:text-indigo-400\" },\n    { icon: Search, name: \"Video Finder\", description: \"Find educational videos from YouTube\", color: \"bg-emerald-100 dark:bg-emerald-950 text-emerald-600 dark:text-emerald-400\" },\n    { icon: Presentation, name: \"Google Slides\", description: \"AI-generated presentations with real images\", color: \"bg-red-100 dark:bg-red-950 text-red-600 dark:text-red-400\" },\n  ];\n\n  const features = [\n    { icon: Sparkles, title: \"AI-Powered Generation\", description: \"Create content faster with AI assistance using GPT-5\" },\n    { icon: GraduationCap, title: \"Google Classroom Integration\", description: \"Share all content types directly to your courses\" },\n    { icon: Users, title: \"Progress Tracking\", description: \"Monitor student engagement and completion rates\" },\n    { icon: Globe, title: \"Public Sharing\", description: \"Share content with shareable links\" },\n    { icon: CheckCircle2, title: \"Accessible Design\", description: \"WCAG 2.1 AA compliant for all learners\" },\n  ];\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      {/* Header */}\n      <header className=\"sticky top-0 z-50 w-full border-b bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60\" role=\"banner\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"flex h-16 items-center justify-between gap-4\">\n            {/* Logo */}\n            <div className=\"flex items-center gap-2\">\n              <img \n                src=\"/favicon.png\" \n                alt=\"OECS Content Creator Logo\" \n                className=\"h-9 w-9 rounded-lg\"\n              />\n              <div className=\"hidden sm:block\">\n                <h1 className=\"font-bold text-lg text-foreground\">OECS Content Creator</h1>\n                <p className=\"text-xs text-muted-foreground\">Create. Engage. Educate.</p>\n              </div>\n            </div>\n\n            {/* Navigation */}\n            <nav className=\"hidden md:flex items-center gap-6\" role=\"navigation\">\n              <a \n                href=\"#features\" \n                className=\"text-sm font-medium text-muted-foreground hover:text-foreground transition-colors\"\n                data-testid=\"link-nav-features\"\n              >\n                Features\n              </a>\n              <a \n                href=\"#content-types\" \n                className=\"text-sm font-medium text-muted-foreground hover:text-foreground transition-colors\"\n                data-testid=\"link-nav-content-types\"\n              >\n                Content Types\n              </a>\n              <a \n                href=\"#get-started\" \n                className=\"text-sm font-medium text-muted-foreground hover:text-foreground transition-colors\"\n                data-testid=\"link-nav-get-started\"\n              >\n                Get Started\n              </a>\n            </nav>\n\n            {/* CTA Buttons */}\n            <div className=\"flex items-center gap-2\">\n              <Button \n                variant=\"ghost\" \n                onClick={() => navigate(\"/login\")}\n                data-testid=\"button-login\"\n              >\n                Log In\n              </Button>\n              <Button \n                onClick={() => navigate(\"/login\")}\n                data-testid=\"button-signup\"\n              >\n                Sign Up\n              </Button>\n            </div>\n          </div>\n        </div>\n      </header>\n\n      {/* Hero Section */}\n      <section className=\"relative overflow-hidden py-20 sm:py-32\" role=\"main\">\n        {/* Background Image */}\n        <div \n          className=\"absolute inset-0 z-0\"\n          style={{\n            backgroundImage: `url(${heroBackground})`,\n            backgroundSize: 'cover',\n            backgroundPosition: 'center',\n            backgroundRepeat: 'no-repeat'\n          }}\n        />\n        \n        {/* Gradient Overlay */}\n        <div \n          className=\"absolute inset-0 z-10\"\n          style={{\n            background: 'linear-gradient(135deg, rgba(82, 64, 59, 0.85) 0%, rgba(34, 139, 34, 0.75) 50%, rgba(0, 128, 128, 0.85) 100%)'\n          }}\n        />\n\n        <div className=\"relative z-20 max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"text-center\">\n            <h2 className=\"text-4xl sm:text-5xl lg:text-6xl font-bold tracking-tight text-white mb-6\">\n              Create Interactive Educational\n              <span className=\"block text-primary-foreground mt-2\" style={{ color: '#a3e635' }}>Content in Minutes</span>\n            </h2>\n            <p className=\"mt-6 text-lg sm:text-xl text-gray-100 max-w-3xl mx-auto\">\n              Empower educators across the Eastern Caribbean with AI-powered tools to create \n              engaging quizzes, flashcards, interactive videos, and more. All in one platform.\n            </p>\n            <div className=\"mt-10 flex flex-col sm:flex-row items-center justify-center gap-4\">\n              <Button \n                size=\"lg\" \n                onClick={() => navigate(\"/login\")}\n                className=\"w-full sm:w-auto bg-primary hover:bg-primary/90 text-primary-foreground border-0\"\n                data-testid=\"button-hero-get-started\"\n              >\n                Get Started Free\n                <ArrowRight className=\"ml-2 h-5 w-5\" />\n              </Button>\n              <Button \n                size=\"lg\" \n                variant=\"outline\" \n                onClick={() => document.getElementById('content-types')?.scrollIntoView({ behavior: 'smooth' })}\n                className=\"w-full sm:w-auto border-white text-white hover:bg-white/10 backdrop-blur-sm\"\n                data-testid=\"button-hero-learn-more\"\n              >\n                Learn More\n              </Button>\n            </div>\n          </div>\n\n          {/* Stats */}\n          <div className=\"mt-20 grid grid-cols-1 sm:grid-cols-3 gap-8 max-w-4xl mx-auto\">\n            <div className=\"text-center\">\n              <div className=\"text-4xl font-bold text-white mb-2\" style={{ color: '#a3e635' }}>10</div>\n              <div className=\"text-sm text-gray-100\">Content Types</div>\n            </div>\n            <div className=\"text-center\">\n              <div className=\"text-4xl font-bold text-white mb-2\" style={{ color: '#a3e635' }}>AI</div>\n              <div className=\"text-sm text-gray-100\">Powered Generation</div>\n            </div>\n            <div className=\"text-center\">\n              <div className=\"text-4xl font-bold text-white mb-2\" style={{ color: '#a3e635' }}>100%</div>\n              <div className=\"text-sm text-gray-100\">Free to Start</div>\n            </div>\n          </div>\n        </div>\n      </section>\n\n      {/* Features Section */}\n      <section id=\"features\" className=\"py-20 bg-muted/30 scroll-mt-20\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"text-center mb-16\">\n            <h3 className=\"text-3xl sm:text-4xl font-bold text-foreground mb-4\">\n              Built for Caribbean Educators\n            </h3>\n            <p className=\"text-lg text-muted-foreground max-w-2xl mx-auto\">\n              Everything you need to create, share, and track interactive educational content\n            </p>\n          </div>\n\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6\">\n            {features.map((feature, index) => (\n              <Card key={index} className=\"hover-elevate\">\n                <CardContent className=\"p-6\">\n                  <div className=\"h-12 w-12 rounded-lg bg-primary/10 flex items-center justify-center mb-4\">\n                    <feature.icon className=\"h-6 w-6 text-primary\" />\n                  </div>\n                  <h4 className=\"font-semibold text-foreground mb-2\">{feature.title}</h4>\n                  <p className=\"text-sm text-muted-foreground\">{feature.description}</p>\n                </CardContent>\n              </Card>\n            ))}\n          </div>\n        </div>\n      </section>\n\n      {/* Content Types Section */}\n      <section id=\"content-types\" className=\"py-20 scroll-mt-20\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"text-center mb-16\">\n            <h3 className=\"text-3xl sm:text-4xl font-bold text-foreground mb-4\">\n              10 Interactive Content Types\n            </h3>\n            <p className=\"text-lg text-muted-foreground max-w-2xl mx-auto\">\n              Choose from a variety of engaging formats to match your teaching style\n            </p>\n          </div>\n\n          <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-6\">\n            {contentTypes.map((type, index) => (\n              <Card key={index} className=\"hover-elevate\">\n                <CardContent className=\"p-6\">\n                  <div className={`h-14 w-14 rounded-lg ${type.color} flex items-center justify-center mb-4`}>\n                    <type.icon className=\"h-7 w-7\" />\n                  </div>\n                  <h4 className=\"font-semibold text-foreground mb-2\">{type.name}</h4>\n                  <p className=\"text-sm text-muted-foreground\">{type.description}</p>\n                </CardContent>\n              </Card>\n            ))}\n          </div>\n        </div>\n      </section>\n\n      {/* CTA Section */}\n      <section id=\"get-started\" className=\"py-20 bg-primary text-primary-foreground scroll-mt-20\">\n        <div className=\"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 text-center\">\n          <h3 className=\"text-3xl sm:text-4xl font-bold mb-4\">\n            Ready to Transform Your Teaching?\n          </h3>\n          <p className=\"text-lg mb-8 opacity-90\">\n            Join educators across the Eastern Caribbean creating engaging content with OECS Content Creator\n          </p>\n          <div className=\"flex flex-col sm:flex-row items-center justify-center gap-4\">\n            <Button \n              size=\"lg\" \n              variant=\"secondary\"\n              onClick={() => navigate(\"/login\")}\n              className=\"w-full sm:w-auto\"\n              data-testid=\"button-cta-get-started\"\n            >\n              Get Started Now\n              <ArrowRight className=\"ml-2 h-5 w-5\" />\n            </Button>\n          </div>\n        </div>\n      </section>\n\n      {/* Footer */}\n      <footer className=\"border-t bg-muted/30 py-12\" role=\"contentinfo\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-8 mb-8\">\n            {/* Brand */}\n            <div>\n              <div className=\"flex items-center gap-2 mb-4\">\n                <div className=\"h-8 w-8 rounded-lg bg-primary flex items-center justify-center\">\n                  <BookOpen className=\"h-4 w-4 text-primary-foreground\" />\n                </div>\n                <span className=\"font-bold text-foreground\">OECS Content Creator</span>\n              </div>\n              <p className=\"text-sm text-muted-foreground\">\n                Create. Engage. Educate.\n              </p>\n            </div>\n\n            {/* Links */}\n            <div>\n              <h4 className=\"font-semibold text-foreground mb-4\">Product</h4>\n              <ul className=\"space-y-2\">\n                <li>\n                  <a \n                    href=\"#features\" \n                    className=\"text-sm text-muted-foreground hover:text-foreground transition-colors\"\n                    data-testid=\"link-footer-features\"\n                  >\n                    Features\n                  </a>\n                </li>\n                <li>\n                  <a \n                    href=\"#content-types\" \n                    className=\"text-sm text-muted-foreground hover:text-foreground transition-colors\"\n                    data-testid=\"link-footer-content-types\"\n                  >\n                    Content Types\n                  </a>\n                </li>\n              </ul>\n            </div>\n\n            {/* Support */}\n            <div>\n              <h4 className=\"font-semibold text-foreground mb-4\">Support</h4>\n              <ul className=\"space-y-2\">\n                <li>\n                  <button \n                    onClick={() => navigate(\"/login\")}\n                    className=\"text-sm text-muted-foreground hover:text-foreground transition-colors\"\n                    data-testid=\"link-footer-login\"\n                  >\n                    Log In\n                  </button>\n                </li>\n                <li>\n                  <button \n                    onClick={() => navigate(\"/login\")}\n                    className=\"text-sm text-muted-foreground hover:text-foreground transition-colors\"\n                    data-testid=\"link-footer-signup\"\n                  >\n                    Sign Up\n                  </button>\n                </li>\n              </ul>\n            </div>\n          </div>\n\n          {/* Copyright */}\n          <div className=\"pt-8 border-t text-center\">\n            <p className=\"text-sm text-muted-foreground\">\n              © {new Date().getFullYear()} OECS Content Creator. Built for educators across the Eastern Caribbean.\n            </p>\n          </div>\n        </div>\n      </footer>\n    </div>\n  );\n}\n","size_bytes":15183},"OAUTH_SETUP_GUIDE.md":{"content":"# OAuth Authentication Setup Guide\n\nThis guide explains how to configure Google and Microsoft authentication for your OECS Content Creator application.\n\n## How Redirect URIs Are Determined\n\nThe application automatically determines the correct redirect URI based on the environment:\n\n**Domain Precedence Order:**\n1. **Custom Domain** (if `REPLIT_DOMAINS` is set): `https://h5pcreator.org`\n2. **Workspace URL** (if deployed on Replit): `https://workspace.username.repl.co`\n3. **Production Fallback**: `https://h5pcreator.org`\n4. **Development**: `http://localhost:5000`\n\nThis means you may need to register multiple redirect URIs in Google/Azure depending on your deployment setup.\n\n## Required Secrets\n\nAdd these secrets to your Replit project (Tools → Secrets):\n\n### For Google OAuth:\n- `GOOGLE_CLIENT_ID`\n- `GOOGLE_CLIENT_SECRET`\n\n### For Microsoft OAuth:\n- `MICROSOFT_CLIENT_ID`\n- `MICROSOFT_CLIENT_SECRET`\n- `MICROSOFT_TENANT_ID` (use \"common\" to allow any Microsoft account)\n\n## Setting Up Google OAuth\n\n### 1. Create Google Cloud Project\n\n1. Go to [Google Cloud Console](https://console.cloud.google.com/)\n2. Create a new project or select an existing one\n3. Enable the Google+ API\n\n### 2. Configure OAuth Consent Screen\n\n1. Navigate to **APIs & Services** → **OAuth consent screen**\n2. Choose **External** user type\n3. Fill in required fields:\n   - App name: `OECS Content Creator`\n   - User support email: Your email\n   - Developer contact: Your email\n4. Add scopes: `email`, `profile`\n5. Save and continue\n\n### 3. Create OAuth Credentials\n\n1. Go to **APIs & Services** → **Credentials**\n2. Click **Create Credentials** → **OAuth client ID**\n3. Application type: **Web application**\n4. Name: `OECS Content Creator`\n5. **Authorized JavaScript origins**:\n   - Development: `http://localhost:5000`\n   - Production: `https://h5pcreator.org`\n   - Workspace (if testing): `https://workspace.yourusername.repl.co`\n6. **Authorized redirect URIs** (add all that apply):\n   - Development: `http://localhost:5000/api/auth/google/callback`\n   - Custom domain: `https://h5pcreator.org/api/auth/google/callback`\n   - Workspace (optional): `https://workspace.yourusername.repl.co/api/auth/google/callback`\n7. Click **Create**\n8. Copy the **Client ID** and **Client Secret**\n\n**Note**: Google OAuth automatically uses the request host, so all configured redirect URIs will work. The app will redirect to whichever domain you're currently accessing.\n\n### 4. Add Secrets to Replit\n\n1. Open your Replit project\n2. Click **Tools** → **Secrets** (lock icon 🔒)\n3. Add:\n   - Key: `GOOGLE_CLIENT_ID`, Value: [paste your client ID]\n   - Key: `GOOGLE_CLIENT_SECRET`, Value: [paste your client secret]\n\n---\n\n## Setting Up Microsoft OAuth\n\n### 1. Register Application in Azure\n\n1. Go to [Azure Portal](https://portal.azure.com)\n2. Navigate to **Azure Active Directory** → **App registrations**\n3. Click **New registration**\n4. Fill in details:\n   - Name: `OECS Content Creator`\n   - Supported account types: **Accounts in any organizational directory and personal Microsoft accounts**\n   - Redirect URI: \n     - Platform: **Web**\n     - URI: `https://h5pcreator.org/api/auth/microsoft/callback`\n5. Click **Register**\n\n### 2. Get Application IDs\n\n1. After registration, you'll see the **Overview** page\n2. Copy:\n   - **Application (client) ID**\n   - **Directory (tenant) ID**\n\n### 3. Create Client Secret\n\n1. Go to **Certificates & secrets**\n2. Click **New client secret**\n3. Description: `OECS Production`\n4. Expires: Choose appropriate duration (e.g., 24 months)\n5. Click **Add**\n6. **Important**: Copy the secret **Value** immediately (you won't see it again!)\n\n### 4. Configure Platform Settings\n\n1. Go to **Authentication**\n2. Under **Platform configurations** → **Web**, add all relevant redirect URIs:\n   - Development: `http://localhost:5000/api/auth/microsoft/callback`\n   - Custom domain: `https://h5pcreator.org/api/auth/microsoft/callback`\n   - Workspace (optional): `https://workspace.yourusername.repl.co/api/auth/microsoft/callback`\n3. Under **Implicit grant and hybrid flows**, leave all unchecked (we use authorization code flow)\n4. Click **Save**\n\n**Note**: The app will automatically use the correct redirect URI based on the domain precedence order (see top of this guide).\n\n### 5. Add API Permissions\n\n1. Go to **API permissions**\n2. Default permissions should include `User.Read`\n3. If not present, click **Add a permission** → **Microsoft Graph** → **Delegated permissions**\n4. Select `User.Read`\n5. Click **Add permissions**\n\n### 6. Add Secrets to Replit\n\n1. Open your Replit project\n2. Click **Tools** → **Secrets**\n3. Add:\n   - Key: `MICROSOFT_CLIENT_ID`, Value: [paste Application (client) ID]\n   - Key: `MICROSOFT_CLIENT_SECRET`, Value: [paste the secret value]\n   - Key: `MICROSOFT_TENANT_ID`, Value: `common` (or your specific tenant ID)\n\n---\n\n## Testing OAuth\n\n### Development Testing\n\n1. Make sure all secrets are added to Replit\n2. Restart your application\n3. Go to `/login`\n4. Click **Continue with Google** or **Continue with Microsoft**\n5. Complete the OAuth flow\n6. You should be redirected to `/dashboard`\n\n### Production Testing\n\n1. Ensure all secrets are added in production environment\n2. Update redirect URIs to use your production domain (`https://h5pcreator.org`)\n3. Test the complete OAuth flow on your live site\n\n---\n\n## Troubleshooting\n\n### \"redirect_uri_mismatch\" Error\n\n- **Problem**: The callback URL doesn't match registered URIs\n- **Solution**: Verify redirect URIs in Google Cloud Console / Azure Portal match exactly:\n  - `https://h5pcreator.org/api/auth/google/callback`\n  - `https://h5pcreator.org/api/auth/microsoft/callback`\n\n### \"invalid_client\" Error\n\n- **Problem**: Client ID or secret is incorrect\n- **Solution**: Double-check your secrets in Replit match Azure/Google Console\n\n### \"unauthorized_client\" Error (Microsoft)\n\n- **Problem**: App not properly configured for public access\n- **Solution**: Ensure \"Accounts in any organizational directory and personal Microsoft accounts\" is selected\n\n### Session Not Persisting\n\n- **Problem**: User is logged out immediately after OAuth\n- **Solution**: Verify `SESSION_SECRET` is set in production\n\n---\n\n## Security Notes\n\n1. **Never commit secrets** to your git repository\n2. **Use strong session secrets** - Generate random 32+ character strings\n3. **Enable HTTPS** in production (required for secure cookies)\n4. **Rotate secrets periodically** - Update client secrets every 12-24 months\n5. **Monitor OAuth usage** - Check Azure/Google Console for suspicious activity\n\n---\n\n## Support\n\nIf you encounter issues:\n1. Check browser console for detailed error messages\n2. Check server logs for backend errors\n3. Verify all redirect URIs match exactly\n4. Ensure all secrets are properly configured in production\n\n---\n\n**Last Updated**: November 2024\n","size_bytes":6853},"server/passport-config.ts":{"content":"import passport from 'passport';\nimport { Strategy as GoogleStrategy, Profile as GoogleProfile, VerifyCallback } from 'passport-google-oauth20';\nimport { storage } from './storage';\nimport bcrypt from 'bcryptjs';\nimport crypto from 'crypto';\nimport type { Profile } from '@shared/schema';\n\n// Google OAuth Strategy\nif (process.env.GOOGLE_CLIENT_ID && process.env.GOOGLE_CLIENT_SECRET) {\n  passport.use(\n    new GoogleStrategy(\n      {\n        clientID: process.env.GOOGLE_CLIENT_ID,\n        clientSecret: process.env.GOOGLE_CLIENT_SECRET,\n        // Use relative path - Passport.js will automatically derive the full URL from the request\n        // This ensures it works across localhost, workspace URLs, and custom domains\n        callbackURL: '/api/auth/google/callback',\n        // Request Slides API and Classroom API access\n        scope: [\n          'profile',\n          'email',\n          'https://www.googleapis.com/auth/presentations', // Google Slides API\n          'https://www.googleapis.com/auth/classroom.courses.readonly', // List Classroom courses\n          'https://www.googleapis.com/auth/classroom.coursework.students', // Create coursework/assignments\n          'https://www.googleapis.com/auth/classroom.announcements', // Create announcements\n        ],\n      } as any,\n      async (accessToken: string, refreshToken: string, profile: GoogleProfile, done: VerifyCallback) => {\n        try {\n          // Check if user exists with this Google ID or email\n          const email = profile.emails?.[0]?.value;\n          if (!email) {\n            return done(new Error('No email found in Google profile'), undefined);\n          }\n\n          let user = await storage.getProfileByEmail(email);\n\n          // Calculate token expiry (typically 1 hour from now)\n          const tokenExpiry = new Date(Date.now() + 3600 * 1000);\n\n          if (!user) {\n            // Create new OAuth user with sentinel password hash\n            const sentinelPassword = await bcrypt.hash(crypto.randomBytes(32).toString('hex'), 10);\n            \n            user = await storage.createProfile({\n              email,\n              password: sentinelPassword,\n              fullName: profile.displayName || email,\n              role: 'teacher',\n              institution: null,\n              authProvider: 'google',\n              googleId: profile.id,\n              microsoftId: null,\n              googleAccessToken: accessToken,\n              googleRefreshToken: refreshToken,\n              googleTokenExpiry: tokenExpiry,\n            });\n          } else {\n            // Update existing user with new tokens\n            await storage.updateProfile(user.id, {\n              googleId: profile.id,\n              googleAccessToken: accessToken,\n              googleRefreshToken: refreshToken || user.googleRefreshToken, // Keep existing if new one not provided\n              googleTokenExpiry: tokenExpiry,\n            });\n            // Refresh user object\n            user = await storage.getProfileById(user.id);\n          }\n\n          return done(null, user);\n        } catch (error) {\n          return done(error as Error, undefined);\n        }\n      }\n    )\n  );\n}\n\n\n// Serialize user for session\npassport.serializeUser((user: any, done) => {\n  done(null, user.id);\n});\n\n// Deserialize user from session\npassport.deserializeUser(async (id: string, done) => {\n  try {\n    const user = await storage.getProfileById(id);\n    done(null, user);\n  } catch (error) {\n    done(error, null);\n  }\n});\n\nexport default passport;\n","size_bytes":3517},"client/src/components/players/VideoFinderPlayer.tsx":{"content":"import { Card } from \"@/components/ui/card\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { ExternalLink, Play, Calendar, Search as SearchIcon, BookOpen, HelpCircle } from \"lucide-react\";\nimport type { VideoFinderData } from \"@shared/schema\";\nimport { useState } from \"react\";\n\ninterface VideoFinderPlayerProps {\n  data: VideoFinderData;\n}\n\nexport function VideoFinderPlayer({ data }: VideoFinderPlayerProps) {\n  const [selectedVideo, setSelectedVideo] = useState<string | null>(null);\n\n  const formatDuration = (duration: string) => {\n    // Convert ISO 8601 duration to readable format\n    const match = duration.match(/PT(?:(\\d+)H)?(?:(\\d+)M)?(?:(\\d+)S)?/);\n    if (!match) return \"\";\n    const hours = match[1] || \"0\";\n    const minutes = match[2] || \"0\";\n    const seconds = match[3] || \"0\";\n    if (hours !== \"0\") {\n      return `${hours}:${minutes.padStart(2, \"0\")}:${seconds.padStart(2, \"0\")}`;\n    }\n    return `${minutes}:${seconds.padStart(2, \"0\")}`;\n  };\n\n  const formatDate = (dateString: string) => {\n    const date = new Date(dateString);\n    return date.toLocaleDateString(\"en-US\", {\n      year: \"numeric\",\n      month: \"long\",\n      day: \"numeric\",\n    });\n  };\n\n  return (\n    <div className=\"w-full max-w-6xl mx-auto p-4 space-y-6\">\n      {/* Search Criteria Card */}\n      <Card className=\"p-6\">\n        <div className=\"flex items-start gap-4 mb-4\">\n          <div className=\"h-10 w-10 rounded-lg bg-primary/10 flex items-center justify-center flex-shrink-0\">\n            <SearchIcon className=\"h-5 w-5 text-primary\" />\n          </div>\n          <div className=\"flex-1\">\n            <h3 className=\"text-lg font-semibold mb-2\">Search Criteria</h3>\n            <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-3 text-sm\">\n              <div>\n                <span className=\"font-medium text-muted-foreground\">Subject:</span>{\" \"}\n                <span className=\"text-foreground\">{data.searchCriteria.subject}</span>\n              </div>\n              <div>\n                <span className=\"font-medium text-muted-foreground\">Topic:</span>{\" \"}\n                <span className=\"text-foreground\">{data.searchCriteria.topic}</span>\n              </div>\n              <div className=\"sm:col-span-2\">\n                <span className=\"font-medium text-muted-foreground\">Learning Outcome:</span>{\" \"}\n                <span className=\"text-foreground\">{data.searchCriteria.learningOutcome}</span>\n              </div>\n              <div>\n                <span className=\"font-medium text-muted-foreground\">Grade Level:</span>{\" \"}\n                <span className=\"text-foreground\">{data.searchCriteria.gradeLevel}</span>\n              </div>\n              {data.searchCriteria.ageRange && (\n                <div>\n                  <span className=\"font-medium text-muted-foreground\">Age Range:</span>{\" \"}\n                  <span className=\"text-foreground\">{data.searchCriteria.ageRange}</span>\n                </div>\n              )}\n            </div>\n            {data.searchDate && (\n              <div className=\"flex items-center gap-2 mt-3 text-sm text-muted-foreground\">\n                <Calendar className=\"h-4 w-4\" />\n                <span>Searched on {formatDate(data.searchDate)}</span>\n              </div>\n            )}\n          </div>\n        </div>\n      </Card>\n\n      {/* Viewing Instructions */}\n      {data.viewingInstructions && (\n        <Card className=\"p-6\">\n          <div className=\"flex items-start gap-4\">\n            <div className=\"h-10 w-10 rounded-lg bg-primary/10 flex items-center justify-center flex-shrink-0\">\n              <BookOpen className=\"h-5 w-5 text-primary\" />\n            </div>\n            <div className=\"flex-1\">\n              <h3 className=\"text-lg font-semibold mb-2\">Viewing Instructions</h3>\n              <p className=\"text-foreground leading-relaxed whitespace-pre-wrap\">\n                {data.viewingInstructions}\n              </p>\n            </div>\n          </div>\n        </Card>\n      )}\n\n      {/* Guiding Questions */}\n      {data.guidingQuestions && data.guidingQuestions.length > 0 && (\n        <Card className=\"p-6\">\n          <div className=\"flex items-start gap-4\">\n            <div className=\"h-10 w-10 rounded-lg bg-primary/10 flex items-center justify-center flex-shrink-0\">\n              <HelpCircle className=\"h-5 w-5 text-primary\" />\n            </div>\n            <div className=\"flex-1\">\n              <h3 className=\"text-lg font-semibold mb-3\">Guiding Questions</h3>\n              <div className=\"space-y-2\">\n                {data.guidingQuestions.map((question, index) => (\n                  <div key={index} className=\"flex items-start gap-3\">\n                    <span className=\"font-semibold text-primary flex-shrink-0\">\n                      {index + 1}.\n                    </span>\n                    <p className=\"text-foreground leading-relaxed\">\n                      {question}\n                    </p>\n                  </div>\n                ))}\n              </div>\n            </div>\n          </div>\n        </Card>\n      )}\n\n      {/* Video Results */}\n      <div className=\"space-y-4\">\n        <h3 className=\"text-xl font-semibold\">\n          Videos Found ({data.searchResults.length})\n        </h3>\n        {data.searchResults.length === 0 ? (\n          <Card className=\"p-12 text-center\">\n            <SearchIcon className=\"h-12 w-12 mx-auto mb-4 text-muted-foreground opacity-20\" />\n            <p className=\"text-muted-foreground\">No videos found for this search</p>\n          </Card>\n        ) : (\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n            {data.searchResults.map((video) => (\n              <Card key={video.id} className=\"overflow-hidden hover-elevate\">\n                <button\n                  onClick={() => setSelectedVideo(video.videoId)}\n                  className=\"block w-full text-left\"\n                  data-testid={`button-video-${video.id}`}\n                >\n                  <div className=\"relative w-full aspect-video bg-muted group\">\n                    <img\n                      src={video.thumbnailUrl}\n                      alt={video.title}\n                      className=\"w-full h-full object-cover\"\n                      loading=\"lazy\"\n                    />\n                    <div className=\"absolute inset-0 bg-black/50 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity\">\n                      <div className=\"h-16 w-16 rounded-full bg-red-600 flex items-center justify-center\">\n                        <Play className=\"h-8 w-8 text-white ml-1\" fill=\"white\" />\n                      </div>\n                    </div>\n                  </div>\n                  <div className=\"p-4 space-y-2\">\n                    <h4 className=\"font-medium line-clamp-2 leading-snug\">\n                      {video.title}\n                    </h4>\n                    <p className=\"text-sm text-muted-foreground\">\n                      {video.channelTitle}\n                    </p>\n                    {video.duration && (\n                      <p className=\"text-sm text-muted-foreground\">\n                        Duration: {formatDuration(video.duration)}\n                      </p>\n                    )}\n                    <div className=\"flex items-center gap-1 text-sm text-primary pt-2\">\n                      <Play className=\"h-4 w-4\" />\n                      <span>Watch Video</span>\n                    </div>\n                  </div>\n                </button>\n                <div className=\"px-4 pb-4\">\n                  <a\n                    href={`https://www.youtube.com/watch?v=${video.videoId}`}\n                    target=\"_blank\"\n                    rel=\"noopener noreferrer\"\n                    className=\"flex items-center gap-1 text-xs text-muted-foreground hover:text-foreground transition-colors\"\n                    data-testid={`link-youtube-${video.id}`}\n                  >\n                    <ExternalLink className=\"h-3 w-3\" />\n                    <span>Open on YouTube</span>\n                  </a>\n                </div>\n              </Card>\n            ))}\n          </div>\n        )}\n      </div>\n\n      {/* Video Player Dialog */}\n      <Dialog open={!!selectedVideo} onOpenChange={(open) => !open && setSelectedVideo(null)}>\n        <DialogContent className=\"max-w-4xl p-0\">\n          <DialogHeader className=\"p-6 pb-4\">\n            <DialogTitle>\n              {selectedVideo && data.searchResults.find(v => v.videoId === selectedVideo)?.title}\n            </DialogTitle>\n          </DialogHeader>\n          <div className=\"w-full aspect-video bg-black\">\n            {selectedVideo && (\n              <iframe\n                width=\"100%\"\n                height=\"100%\"\n                src={`https://www.youtube.com/embed/${selectedVideo}?autoplay=1`}\n                title=\"YouTube video player\"\n                frameBorder=\"0\"\n                allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share\"\n                allowFullScreen\n                data-testid=\"iframe-youtube-player\"\n              />\n            )}\n          </div>\n          <div className=\"p-6 pt-4\">\n            <div className=\"flex items-center justify-between\">\n              <div className=\"flex-1\">\n                <p className=\"text-sm text-muted-foreground\">\n                  {selectedVideo && data.searchResults.find(v => v.videoId === selectedVideo)?.channelTitle}\n                </p>\n              </div>\n              <a\n                href={`https://www.youtube.com/watch?v=${selectedVideo}`}\n                target=\"_blank\"\n                rel=\"noopener noreferrer\"\n                className=\"flex items-center gap-2 text-sm text-primary hover:underline\"\n                data-testid=\"link-open-youtube\"\n              >\n                <ExternalLink className=\"h-4 w-4\" />\n                <span>Open on YouTube</span>\n              </a>\n            </div>\n          </div>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","size_bytes":10067},"client/src/pages/VideoFinderCreator.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useParams, useLocation } from \"wouter\";\nimport { Breadcrumbs } from \"@/components/Breadcrumbs\";\nimport { useBreadcrumbs } from \"@/hooks/useBreadcrumbs\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { ArrowLeft, Search, Globe, ExternalLink, Play, Sparkles, X, CheckSquare, Square } from \"lucide-react\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport type { H5pContent, VideoFinderData, VideoResult } from \"@shared/schema\";\nimport ShareToClassroomDialog from \"@/components/ShareToClassroomDialog\";\n\nexport default function VideoFinderCreator() {\n  const params = useParams();\n  const [_, navigate] = useLocation();\n  const { toast } = useToast();\n  const contentId = params.id;\n  const breadcrumbs = useBreadcrumbs(contentId);\n  const isEditing = !!contentId;\n\n  const [title, setTitle] = useState(\"\");\n  const [description, setDescription] = useState(\"\");\n  const [subject, setSubject] = useState(\"\");\n  const [topic, setTopic] = useState(\"\");\n  const [learningOutcome, setLearningOutcome] = useState(\"\");\n  const [gradeLevel, setGradeLevel] = useState(\"\");\n  const [ageRange, setAgeRange] = useState(\"\");\n  const [videoCount, setVideoCount] = useState(10);\n  const [searchResults, setSearchResults] = useState<VideoResult[]>([]);\n  const [selectedVideoIds, setSelectedVideoIds] = useState<string[]>([]);\n  const [searchDate, setSearchDate] = useState(\"\");\n  const [viewingInstructions, setViewingInstructions] = useState(\"\");\n  const [guidingQuestions, setGuidingQuestions] = useState<string[]>([]);\n  const [isPublished, setIsPublished] = useState(false);\n  const [isPublic, setIsPublic] = useState(false);\n  const [isSaving, setIsSaving] = useState(false);\n  const [isSearching, setIsSearching] = useState(false);\n  const [isGenerating, setIsGenerating] = useState(false);\n\n  const { data: content } = useQuery<H5pContent>({\n    queryKey: [\"/api/content\", contentId],\n    enabled: isEditing,\n  });\n\n  useEffect(() => {\n    if (content && content.type === \"video-finder\") {\n      setTitle(content.title);\n      setDescription(content.description || \"\");\n      const data = content.data as VideoFinderData;\n      setSubject(data.searchCriteria.subject);\n      setTopic(data.searchCriteria.topic);\n      setLearningOutcome(data.searchCriteria.learningOutcome);\n      setGradeLevel(data.searchCriteria.gradeLevel);\n      setAgeRange(data.searchCriteria.ageRange);\n      setVideoCount(data.searchCriteria.videoCount);\n      setSearchResults(data.searchResults || []);\n      setSelectedVideoIds((data.searchResults || []).map(v => v.id));\n      setSearchDate(data.searchDate);\n      setViewingInstructions(data.viewingInstructions || \"\");\n      setGuidingQuestions(data.guidingQuestions || []);\n      setIsPublished(content.isPublished);\n      setIsPublic(content.isPublic || false);\n    }\n  }, [content]);\n\n  const saveMutation = useMutation({\n    mutationFn: async (params: { publish: boolean, selectedIds: string[] }) => {\n      const selectedVideos = searchResults.filter(v => params.selectedIds.includes(v.id));\n      const data: VideoFinderData = {\n        searchCriteria: {\n          subject,\n          topic,\n          learningOutcome,\n          gradeLevel,\n          ageRange,\n          videoCount,\n        },\n        searchResults: selectedVideos,\n        searchDate,\n        viewingInstructions: viewingInstructions || undefined,\n        guidingQuestions: guidingQuestions.length > 0 ? guidingQuestions : undefined,\n      };\n\n      if (isEditing) {\n        const response = await apiRequest(\"PUT\", `/api/content/${contentId}`, {\n          title,\n          description,\n          data,\n          isPublished: params.publish,\n          isPublic,\n        });\n        return await response.json();\n      } else {\n        const response = await apiRequest(\"POST\", \"/api/content\", {\n          title,\n          description,\n          type: \"video-finder\",\n          data,\n          isPublished: params.publish,\n          isPublic,\n        });\n        return await response.json();\n      }\n    },\n    onSuccess: (data) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/content\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/content/public\"] });\n      if (!isEditing) {\n        navigate(`/create/video-finder/${data.id}`);\n      }\n      toast({ title: \"Saved!\", description: \"Video finder saved successfully.\" });\n      setIsSaving(false);\n    },\n  });\n\n  const searchMutation = useMutation({\n    mutationFn: async () => {\n      const response = await apiRequest(\"POST\", \"/api/youtube/search\", {\n        subject,\n        topic,\n        learningOutcome,\n        gradeLevel,\n        ageRange,\n        videoCount,\n      });\n      return await response.json();\n    },\n    onSuccess: (data) => {\n      setSearchResults(data.results);\n      setSelectedVideoIds(data.results.map((v: VideoResult) => v.id));\n      setSearchDate(data.searchDate);\n      setIsSearching(false);\n      toast({\n        title: \"Search complete!\",\n        description: `Found ${data.results.length} videos`,\n      });\n    },\n    onError: (error: any) => {\n      setIsSearching(false);\n      toast({\n        title: \"Search failed\",\n        description: error.message || \"Failed to search YouTube. Please try again.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const generatePedagogyMutation = useMutation({\n    mutationFn: async () => {\n      const selectedVideos = searchResults.filter(v => selectedVideoIds.includes(v.id));\n      const response = await apiRequest(\"POST\", \"/api/video-finder/generate-pedagogy\", {\n        subject,\n        topic,\n        learningOutcome,\n        gradeLevel,\n        ageRange,\n        videoCount: selectedVideos.length,\n      });\n      return await response.json();\n    },\n    onSuccess: (data) => {\n      setViewingInstructions(data.viewingInstructions);\n      setGuidingQuestions(data.guidingQuestions);\n      setIsGenerating(false);\n      toast({\n        title: \"Generated!\",\n        description: \"AI has created viewing instructions and guiding questions\",\n      });\n    },\n    onError: (error: any) => {\n      setIsGenerating(false);\n      toast({\n        title: \"Generation failed\",\n        description: error.message || \"Failed to generate pedagogical content. Please try again.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleSearch = () => {\n    if (!subject || !topic || !learningOutcome || !gradeLevel) {\n      toast({\n        title: \"Missing information\",\n        description: \"Please fill in all required fields\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    setIsSearching(true);\n    searchMutation.mutate();\n  };\n\n  const handleSave = () => {\n    if (!title) {\n      toast({\n        title: \"Missing title\",\n        description: \"Please provide a title for this content\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    if (searchResults.length > 0 && selectedVideoIds.length === 0) {\n      toast({\n        title: \"No videos selected\",\n        description: \"Please select at least one video to save\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    setIsSaving(true);\n    saveMutation.mutate({ publish: isPublished, selectedIds: selectedVideoIds });\n  };\n\n  const handlePublish = async () => {\n    if (!title) {\n      toast({\n        title: \"Missing title\",\n        description: \"Please provide a title before publishing\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    if (searchResults.length > 0 && selectedVideoIds.length === 0) {\n      toast({\n        title: \"No videos selected\",\n        description: \"Please select at least one video before publishing\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    setIsSaving(true);\n    setIsPublished(true);\n    saveMutation.mutate({ publish: true, selectedIds: selectedVideoIds });\n  };\n\n  const handleGeneratePedagogy = () => {\n    if (!subject || !topic || !learningOutcome || !gradeLevel) {\n      toast({\n        title: \"Missing information\",\n        description: \"Please fill in all required search criteria fields first\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    if (selectedVideoIds.length === 0) {\n      toast({\n        title: \"No videos selected\",\n        description: \"Please select at least one video before generating pedagogical content\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    setIsGenerating(true);\n    generatePedagogyMutation.mutate();\n  };\n\n  const toggleVideoSelection = (videoId: string) => {\n    setSelectedVideoIds(prev =>\n      prev.includes(videoId)\n        ? prev.filter(id => id !== videoId)\n        : [...prev, videoId]\n    );\n  };\n\n  const selectAllVideos = () => {\n    setSelectedVideoIds(searchResults.map(v => v.id));\n  };\n\n  const clearAllVideos = () => {\n    setSelectedVideoIds([]);\n  };\n\n  const addGuidingQuestion = () => {\n    setGuidingQuestions([...guidingQuestions, \"\"]);\n  };\n\n  const updateGuidingQuestion = (index: number, value: string) => {\n    const updated = [...guidingQuestions];\n    updated[index] = value;\n    setGuidingQuestions(updated);\n  };\n\n  const removeGuidingQuestion = (index: number) => {\n    setGuidingQuestions(guidingQuestions.filter((_, i) => i !== index));\n  };\n\n  const formatDuration = (duration: string) => {\n    // Convert ISO 8601 duration to readable format\n    const match = duration.match(/PT(?:(\\d+)H)?(?:(\\d+)M)?(?:(\\d+)S)?/);\n    if (!match) return \"\";\n    const hours = match[1] || \"0\";\n    const minutes = match[2] || \"0\";\n    const seconds = match[3] || \"0\";\n    if (hours !== \"0\") {\n      return `${hours}:${minutes.padStart(2, \"0\")}:${seconds.padStart(2, \"0\")}`;\n    }\n    return `${minutes}:${seconds.padStart(2, \"0\")}`;\n  };\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      {/* Header */}\n      <header className=\"border-b bg-card\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"flex items-center justify-between h-16\">\n            <div className=\"flex items-center gap-4\">\n              <Button\n                variant=\"ghost\"\n                size=\"icon\"\n                onClick={() => navigate(\"/dashboard\")}\n                data-testid=\"button-back\"\n              >\n                <ArrowLeft className=\"h-5 w-5\" />\n              </Button>\n              <h1 className=\"text-2xl font-bold text-foreground\">\n                {isEditing ? \"Edit\" : \"Create\"} Video Finder\n              </h1>\n            </div>\n            <div className=\"flex items-center gap-2\">\n              <Button\n                variant=\"outline\"\n                onClick={handleSave}\n                disabled={isSaving || !title}\n                data-testid=\"button-save\"\n              >\n                Save\n              </Button>\n              {contentId && isPublished && (\n                <ShareToClassroomDialog\n                  contentTitle={title}\n                  contentDescription={description}\n                  materialLink={`${window.location.origin}/public/${contentId}`}\n                />\n              )}\n              {isPublished ? (\n                <Button variant=\"default\" disabled data-testid=\"button-published\">\n                  <Globe className=\"mr-2 h-4 w-4\" />\n                  Published\n                </Button>\n              ) : (\n                <Button\n                  onClick={handlePublish}\n                  disabled={isSaving || !title || searchResults.length === 0}\n                  data-testid=\"button-publish\"\n                >\n                  <Globe className=\"mr-2 h-4 w-4\" />\n                  Publish\n                </Button>\n              )}\n            </div>\n          </div>\n        </div>\n      </header>\n\n      {/* Main Content */}\n      <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n        <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-8\">\n          {/* Left Column - Form */}\n          <div className=\"space-y-6\">\n            <Card>\n              <CardHeader>\n                <CardTitle>Basic Information</CardTitle>\n              </CardHeader>\n              <CardContent className=\"space-y-4\">\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"title\">Title *</Label>\n                  <Input\n                    id=\"title\"\n                    value={title}\n                    onChange={(e) => setTitle(e.target.value)}\n                    placeholder=\"e.g., Math Videos for Grade 5\"\n                    data-testid=\"input-title\"\n                  />\n                </div>\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"description\">Description</Label>\n                  <Input\n                    id=\"description\"\n                    value={description}\n                    onChange={(e) => setDescription(e.target.value)}\n                    placeholder=\"Brief description of this video collection\"\n                    data-testid=\"input-description\"\n                  />\n                </div>\n                <div className=\"flex items-center justify-between p-4 bg-muted/50 rounded-lg\">\n                  <div className=\"space-y-0.5\">\n                    <Label htmlFor=\"isPublic\" className=\"text-base\">Share as Public Resource</Label>\n                    <p className=\"text-sm text-muted-foreground\">\n                      Allow other teachers to discover and use this video collection on the Shared Resources page. Content will be automatically published when shared.\n                    </p>\n                  </div>\n                  <Switch\n                    id=\"isPublic\"\n                    checked={isPublic}\n                    onCheckedChange={(checked) => {\n                      setIsPublic(checked);\n                      if (checked) {\n                        setIsPublished(true);\n                      }\n                    }}\n                    data-testid=\"switch-public\"\n                  />\n                </div>\n              </CardContent>\n            </Card>\n\n            <Card>\n              <CardHeader>\n                <CardTitle>Search Criteria</CardTitle>\n              </CardHeader>\n              <CardContent className=\"space-y-4\">\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"subject\">Subject *</Label>\n                  <Input\n                    id=\"subject\"\n                    value={subject}\n                    onChange={(e) => setSubject(e.target.value)}\n                    placeholder=\"e.g., Mathematics, Science, English\"\n                    data-testid=\"input-subject\"\n                  />\n                </div>\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"topic\">Topic *</Label>\n                  <Input\n                    id=\"topic\"\n                    value={topic}\n                    onChange={(e) => setTopic(e.target.value)}\n                    placeholder=\"e.g., Fractions, Photosynthesis, Grammar\"\n                    data-testid=\"input-topic\"\n                  />\n                </div>\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"learningOutcome\">Learning Outcome *</Label>\n                  <Input\n                    id=\"learningOutcome\"\n                    value={learningOutcome}\n                    onChange={(e) => setLearningOutcome(e.target.value)}\n                    placeholder=\"e.g., Students will understand...\"\n                    data-testid=\"input-learning-outcome\"\n                  />\n                </div>\n                <div className=\"grid grid-cols-2 gap-4\">\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"gradeLevel\">Grade Level *</Label>\n                    <Select value={gradeLevel} onValueChange={setGradeLevel}>\n                      <SelectTrigger id=\"gradeLevel\" data-testid=\"select-grade-level\">\n                        <SelectValue placeholder=\"Select grade level\" />\n                      </SelectTrigger>\n                      <SelectContent>\n                        <SelectItem value=\"Pre-K\">Pre-K</SelectItem>\n                        <SelectItem value=\"Kindergarten\">Kindergarten</SelectItem>\n                        <SelectItem value=\"K-2\">K-2 (Grades K-2)</SelectItem>\n                        <SelectItem value=\"3-5\">3-5 (Grades 3-5)</SelectItem>\n                        <SelectItem value=\"6-8\">6-8 (Grades 6-8)</SelectItem>\n                        <SelectItem value=\"9-12\">9-12 (Grades 9-12)</SelectItem>\n                        <SelectItem value=\"Higher Education\">Higher Education</SelectItem>\n                      </SelectContent>\n                    </Select>\n                  </div>\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"ageRange\">Age Range</Label>\n                    <Input\n                      id=\"ageRange\"\n                      value={ageRange}\n                      onChange={(e) => setAgeRange(e.target.value)}\n                      placeholder=\"e.g., 10-12\"\n                      data-testid=\"input-age-range\"\n                    />\n                  </div>\n                </div>\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"videoCount\">Number of Videos (1-50)</Label>\n                  <Input\n                    id=\"videoCount\"\n                    type=\"number\"\n                    min={1}\n                    max={50}\n                    value={videoCount}\n                    onChange={(e) => setVideoCount(parseInt(e.target.value) || 10)}\n                    data-testid=\"input-video-count\"\n                  />\n                </div>\n                <Button\n                  onClick={handleSearch}\n                  disabled={isSearching || !subject || !topic || !learningOutcome || !gradeLevel}\n                  className=\"w-full\"\n                  data-testid=\"button-search\"\n                >\n                  {isSearching ? (\n                    <>Searching...</>\n                  ) : (\n                    <>\n                      <Search className=\"mr-2 h-4 w-4\" />\n                      Search YouTube\n                    </>\n                  )}\n                </Button>\n              </CardContent>\n            </Card>\n\n            {/* Pedagogical Content Card */}\n            <Card>\n              <CardHeader className=\"flex flex-row items-center justify-between gap-2 space-y-0 pb-2\">\n                <CardTitle>Pedagogical Content</CardTitle>\n                <Button\n                  variant=\"outline\"\n                  size=\"sm\"\n                  onClick={handleGeneratePedagogy}\n                  disabled={isGenerating || !subject || !topic || !learningOutcome || !gradeLevel}\n                  data-testid=\"button-generate-pedagogy\"\n                >\n                  {isGenerating ? (\n                    <>Generating...</>\n                  ) : (\n                    <>\n                      <Sparkles className=\"mr-2 h-4 w-4\" />\n                      Generate with AI\n                    </>\n                  )}\n                </Button>\n              </CardHeader>\n              <CardContent className=\"space-y-4\">\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"viewingInstructions\">Viewing Instructions</Label>\n                  <p className=\"text-xs text-muted-foreground\">\n                    Provide guidance on what learners should focus on while watching\n                  </p>\n                  <Textarea\n                    id=\"viewingInstructions\"\n                    value={viewingInstructions}\n                    onChange={(e) => setViewingInstructions(e.target.value)}\n                    placeholder=\"e.g., Watch these videos to understand how plants make their own food. Take notes on the inputs, outputs, and location of this process...\"\n                    rows={4}\n                    data-testid=\"textarea-viewing-instructions\"\n                  />\n                </div>\n\n                <div className=\"space-y-2\">\n                  <div className=\"flex items-center justify-between\">\n                    <div>\n                      <Label>Guiding Questions</Label>\n                      <p className=\"text-xs text-muted-foreground\">\n                        Questions to help learners focus while watching\n                      </p>\n                    </div>\n                    <Button\n                      variant=\"outline\"\n                      size=\"sm\"\n                      onClick={addGuidingQuestion}\n                      data-testid=\"button-add-question\"\n                    >\n                      Add Question\n                    </Button>\n                  </div>\n                  {guidingQuestions.length === 0 ? (\n                    <div className=\"text-center py-6 text-sm text-muted-foreground border border-dashed rounded-lg\">\n                      No guiding questions yet. Click \"Add Question\" or generate with AI\n                    </div>\n                  ) : (\n                    <div className=\"space-y-2\">\n                      {guidingQuestions.map((question, index) => (\n                        <div key={index} className=\"flex items-start gap-2\">\n                          <span className=\"text-sm font-medium text-muted-foreground mt-2 flex-shrink-0\">\n                            {index + 1}.\n                          </span>\n                          <Input\n                            value={question}\n                            onChange={(e) => updateGuidingQuestion(index, e.target.value)}\n                            placeholder=\"Enter a guiding question...\"\n                            data-testid={`input-question-${index}`}\n                          />\n                          <Button\n                            variant=\"ghost\"\n                            size=\"icon\"\n                            onClick={() => removeGuidingQuestion(index)}\n                            data-testid={`button-remove-question-${index}`}\n                          >\n                            <X className=\"h-4 w-4\" />\n                          </Button>\n                        </div>\n                      ))}\n                    </div>\n                  )}\n                </div>\n              </CardContent>\n            </Card>\n          </div>\n\n          {/* Right Column - Results */}\n          <div className=\"space-y-6\">\n            <Card>\n              <CardHeader>\n                <div className=\"flex items-center justify-between\">\n                  <CardTitle>\n                    Video Results\n                    {searchResults.length > 0 && (\n                      <span className=\"ml-2 text-sm font-normal text-muted-foreground\">\n                        ({selectedVideoIds.length} of {searchResults.length} selected)\n                      </span>\n                    )}\n                  </CardTitle>\n                  {searchResults.length > 0 && (\n                    <div className=\"flex gap-2\">\n                      <Button\n                        variant=\"outline\"\n                        size=\"sm\"\n                        onClick={selectAllVideos}\n                        disabled={selectedVideoIds.length === searchResults.length}\n                        data-testid=\"button-select-all\"\n                      >\n                        Select All\n                      </Button>\n                      <Button\n                        variant=\"outline\"\n                        size=\"sm\"\n                        onClick={clearAllVideos}\n                        disabled={selectedVideoIds.length === 0}\n                        data-testid=\"button-clear-all\"\n                      >\n                        Clear All\n                      </Button>\n                    </div>\n                  )}\n                </div>\n              </CardHeader>\n              <CardContent>\n                {searchResults.length === 0 ? (\n                  <div className=\"text-center py-12 text-muted-foreground\">\n                    <Search className=\"h-12 w-12 mx-auto mb-4 opacity-20\" />\n                    <p>No videos yet. Fill in the search criteria and click \"Search YouTube\"</p>\n                  </div>\n                ) : (\n                  <div className=\"space-y-4 max-h-[600px] overflow-y-auto\">\n                    {searchResults.map((video) => {\n                      const isSelected = selectedVideoIds.includes(video.id);\n                      return (\n                        <div \n                          key={video.id}\n                          className={`transition-all ${!isSelected ? 'opacity-60' : ''}`}\n                        >\n                          <Card className={`overflow-hidden ${isSelected ? 'border-primary border-2' : 'border-border'}`}>\n                            <div className=\"flex gap-4 p-4\">\n                              <button\n                                onClick={() => toggleVideoSelection(video.id)}\n                                className=\"flex-shrink-0 self-start mt-1 hover-elevate active-elevate-2 p-1 rounded\"\n                                data-testid={`button-toggle-video-${video.id}`}\n                              >\n                                {isSelected ? (\n                                  <CheckSquare className=\"h-5 w-5 text-primary\" />\n                                ) : (\n                                  <Square className=\"h-5 w-5 text-muted-foreground\" />\n                                )}\n                              </button>\n                              <div className=\"relative flex-shrink-0 w-40 h-24 bg-muted rounded overflow-hidden group\">\n                                <img\n                                  src={video.thumbnailUrl}\n                                  alt={video.title}\n                                  className=\"w-full h-full object-cover\"\n                                />\n                                <div className=\"absolute inset-0 bg-black/50 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity\">\n                                  <Play className=\"h-8 w-8 text-white\" />\n                                </div>\n                              </div>\n                              <div className=\"flex-1 min-w-0\">\n                                <h4 className=\"font-medium text-sm line-clamp-2 mb-1\">\n                                  {video.title}\n                                </h4>\n                                <p className=\"text-xs text-muted-foreground mb-2\">\n                                  {video.channelTitle}\n                                </p>\n                                {video.duration && (\n                                  <p className=\"text-xs text-muted-foreground mb-2\">\n                                    Duration: {formatDuration(video.duration)}\n                                  </p>\n                                )}\n                                <a\n                                  href={`https://www.youtube.com/watch?v=${video.videoId}`}\n                                  target=\"_blank\"\n                                  rel=\"noopener noreferrer\"\n                                  className=\"inline-flex items-center gap-1 text-xs text-primary hover:underline\"\n                                  data-testid={`link-video-${video.id}`}\n                                >\n                                  Watch on YouTube\n                                  <ExternalLink className=\"h-3 w-3\" />\n                                </a>\n                              </div>\n                            </div>\n                          </Card>\n                        </div>\n                      );\n                    })}\n                  </div>\n                )}\n              </CardContent>\n            </Card>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n","size_bytes":28232},"attached_assets/content-1763259757118.md":{"content":"# OECS Content Creator\n\nCreate. Engage. Educate.\n\nLoginRegister\n\nLogin\n\nEnter your credentials to access your account\n\nContinue with GoogleContinue with Microsoft\n\nOr continue with email\n\nEmail\n\nPassword\n\nLogin","size_bytes":210},"attached_assets/content-1763260460013.md":{"content":"```json\n{\"message\":\"Unauthorized\"}\n```","size_bytes":38},"attached_assets/content-1763260057869.md":{"content":"```json\n{\"message\":\"Unauthorized\"}\n```","size_bytes":38},"server/msal-config.ts":{"content":"import { ConfidentialClientApplication, Configuration } from \"@azure/msal-node\";\n\nexport function getMsalClient(): ConfidentialClientApplication | null {\n  if (!process.env.MICROSOFT_CLIENT_ID || !process.env.MICROSOFT_CLIENT_SECRET || !process.env.MICROSOFT_TENANT_ID) {\n    return null;\n  }\n\n  const msalConfig: Configuration = {\n    auth: {\n      clientId: process.env.MICROSOFT_CLIENT_ID,\n      authority: `https://login.microsoftonline.com/${process.env.MICROSOFT_TENANT_ID}`,\n      clientSecret: process.env.MICROSOFT_CLIENT_SECRET,\n    },\n    system: {\n      loggerOptions: {\n        loggerCallback(loglevel, message, containsPii) {\n          if (!containsPii) {\n            console.log(message);\n          }\n        },\n        piiLoggingEnabled: false,\n        logLevel: 3,\n      },\n    },\n  };\n\n  return new ConfidentialClientApplication(msalConfig);\n}\n\nexport function getRedirectUri(req: any): string {\n  const protocol = req.protocol;\n  const host = req.get('host');\n  return `${protocol}://${host}/api/auth/microsoft/callback`;\n}\n","size_bytes":1043},"server/youtube.ts":{"content":"import { google } from 'googleapis';\n\n// Get YouTube client using Google API Key\nfunction getYouTubeClient() {\n  // Accept both YOUTUBE_API_KEY and GOOGLE_API_KEY for flexibility\n  const apiKey = process.env.YOUTUBE_API_KEY || process.env.GOOGLE_API_KEY;\n  \n  if (!apiKey) {\n    throw new Error('YouTube API key not found. Please set YOUTUBE_API_KEY or GOOGLE_API_KEY in environment variables.');\n  }\n  \n  return google.youtube({\n    version: 'v3',\n    auth: apiKey,\n  });\n}\n\nexport interface YouTubeSearchParams {\n  subject: string;\n  topic: string;\n  learningOutcome: string;\n  gradeLevel: string;\n  ageRange: string;\n  maxResults: number;\n}\n\nexport async function searchEducationalVideos(params: YouTubeSearchParams) {\n  try {\n    const youtube = getYouTubeClient();\n    \n    // Build search query from educational criteria\n    const query = `${params.subject} ${params.topic} ${params.learningOutcome} education tutorial grade ${params.gradeLevel}`;\n    \n    const searchResponse = await youtube.search.list({\n      part: ['snippet'],\n      q: query,\n      type: ['video'],\n      maxResults: params.maxResults,\n      order: 'relevance',\n      safeSearch: 'strict',\n      videoEmbeddable: 'true',\n      videoSyndicated: 'true',\n      relevanceLanguage: 'en',\n    });\n\n    if (!searchResponse.data.items || searchResponse.data.items.length === 0) {\n      return [];\n    }\n\n    // Get video IDs for detailed information\n    const videoIds = searchResponse.data.items\n      .map(item => item.id?.videoId)\n      .filter((id): id is string => !!id);\n\n    // Fetch video details including duration\n    const videosResponse = await youtube.videos.list({\n      part: ['contentDetails', 'snippet'],\n      id: videoIds,\n    });\n\n    // Format results\n    const results = videosResponse.data.items?.map(video => ({\n      id: video.id || '',\n      videoId: video.id || '',\n      title: video.snippet?.title || '',\n      description: video.snippet?.description || '',\n      thumbnailUrl: video.snippet?.thumbnails?.medium?.url || video.snippet?.thumbnails?.default?.url || '',\n      channelTitle: video.snippet?.channelTitle || '',\n      publishedAt: video.snippet?.publishedAt || '',\n      duration: video.contentDetails?.duration || '',\n    })) || [];\n\n    return results;\n  } catch (error: any) {\n    console.error('YouTube API error:', error);\n    \n    // Check if it's an auth/key issue\n    if (error.message && error.message.includes('GOOGLE_API_KEY')) {\n      throw new Error('YouTube API key not configured. Please add GOOGLE_API_KEY to your secrets.');\n    }\n    \n    if (error.message && (error.message.includes('API key') || error.message.includes('invalid') || error.message.includes('credentials'))) {\n      throw new Error('Invalid YouTube API key. Please check your GOOGLE_API_KEY secret.');\n    }\n    \n    throw new Error('Failed to search YouTube videos. Please try again.');\n  }\n}\n","size_bytes":2889},"PUBLISH_AND_TEST.md":{"content":"# How to Publish and Test Microsoft OAuth\n\nThis guide walks you through publishing your changes and testing Microsoft OAuth on your live site.\n\n## 🚀 Step 1: Publish Your Changes\n\n1. In Replit, look for the **\"Publish\"** or **\"Deploy\"** button (top right)\n2. Click it and follow the prompts\n3. Wait for the deployment to complete (usually 1-2 minutes)\n4. Your changes are now live at: **https://h5pcreator.org**\n\n**Important**: The development server (preview pane) and your published site are **completely separate**. OAuth changes must be published to work on h5pcreator.org.\n\n---\n\n## ✅ Step 2: Test Microsoft OAuth\n\n### Quick Test Checklist\n\n1. **Open your published site**: https://h5pcreator.org\n2. **Click \"Login\"** or navigate to the login page\n3. **Click \"Sign in with Microsoft\"**\n4. **What should happen**:\n   - You're redirected to Microsoft login page\n   - After signing in, you're redirected back to your dashboard\n   - You're logged in successfully\n\n### If it works ✅\nCongratulations! Microsoft OAuth is working correctly.\n\n### If it doesn't work ❌\nCheck these common issues:\n\n#### Error: \"Redirect URI mismatch\"\n**Fix**: Go to [Azure Portal](https://portal.azure.com) and add `https://h5pcreator.org/api/auth/microsoft/callback` to your redirect URIs.\n\n#### Error: \"Invalid client secret\"\n**Fix**: \n1. Generate a new client secret in Azure Portal\n2. Copy the secret value\n3. Update `MICROSOFT_CLIENT_SECRET` in Replit secrets\n4. Republish your app\n\n#### Stuck at Microsoft login or blank page\n**Fix**: \n1. Check browser console for errors (press F12)\n2. Make sure all secrets are set in Replit (not just locally)\n3. Verify your `MICROSOFT_TENANT_ID` is correct (try `common` if using personal accounts)\n\n#### Error: \"Microsoft authentication is not configured\"\n**Fix**: Make sure these secrets are set in Replit:\n- `MICROSOFT_CLIENT_ID`\n- `MICROSOFT_CLIENT_SECRET`\n- `MICROSOFT_TENANT_ID`\n\n---\n\n## 🔍 Step 3: Monitor Logs (Advanced)\n\nIf you need to debug, you can check your production logs:\n\n1. In Replit, go to the **\"Deployments\"** or **\"Logs\"** tab\n2. Look for any errors related to Microsoft OAuth\n3. Common log messages:\n   - `Microsoft OAuth initiation error` - Problem starting OAuth flow\n   - `Microsoft OAuth callback error` - Problem after user signs in\n\n---\n\n## 📋 Complete Testing Workflow\n\n1. ✅ Verify Azure configuration (see AZURE_SETUP_CHECKLIST.md)\n2. ✅ Ensure all Replit secrets are set\n3. ✅ Click \"Publish\" in Replit\n4. ✅ Wait for deployment to complete\n5. ✅ Go to https://h5pcreator.org\n6. ✅ Test Microsoft login\n7. ✅ If it works, you're done! If not, check troubleshooting section above\n\n---\n\n## 💡 Pro Tips\n\n- **Always publish after making changes** - The preview pane doesn't reflect what users see\n- **Test with a real Microsoft account** - Use your personal or work account\n- **Check both work and personal accounts** - If you support multi-tenant\n- **Clear cookies if stuck** - Sometimes old sessions cause issues\n- **Use incognito mode** - Helps avoid cached credentials interfering\n\n---\n\n## Need Help?\n\nIf you're still stuck:\n\n1. Double-check AZURE_SETUP_CHECKLIST.md - Make sure everything is configured\n2. Check that all secrets are set in Replit (not just environment variables)\n3. Try the troubleshooting steps above\n4. Check browser console for specific error messages (F12)\n","size_bytes":3352},"AZURE_SETUP_CHECKLIST.md":{"content":"# Azure Microsoft OAuth Setup Checklist\n\nFollow this checklist to ensure your Azure app registration is configured correctly for Microsoft OAuth.\n\n## ✅ Step 1: Verify Azure App Registration\n\n1. Go to [Azure Portal](https://portal.azure.com)\n2. Navigate to **Azure Active Directory** > **App registrations**\n3. Find your app: **OECS Content Creator**\n\n## ✅ Step 2: Check Redirect URIs\n\nIn your app registration, go to **Authentication** section and verify you have BOTH redirect URIs:\n\n- **Development**: `http://localhost:5000/api/auth/microsoft/callback`\n- **Production**: `https://h5pcreator.org/api/auth/microsoft/callback`\n\n**Important**: Make sure the platform type is **Web** (not SPA or Mobile).\n\n## ✅ Step 3: Verify Client Secret\n\n1. Go to **Certificates & secrets** section\n2. Check that you have an active client secret (not expired)\n3. If expired or missing, create a new one and update your Replit secrets\n\n## ✅ Step 4: Verify API Permissions\n\nGo to **API permissions** and ensure you have:\n\n- **Microsoft Graph** > **User.Read** (Delegated)\n- Status should show \"Granted for [your organization]\"\n\nIf not granted, click **Grant admin consent**.\n\n## ✅ Step 5: Check Supported Account Types\n\nIn **Authentication** > **Supported account types**, verify:\n\n- **Recommended**: \"Accounts in any organizational directory (Any Azure AD directory - Multitenant)\"\n- This allows both work/school AND personal Microsoft accounts\n\n## ✅ Step 6: Verify Replit Secrets\n\nIn your Replit project, check that these secrets are set:\n\n- `MICROSOFT_CLIENT_ID` - Your Application (client) ID\n- `MICROSOFT_CLIENT_SECRET` - Your client secret value\n- `MICROSOFT_TENANT_ID` - Usually `common` for multi-tenant, or your specific tenant ID\n- `SESSION_SECRET` - Required for sessions\n- `DATABASE_URL` - Required for production\n\n**Where to find these values**:\n- Client ID: Overview page\n- Tenant ID: Overview page (or use `common` for multi-tenant)\n- Client Secret: You copied this when you created it (can't view again)\n\n---\n\n## 🔧 Troubleshooting Common Issues\n\n### \"Redirect URI mismatch\" error\n- Double-check that your redirect URI in Azure **exactly matches** the callback URL\n- Remember: `http://localhost:5000` vs `http://localhost:5000/` are different!\n\n### \"Invalid client secret\" error\n- Your secret might be expired\n- Create a new secret in Azure and update `MICROSOFT_CLIENT_SECRET` in Replit\n\n### Users can't sign in with personal Microsoft accounts\n- Change **Supported account types** to allow multi-tenant + personal accounts\n- Use `common` as your `MICROSOFT_TENANT_ID`\n\n### Works in development but not production\n- Make sure you've **published** your latest code changes\n- Verify the production redirect URI is registered in Azure\n- Check that production secrets are set correctly\n\n---\n\n## 📝 Quick Reference\n\n**Your Application (Client) ID**: Found in Azure Portal > App registrations > Overview\n\n**Tenant ID**: \n- For multi-tenant: Use `common`\n- For single tenant: Found in Azure Portal > App registrations > Overview\n\n**Redirect URIs**:\n- Development: `http://localhost:5000/api/auth/microsoft/callback`\n- Production: `https://h5pcreator.org/api/auth/microsoft/callback`\n","size_bytes":3191},"client/src/pages/GoogleSlidesCreator.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useParams, useLocation, Link } from \"wouter\";\nimport { useMutation, useQuery } from \"@tanstack/react-query\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Label } from \"@/components/ui/label\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Alert, AlertDescription } from \"@/components/ui/alert\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Loader2, ArrowLeft, Plus, Trash2, Sparkles, Globe, ExternalLink, AlertCircle, Palette, Zap, Image as ImageIcon } from \"lucide-react\";\nimport type { GoogleSlidesData, SlideContent, H5pContent } from \"@shared/schema\";\nimport ShareToClassroomDialog from \"@/components/ShareToClassroomDialog\";\n\ndeclare global {\n  interface Window {\n    puter?: {\n      ai: {\n        txt2img: (prompt: string, options?: { model?: string }) => Promise<HTMLImageElement>;\n      };\n    };\n  }\n}\n\ntype ImageProvider = \"puterjs\" | \"unsplash\";\n\nexport default function GoogleSlidesCreator() {\n  const { id: contentId } = useParams();\n  const [, navigate] = useLocation();\n  const { toast } = useToast();\n  const { user } = useAuth();\n  \n  const isEditing = !!contentId;\n  \n  const [title, setTitle] = useState(\"\");\n  const [description, setDescription] = useState(\"\");\n  const [topic, setTopic] = useState(\"\");\n  const [gradeLevel, setGradeLevel] = useState(\"\");\n  const [ageRange, setAgeRange] = useState(\"\");\n  const [learningOutcomes, setLearningOutcomes] = useState<string[]>([\"\"]);\n  const [customInstructions, setCustomInstructions] = useState(\"\");\n  const [numberOfSlides, setNumberOfSlides] = useState(10);\n  const [slides, setSlides] = useState<SlideContent[]>([]);\n  const [generatedDate, setGeneratedDate] = useState(\"\");\n  const [isPublished, setIsPublished] = useState(false);\n  const [isPublic, setIsPublic] = useState(false);\n  const [isSaving, setIsSaving] = useState(false);\n  const [presentationId, setPresentationId] = useState<string>(\"\");\n  const [presentationUrl, setPresentationUrl] = useState<string>(\"\");\n  const [colorScheme, setColorScheme] = useState<string>(\"blue\");\n  const [imageProvider, setImageProvider] = useState<ImageProvider>(\"puterjs\");\n\n  const { data: content, isLoading: isLoadingContent } = useQuery<H5pContent>({\n    queryKey: [`/api/content/${contentId}`],\n    enabled: isEditing,\n  });\n\n  const { data: authProviders, isLoading: isLoadingProviders } = useQuery<{ google: boolean; microsoft: boolean }>({\n    queryKey: [\"/api/auth/providers\"],\n  });\n\n  useEffect(() => {\n    if (content && content.type === \"google-slides\") {\n      setTitle(content.title);\n      setDescription(content.description || \"\");\n      const data = content.data as GoogleSlidesData;\n      setTopic(data.topic);\n      setGradeLevel(data.gradeLevel);\n      setAgeRange(data.ageRange);\n      setLearningOutcomes(data.learningOutcomes);\n      setCustomInstructions(data.customInstructions || \"\");\n      setSlides(data.slides || []);\n      setGeneratedDate(data.generatedDate);\n      setIsPublished(content.isPublished);\n      setIsPublic(content.isPublic || false);\n      setPresentationId(data.presentationId || \"\");\n      setPresentationUrl(data.presentationUrl || \"\");\n      setColorScheme(data.colorScheme || \"blue\");\n      setImageProvider(data.imageProvider || \"puterjs\");\n    }\n  }, [content]);\n\n  // Handle return from Google authentication\n  useEffect(() => {\n    const urlParams = new URLSearchParams(window.location.search);\n    if (urlParams.get('googleAuthSuccess') === 'true' && user?.googleAccessToken) {\n      // User just authenticated with Google, show success message\n      toast({\n        title: \"Google Account Connected!\",\n        description: \"You can now create Google Slides presentations.\",\n      });\n      \n      // Clean up URL\n      urlParams.delete('googleAuthSuccess');\n      const newUrl = window.location.pathname + (urlParams.toString() ? '?' + urlParams.toString() : '');\n      window.history.replaceState({}, '', newUrl);\n    }\n  }, [user, toast]);\n\n  const saveMutation = useMutation({\n    mutationFn: async (params: { publish: boolean }) => {\n      const data: GoogleSlidesData = {\n        topic,\n        gradeLevel,\n        ageRange,\n        learningOutcomes: learningOutcomes.filter(o => o.trim()),\n        ...(customInstructions && { customInstructions }),\n        slides,\n        generatedDate: generatedDate || new Date().toISOString(),\n        colorScheme,\n        imageProvider,\n        ...(presentationId && { presentationId }),\n        ...(presentationUrl && { presentationUrl }),\n      };\n\n      if (isEditing) {\n        const response = await apiRequest(\"PUT\", `/api/content/${contentId}`, {\n          title,\n          description,\n          data,\n          isPublished: params.publish,\n          isPublic,\n        });\n        return await response.json();\n      } else {\n        const response = await apiRequest(\"POST\", \"/api/content\", {\n          title,\n          description,\n          type: \"google-slides\",\n          data,\n          isPublished: params.publish,\n          isPublic,\n        });\n        return await response.json();\n      }\n    },\n    onSuccess: (data) => {\n      setIsSaving(false);\n      setIsPublished(data.isPublished);\n      queryClient.invalidateQueries({ queryKey: [\"/api/content\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/content/public\"] });\n      if (!isEditing) {\n        navigate(`/create/google-slides/${data.id}`);\n      }\n      toast({ title: \"Saved!\", description: \"Google Slides content saved successfully.\" });\n    },\n    onError: (error: any) => {\n      setIsSaving(false);\n      toast({\n        title: \"Save failed\",\n        description: error.message || \"Failed to save Google Slides content\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const generateMutation = useMutation({\n    mutationFn: async () => {\n      const response = await apiRequest(\"POST\", \"/api/google-slides/generate\", {\n        topic,\n        gradeLevel,\n        ageRange,\n        learningOutcomes: learningOutcomes.filter(o => o.trim()),\n        numberOfSlides,\n        ...(customInstructions && { customInstructions }),\n      });\n      return await response.json();\n    },\n    onSuccess: async (data) => {\n      console.log(\"Generate mutation success, received data:\", data);\n      let slidesData = data.slides || [];\n      console.log(\"Slides data:\", slidesData);\n      \n      // Track successful image generations and provider actually used\n      let successCount = 0;\n      let failCount = 0;\n      let usedPuterJs = false;\n      let usedUnsplash = false;\n      let fallbackOccurred = false;\n      \n      // Generate/fetch images based on selected provider\n      try {\n        const slidesWithImages = await Promise.all(\n          slidesData.map(async (slide: SlideContent) => {\n            if (slide.imageUrl && !slide.imageUrl.startsWith('http')) {\n              const originalPrompt = slide.imageUrl;\n              // This is a search query/prompt, fetch/generate actual image\n              try {\n                if (imageProvider === \"puterjs\") {\n                  // Use Puter.js AI image generation\n                  if (window.puter) {\n                    try {\n                      const imageElement = await window.puter.ai.txt2img(originalPrompt, {\n                        model: \"gpt-image-1\"\n                      });\n                      \n                      successCount++;\n                      usedPuterJs = true;\n                      return {\n                        ...slide,\n                        imageUrl: imageElement.src,\n                        imageAlt: slide.imageAlt || originalPrompt,\n                      };\n                    } catch (puterError) {\n                      console.error(\"Puter.js generation error for slide:\", puterError);\n                      fallbackOccurred = true;\n                      // Fall back to Unsplash on Puter.js error\n                      const imageResponse = await apiRequest(\"POST\", \"/api/unsplash/search\", {\n                        query: originalPrompt,\n                        count: 1,\n                      });\n                      const imageData = await imageResponse.json();\n                      \n                      if (imageData.photos && imageData.photos.length > 0) {\n                        const photo = imageData.photos[0];\n                        successCount++;\n                        usedUnsplash = true;\n                        return {\n                          ...slide,\n                          imageUrl: photo.urls.regular,\n                          imageAlt: slide.imageAlt || photo.alt_description || photo.description || originalPrompt,\n                        };\n                      } else {\n                        // Both providers failed for this slide\n                        failCount++;\n                        return {\n                          ...slide,\n                          imageUrl: \"\", // Clear broken query string\n                          imageAlt: slide.imageAlt || originalPrompt,\n                        };\n                      }\n                    }\n                  } else {\n                    console.warn(\"Puter.js not available, falling back to Unsplash\");\n                    fallbackOccurred = true;\n                    // Fall back to Unsplash if Puter.js not loaded\n                    const imageResponse = await apiRequest(\"POST\", \"/api/unsplash/search\", {\n                      query: originalPrompt,\n                      count: 1,\n                    });\n                    const imageData = await imageResponse.json();\n                    \n                    if (imageData.photos && imageData.photos.length > 0) {\n                      const photo = imageData.photos[0];\n                      successCount++;\n                      usedUnsplash = true;\n                      return {\n                        ...slide,\n                        imageUrl: photo.urls.regular,\n                        imageAlt: slide.imageAlt || photo.alt_description || photo.description || originalPrompt,\n                      };\n                    } else {\n                      failCount++;\n                      return {\n                        ...slide,\n                        imageUrl: \"\", // Clear broken query string\n                        imageAlt: slide.imageAlt || originalPrompt,\n                      };\n                    }\n                  }\n                } else {\n                  // Use Unsplash stock photos\n                  const imageResponse = await apiRequest(\"POST\", \"/api/unsplash/search\", {\n                    query: originalPrompt,\n                    count: 1,\n                  });\n                  const imageData = await imageResponse.json();\n                  \n                  if (imageData.photos && imageData.photos.length > 0) {\n                    const photo = imageData.photos[0];\n                    successCount++;\n                    usedUnsplash = true;\n                    return {\n                      ...slide,\n                      imageUrl: photo.urls.regular,\n                      imageAlt: slide.imageAlt || photo.alt_description || photo.description || originalPrompt,\n                    };\n                  } else {\n                    failCount++;\n                    return {\n                      ...slide,\n                      imageUrl: \"\", // Clear broken query string\n                      imageAlt: slide.imageAlt || originalPrompt,\n                    };\n                  }\n                }\n              } catch (err) {\n                console.error(\"Failed to fetch/generate image for slide:\", err);\n                failCount++;\n                return {\n                  ...slide,\n                  imageUrl: \"\", // Clear broken query string\n                  imageAlt: slide.imageAlt || originalPrompt,\n                };\n              }\n            }\n            return slide;\n          })\n        );\n        \n        console.log(\"Slides with images:\", slidesWithImages);\n        setSlides(slidesWithImages);\n        \n        // Provide accurate feedback based on what actually happened\n        let toastMessage = \"\";\n        if (fallbackOccurred && usedUnsplash && usedPuterJs) {\n          toastMessage = `Generated with mixed sources. ${failCount > 0 ? `${failCount} images failed to load.` : \"\"}`;\n        } else if (fallbackOccurred && usedUnsplash && !usedPuterJs) {\n          toastMessage = `Puter.js unavailable. Used Unsplash stock photos instead. ${failCount > 0 ? `${failCount} images failed to load.` : \"\"}`;\n        } else if (usedPuterJs) {\n          toastMessage = `Generated with AI images. ${failCount > 0 ? `${failCount} images failed to load.` : \"\"}`;\n        } else if (usedUnsplash) {\n          toastMessage = `Generated with stock photos. ${failCount > 0 ? `${failCount} images failed to load.` : \"\"}`;\n        } else {\n          toastMessage = \"Slides generated without images.\";\n        }\n        \n        toast({ \n          title: successCount > 0 ? \"Generated with Images!\" : \"Generated!\", \n          description: toastMessage,\n          variant: failCount > 0 && successCount === 0 ? \"destructive\" : \"default\",\n        });\n      } catch (err) {\n        // Fallback to slides without images if complete image fetching failure\n        console.error(\"Complete image generation/fetch failure:\", err);\n        setSlides(slidesData);\n        toast({ \n          title: \"Image Generation Failed\", \n          description: \"Slides content generated but all images failed to load. Both AI generation and stock photos unavailable.\",\n          variant: \"destructive\",\n        });\n      }\n      \n      setGeneratedDate(data.generatedDate);\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Generation failed\",\n        description: error.message || \"Failed to generate slides. Please try again.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const createPresentationMutation = useMutation({\n    mutationFn: async () => {\n      const response = await apiRequest(\"POST\", \"/api/google-slides/create-presentation\", {\n        title,\n        slides,\n      });\n      return await response.json();\n    },\n    onSuccess: async (data) => {\n      setPresentationId(data.presentationId);\n      setPresentationUrl(data.url);\n      toast({ \n        title: \"Created in Google Slides!\", \n        description: \"Your presentation is ready. Click 'Open in Google Slides' to view it.\" \n      });\n      \n      // Save the presentation URL to content\n      if (isEditing && contentId) {\n        try {\n          const updatedData: GoogleSlidesData = {\n            topic,\n            gradeLevel,\n            ageRange,\n            learningOutcomes: learningOutcomes.filter(o => o.trim()),\n            slides,\n            generatedDate: generatedDate || new Date().toISOString(),\n            colorScheme,\n            presentationId: data.presentationId,\n            presentationUrl: data.url,\n          };\n          \n          await apiRequest(\"PUT\", `/api/content/${contentId}`, {\n            title,\n            description,\n            data: updatedData,\n            isPublished,\n          });\n          queryClient.invalidateQueries({ queryKey: [`/api/content/${contentId}`] });\n        } catch (error: any) {\n          toast({\n            title: \"Warning\",\n            description: \"Presentation created but failed to save URL. Please save manually.\",\n            variant: \"destructive\",\n          });\n        }\n      }\n    },\n    onError: (error: any) => {\n      const errorMessage = error.message || \"An error occurred\";\n      \n      if (errorMessage.includes(\"Google\") || errorMessage.includes(\"OAuth\") || errorMessage.includes(\"connect your account\")) {\n        // Auto-redirect to Google authentication\n        toast({\n          title: \"Google Authentication Required\",\n          description: \"Redirecting to Google sign-in...\",\n        });\n        \n        // Build return URL with current location\n        const returnUrl = window.location.pathname;\n        \n        // Redirect to Google OAuth with return URL\n        setTimeout(() => {\n          window.location.href = `/api/auth/google?returnTo=${encodeURIComponent(returnUrl)}`;\n        }, 1500);\n      } else {\n        toast({\n          title: \"Failed to create presentation\",\n          description: errorMessage,\n          variant: \"destructive\",\n        });\n      }\n    },\n  });\n\n  const handleSave = () => {\n    if (!title) {\n      toast({\n        title: \"Missing title\",\n        description: \"Please provide a title before saving\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    if (slides.length === 0) {\n      toast({\n        title: \"No slides\",\n        description: \"Please generate slides before saving\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    setIsSaving(true);\n    saveMutation.mutate({ publish: isPublished });\n  };\n\n  const handlePublish = () => {\n    if (!title) {\n      toast({\n        title: \"Missing title\",\n        description: \"Please provide a title before publishing\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    if (slides.length === 0) {\n      toast({\n        title: \"No slides\",\n        description: \"Please generate slides before publishing\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    setIsSaving(true);\n    saveMutation.mutate({ publish: true });\n  };\n\n  const handleGenerate = () => {\n    if (!topic || !gradeLevel || !ageRange) {\n      toast({\n        title: \"Missing information\",\n        description: \"Please fill in topic, grade level, and age range\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    const validOutcomes = learningOutcomes.filter(o => o.trim());\n    if (validOutcomes.length === 0) {\n      toast({\n        title: \"Missing learning outcomes\",\n        description: \"Please add at least one learning outcome\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    generateMutation.mutate();\n  };\n\n  const addLearningOutcome = () => {\n    setLearningOutcomes([...learningOutcomes, \"\"]);\n  };\n\n  const removeLearningOutcome = (index: number) => {\n    setLearningOutcomes(learningOutcomes.filter((_, i) => i !== index));\n  };\n\n  const updateLearningOutcome = (index: number, value: string) => {\n    const updated = [...learningOutcomes];\n    updated[index] = value;\n    setLearningOutcomes(updated);\n  };\n\n  if (isLoadingContent) {\n    return (\n      <div className=\"flex items-center justify-center min-h-screen\">\n        <Loader2 className=\"h-8 w-8 animate-spin\" data-testid=\"loader-content\" />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"container mx-auto py-8 px-4 max-w-6xl\">\n      <div className=\"mb-6 flex items-center justify-between\">\n        <div className=\"flex items-center gap-4\">\n          <Link href=\"/dashboard\">\n            <Button variant=\"ghost\" size=\"icon\" data-testid=\"button-back\">\n              <ArrowLeft className=\"h-4 w-4\" />\n            </Button>\n          </Link>\n          <h1 className=\"text-3xl font-bold\">\n            {isEditing ? \"Edit Google Slides\" : \"Create Google Slides\"}\n          </h1>\n        </div>\n        <div className=\"flex gap-2\">\n          {contentId && presentationUrl && (\n            <ShareToClassroomDialog\n              contentTitle={title}\n              contentDescription={description}\n              materialLink={presentationUrl}\n            />\n          )}\n          <Button\n            onClick={handleSave}\n            disabled={isSaving || !title || slides.length === 0}\n            data-testid=\"button-save\"\n          >\n            {isSaving ? <Loader2 className=\"h-4 w-4 animate-spin mr-2\" /> : null}\n            Save\n          </Button>\n          <Button\n            onClick={handlePublish}\n            disabled={isSaving || !title || slides.length === 0}\n            variant=\"default\"\n            data-testid=\"button-publish\"\n          >\n            {isSaving ? <Loader2 className=\"h-4 w-4 animate-spin mr-2\" /> : null}\n            <Globe className=\"h-4 w-4 mr-2\" />\n            Publish\n          </Button>\n        </div>\n      </div>\n\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n        <div className=\"space-y-6\">\n          <Card>\n            <CardHeader>\n              <CardTitle>Basic Information</CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <div>\n                <Label htmlFor=\"title\">Title *</Label>\n                <Input\n                  id=\"title\"\n                  value={title}\n                  onChange={(e) => setTitle(e.target.value)}\n                  placeholder=\"e.g., Introduction to Photosynthesis\"\n                  data-testid=\"input-title\"\n                />\n              </div>\n              <div>\n                <Label htmlFor=\"description\">Description</Label>\n                <Textarea\n                  id=\"description\"\n                  value={description}\n                  onChange={(e) => setDescription(e.target.value)}\n                  placeholder=\"Brief description of this presentation\"\n                  rows={3}\n                  data-testid=\"input-description\"\n                />\n              </div>\n              <div className=\"flex items-center justify-between p-4 bg-muted/50 rounded-lg\">\n                <div className=\"space-y-0.5\">\n                  <Label htmlFor=\"isPublic\" className=\"text-base\">Share as Public Resource</Label>\n                  <p className=\"text-sm text-muted-foreground\">\n                    Allow other teachers to discover and use this Google Slides presentation on the Shared Resources page. Content will be automatically published when shared.\n                  </p>\n                </div>\n                <Switch\n                  id=\"isPublic\"\n                  checked={isPublic}\n                  onCheckedChange={(checked) => {\n                    setIsPublic(checked);\n                    if (checked) {\n                      setIsPublished(true);\n                    }\n                  }}\n                  data-testid=\"switch-public\"\n                />\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader>\n              <CardTitle>Presentation Details</CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <div>\n                <Label htmlFor=\"topic\">Topic *</Label>\n                <Input\n                  id=\"topic\"\n                  value={topic}\n                  onChange={(e) => setTopic(e.target.value)}\n                  placeholder=\"e.g., Photosynthesis\"\n                  data-testid=\"input-topic\"\n                />\n              </div>\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div>\n                  <Label htmlFor=\"gradeLevel\">Grade Level *</Label>\n                  <Select value={gradeLevel} onValueChange={setGradeLevel}>\n                    <SelectTrigger id=\"gradeLevel\" data-testid=\"select-grade\">\n                      <SelectValue placeholder=\"Select grade level\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"Pre-K\">Pre-K</SelectItem>\n                      <SelectItem value=\"Kindergarten\">Kindergarten</SelectItem>\n                      <SelectItem value=\"K-2\">K-2 (Grades K-2)</SelectItem>\n                      <SelectItem value=\"3-5\">3-5 (Grades 3-5)</SelectItem>\n                      <SelectItem value=\"6-8\">6-8 (Grades 6-8)</SelectItem>\n                      <SelectItem value=\"9-12\">9-12 (Grades 9-12)</SelectItem>\n                      <SelectItem value=\"Higher Education\">Higher Education</SelectItem>\n                    </SelectContent>\n                  </Select>\n                </div>\n                <div>\n                  <Label htmlFor=\"ageRange\">Age Range *</Label>\n                  <Input\n                    id=\"ageRange\"\n                    value={ageRange}\n                    onChange={(e) => setAgeRange(e.target.value)}\n                    placeholder=\"e.g., 10-11\"\n                    data-testid=\"input-age\"\n                  />\n                </div>\n              </div>\n              <div>\n                <Label htmlFor=\"numberOfSlides\">Number of Slides</Label>\n                <Input\n                  id=\"numberOfSlides\"\n                  type=\"number\"\n                  min=\"5\"\n                  max=\"30\"\n                  value={numberOfSlides}\n                  onChange={(e) => setNumberOfSlides(parseInt(e.target.value) || 10)}\n                  data-testid=\"input-slide-count\"\n                />\n                <p className=\"text-xs text-muted-foreground mt-1\">Between 5 and 30 slides</p>\n              </div>\n              <div>\n                <Label htmlFor=\"imageProvider\">Image Source</Label>\n                <Select value={imageProvider} onValueChange={(value) => setImageProvider(value as ImageProvider)}>\n                  <SelectTrigger id=\"imageProvider\" data-testid=\"select-image-provider\">\n                    <SelectValue placeholder=\"Select image source\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"puterjs\" data-testid=\"select-image-provider-puterjs\">\n                      <div className=\"flex items-center gap-2\">\n                        <Zap className=\"h-4 w-4\" />\n                        <span>AI Generated (Free, Recommended)</span>\n                      </div>\n                    </SelectItem>\n                    <SelectItem value=\"unsplash\" data-testid=\"select-image-provider-unsplash\">\n                      <div className=\"flex items-center gap-2\">\n                        <ImageIcon className=\"h-4 w-4\" />\n                        <span>Stock Photos (Unsplash)</span>\n                      </div>\n                    </SelectItem>\n                  </SelectContent>\n                </Select>\n                <p className=\"text-xs text-muted-foreground mt-1\">\n                  {imageProvider === \"puterjs\" \n                    ? \"Free AI-generated images using Puter.js - no API key required\" \n                    : \"Stock photos from Unsplash - requires internet connection\"}\n                </p>\n              </div>\n              <div>\n                <Label htmlFor=\"colorScheme\">Color Theme</Label>\n                <Select value={colorScheme} onValueChange={setColorScheme}>\n                  <SelectTrigger id=\"colorScheme\" data-testid=\"select-color-scheme\">\n                    <SelectValue placeholder=\"Select color theme\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"blue\">Professional Blue</SelectItem>\n                    <SelectItem value=\"green\">Fresh Green</SelectItem>\n                    <SelectItem value=\"purple\">Creative Purple</SelectItem>\n                    <SelectItem value=\"orange\">Energetic Orange</SelectItem>\n                    <SelectItem value=\"teal\">Modern Teal</SelectItem>\n                    <SelectItem value=\"red\">Bold Red</SelectItem>\n                  </SelectContent>\n                </Select>\n                <p className=\"text-xs text-muted-foreground mt-1\">Visual theme for your presentation</p>\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center justify-between\">\n                Learning Outcomes *\n                <Button\n                  onClick={addLearningOutcome}\n                  size=\"sm\"\n                  variant=\"outline\"\n                  data-testid=\"button-add-outcome\"\n                >\n                  <Plus className=\"h-4 w-4 mr-1\" />\n                  Add\n                </Button>\n              </CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-3\">\n              {learningOutcomes.map((outcome, index) => (\n                <div key={index} className=\"flex gap-2\">\n                  <Input\n                    value={outcome}\n                    onChange={(e) => updateLearningOutcome(index, e.target.value)}\n                    placeholder={`Learning outcome ${index + 1}`}\n                    data-testid={`input-outcome-${index}`}\n                  />\n                  {learningOutcomes.length > 1 && (\n                    <Button\n                      onClick={() => removeLearningOutcome(index)}\n                      size=\"icon\"\n                      variant=\"ghost\"\n                      data-testid={`button-remove-outcome-${index}`}\n                    >\n                      <Trash2 className=\"h-4 w-4\" />\n                    </Button>\n                  )}\n                </div>\n              ))}\n              <Button\n                onClick={handleGenerate}\n                className=\"w-full\"\n                disabled={\n                  generateMutation.isPending ||\n                  !topic ||\n                  !gradeLevel ||\n                  !ageRange ||\n                  learningOutcomes.filter(o => o.trim()).length === 0\n                }\n                data-testid=\"button-generate\"\n                aria-label={`Generate slides button. Status: ${\n                  generateMutation.isPending ? 'Loading' :\n                  !topic ? 'Topic required' :\n                  !gradeLevel ? 'Grade level required' :\n                  !ageRange ? 'Age range required' :\n                  learningOutcomes.filter(o => o.trim()).length === 0 ? 'Learning outcomes required' :\n                  'Ready'\n                }`}\n              >\n                {generateMutation.isPending ? (\n                  <Loader2 className=\"h-4 w-4 animate-spin mr-2\" />\n                ) : (\n                  <Sparkles className=\"h-4 w-4 mr-2\" />\n                )}\n                Generate Slides with AI\n              </Button>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader>\n              <CardTitle>Custom Instructions (Optional)</CardTitle>\n              <p className=\"text-sm text-muted-foreground\">\n                Provide additional guidance to help the AI understand exactly what you want in your presentation\n              </p>\n            </CardHeader>\n            <CardContent>\n              <Textarea\n                value={customInstructions}\n                onChange={(e) => setCustomInstructions(e.target.value)}\n                placeholder=\"Example: Focus on Caribbean examples and cultural context. Include interactive questions after each main concept. Use simple language appropriate for ESL learners.\"\n                rows={4}\n                data-testid=\"textarea-custom-instructions\"\n                className=\"resize-none\"\n              />\n              <p className=\"text-xs text-muted-foreground mt-2\">\n                💡 Tip: Be specific about teaching approach, examples to include, cultural context, or any special requirements\n              </p>\n            </CardContent>\n          </Card>\n        </div>\n\n        <div>\n          <Card>\n            <CardHeader>\n              <div className=\"flex items-center justify-between\">\n                <CardTitle>\n                  Generated Slides\n                  {slides.length > 0 && ` (${slides.length} slides)`}\n                </CardTitle>\n                {slides.length > 0 && !isLoadingProviders && (\n                  <div className=\"flex gap-2\">\n                    {presentationUrl ? (\n                      <Button\n                        onClick={() => window.open(presentationUrl, '_blank')}\n                        size=\"sm\"\n                        variant=\"outline\"\n                        data-testid=\"button-open-slides\"\n                      >\n                        <ExternalLink className=\"h-4 w-4 mr-1\" />\n                        Open in Google Slides\n                      </Button>\n                    ) : user?.googleAccessToken ? (\n                      <Button\n                        onClick={() => createPresentationMutation.mutate()}\n                        size=\"sm\"\n                        disabled={createPresentationMutation.isPending}\n                        data-testid=\"button-create-slides\"\n                      >\n                        {createPresentationMutation.isPending ? (\n                          <Loader2 className=\"h-4 w-4 animate-spin mr-1\" />\n                        ) : (\n                          <ExternalLink className=\"h-4 w-4 mr-1\" />\n                        )}\n                        Create in Google Slides\n                      </Button>\n                    ) : authProviders?.google === true ? (\n                      <Button\n                        asChild\n                        size=\"sm\"\n                        variant=\"outline\"\n                        data-testid=\"button-connect-google\"\n                      >\n                        <a href=\"/api/auth/google\">\n                          <ExternalLink className=\"h-4 w-4 mr-1\" />\n                          Connect Google Account\n                        </a>\n                      </Button>\n                    ) : null}\n                  </div>\n                )}\n              </div>\n            </CardHeader>\n            <CardContent>\n              {!isLoadingProviders && authProviders?.google === false && (\n                <Alert className=\"mb-4\" variant=\"destructive\" data-testid=\"alert-google-not-configured\">\n                  <AlertCircle className=\"h-4 w-4\" />\n                  <AlertDescription>\n                    Google Slides integration is not configured. To use this feature, the administrator needs to set up Google OAuth credentials (GOOGLE_CLIENT_ID and GOOGLE_CLIENT_SECRET).\n                  </AlertDescription>\n                </Alert>\n              )}\n              {!isLoadingProviders && slides.length > 0 && !presentationUrl && !user?.googleAccessToken && authProviders?.google === true && (\n                <Alert className=\"mb-4\" data-testid=\"alert-google-required\">\n                  <AlertCircle className=\"h-4 w-4\" />\n                  <AlertDescription>\n                    To create actual Google Slides presentations, you need to connect your Google account. \n                    This allows the app to create presentations in your Google Drive with real images.\n                    Click \"Connect Google Account\" above to get started.\n                  </AlertDescription>\n                </Alert>\n              )}\n              {slides.length === 0 ? (\n                <div className=\"text-center py-12 text-muted-foreground\">\n                  <Sparkles className=\"h-12 w-12 mx-auto mb-4 opacity-20\" />\n                  <p>No slides yet. Fill in the details and click \"Generate Slides with AI\"</p>\n                </div>\n              ) : (\n                <div className=\"space-y-4 max-h-[600px] overflow-y-auto\">\n                  {slides.map((slide, index) => (\n                    <Card key={slide.id} className=\"overflow-hidden\">\n                      <CardHeader className=\"pb-3\">\n                        <div className=\"flex items-start justify-between\">\n                          <div className=\"flex-1\">\n                            <div className=\"text-xs text-muted-foreground mb-1\">\n                              Slide {index + 1} • {slide.type}\n                            </div>\n                            {slide.title && (\n                              <h4 className=\"font-medium text-sm\">{slide.title}</h4>\n                            )}\n                          </div>\n                        </div>\n                      </CardHeader>\n                      <CardContent className=\"pt-0 space-y-2 text-sm\">\n                        {slide.content && (\n                          <p className=\"text-muted-foreground\">{slide.content}</p>\n                        )}\n                        {slide.bulletPoints && slide.bulletPoints.length > 0 && (\n                          <ul className=\"list-disc list-inside space-y-1 text-muted-foreground\">\n                            {slide.bulletPoints.map((point, i) => (\n                              <li key={i}>{point}</li>\n                            ))}\n                          </ul>\n                        )}\n                        {slide.questions && slide.questions.length > 0 && (\n                          <div className=\"space-y-1\">\n                            {slide.questions.map((question, i) => (\n                              <p key={i} className=\"text-muted-foreground\">\n                                {i + 1}. {question}\n                              </p>\n                            ))}\n                          </div>\n                        )}\n                        {slide.imageUrl && (\n                          <div className=\"bg-muted rounded overflow-hidden\">\n                            {slide.imageUrl.startsWith('http') || slide.imageUrl.startsWith('data:') ? (\n                              <img \n                                src={slide.imageUrl} \n                                alt={slide.imageAlt || \"Slide image\"}\n                                className=\"w-full h-auto max-h-48 object-contain\"\n                              />\n                            ) : (\n                              <div className=\"p-2 text-xs\">\n                                <div className=\"font-medium mb-1\">Image Search Query:</div>\n                                <div className=\"text-muted-foreground\">{slide.imageUrl}</div>\n                              </div>\n                            )}\n                            {slide.imageAlt && (\n                              <div className=\"p-2 text-xs border-t\">\n                                <span className=\"font-medium\">Alt text:</span> {slide.imageAlt}\n                              </div>\n                            )}\n                          </div>\n                        )}\n                        {slide.notes && (\n                          <div className=\"bg-muted rounded p-2 text-xs\">\n                            <div className=\"font-medium mb-1\">Speaker Notes:</div>\n                            <div className=\"text-muted-foreground\">{slide.notes}</div>\n                          </div>\n                        )}\n                      </CardContent>\n                    </Card>\n                  ))}\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n    </div>\n  );\n}\n","size_bytes":38698},"client/src/components/players/GoogleSlidesPlayer.tsx":{"content":"import { useState } from \"react\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { ChevronLeft, ChevronRight, LayoutGrid, Presentation, ExternalLink } from \"lucide-react\";\nimport type { GoogleSlidesData, SlideContent } from \"@shared/schema\";\nimport ShareToClassroomDialog from \"@/components/ShareToClassroomDialog\";\n\ninterface GoogleSlidesPlayerProps {\n  data: GoogleSlidesData;\n}\n\n// Color scheme definitions\nconst colorSchemes = {\n  blue: {\n    bg: \"bg-blue-50 dark:bg-blue-950\",\n    accent: \"bg-blue-600\",\n    text: \"text-blue-900 dark:text-blue-100\",\n    border: \"border-blue-200 dark:border-blue-800\"\n  },\n  green: {\n    bg: \"bg-green-50 dark:bg-green-950\",\n    accent: \"bg-green-600\",\n    text: \"text-green-900 dark:text-green-100\",\n    border: \"border-green-200 dark:border-green-800\"\n  },\n  purple: {\n    bg: \"bg-purple-50 dark:bg-purple-950\",\n    accent: \"bg-purple-600\",\n    text: \"text-purple-900 dark:text-purple-100\",\n    border: \"border-purple-200 dark:border-purple-800\"\n  },\n  orange: {\n    bg: \"bg-orange-50 dark:bg-orange-950\",\n    accent: \"bg-orange-600\",\n    text: \"text-orange-900 dark:text-orange-100\",\n    border: \"border-orange-200 dark:border-orange-800\"\n  },\n  teal: {\n    bg: \"bg-teal-50 dark:bg-teal-950\",\n    accent: \"bg-teal-600\",\n    text: \"text-teal-900 dark:text-teal-100\",\n    border: \"border-teal-200 dark:border-teal-800\"\n  },\n  red: {\n    bg: \"bg-red-50 dark:bg-red-950\",\n    accent: \"bg-red-600\",\n    text: \"text-red-900 dark:text-red-100\",\n    border: \"border-red-200 dark:border-red-800\"\n  },\n};\n\nexport default function GoogleSlidesPlayer({ data }: GoogleSlidesPlayerProps) {\n  const [currentSlideIndex, setCurrentSlideIndex] = useState(0);\n  const [viewMode, setViewMode] = useState<\"presentation\" | \"grid\">(\"presentation\");\n  \n  const currentSlide = data.slides[currentSlideIndex];\n  const theme = colorSchemes[data.colorScheme as keyof typeof colorSchemes] || colorSchemes.blue;\n  \n  const goToNextSlide = () => {\n    if (currentSlideIndex < data.slides.length - 1) {\n      setCurrentSlideIndex(currentSlideIndex + 1);\n    }\n  };\n  \n  const goToPreviousSlide = () => {\n    if (currentSlideIndex > 0) {\n      setCurrentSlideIndex(currentSlideIndex - 1);\n    }\n  };\n  \n  const goToSlide = (index: number) => {\n    setCurrentSlideIndex(index);\n    setViewMode(\"presentation\");\n  };\n\n  const renderSlideContent = (slide: SlideContent) => {\n    const isImageUrl = slide.imageUrl && (slide.imageUrl.startsWith('http') || slide.imageUrl.startsWith('data:'));\n    \n    return (\n      <div className=\"space-y-6\">\n        {slide.imageUrl && isImageUrl && (\n          <div className=\"relative w-full aspect-video rounded-lg overflow-hidden mb-6\">\n            <img\n              src={slide.imageUrl}\n              alt={slide.imageAlt || slide.title || \"Slide image\"}\n              className=\"w-full h-full object-cover\"\n            />\n          </div>\n        )}\n        \n        {slide.title && (\n          <h2 className={`text-4xl font-bold ${theme.text}`}>{slide.title}</h2>\n        )}\n        \n        {slide.content && (\n          <p className=\"text-xl leading-relaxed\">{slide.content}</p>\n        )}\n        \n        {slide.bulletPoints && slide.bulletPoints.length > 0 && (\n          <ul className=\"space-y-3 text-lg\">\n            {slide.bulletPoints.map((point, i) => (\n              <li key={i} className=\"flex items-start gap-3\">\n                <span className={`${theme.accent} text-white rounded-full w-7 h-7 flex items-center justify-center flex-shrink-0 mt-1 text-sm font-bold`}>\n                  {i + 1}\n                </span>\n                <span className=\"flex-1\">{point}</span>\n              </li>\n            ))}\n          </ul>\n        )}\n        \n        {slide.questions && slide.questions.length > 0 && (\n          <div className=\"space-y-4\">\n            {slide.questions.map((question, i) => (\n              <div key={i} className={`${theme.bg} ${theme.border} border-2 rounded-lg p-5`}>\n                <p className=\"text-lg\">\n                  <span className={`font-semibold ${theme.text}`}>{i + 1}.</span> {question}\n                </p>\n              </div>\n            ))}\n          </div>\n        )}\n        \n        {slide.imageUrl && !isImageUrl && (\n          <div className={`${theme.bg} ${theme.border} border-2 rounded-lg p-6 text-center`}>\n            <div className=\"text-sm text-muted-foreground mb-2\">Image suggestion:</div>\n            <p className=\"font-medium\">{slide.imageUrl}</p>\n            {slide.imageAlt && (\n              <p className=\"text-sm text-muted-foreground mt-2 italic\">{slide.imageAlt}</p>\n            )}\n          </div>\n        )}\n      </div>\n    );\n  };\n\n  if (viewMode === \"grid\") {\n    return (\n      <div className=\"space-y-4\">\n        <div className=\"flex items-center justify-between mb-4\">\n          <h3 className=\"text-lg font-semibold\">All Slides ({data.slides.length})</h3>\n          <div className=\"flex gap-2\">\n            {data.presentationUrl && (\n              <>\n                <ShareToClassroomDialog\n                  contentTitle={data.topic}\n                  contentDescription={`Interactive presentation about ${data.topic}`}\n                  materialLink={data.presentationUrl}\n                />\n                <Button\n                  onClick={() => window.open(data.presentationUrl, '_blank')}\n                  variant=\"outline\"\n                  size=\"sm\"\n                  data-testid=\"button-open-slides\"\n                >\n                  <ExternalLink className=\"h-4 w-4 mr-2\" />\n                  Open in Google Slides\n                </Button>\n              </>\n            )}\n            <Button\n              onClick={() => setViewMode(\"presentation\")}\n              variant=\"outline\"\n              size=\"sm\"\n              data-testid=\"button-presentation-mode\"\n            >\n              <Presentation className=\"h-4 w-4 mr-2\" />\n              Presentation Mode\n            </Button>\n          </div>\n        </div>\n        \n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n          {data.slides.map((slide, index) => (\n            <Card\n              key={slide.id}\n              className=\"cursor-pointer hover-elevate active-elevate-2\"\n              onClick={() => goToSlide(index)}\n              data-testid={`slide-thumbnail-${index}`}\n            >\n              <CardContent className=\"p-4\">\n                <div className=\"text-xs text-muted-foreground mb-2\">\n                  Slide {index + 1} • {slide.type}\n                </div>\n                {slide.title && (\n                  <h4 className=\"font-medium text-sm line-clamp-2 mb-2\">{slide.title}</h4>\n                )}\n                {slide.content && (\n                  <p className=\"text-xs text-muted-foreground line-clamp-3\">{slide.content}</p>\n                )}\n                {slide.bulletPoints && slide.bulletPoints.length > 0 && (\n                  <div className=\"text-xs text-muted-foreground mt-2\">\n                    {slide.bulletPoints.length} bullet points\n                  </div>\n                )}\n                {slide.questions && slide.questions.length > 0 && (\n                  <div className=\"text-xs text-muted-foreground mt-2\">\n                    {slide.questions.length} questions\n                  </div>\n                )}\n              </CardContent>\n            </Card>\n          ))}\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex items-center justify-between\">\n        <div className=\"text-sm text-muted-foreground\">\n          Slide {currentSlideIndex + 1} of {data.slides.length}\n        </div>\n        <div className=\"flex gap-2\">\n          {data.presentationUrl && (\n            <>\n              <ShareToClassroomDialog\n                contentTitle={data.topic}\n                contentDescription={`Interactive presentation about ${data.topic}`}\n                materialLink={data.presentationUrl}\n              />\n              <Button\n                onClick={() => window.open(data.presentationUrl, '_blank')}\n                variant=\"outline\"\n                size=\"sm\"\n                data-testid=\"button-open-slides\"\n              >\n                <ExternalLink className=\"h-4 w-4 mr-2\" />\n                Open in Google Slides\n              </Button>\n            </>\n          )}\n          <Button\n            onClick={() => setViewMode(\"grid\")}\n            variant=\"outline\"\n            size=\"sm\"\n            data-testid=\"button-grid-mode\"\n          >\n            <LayoutGrid className=\"h-4 w-4 mr-2\" />\n            View All\n          </Button>\n        </div>\n      </div>\n\n      <Card className=\"min-h-[400px]\">\n        <CardContent className=\"p-8 lg:p-12\">\n          <div className=\"max-w-3xl mx-auto\" data-testid={`slide-content-${currentSlideIndex}`}>\n            {renderSlideContent(currentSlide)}\n          </div>\n        </CardContent>\n      </Card>\n\n      <div className=\"flex items-center justify-between\">\n        <Button\n          onClick={goToPreviousSlide}\n          disabled={currentSlideIndex === 0}\n          variant=\"outline\"\n          data-testid=\"button-previous\"\n        >\n          <ChevronLeft className=\"h-4 w-4 mr-2\" />\n          Previous\n        </Button>\n        \n        <div className=\"flex gap-1\">\n          {data.slides.map((_, index) => (\n            <button\n              key={index}\n              onClick={() => goToSlide(index)}\n              className={`h-2 rounded-full transition-all ${\n                index === currentSlideIndex \n                  ? 'w-8 bg-primary' \n                  : 'w-2 bg-muted hover:bg-muted-foreground/30'\n              }`}\n              data-testid={`slide-indicator-${index}`}\n            />\n          ))}\n        </div>\n        \n        <Button\n          onClick={goToNextSlide}\n          disabled={currentSlideIndex === data.slides.length - 1}\n          variant=\"outline\"\n          data-testid=\"button-next\"\n        >\n          Next\n          <ChevronRight className=\"h-4 w-4 ml-2\" />\n        </Button>\n      </div>\n\n      {currentSlide.notes && (\n        <Card className=\"bg-muted/50\">\n          <CardContent className=\"p-4\">\n            <div className=\"text-sm font-medium mb-2\">Speaker Notes:</div>\n            <p className=\"text-sm text-muted-foreground\">{currentSlide.notes}</p>\n          </CardContent>\n        </Card>\n      )}\n\n      <div className=\"text-center text-sm text-muted-foreground\">\n        Use arrow keys to navigate • Click \"View All\" to see all slides\n      </div>\n    </div>\n  );\n}\n","size_bytes":10599},"server/google-slides.ts":{"content":"/**\n * Google Slides API service for creating presentations\n */\n\nimport { google } from 'googleapis';\nimport type { Profile } from '@shared/schema';\nimport { storage } from './storage';\n\nconst slides = google.slides('v1');\n\n/**\n * Get OAuth2 client for a user\n */\nasync function getOAuth2Client(user: Profile) {\n  if (!user.googleAccessToken || !user.googleRefreshToken) {\n    throw new Error('User has not connected their Google account with Slides API access');\n  }\n\n  const oauth2Client = new google.auth.OAuth2(\n    process.env.GOOGLE_CLIENT_ID,\n    process.env.GOOGLE_CLIENT_SECRET,\n    `${process.env.REPLIT_DEV_DOMAIN || 'http://localhost:5000'}/api/auth/google/callback`\n  );\n\n  oauth2Client.setCredentials({\n    access_token: user.googleAccessToken,\n    refresh_token: user.googleRefreshToken,\n    expiry_date: user.googleTokenExpiry ? new Date(user.googleTokenExpiry).getTime() : undefined,\n  });\n\n  // Refresh token if expired\n  if (user.googleTokenExpiry && new Date(user.googleTokenExpiry) < new Date()) {\n    const { credentials } = await oauth2Client.refreshAccessToken();\n    await storage.updateProfile(user.id, {\n      googleAccessToken: credentials.access_token || user.googleAccessToken,\n      googleTokenExpiry: credentials.expiry_date ? new Date(credentials.expiry_date) : user.googleTokenExpiry,\n    });\n    oauth2Client.setCredentials(credentials);\n  }\n\n  return oauth2Client;\n}\n\nexport interface SlideContent {\n  type: 'title' | 'content' | 'image' | 'questions';\n  title?: string;\n  subtitle?: string;\n  text?: string;\n  bulletPoints?: string[];\n  imageUrl?: string;\n  imageAlt?: string;\n  imageAttribution?: string;\n  questions?: string[];\n  notes?: string;\n}\n\n/**\n * Create a new Google Slides presentation\n */\nexport async function createPresentation(\n  user: Profile,\n  title: string\n): Promise<{ presentationId: string; url: string }> {\n  const auth = await getOAuth2Client(user);\n\n  const response = await slides.presentations.create({\n    auth,\n    requestBody: {\n      title,\n    },\n  });\n\n  const presentationId = response.data.presentationId!;\n  const url = `https://docs.google.com/presentation/d/${presentationId}/edit`;\n\n  return { presentationId, url };\n}\n\n/**\n * Add slides to a presentation\n */\nexport async function addSlidesToPresentation(\n  user: Profile,\n  presentationId: string,\n  slideContents: SlideContent[]\n): Promise<void> {\n  const auth = await getOAuth2Client(user);\n\n  // Get presentation to find the first slide ID\n  const presentation = await slides.presentations.get({\n    auth,\n    presentationId,\n  });\n\n  const firstSlideId = presentation.data.slides?.[0]?.objectId;\n  const requests: any[] = [];\n\n  // Delete the default blank slide if it exists\n  if (firstSlideId) {\n    requests.push({\n      deleteObject: {\n        objectId: firstSlideId,\n      },\n    });\n  }\n\n  // Create slides\n  slideContents.forEach((content, index) => {\n    const slideId = `slide_${index}`;\n    \n    // Create blank slide\n    requests.push({\n      createSlide: {\n        objectId: slideId,\n        insertionIndex: index,\n        slideLayoutReference: {\n          predefinedLayout: 'BLANK',\n        },\n      },\n    });\n\n    // Add title\n    if (content.title) {\n      const titleBoxId = `title_${index}`;\n      requests.push({\n        createShape: {\n          objectId: titleBoxId,\n          shapeType: 'TEXT_BOX',\n          elementProperties: {\n            pageObjectId: slideId,\n            size: {\n              height: { magnitude: 700000, unit: 'EMU' },\n              width: { magnitude: 8000000, unit: 'EMU' },\n            },\n            transform: {\n              scaleX: 1,\n              scaleY: 1,\n              translateX: 500000,\n              translateY: 500000,\n              unit: 'EMU',\n            },\n          },\n        },\n      });\n\n      requests.push({\n        insertText: {\n          objectId: titleBoxId,\n          text: content.title,\n        },\n      });\n\n      requests.push({\n        updateTextStyle: {\n          objectId: titleBoxId,\n          style: {\n            fontSize: { magnitude: 36, unit: 'PT' },\n            bold: true,\n          },\n          fields: 'fontSize,bold',\n        },\n      });\n    }\n\n    // Add subtitle\n    if (content.subtitle) {\n      const subtitleBoxId = `subtitle_${index}`;\n      requests.push({\n        createShape: {\n          objectId: subtitleBoxId,\n          shapeType: 'TEXT_BOX',\n          elementProperties: {\n            pageObjectId: slideId,\n            size: {\n              height: { magnitude: 500000, unit: 'EMU' },\n              width: { magnitude: 8000000, unit: 'EMU' },\n            },\n            transform: {\n              scaleX: 1,\n              scaleY: 1,\n              translateX: 500000,\n              translateY: 1500000,\n              unit: 'EMU',\n            },\n          },\n        },\n      });\n\n      requests.push({\n        insertText: {\n          objectId: subtitleBoxId,\n          text: content.subtitle,\n        },\n      });\n\n      requests.push({\n        updateTextStyle: {\n          objectId: subtitleBoxId,\n          style: {\n            fontSize: { magnitude: 20, unit: 'PT' },\n          },\n          fields: 'fontSize',\n        },\n      });\n    }\n\n    // Add text content\n    if (content.text) {\n      const textBoxId = `text_${index}`;\n      const yPosition = content.title ? 1500000 : 800000;\n      \n      requests.push({\n        createShape: {\n          objectId: textBoxId,\n          shapeType: 'TEXT_BOX',\n          elementProperties: {\n            pageObjectId: slideId,\n            size: {\n              height: { magnitude: 3000000, unit: 'EMU' },\n              width: { magnitude: 8000000, unit: 'EMU' },\n            },\n            transform: {\n              scaleX: 1,\n              scaleY: 1,\n              translateX: 500000,\n              translateY: yPosition,\n              unit: 'EMU',\n            },\n          },\n        },\n      });\n\n      requests.push({\n        insertText: {\n          objectId: textBoxId,\n          text: content.text,\n        },\n      });\n\n      requests.push({\n        updateTextStyle: {\n          objectId: textBoxId,\n          style: {\n            fontSize: { magnitude: 16, unit: 'PT' },\n          },\n          fields: 'fontSize',\n        },\n      });\n    }\n\n    // Add bullet points\n    if (content.bulletPoints && content.bulletPoints.length > 0) {\n      const bulletBoxId = `bullets_${index}`;\n      const yPosition = content.title ? 1500000 : 800000;\n      \n      requests.push({\n        createShape: {\n          objectId: bulletBoxId,\n          shapeType: 'TEXT_BOX',\n          elementProperties: {\n            pageObjectId: slideId,\n            size: {\n              height: { magnitude: 3000000, unit: 'EMU' },\n              width: { magnitude: 8000000, unit: 'EMU' },\n            },\n            transform: {\n              scaleX: 1,\n              scaleY: 1,\n              translateX: 500000,\n              translateY: yPosition,\n              unit: 'EMU',\n            },\n          },\n        },\n      });\n\n      const bulletText = content.bulletPoints.map(point => `• ${point}`).join('\\n');\n      requests.push({\n        insertText: {\n          objectId: bulletBoxId,\n          text: bulletText,\n        },\n      });\n\n      requests.push({\n        updateTextStyle: {\n          objectId: bulletBoxId,\n          style: {\n            fontSize: { magnitude: 18, unit: 'PT' },\n          },\n          fields: 'fontSize',\n        },\n      });\n    }\n\n    // Add questions\n    if (content.questions && content.questions.length > 0) {\n      const questionsBoxId = `questions_${index}`;\n      const yPosition = content.title ? 1500000 : 800000;\n      \n      requests.push({\n        createShape: {\n          objectId: questionsBoxId,\n          shapeType: 'TEXT_BOX',\n          elementProperties: {\n            pageObjectId: slideId,\n            size: {\n              height: { magnitude: 3500000, unit: 'EMU' },\n              width: { magnitude: 8000000, unit: 'EMU' },\n            },\n            transform: {\n              scaleX: 1,\n              scaleY: 1,\n              translateX: 500000,\n              translateY: yPosition,\n              unit: 'EMU',\n            },\n          },\n        },\n      });\n\n      const questionsText = content.questions.map((q, i) => `${i + 1}. ${q}`).join('\\n\\n');\n      requests.push({\n        insertText: {\n          objectId: questionsBoxId,\n          text: questionsText,\n        },\n      });\n\n      requests.push({\n        updateTextStyle: {\n          objectId: questionsBoxId,\n          style: {\n            fontSize: { magnitude: 16, unit: 'PT' },\n          },\n          fields: 'fontSize',\n        },\n      });\n    }\n\n    // Add image (if URL is publicly accessible)\n    if (content.imageUrl) {\n      requests.push({\n        createImage: {\n          url: content.imageUrl,\n          elementProperties: {\n            pageObjectId: slideId,\n            size: {\n              height: { magnitude: 3000000, unit: 'EMU' },\n              width: { magnitude: 4000000, unit: 'EMU' },\n            },\n            transform: {\n              scaleX: 1,\n              scaleY: 1,\n              translateX: 2500000,\n              translateY: 1500000,\n              unit: 'EMU',\n            },\n          },\n        },\n      });\n    }\n\n    // Add speaker notes\n    if (content.notes) {\n      requests.push({\n        createSpeakerSpotlight: {\n          pageObjectId: slideId,\n          speakerSpotlightProperties: {\n            outline: {\n              outlineFill: {\n                solidFill: {\n                  color: {\n                    rgbColor: { red: 0, green: 0, blue: 0 },\n                  },\n                },\n              },\n            },\n          },\n        },\n      });\n    }\n  });\n\n  // Execute all requests in batches of 100 (API limit)\n  const batchSize = 100;\n  for (let i = 0; i < requests.length; i += batchSize) {\n    const batch = requests.slice(i, i + batchSize);\n    await slides.presentations.batchUpdate({\n      auth,\n      presentationId,\n      requestBody: {\n        requests: batch,\n      },\n    });\n  }\n}\n","size_bytes":10042},"server/unsplash.ts":{"content":"/**\n * Unsplash API service for fetching educational stock photos\n */\n\nconst UNSPLASH_API_URL = 'https://api.unsplash.com';\nconst UNSPLASH_ACCESS_KEY = process.env.UNSPLASH_ACCESS_KEY;\n\nexport interface UnsplashPhoto {\n  id: string;\n  urls: {\n    raw: string;\n    full: string;\n    regular: string;\n    small: string;\n    thumb: string;\n  };\n  alt_description: string | null;\n  description: string | null;\n  user: {\n    name: string;\n    username: string;\n    profile_image: {\n      small: string;\n    };\n  };\n  links: {\n    html: string;\n  };\n}\n\n/**\n * Search for educational photos on Unsplash\n * @param query Search query (e.g., \"classroom\", \"science experiment\")\n * @param perPage Number of results to return (default: 1, max: 30)\n * @returns Array of photo objects\n */\nexport async function searchPhotos(query: string, perPage: number = 1): Promise<UnsplashPhoto[]> {\n  if (!UNSPLASH_ACCESS_KEY) {\n    console.warn('Unsplash API key not configured');\n    return [];\n  }\n\n  try {\n    const params = new URLSearchParams({\n      query,\n      per_page: perPage.toString(),\n      orientation: 'landscape',\n      content_filter: 'high', // PG-13 content\n    });\n\n    const response = await fetch(`${UNSPLASH_API_URL}/search/photos?${params}`, {\n      headers: {\n        'Authorization': `Client-ID ${UNSPLASH_ACCESS_KEY}`,\n      },\n    });\n\n    if (!response.ok) {\n      console.error('Unsplash API error:', response.status, response.statusText);\n      return [];\n    }\n\n    const data = await response.json();\n    return data.results || [];\n  } catch (error) {\n    console.error('Error fetching photos from Unsplash:', error);\n    return [];\n  }\n}\n\n/**\n * Get a random educational photo based on a query\n * @param query Search query\n * @returns Single photo object or null\n */\nexport async function getRandomPhoto(query: string): Promise<UnsplashPhoto | null> {\n  if (!UNSPLASH_ACCESS_KEY) {\n    console.warn('Unsplash API key not configured');\n    return null;\n  }\n\n  try {\n    const params = new URLSearchParams({\n      query,\n      orientation: 'landscape',\n      content_filter: 'high',\n    });\n\n    const response = await fetch(`${UNSPLASH_API_URL}/photos/random?${params}`, {\n      headers: {\n        'Authorization': `Client-ID ${UNSPLASH_ACCESS_KEY}`,\n      },\n    });\n\n    if (!response.ok) {\n      console.error('Unsplash API error:', response.status, response.statusText);\n      return null;\n    }\n\n    const data = await response.json();\n    return data;\n  } catch (error) {\n    console.error('Error fetching random photo from Unsplash:', error);\n    return null;\n  }\n}\n\n/**\n * Generate attribution text for an Unsplash photo\n * @param photo Unsplash photo object\n * @returns Attribution string (e.g., \"Photo by John Doe on Unsplash\")\n */\nexport function generateAttribution(photo: UnsplashPhoto): string {\n  return `Photo by ${photo.user.name} on Unsplash`;\n}\n\n/**\n * Get the alt text for an image (description or alt_description)\n * @param photo Unsplash photo object\n * @returns Alt text string\n */\nexport function getAltText(photo: UnsplashPhoto): string {\n  return photo.alt_description || photo.description || 'Educational image';\n}\n\n/**\n * Trigger a download event to support Unsplash API guidelines\n * (required by Unsplash when using images in production)\n * @param photo Unsplash photo object\n */\nexport async function triggerDownload(photo: UnsplashPhoto): Promise<void> {\n  if (!UNSPLASH_ACCESS_KEY) {\n    return;\n  }\n\n  try {\n    await fetch(`${photo.links.html}/download`, {\n      headers: {\n        'Authorization': `Client-ID ${UNSPLASH_ACCESS_KEY}`,\n      },\n    });\n  } catch (error) {\n    console.error('Error triggering Unsplash download event:', error);\n  }\n}\n","size_bytes":3693},"client/src/components/ShareToClassroomDialog.tsx":{"content":"import { useState } from \"react\";\nimport { useMutation, useQuery } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n} from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Label } from \"@/components/ui/label\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Loader2, Users, Calendar } from \"lucide-react\";\nimport { SiGoogleclassroom } from \"react-icons/si\";\n\ninterface ShareToClassroomDialogProps {\n  contentTitle: string;\n  contentDescription?: string;\n  materialLink: string;\n  children?: React.ReactNode;\n}\n\ninterface GoogleClassroomCourse {\n  id: string;\n  name: string;\n  section?: string;\n  descriptionHeading?: string;\n  room?: string;\n}\n\nexport default function ShareToClassroomDialog({\n  contentTitle,\n  contentDescription,\n  materialLink,\n  children,\n}: ShareToClassroomDialogProps) {\n  const { toast } = useToast();\n  const [open, setOpen] = useState(false);\n  const [shareType, setShareType] = useState<\"assignment\" | \"announcement\">(\"assignment\");\n  \n  // Assignment fields\n  const [selectedCourse, setSelectedCourse] = useState(\"\");\n  const [assignmentTitle, setAssignmentTitle] = useState(contentTitle);\n  const [assignmentDescription, setAssignmentDescription] = useState(contentDescription || \"\");\n  const [dueDate, setDueDate] = useState(\"\");\n  const [dueTime, setDueTime] = useState(\"\");\n  \n  // Announcement fields\n  const [announcementText, setAnnouncementText] = useState(\n    `Check out this new content: ${contentTitle}`\n  );\n\n  // Fetch user's Google Classroom courses\n  const { data: coursesData, isLoading: loadingCourses } = useQuery<{ courses: GoogleClassroomCourse[] }>({\n    queryKey: [\"/api/google-classroom/courses\"],\n    enabled: open,\n  });\n\n  const courses = coursesData?.courses || [];\n\n  // Share as assignment mutation\n  const shareAssignmentMutation = useMutation({\n    mutationFn: async () => {\n      if (!selectedCourse) {\n        throw new Error(\"Please select a course\");\n      }\n\n      const payload: any = {\n        courseId: selectedCourse,\n        title: assignmentTitle,\n        description: assignmentDescription,\n        materialLink,\n      };\n\n      // Add due date if provided\n      if (dueDate) {\n        const [year, month, day] = dueDate.split(\"-\").map(Number);\n        payload.dueDate = { year, month, day };\n\n        if (dueTime) {\n          const [hours, minutes] = dueTime.split(\":\").map(Number);\n          payload.dueTime = { hours, minutes };\n        }\n      }\n\n      const response = await apiRequest(\"POST\", \"/api/google-classroom/share\", payload);\n      return await response.json();\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Shared to Google Classroom!\",\n        description: \"Assignment created successfully.\",\n      });\n      setOpen(false);\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Failed to share\",\n        description: error.message || \"Could not share to Google Classroom\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Post announcement mutation\n  const postAnnouncementMutation = useMutation({\n    mutationFn: async () => {\n      if (!selectedCourse) {\n        throw new Error(\"Please select a course\");\n      }\n\n      const response = await apiRequest(\"POST\", \"/api/google-classroom/announce\", {\n        courseId: selectedCourse,\n        text: announcementText,\n        materialLink,\n        materialTitle: contentTitle,\n      });\n      return await response.json();\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Posted to Google Classroom!\",\n        description: \"Announcement created successfully.\",\n      });\n      setOpen(false);\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Failed to post\",\n        description: error.message || \"Could not post announcement to Google Classroom\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleShare = () => {\n    if (shareType === \"assignment\") {\n      shareAssignmentMutation.mutate();\n    } else {\n      postAnnouncementMutation.mutate();\n    }\n  };\n\n  const isLoading = shareAssignmentMutation.isPending || postAnnouncementMutation.isPending;\n\n  return (\n    <Dialog open={open} onOpenChange={setOpen}>\n      <DialogTrigger asChild>\n        {children || (\n          <Button variant=\"outline\" size=\"sm\" data-testid=\"button-share-classroom\">\n            <SiGoogleclassroom className=\"h-4 w-4 mr-2\" />\n            Share to Classroom\n          </Button>\n        )}\n      </DialogTrigger>\n      <DialogContent className=\"max-w-2xl max-h-[90vh] overflow-y-auto\">\n        <DialogHeader>\n          <DialogTitle className=\"flex items-center gap-2\">\n            <SiGoogleclassroom className=\"h-5 w-5\" />\n            Share to Google Classroom\n          </DialogTitle>\n          <DialogDescription>\n            Share this content with your students on Google Classroom\n          </DialogDescription>\n        </DialogHeader>\n\n        <Tabs value={shareType} onValueChange={(v) => {\n          setShareType(v as \"assignment\" | \"announcement\");\n          // Reset course selection when switching tabs for clarity\n          setSelectedCourse(\"\");\n        }}>\n          <TabsList className=\"grid w-full grid-cols-2\">\n            <TabsTrigger value=\"assignment\" data-testid=\"tab-assignment\">\n              <Calendar className=\"h-4 w-4 mr-2\" />\n              Assignment\n            </TabsTrigger>\n            <TabsTrigger value=\"announcement\" data-testid=\"tab-announcement\">\n              <Users className=\"h-4 w-4 mr-2\" />\n              Announcement\n            </TabsTrigger>\n          </TabsList>\n\n          <div className=\"mt-4 space-y-4\">\n            {/* Course selection (common to both) */}\n            <div>\n              <Label htmlFor=\"course\">Select Course *</Label>\n              {loadingCourses ? (\n                <div className=\"flex items-center justify-center py-8\">\n                  <Loader2 className=\"h-6 w-6 animate-spin text-muted-foreground\" />\n                </div>\n              ) : courses.length === 0 ? (\n                <div className=\"text-sm text-muted-foreground py-4 text-center border rounded-md\">\n                  No courses found. Make sure you're signed in with Google and have active courses.\n                </div>\n              ) : (\n                <Select value={selectedCourse} onValueChange={setSelectedCourse}>\n                  <SelectTrigger id=\"course\" data-testid=\"select-course\">\n                    <SelectValue placeholder=\"Choose a course\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {courses.map((course) => (\n                      <SelectItem key={course.id} value={course.id}>\n                        {course.name} {course.section ? `(${course.section})` : \"\"}\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              )}\n            </div>\n\n            {/* Assignment tab */}\n            <TabsContent value=\"assignment\" className=\"space-y-4\">\n              <div>\n                <Label htmlFor=\"assignmentTitle\">Assignment Title *</Label>\n                <Input\n                  id=\"assignmentTitle\"\n                  value={assignmentTitle}\n                  onChange={(e) => setAssignmentTitle(e.target.value)}\n                  placeholder=\"Enter assignment title\"\n                  data-testid=\"input-assignment-title\"\n                />\n              </div>\n\n              <div>\n                <Label htmlFor=\"assignmentDescription\">Instructions (Optional)</Label>\n                <Textarea\n                  id=\"assignmentDescription\"\n                  value={assignmentDescription}\n                  onChange={(e) => setAssignmentDescription(e.target.value)}\n                  placeholder=\"Add instructions for students...\"\n                  rows={4}\n                  data-testid=\"textarea-assignment-description\"\n                />\n              </div>\n\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div>\n                  <Label htmlFor=\"dueDate\">Due Date (Optional)</Label>\n                  <Input\n                    id=\"dueDate\"\n                    type=\"date\"\n                    value={dueDate}\n                    onChange={(e) => setDueDate(e.target.value)}\n                    data-testid=\"input-due-date\"\n                  />\n                </div>\n                <div>\n                  <Label htmlFor=\"dueTime\">Due Time (Optional)</Label>\n                  <Input\n                    id=\"dueTime\"\n                    type=\"time\"\n                    value={dueTime}\n                    onChange={(e) => setDueTime(e.target.value)}\n                    disabled={!dueDate}\n                    data-testid=\"input-due-time\"\n                  />\n                </div>\n              </div>\n\n              <div className=\"text-xs text-muted-foreground bg-muted p-3 rounded-md\">\n                <strong>Note:</strong> The content will be attached as a link in the assignment.\n              </div>\n            </TabsContent>\n\n            {/* Announcement tab */}\n            <TabsContent value=\"announcement\" className=\"space-y-4\">\n              <div>\n                <Label htmlFor=\"announcementText\">Announcement Text *</Label>\n                <Textarea\n                  id=\"announcementText\"\n                  value={announcementText}\n                  onChange={(e) => setAnnouncementText(e.target.value)}\n                  placeholder=\"Write your announcement...\"\n                  rows={6}\n                  data-testid=\"textarea-announcement\"\n                />\n              </div>\n\n              <div className=\"text-xs text-muted-foreground bg-muted p-3 rounded-md\">\n                <strong>Note:</strong> The content will be attached as a link in the announcement.\n              </div>\n            </TabsContent>\n          </div>\n        </Tabs>\n\n        <div className=\"flex justify-end gap-2 pt-4 border-t\">\n          <Button\n            variant=\"outline\"\n            onClick={() => setOpen(false)}\n            disabled={isLoading}\n            data-testid=\"button-cancel-share\"\n          >\n            Cancel\n          </Button>\n          <Button\n            onClick={handleShare}\n            disabled={isLoading || !selectedCourse || courses.length === 0}\n            data-testid=\"button-confirm-share\"\n          >\n            {isLoading ? (\n              <>\n                <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\n                Sharing...\n              </>\n            ) : (\n              <>\n                <SiGoogleclassroom className=\"h-4 w-4 mr-2\" />\n                {shareType === \"assignment\" ? \"Create Assignment\" : \"Post Announcement\"}\n              </>\n            )}\n          </Button>\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","size_bytes":11200},"server/google-classroom.ts":{"content":"import { google } from 'googleapis';\nimport type { Profile } from '@shared/schema';\n\nconst classroom = google.classroom('v1');\n\n/**\n * Get OAuth2 client with user's access token\n */\nfunction getOAuth2Client(user: Profile) {\n  const oauth2Client = new google.auth.OAuth2(\n    process.env.GOOGLE_CLIENT_ID,\n    process.env.GOOGLE_CLIENT_SECRET\n  );\n\n  if (!user.googleAccessToken) {\n    throw new Error('User does not have Google access token');\n  }\n\n  oauth2Client.setCredentials({\n    access_token: user.googleAccessToken,\n    refresh_token: user.googleRefreshToken,\n  });\n\n  return oauth2Client;\n}\n\n/**\n * List all courses the user teaches\n */\nexport async function listTeacherCourses(user: Profile) {\n  try {\n    const auth = getOAuth2Client(user);\n    \n    const response = await classroom.courses.list({\n      auth,\n      teacherId: 'me',\n      courseStates: ['ACTIVE'],\n      pageSize: 100,\n    });\n\n    return response.data.courses || [];\n  } catch (error: any) {\n    console.error('Error listing courses:', error.message);\n    throw new Error(`Failed to list courses: ${error.message}`);\n  }\n}\n\n/**\n * Share content to Google Classroom as a coursework assignment\n */\nexport async function shareToClassroom(\n  user: Profile,\n  courseId: string,\n  title: string,\n  description: string,\n  materialLink: string,\n  dueDate?: { year: number; month: number; day: number },\n  dueTime?: { hours: number; minutes: number }\n) {\n  try {\n    const auth = getOAuth2Client(user);\n\n    // Create coursework (assignment)\n    const coursework: any = {\n      title,\n      description,\n      materials: [\n        {\n          link: {\n            url: materialLink,\n            title: title,\n          },\n        },\n      ],\n      state: 'PUBLISHED',\n      workType: 'ASSIGNMENT',\n    };\n\n    // Add due date/time if provided\n    if (dueDate) {\n      coursework.dueDate = dueDate;\n      if (dueTime) {\n        coursework.dueTime = dueTime;\n      }\n    }\n\n    const response = await classroom.courses.courseWork.create({\n      auth,\n      courseId,\n      requestBody: coursework,\n    });\n\n    return response.data;\n  } catch (error: any) {\n    console.error('Error sharing to classroom:', error.message);\n    throw new Error(`Failed to share to classroom: ${error.message}`);\n  }\n}\n\n/**\n * Post an announcement to Google Classroom (no assignment, just info)\n */\nexport async function postAnnouncement(\n  user: Profile,\n  courseId: string,\n  text: string,\n  materialLink?: string,\n  materialTitle?: string\n) {\n  try {\n    const auth = getOAuth2Client(user);\n\n    const announcement: any = {\n      text,\n      state: 'PUBLISHED',\n    };\n\n    // Add material link if provided\n    if (materialLink) {\n      announcement.materials = [\n        {\n          link: {\n            url: materialLink,\n            title: materialTitle || 'Link',\n          },\n        },\n      ];\n    }\n\n    const response = await classroom.courses.announcements.create({\n      auth,\n      courseId,\n      requestBody: announcement,\n    });\n\n    return response.data;\n  } catch (error: any) {\n    console.error('Error posting announcement:', error.message);\n    throw new Error(`Failed to post announcement: ${error.message}`);\n  }\n}\n","size_bytes":3187},"client/src/pages/SharedResourcesPage.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Link, useLocation } from \"wouter\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Avatar, AvatarFallback } from \"@/components/ui/avatar\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { ThemeToggle } from \"@/components/ThemeToggle\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { Breadcrumbs } from \"@/components/Breadcrumbs\";\nimport { useBreadcrumbs } from \"@/hooks/useBreadcrumbs\";\nimport {\n  BookOpen,\n  Layers,\n  Video,\n  Image as ImageIcon,\n  Move,\n  Edit3,\n  Brain,\n  BookText,\n  Search as SearchIcon,\n  Presentation,\n  Eye,\n  Filter,\n  X,\n  ArrowLeft,\n  LogOut,\n  GraduationCap,\n  User,\n  Grid3x3,\n  List,\n} from \"lucide-react\";\nimport type { H5pContent } from \"@shared/schema\";\n\nconst contentTypeIcons = {\n  quiz: BookOpen,\n  flashcard: Layers,\n  \"interactive-video\": Video,\n  \"image-hotspot\": ImageIcon,\n  \"drag-drop\": Move,\n  \"fill-blanks\": Edit3,\n  \"memory-game\": Brain,\n  \"interactive-book\": BookText,\n  \"video-finder\": SearchIcon,\n  \"google-slides\": Presentation,\n};\n\nconst contentTypeLabels = {\n  quiz: \"Quiz\",\n  flashcard: \"Flashcard\",\n  \"interactive-video\": \"Interactive Video\",\n  \"image-hotspot\": \"Image Hotspot\",\n  \"drag-drop\": \"Drag & Drop\",\n  \"fill-blanks\": \"Fill in Blanks\",\n  \"memory-game\": \"Memory Game\",\n  \"interactive-book\": \"Interactive Book\",\n  \"video-finder\": \"Video Finder\",\n  \"google-slides\": \"Google Slides\",\n};\n\nexport default function SharedResourcesPage() {\n  const { user, logout } = useAuth();\n  const [_, navigate] = useLocation();\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [typeFilter, setTypeFilter] = useState<string>(\"all\");\n  const [tagFilter, setTagFilter] = useState(\"all\");\n  const [viewMode, setViewMode] = useState<\"grid\" | \"list\">(\"grid\");\n  const breadcrumbs = useBreadcrumbs();\n\n  const { data: contents = [], isLoading } = useQuery<H5pContent[]>({\n    queryKey: [\n      \"/api/content/public\", \n      {\n        ...(searchQuery && { search: searchQuery }),\n        ...(typeFilter !== \"all\" && { type: typeFilter }),\n        ...(tagFilter !== \"all\" && { tags: tagFilter })\n      }\n    ],\n  });\n\n  // Get unique tags from all content\n  const allTags = Array.from(\n    new Set(\n      contents\n        .flatMap(c => c.tags || [])\n        .filter(Boolean)\n    )\n  ).sort();\n\n  const clearFilters = () => {\n    setSearchQuery(\"\");\n    setTypeFilter(\"all\");\n    setTagFilter(\"all\");\n  };\n\n  const hasActiveFilters = searchQuery || typeFilter !== \"all\" || tagFilter !== \"all\";\n\n  const getInitials = (name?: string) => {\n    if (!name) return \"??\";\n    return name\n      .split(\" \")\n      .map((n) => n[0])\n      .join(\"\")\n      .toUpperCase()\n      .slice(0, 2);\n  };\n\n  const handleLogout = async () => {\n    await logout();\n  };\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      {/* Skip to main content */}\n      <a href=\"#main-content\" className=\"skip-to-content\">\n        Skip to main content\n      </a>\n      \n      {/* Header */}\n      <header className=\"border-b bg-card\" role=\"banner\">\n        <div className=\"max-w-7xl mx-auto px-6 h-16 flex items-center justify-between\">\n          <div className=\"flex items-center gap-4\">\n            <Button\n              variant=\"ghost\"\n              size=\"icon\"\n              onClick={() => navigate(\"/dashboard\")}\n              data-testid=\"button-back-dashboard\"\n              aria-label=\"Back to dashboard\"\n            >\n              <ArrowLeft className=\"h-5 w-5\" />\n            </Button>\n            <div className=\"flex items-center gap-3\">\n              <img \n                src=\"/favicon.png\" \n                alt=\"OECS Content Creator Logo\" \n                className=\"h-10 w-10 rounded-lg\"\n              />\n              <div>\n                <h1 className=\"text-xl font-bold text-foreground\">OECS Content Creator</h1>\n              </div>\n            </div>\n          </div>\n          <div className=\"flex items-center gap-4\">\n            <ThemeToggle />\n            <div className=\"flex items-center gap-3\">\n              <Avatar className=\"h-10 w-10\">\n                <AvatarFallback className=\"bg-primary text-primary-foreground\">\n                  {user ? getInitials(user.fullName) : \"U\"}\n                </AvatarFallback>\n              </Avatar>\n              <div className=\"hidden md:block\">\n                <p className=\"text-sm font-medium text-foreground\">{user?.fullName}</p>\n                <p className=\"text-xs text-muted-foreground\">{user?.role}</p>\n              </div>\n            </div>\n            <Button \n              variant=\"ghost\" \n              size=\"icon\" \n              onClick={handleLogout} \n              data-testid=\"button-logout\"\n              aria-label=\"Log out\"\n            >\n              <LogOut className=\"h-5 w-5\" />\n            </Button>\n          </div>\n        </div>\n      </header>\n\n      {/* Breadcrumbs */}\n      <div className=\"bg-background border-b\">\n        <div className=\"max-w-7xl mx-auto px-6 py-3\">\n          <Breadcrumbs items={breadcrumbs} />\n        </div>\n      </div>\n\n      {/* Main Content */}\n      <main id=\"main-content\" className=\"container mx-auto px-4 py-8 max-w-7xl\" role=\"main\">\n      {/* Header */}\n      <div className=\"mb-8\">\n        <h1 className=\"text-3xl font-bold mb-2\">Shared Resources</h1>\n        <p className=\"text-muted-foreground\">\n          Discover and use interactive educational content shared by teachers across the Caribbean\n        </p>\n      </div>\n\n      {/* Filters */}\n      <Card className=\"mb-8\">\n        <CardContent className=\"p-6\">\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n            {/* Search */}\n            <div className=\"space-y-2\">\n              <label className=\"text-sm font-medium\">Search</label>\n              <div className=\"relative\">\n                <SearchIcon className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n                <Input\n                  placeholder=\"Search by title or description...\"\n                  value={searchQuery}\n                  onChange={(e) => setSearchQuery(e.target.value)}\n                  className=\"pl-9\"\n                  data-testid=\"input-search\"\n                />\n              </div>\n            </div>\n\n            {/* Content Type Filter */}\n            <div className=\"space-y-2\">\n              <label className=\"text-sm font-medium\">Content Type</label>\n              <Select value={typeFilter} onValueChange={setTypeFilter}>\n                <SelectTrigger data-testid=\"select-type-filter\">\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"all\">All Types</SelectItem>\n                  <SelectItem value=\"quiz\">Quiz</SelectItem>\n                  <SelectItem value=\"flashcard\">Flashcard</SelectItem>\n                  <SelectItem value=\"interactive-video\">Interactive Video</SelectItem>\n                  <SelectItem value=\"image-hotspot\">Image Hotspot</SelectItem>\n                  <SelectItem value=\"drag-drop\">Drag & Drop</SelectItem>\n                  <SelectItem value=\"fill-blanks\">Fill in Blanks</SelectItem>\n                  <SelectItem value=\"memory-game\">Memory Game</SelectItem>\n                  <SelectItem value=\"interactive-book\">Interactive Book</SelectItem>\n                  <SelectItem value=\"video-finder\">Video Finder</SelectItem>\n                  <SelectItem value=\"google-slides\">Google Slides</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n\n            {/* Tag Filter */}\n            <div className=\"space-y-2\">\n              <label className=\"text-sm font-medium\">Tags</label>\n              <Select value={tagFilter} onValueChange={setTagFilter}>\n                <SelectTrigger data-testid=\"select-tag-filter\">\n                  <SelectValue placeholder=\"All Tags\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"all\">All Tags</SelectItem>\n                  {allTags.map((tag) => (\n                    <SelectItem key={tag} value={tag}>\n                      {tag}\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </div>\n          </div>\n\n          {hasActiveFilters && (\n            <div className=\"mt-4 flex items-center gap-2\">\n              <Button\n                variant=\"ghost\"\n                size=\"sm\"\n                onClick={clearFilters}\n                data-testid=\"button-clear-filters\"\n              >\n                <X className=\"h-4 w-4 mr-1\" />\n                Clear Filters\n              </Button>\n            </div>\n          )}\n        </CardContent>\n      </Card>\n\n      {/* Results Count & View Toggle */}\n      <div className=\"mb-4 flex items-center justify-between gap-4\">\n        <div className=\"flex items-center gap-2 text-sm text-muted-foreground\">\n          <Filter className=\"h-4 w-4\" />\n          <span data-testid=\"text-results-count\">\n            {contents.length} {contents.length === 1 ? \"resource\" : \"resources\"} found\n          </span>\n        </div>\n        <div className=\"flex items-center gap-1\">\n          <Button\n            variant={viewMode === \"grid\" ? \"default\" : \"ghost\"}\n            size=\"icon\"\n            onClick={() => setViewMode(\"grid\")}\n            data-testid=\"button-view-grid\"\n            aria-label=\"Grid view\"\n          >\n            <Grid3x3 className=\"h-4 w-4\" />\n          </Button>\n          <Button\n            variant={viewMode === \"list\" ? \"default\" : \"ghost\"}\n            size=\"icon\"\n            onClick={() => setViewMode(\"list\")}\n            data-testid=\"button-view-list\"\n            aria-label=\"List view\"\n          >\n            <List className=\"h-4 w-4\" />\n          </Button>\n        </div>\n      </div>\n\n      {/* Content Grid */}\n      {isLoading ? (\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n          {[1, 2, 3, 4, 5, 6].map((i) => (\n            <Card key={i} className=\"animate-pulse\">\n              <CardHeader>\n                <div className=\"h-6 bg-muted rounded w-3/4 mb-2\"></div>\n                <div className=\"h-4 bg-muted rounded w-1/2\"></div>\n              </CardHeader>\n              <CardContent>\n                <div className=\"h-20 bg-muted rounded\"></div>\n              </CardContent>\n            </Card>\n          ))}\n        </div>\n      ) : contents.length === 0 ? (\n        <Card className=\"text-center py-12\">\n          <CardContent>\n            <SearchIcon className=\"h-12 w-12 text-muted-foreground mx-auto mb-4\" />\n            <h3 className=\"text-lg font-semibold mb-2\">No resources found</h3>\n            <p className=\"text-muted-foreground mb-4\">\n              {hasActiveFilters\n                ? \"Try adjusting your filters to find more resources\"\n                : \"No public resources have been shared yet\"}\n            </p>\n            {hasActiveFilters && (\n              <Button variant=\"outline\" onClick={clearFilters} data-testid=\"button-clear-filters-empty\">\n                Clear Filters\n              </Button>\n            )}\n          </CardContent>\n        </Card>\n      ) : (\n        <div className={viewMode === \"grid\" ? \"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\" : \"flex flex-col gap-4\"}>\n          {contents.map((content: any) => {\n            const Icon = contentTypeIcons[content.type as keyof typeof contentTypeIcons] || BookOpen;\n            const typeLabel = contentTypeLabels[content.type as keyof typeof contentTypeLabels] || content.type;\n            \n            // Extract subject and grade level from content data\n            const subject = content.data?.topic || content.data?.subject || null;\n            const gradeLevel = content.data?.gradeLevel || null;\n\n            if (viewMode === \"list\") {\n              // List View Layout\n              return (\n                <Card key={content.id} className=\"hover-elevate\" data-testid={`card-resource-${content.id}`}>\n                  <div className=\"flex flex-col md:flex-row gap-4 p-6\">\n                    <div className=\"flex-1 space-y-3\">\n                      <div className=\"flex items-start gap-3\">\n                        <Badge variant=\"secondary\" className=\"flex items-center gap-1\">\n                          <Icon className=\"h-3 w-3\" />\n                          {typeLabel}\n                        </Badge>\n                      </div>\n                      <div>\n                        <h3 className=\"text-xl font-semibold mb-1\">{content.title}</h3>\n                        {content.description && (\n                          <p className=\"text-sm text-muted-foreground line-clamp-2\">\n                            {content.description}\n                          </p>\n                        )}\n                      </div>\n                      <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-2 text-sm\">\n                        {subject && (\n                          <div className=\"flex items-center gap-2 text-muted-foreground\">\n                            <BookOpen className=\"h-3.5 w-3.5 flex-shrink-0\" />\n                            <span className=\"truncate\">{subject}</span>\n                          </div>\n                        )}\n                        {gradeLevel && (\n                          <div className=\"flex items-center gap-2 text-muted-foreground\">\n                            <GraduationCap className=\"h-3.5 w-3.5 flex-shrink-0\" />\n                            <span className=\"truncate\">{gradeLevel}</span>\n                          </div>\n                        )}\n                        {content.creatorName && (\n                          <div className=\"flex items-center gap-2 text-muted-foreground\">\n                            <User className=\"h-3.5 w-3.5 flex-shrink-0\" />\n                            <span className=\"truncate\">{content.creatorName}</span>\n                          </div>\n                        )}\n                      </div>\n                      {content.tags && content.tags.length > 0 && (\n                        <div className=\"flex flex-wrap gap-1\">\n                          {content.tags.slice(0, 5).map((tag: string, idx: number) => (\n                            <Badge key={idx} variant=\"outline\" className=\"text-xs\">\n                              {tag}\n                            </Badge>\n                          ))}\n                          {content.tags.length > 5 && (\n                            <Badge variant=\"outline\" className=\"text-xs\">\n                              +{content.tags.length - 5}\n                            </Badge>\n                          )}\n                        </div>\n                      )}\n                    </div>\n                    <div className=\"flex items-center md:items-start\">\n                      <Link href={`/public/${content.id}`}>\n                        <Button size=\"default\" data-testid={`button-preview-${content.id}`}>\n                          <Eye className=\"h-4 w-4 mr-2\" />\n                          Preview & Use\n                        </Button>\n                      </Link>\n                    </div>\n                  </div>\n                </Card>\n              );\n            }\n\n            // Grid View Layout (with aligned buttons at bottom)\n            return (\n              <Card key={content.id} className=\"hover-elevate flex flex-col\" data-testid={`card-resource-${content.id}`}>\n                <CardHeader>\n                  <div className=\"flex items-start justify-between gap-2 mb-2\">\n                    <Badge variant=\"secondary\" className=\"flex items-center gap-1\">\n                      <Icon className=\"h-3 w-3\" />\n                      {typeLabel}\n                    </Badge>\n                  </div>\n                  <CardTitle className=\"line-clamp-2\">{content.title}</CardTitle>\n                  {content.description && (\n                    <CardDescription className=\"line-clamp-2\">\n                      {content.description}\n                    </CardDescription>\n                  )}\n                </CardHeader>\n                <CardContent className=\"flex flex-col flex-1 space-y-3\">\n                  {/* Meta Information */}\n                  <div className=\"space-y-1.5 text-sm\">\n                    {subject && (\n                      <div className=\"flex items-center gap-2 text-muted-foreground\">\n                        <BookOpen className=\"h-3.5 w-3.5 flex-shrink-0\" />\n                        <span className=\"truncate\">{subject}</span>\n                      </div>\n                    )}\n                    {gradeLevel && (\n                      <div className=\"flex items-center gap-2 text-muted-foreground\">\n                        <GraduationCap className=\"h-3.5 w-3.5 flex-shrink-0\" />\n                        <span className=\"truncate\">{gradeLevel}</span>\n                      </div>\n                    )}\n                    {content.creatorName && (\n                      <div className=\"flex items-center gap-2 text-muted-foreground\">\n                        <User className=\"h-3.5 w-3.5 flex-shrink-0\" />\n                        <span className=\"truncate\">{content.creatorName}</span>\n                      </div>\n                    )}\n                  </div>\n\n                  {content.tags && content.tags.length > 0 && (\n                    <div className=\"flex flex-wrap gap-1\">\n                      {content.tags.slice(0, 3).map((tag: string, idx: number) => (\n                        <Badge key={idx} variant=\"outline\" className=\"text-xs\">\n                          {tag}\n                        </Badge>\n                      ))}\n                      {content.tags.length > 3 && (\n                        <Badge variant=\"outline\" className=\"text-xs\">\n                          +{content.tags.length - 3}\n                        </Badge>\n                      )}\n                    </div>\n                  )}\n                  \n                  {/* Spacer to push button to bottom */}\n                  <div className=\"flex-1\"></div>\n                  \n                  <Link href={`/public/${content.id}`}>\n                    <Button className=\"w-full\" size=\"sm\" data-testid={`button-preview-${content.id}`}>\n                      <Eye className=\"h-4 w-4 mr-1\" />\n                      Preview & Use\n                    </Button>\n                  </Link>\n                </CardContent>\n              </Card>\n            );\n          })}\n        </div>\n      )}\n      </main>\n    </div>\n  );\n}\n","size_bytes":18788},"client/src/hooks/useBreadcrumbs.ts":{"content":"import { useLocation } from \"wouter\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport type { H5pContent } from \"@shared/schema\";\nimport type { BreadcrumbItem } from \"@/components/Breadcrumbs\";\nimport {\n  FileQuestion,\n  Layers,\n  Video,\n  Image as ImageIcon,\n  Move,\n  PenTool,\n  Brain,\n  BookOpenCheck,\n  Search,\n  Presentation,\n  Users,\n  BarChart3,\n  HelpCircle,\n  Share2,\n  Eye,\n} from \"lucide-react\";\n\nconst contentTypeConfig = {\n  quiz: { icon: FileQuestion, label: \"Quiz\" },\n  flashcard: { icon: Layers, label: \"Flashcard\" },\n  \"interactive-video\": { icon: Video, label: \"Interactive Video\" },\n  \"image-hotspot\": { icon: ImageIcon, label: \"Image Hotspot\" },\n  \"drag-drop\": { icon: Move, label: \"Drag & Drop\" },\n  \"fill-blanks\": { icon: PenTool, label: \"Fill in the Blanks\" },\n  \"memory-game\": { icon: Brain, label: \"Memory Game\" },\n  \"interactive-book\": { icon: BookOpenCheck, label: \"Interactive Book\" },\n  \"video-finder\": { icon: Search, label: \"Video Finder\" },\n  \"google-slides\": { icon: Presentation, label: \"Google Slides\" },\n};\n\nexport function useBreadcrumbs(contentId?: string): BreadcrumbItem[] {\n  const [location] = useLocation();\n  \n  // Fetch content details if we have a content ID\n  const { data: content } = useQuery<H5pContent>({\n    queryKey: [\"/api/content\", contentId],\n    enabled: !!contentId,\n  });\n\n  const segments = location.split(\"/\").filter(Boolean);\n  const breadcrumbs: BreadcrumbItem[] = [];\n\n  // Dashboard is the home, so we start from index 0\n  if (segments.length === 0) {\n    return breadcrumbs;\n  }\n\n  // Handle different routes\n  if (segments[0] === \"shared-resources\") {\n    breadcrumbs.push({\n      label: \"Shared Resources\",\n      icon: Users,\n    });\n  } else if (segments[0] === \"analytics\") {\n    breadcrumbs.push({\n      label: \"Analytics\",\n      icon: BarChart3,\n    });\n  } else if (segments[0] === \"help\") {\n    breadcrumbs.push({\n      label: \"Help\",\n      icon: HelpCircle,\n    });\n  } else if (segments[0] === \"create\" && segments[1]) {\n    const contentType = segments[1];\n    const config = contentTypeConfig[contentType as keyof typeof contentTypeConfig];\n    \n    if (config) {\n      breadcrumbs.push({\n        label: `Create ${config.label}`,\n        icon: config.icon,\n      });\n      \n      // If editing existing content (has ID)\n      if (segments[2] && content) {\n        breadcrumbs.push({\n          label: content.title || \"Untitled\",\n        });\n      }\n    }\n  } else if (segments[0] === \"preview\" && segments[1]) {\n    breadcrumbs.push({\n      label: \"Preview\",\n      icon: Eye,\n      href: `/preview/${segments[1]}`,\n    });\n    \n    if (content) {\n      breadcrumbs.push({\n        label: content.title || \"Untitled\",\n      });\n    }\n  } else if (segments[0] === \"share\" && segments[1]) {\n    breadcrumbs.push({\n      label: \"Share\",\n      icon: Share2,\n      href: `/share/${segments[1]}`,\n    });\n    \n    if (content) {\n      breadcrumbs.push({\n        label: content.title || \"Untitled\",\n      });\n    }\n  }\n\n  return breadcrumbs;\n}\n","size_bytes":3021},"client/src/components/ImageEditorDialog.tsx":{"content":"import { useState, useRef, useEffect } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n  DialogFooter,\n} from \"@/components/ui/dialog\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Crop, Maximize2, Lock, Unlock } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\n\ntype ImageEditorDialogProps = {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  imageUrl: string;\n  onImageEdited: (editedImageUrl: string) => void;\n};\n\nexport function ImageEditorDialog({\n  open,\n  onOpenChange,\n  imageUrl,\n  onImageEdited,\n}: ImageEditorDialogProps) {\n  const { toast } = useToast();\n  const canvasRef = useRef<HTMLCanvasElement>(null);\n  const animationFrameRef = useRef<number | null>(null);\n  const [image, setImage] = useState<HTMLImageElement | null>(null);\n  const [activeTab, setActiveTab] = useState(\"resize\");\n  \n  // Resize state\n  const [width, setWidth] = useState(0);\n  const [height, setHeight] = useState(0);\n  const [aspectRatioLocked, setAspectRatioLocked] = useState(true);\n  const [originalAspectRatio, setOriginalAspectRatio] = useState(1);\n  \n  // Crop state\n  const [cropStart, setCropStart] = useState<{ x: number; y: number } | null>(null);\n  const [cropEnd, setCropEnd] = useState<{ x: number; y: number } | null>(null);\n  const [isDragging, setIsDragging] = useState(false);\n  const cropEndRef = useRef<{ x: number; y: number } | null>(null);\n\n  // Load image when dialog opens\n  useEffect(() => {\n    if (open && imageUrl) {\n      const img = new Image();\n      img.crossOrigin = \"anonymous\";\n      img.onload = () => {\n        setImage(img);\n        setWidth(img.width);\n        setHeight(img.height);\n        setOriginalAspectRatio(img.width / img.height);\n        drawImageOnCanvas(img);\n      };\n      img.src = imageUrl;\n    }\n  }, [open, imageUrl]);\n\n  // Redraw canvas when switching to crop tab or changing crop start\n  useEffect(() => {\n    if (image && activeTab === \"crop\") {\n      drawImageOnCanvas(image);\n      if (cropStart && cropEnd) {\n        drawCropSelection();\n      }\n    }\n  }, [cropStart, activeTab]);\n\n  // Clean up animation frame on unmount\n  useEffect(() => {\n    return () => {\n      if (animationFrameRef.current !== null) {\n        cancelAnimationFrame(animationFrameRef.current);\n      }\n    };\n  }, []);\n\n  const drawImageOnCanvas = (img: HTMLImageElement) => {\n    const canvas = canvasRef.current;\n    if (!canvas) return;\n\n    const ctx = canvas.getContext(\"2d\");\n    if (!ctx) return;\n\n    // Set canvas size to fit the image while maintaining aspect ratio\n    const maxWidth = 600;\n    const maxHeight = 400;\n    let drawWidth = img.width;\n    let drawHeight = img.height;\n\n    if (drawWidth > maxWidth) {\n      drawHeight = (maxWidth / drawWidth) * drawHeight;\n      drawWidth = maxWidth;\n    }\n    if (drawHeight > maxHeight) {\n      drawWidth = (maxHeight / drawHeight) * drawWidth;\n      drawHeight = maxHeight;\n    }\n\n    canvas.width = drawWidth;\n    canvas.height = drawHeight;\n    ctx.drawImage(img, 0, 0, drawWidth, drawHeight);\n  };\n\n  const drawCropSelection = () => {\n    const canvas = canvasRef.current;\n    if (!canvas || !cropStart) return;\n\n    const currentCropEnd = cropEndRef.current || cropEnd;\n    if (!currentCropEnd) return;\n\n    const ctx = canvas.getContext(\"2d\");\n    if (!ctx) return;\n\n    const x = Math.min(cropStart.x, currentCropEnd.x);\n    const y = Math.min(cropStart.y, currentCropEnd.y);\n    const w = Math.abs(currentCropEnd.x - cropStart.x);\n    const h = Math.abs(currentCropEnd.y - cropStart.y);\n\n    // Draw semi-transparent overlay\n    ctx.fillStyle = \"rgba(0, 0, 0, 0.5)\";\n    ctx.fillRect(0, 0, canvas.width, canvas.height);\n\n    // Clear the crop area\n    ctx.clearRect(x, y, w, h);\n    if (image) {\n      const scaleX = canvas.width / image.width;\n      const scaleY = canvas.height / image.height;\n      ctx.drawImage(\n        image,\n        x / scaleX,\n        y / scaleY,\n        w / scaleX,\n        h / scaleY,\n        x,\n        y,\n        w,\n        h\n      );\n    }\n\n    // Draw crop border\n    ctx.strokeStyle = \"#3b82f6\";\n    ctx.lineWidth = 2;\n    ctx.strokeRect(x, y, w, h);\n  };\n\n  const scheduleRedraw = () => {\n    if (animationFrameRef.current !== null) {\n      return; // Already scheduled\n    }\n\n    animationFrameRef.current = requestAnimationFrame(() => {\n      animationFrameRef.current = null;\n      if (image && activeTab === \"crop\" && cropStart) {\n        drawImageOnCanvas(image);\n        drawCropSelection();\n      }\n    });\n  };\n\n  const handleCanvasMouseDown = (e: React.MouseEvent<HTMLCanvasElement>) => {\n    if (activeTab !== \"crop\") return;\n    \n    const canvas = canvasRef.current;\n    if (!canvas) return;\n\n    const rect = canvas.getBoundingClientRect();\n    const x = e.clientX - rect.left;\n    const y = e.clientY - rect.top;\n\n    const newPos = { x, y };\n    setCropStart(newPos);\n    setCropEnd(newPos);\n    cropEndRef.current = newPos;\n    setIsDragging(true);\n  };\n\n  const handleCanvasMouseMove = (e: React.MouseEvent<HTMLCanvasElement>) => {\n    if (!isDragging || activeTab !== \"crop\") return;\n\n    const canvas = canvasRef.current;\n    if (!canvas) return;\n\n    const rect = canvas.getBoundingClientRect();\n    const x = e.clientX - rect.left;\n    const y = e.clientY - rect.top;\n\n    // Store in ref for smooth rendering\n    cropEndRef.current = { x, y };\n    \n    // Schedule a redraw (throttled to one per frame)\n    scheduleRedraw();\n  };\n\n  const handleCanvasMouseUp = () => {\n    if (cropEndRef.current) {\n      // Save final position to state\n      setCropEnd(cropEndRef.current);\n    }\n    setIsDragging(false);\n  };\n\n  const handleWidthChange = (newWidth: number) => {\n    setWidth(newWidth);\n    if (aspectRatioLocked) {\n      setHeight(Math.round(newWidth / originalAspectRatio));\n    }\n  };\n\n  const handleHeightChange = (newHeight: number) => {\n    setHeight(newHeight);\n    if (aspectRatioLocked) {\n      setWidth(Math.round(newHeight * originalAspectRatio));\n    }\n  };\n\n  const applyResize = () => {\n    if (!image) return null;\n\n    try {\n      const canvas = document.createElement(\"canvas\");\n      canvas.width = width;\n      canvas.height = height;\n      const ctx = canvas.getContext(\"2d\");\n      if (!ctx) return null;\n\n      ctx.drawImage(image, 0, 0, width, height);\n      return canvas.toDataURL(\"image/png\");\n    } catch (error) {\n      // Canvas is tainted by CORS (external URL without proper headers)\n      toast({\n        title: \"Cannot edit external image\",\n        description: \"This image cannot be edited due to CORS restrictions. Using original image.\",\n      });\n      return imageUrl;\n    }\n  };\n\n  const applyCrop = () => {\n    if (!image || !cropStart || !cropEnd || !canvasRef.current) return null;\n\n    const canvas = canvasRef.current;\n    const scaleX = image.width / canvas.width;\n    const scaleY = image.height / canvas.height;\n\n    const x = Math.min(cropStart.x, cropEnd.x) * scaleX;\n    const y = Math.min(cropStart.y, cropEnd.y) * scaleY;\n    const w = Math.abs(cropEnd.x - cropStart.x) * scaleX;\n    const h = Math.abs(cropEnd.y - cropStart.y) * scaleY;\n\n    if (w < 1 || h < 1) {\n      toast({\n        title: \"Invalid crop area\",\n        description: \"Please select a larger area to crop.\",\n        variant: \"destructive\",\n      });\n      return null;\n    }\n\n    try {\n      const cropCanvas = document.createElement(\"canvas\");\n      cropCanvas.width = w;\n      cropCanvas.height = h;\n      const ctx = cropCanvas.getContext(\"2d\");\n      if (!ctx) return null;\n\n      ctx.drawImage(image, x, y, w, h, 0, 0, w, h);\n      return cropCanvas.toDataURL(\"image/png\");\n    } catch (error) {\n      // Canvas is tainted by CORS (external URL without proper headers)\n      toast({\n        title: \"Cannot crop external image\",\n        description: \"This image cannot be cropped due to CORS restrictions. Using original image.\",\n      });\n      return imageUrl;\n    }\n  };\n\n  const handleApply = () => {\n    let editedImageUrl: string | null = null;\n\n    if (activeTab === \"resize\") {\n      editedImageUrl = applyResize();\n    } else if (activeTab === \"crop\") {\n      editedImageUrl = applyCrop();\n    }\n\n    if (editedImageUrl) {\n      onImageEdited(editedImageUrl);\n      handleClose();\n    }\n  };\n\n  const handleSkip = () => {\n    onImageEdited(imageUrl);\n    handleClose();\n  };\n\n  const handleClose = () => {\n    setCropStart(null);\n    setCropEnd(null);\n    setIsDragging(false);\n    setActiveTab(\"resize\");\n    onOpenChange(false);\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={handleClose}>\n      <DialogContent className=\"max-w-3xl max-h-[90vh] flex flex-col\">\n        <DialogHeader>\n          <DialogTitle className=\"flex items-center gap-2\">\n            <Crop className=\"h-5 w-5 text-primary\" />\n            Edit Image\n          </DialogTitle>\n          <DialogDescription>\n            Resize or crop your image before inserting it into the document.\n          </DialogDescription>\n        </DialogHeader>\n\n        <Tabs value={activeTab} onValueChange={setActiveTab} className=\"flex-1 flex flex-col overflow-hidden\">\n          <TabsList className=\"grid w-full grid-cols-2\">\n            <TabsTrigger value=\"resize\" data-testid=\"tab-resize\">\n              <Maximize2 className=\"h-4 w-4 mr-2\" />\n              Resize\n            </TabsTrigger>\n            <TabsTrigger value=\"crop\" data-testid=\"tab-crop\">\n              <Crop className=\"h-4 w-4 mr-2\" />\n              Crop\n            </TabsTrigger>\n          </TabsList>\n\n          <div className=\"flex-1 overflow-y-auto py-4\">\n            <TabsContent value=\"resize\" className=\"space-y-4 mt-0\">\n              <div className=\"flex items-center gap-4\">\n                <div className=\"flex-1\">\n                  <Label htmlFor=\"width\">Width (px)</Label>\n                  <Input\n                    id=\"width\"\n                    type=\"number\"\n                    value={width}\n                    onChange={(e) => handleWidthChange(Number(e.target.value))}\n                    min={1}\n                    data-testid=\"input-width\"\n                  />\n                </div>\n                <Button\n                  variant=\"outline\"\n                  size=\"icon\"\n                  onClick={() => setAspectRatioLocked(!aspectRatioLocked)}\n                  className=\"mt-6\"\n                  data-testid=\"button-lock-aspect\"\n                >\n                  {aspectRatioLocked ? <Lock className=\"h-4 w-4\" /> : <Unlock className=\"h-4 w-4\" />}\n                </Button>\n                <div className=\"flex-1\">\n                  <Label htmlFor=\"height\">Height (px)</Label>\n                  <Input\n                    id=\"height\"\n                    type=\"number\"\n                    value={height}\n                    onChange={(e) => handleHeightChange(Number(e.target.value))}\n                    min={1}\n                    data-testid=\"input-height\"\n                  />\n                </div>\n              </div>\n              <p className=\"text-sm text-muted-foreground\">\n                {aspectRatioLocked ? \"Aspect ratio locked\" : \"Aspect ratio unlocked\"} • Original: {image?.width} × {image?.height}\n              </p>\n              <div className=\"border rounded-lg overflow-hidden bg-muted/50 flex items-center justify-center p-4\">\n                <canvas ref={canvasRef} className=\"max-w-full\" />\n              </div>\n            </TabsContent>\n\n            <TabsContent value=\"crop\" className=\"space-y-4 mt-0\">\n              <p className=\"text-sm text-muted-foreground\">\n                Click and drag on the image to select the area you want to keep.\n              </p>\n              <div className=\"border rounded-lg overflow-hidden bg-muted/50 flex items-center justify-center p-4\">\n                <canvas\n                  ref={canvasRef}\n                  className=\"max-w-full cursor-crosshair\"\n                  onMouseDown={handleCanvasMouseDown}\n                  onMouseMove={handleCanvasMouseMove}\n                  onMouseUp={handleCanvasMouseUp}\n                  onMouseLeave={handleCanvasMouseUp}\n                  data-testid=\"canvas-crop\"\n                />\n              </div>\n              {cropStart && cropEnd && (\n                <p className=\"text-sm text-muted-foreground\">\n                  Selection: {Math.abs(Math.round((cropEnd.x - cropStart.x) * (image?.width || 1) / (canvasRef.current?.width || 1)))} × {Math.abs(Math.round((cropEnd.y - cropStart.y) * (image?.height || 1) / (canvasRef.current?.height || 1)))} px\n                </p>\n              )}\n            </TabsContent>\n          </div>\n        </Tabs>\n\n        <DialogFooter>\n          <Button variant=\"outline\" onClick={handleSkip} data-testid=\"button-skip-editing\">\n            Skip Editing\n          </Button>\n          <Button onClick={handleApply} data-testid=\"button-apply-edit\">\n            Apply & Insert\n          </Button>\n        </DialogFooter>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","size_bytes":13135},"client/src/components/Breadcrumbs.tsx":{"content":"import { ChevronRight, Home } from \"lucide-react\";\nimport { Link } from \"wouter\";\n\nexport type BreadcrumbItem = {\n  label: string;\n  href?: string;\n  icon?: React.ComponentType<{ className?: string }>;\n};\n\ntype BreadcrumbsProps = {\n  items: BreadcrumbItem[];\n};\n\nexport function Breadcrumbs({ items }: BreadcrumbsProps) {\n  if (items.length === 0) return null;\n\n  return (\n    <nav aria-label=\"Breadcrumb\" className=\"flex items-center gap-2 text-sm\">\n      <Link \n        href=\"/dashboard\" \n        className=\"flex items-center gap-1 text-muted-foreground hover-elevate rounded-md px-2 py-1 transition-colors\"\n        data-testid=\"breadcrumb-home\"\n      >\n        <Home className=\"h-4 w-4\" />\n        <span>Home</span>\n      </Link>\n      \n      {items.map((item, index) => {\n        const isLast = index === items.length - 1;\n        const Icon = item.icon;\n        \n        return (\n          <div key={index} className=\"flex items-center gap-2\">\n            <ChevronRight className=\"h-4 w-4 text-muted-foreground\" aria-hidden=\"true\" />\n            {item.href && !isLast ? (\n              <Link\n                href={item.href}\n                className=\"flex items-center gap-1 text-muted-foreground hover-elevate rounded-md px-2 py-1 transition-colors\"\n                data-testid={`breadcrumb-${item.label.toLowerCase().replace(/\\s+/g, \"-\")}`}\n              >\n                {Icon && <Icon className=\"h-4 w-4\" />}\n                <span>{item.label}</span>\n              </Link>\n            ) : (\n              <span \n                className=\"flex items-center gap-1 font-medium text-foreground px-2 py-1\"\n                aria-current={isLast ? \"page\" : undefined}\n                data-testid={`breadcrumb-${item.label.toLowerCase().replace(/\\s+/g, \"-\")}`}\n              >\n                {Icon && <Icon className=\"h-4 w-4\" />}\n                <span>{item.label}</span>\n              </span>\n            )}\n          </div>\n        );\n      })}\n    </nav>\n  );\n}\n","size_bytes":1970},"client/src/components/ImageGeneratorDialog.tsx":{"content":"import { useState } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n  DialogFooter,\n} from \"@/components/ui/dialog\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { Loader2, Sparkles, Zap } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\n\ndeclare global {\n  interface Window {\n    puter?: {\n      ai: {\n        txt2img: (prompt: string, options?: { model?: string }) => Promise<HTMLImageElement>;\n      };\n    };\n  }\n}\n\ntype ImageProvider = \"puterjs\" | \"openai\";\n\ntype ImageGeneratorDialogProps = {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  onImageGenerated: (imageUrl: string) => void;\n};\n\nexport function ImageGeneratorDialog({ \n  open, \n  onOpenChange, \n  onImageGenerated \n}: ImageGeneratorDialogProps) {\n  const { toast } = useToast();\n  const [prompt, setPrompt] = useState(\"\");\n  const [isGenerating, setIsGenerating] = useState(false);\n  const [generatedImage, setGeneratedImage] = useState<string | null>(null);\n  const [provider, setProvider] = useState<ImageProvider>(\"puterjs\");\n  const [openaiAvailable, setOpenaiAvailable] = useState<boolean>(true);\n\n  const generateWithPuterJS = async () => {\n    if (!window.puter) {\n      throw new Error(\"Puter.js is not loaded. Please refresh the page or try OpenAI provider.\");\n    }\n\n    try {\n      const imageElement = await window.puter.ai.txt2img(prompt, {\n        model: \"gpt-image-1\"\n      });\n      \n      return imageElement.src;\n    } catch (error: any) {\n      console.error(\"Puter.js generation error:\", error);\n      throw new Error(\"Failed to generate image with Puter.js. Try refreshing the page or using OpenAI provider.\");\n    }\n  };\n\n  const generateWithOpenAI = async () => {\n    const response = await fetch(\"/api/ai/generate-image\", {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n      },\n      body: JSON.stringify({ prompt }),\n    });\n\n    const data = await response.json();\n\n    if (!response.ok) {\n      if (response.status === 400 && data.message?.includes(\"not configured\")) {\n        setOpenaiAvailable(false);\n        setProvider(\"puterjs\");\n        throw new Error(\"OpenAI API key not configured. Switching to free Puter.js provider.\");\n      }\n      throw new Error(data.message || \"Failed to generate image\");\n    }\n\n    return data.imageUrl;\n  };\n\n  const generateImage = async () => {\n    if (!prompt.trim()) {\n      toast({\n        title: \"Prompt required\",\n        description: \"Please enter a description of the image you want to generate.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    setIsGenerating(true);\n    setGeneratedImage(null);\n\n    try {\n      let imageUrl: string;\n      \n      if (provider === \"puterjs\") {\n        try {\n          imageUrl = await generateWithPuterJS();\n        } catch (puterError: any) {\n          if (!window.puter && openaiAvailable) {\n            toast({\n              title: \"Puter.js unavailable\",\n              description: \"Switching to OpenAI provider...\",\n            });\n            setProvider(\"openai\");\n            imageUrl = await generateWithOpenAI();\n          } else {\n            throw puterError;\n          }\n        }\n      } else {\n        imageUrl = await generateWithOpenAI();\n      }\n\n      setGeneratedImage(imageUrl);\n      \n      toast({\n        title: \"Image generated!\",\n        description: `Your AI-generated image is ready.`,\n      });\n    } catch (error: any) {\n      toast({\n        title: \"Generation failed\",\n        description: error.message || \"Failed to generate image. Please try again.\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsGenerating(false);\n    }\n  };\n\n  const insertImage = () => {\n    if (generatedImage) {\n      onImageGenerated(generatedImage);\n      setPrompt(\"\");\n      setGeneratedImage(null);\n      onOpenChange(false);\n    }\n  };\n\n  const handleOpenChange = (isOpen: boolean) => {\n    if (!isOpen) {\n      setPrompt(\"\");\n      setGeneratedImage(null);\n    }\n    onOpenChange(isOpen);\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={handleOpenChange}>\n      <DialogContent className=\"max-w-2xl max-h-[90vh] flex flex-col\">\n        <DialogHeader>\n          <DialogTitle className=\"flex items-center gap-2\">\n            <Sparkles className=\"h-5 w-5 text-primary\" />\n            AI Image Generator\n          </DialogTitle>\n          <DialogDescription>\n            Generate custom images using AI from text descriptions. Choose between free Puter.js or premium OpenAI DALL-E 3.\n          </DialogDescription>\n        </DialogHeader>\n        \n        <div className=\"space-y-4 py-4 overflow-y-auto flex-1\">\n          <div>\n            <Label htmlFor=\"provider-select\">AI Provider</Label>\n            <Select\n              value={provider}\n              onValueChange={(value: ImageProvider) => setProvider(value)}\n              disabled={isGenerating}\n            >\n              <SelectTrigger id=\"provider-select\" data-testid=\"select-provider\">\n                <SelectValue />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"puterjs\">\n                  <div className=\"flex items-center gap-2\">\n                    <Zap className=\"h-4 w-4 text-green-500\" />\n                    <span>Puter.js - Free (Recommended)</span>\n                  </div>\n                </SelectItem>\n                <SelectItem value=\"openai\" disabled={!openaiAvailable}>\n                  <div className=\"flex items-center gap-2\">\n                    <Sparkles className=\"h-4 w-4 text-purple-500\" />\n                    <span>OpenAI DALL-E 3 - Premium{!openaiAvailable ? \" (Unavailable)\" : \"\"}</span>\n                  </div>\n                </SelectItem>\n              </SelectContent>\n            </Select>\n            <p className=\"text-xs text-muted-foreground mt-1\">\n              {provider === \"puterjs\" \n                ? \"Free, unlimited image generation with no API key required\"\n                : openaiAvailable\n                  ? \"High-quality images (requires OPENAI_API_KEY)\"\n                  : \"OpenAI unavailable - API key not configured\"}\n            </p>\n          </div>\n\n          <div>\n            <Label htmlFor=\"image-prompt\">Describe the image you want</Label>\n            <Input\n              id=\"image-prompt\"\n              value={prompt}\n              onChange={(e) => setPrompt(e.target.value)}\n              placeholder=\"e.g., A peaceful Caribbean beach at sunset with palm trees\"\n              onKeyDown={(e) => {\n                if (e.key === 'Enter' && !isGenerating) {\n                  generateImage();\n                }\n              }}\n              disabled={isGenerating}\n              data-testid=\"input-image-prompt\"\n            />\n            <p className=\"text-sm text-muted-foreground mt-2\">\n              Be specific and descriptive for best results\n            </p>\n          </div>\n\n          {isGenerating && (\n            <div className=\"flex items-center justify-center py-8\">\n              <div className=\"text-center space-y-2\">\n                <Loader2 className=\"h-8 w-8 animate-spin mx-auto text-primary\" />\n                <p className=\"text-sm text-muted-foreground\">\n                  Generating your image... This may take a moment.\n                </p>\n              </div>\n            </div>\n          )}\n\n          {generatedImage && !isGenerating && (\n            <div className=\"space-y-2\">\n              <Label>Generated Image</Label>\n              <div className=\"border rounded-lg overflow-hidden bg-muted/50\">\n                <img \n                  src={generatedImage} \n                  alt={prompt}\n                  className=\"w-full h-auto\"\n                  data-testid=\"img-generated\"\n                />\n              </div>\n              <p className=\"text-xs text-muted-foreground\">\n                {provider === \"puterjs\" \n                  ? \"Powered by Puter.js • Free AI Image Generation\"\n                  : \"Powered by OpenAI DALL-E 3 • Premium AI Image Generation\"}\n              </p>\n            </div>\n          )}\n        </div>\n\n        <DialogFooter>\n          <Button\n            variant=\"outline\"\n            onClick={() => handleOpenChange(false)}\n            disabled={isGenerating}\n            data-testid=\"button-cancel\"\n          >\n            Cancel\n          </Button>\n          {!generatedImage ? (\n            <Button\n              onClick={generateImage}\n              disabled={isGenerating || !prompt.trim()}\n              data-testid=\"button-generate\"\n            >\n              {isGenerating ? (\n                <>\n                  <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\n                  Generating...\n                </>\n              ) : (\n                <>\n                  <Sparkles className=\"h-4 w-4 mr-2\" />\n                  Generate Image\n                </>\n              )}\n            </Button>\n          ) : (\n            <Button\n              onClick={insertImage}\n              data-testid=\"button-insert-generated\"\n            >\n              Insert Image\n            </Button>\n          )}\n        </DialogFooter>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","size_bytes":9412}},"version":2}